<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Private Aggregation API</title>
  <meta content="UD" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-UD" rel="stylesheet">
  <meta content="Bikeshed version d765c696b, updated Fri Mar 8 15:58:52 2024 -0800" name="generator">
  <link href="https://patcg-individual-drafts.github.io/private-aggregation-api" rel="canonical">
  <meta content="9a96b2bc62a63cc5e1bc4b0570625caaf4edf6f7" name="revision">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-idl-highlighting */
pre.idl.highlight {
    background: var(--borderedblock-bg, var(--def-bg));
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)
*/
[data-algorithm] var { cursor: pointer; }
var[data-var-color="0"] { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
var[data-var-color="1"] { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
var[data-var-color="2"] { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
var[data-var-color="3"] { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
var[data-var-color="4"] { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
var[data-var-color="5"] { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
var[data-var-color="6"] { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Private Aggregation API</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#UD">Unofficial Proposal Draft</a>, <time class="dt-updated" datetime="2024-03-29">29 March 2024</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://patcg-individual-drafts.github.io/private-aggregation-api">https://patcg-individual-drafts.github.io/private-aggregation-api</a>
      <dt>Issue Tracking:
      <dd><a href="https://github.com/patcg-individual-drafts/private-aggregation-api/issues/">GitHub</a>
      <dd><a href="#issues-index">Inline In Spec</a>
      <dt class="editor">Editor:
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:alexmt@chromium.org">Alexander Turner</a> (<a class="p-org org" href="https://www.google.com">Google</a>)
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 2024 the Contributors to “Private Aggregation API”.

This document is licensed under the <a href="https://www.w3.org/copyright/software-license/">W3C Software License</a>.

Contributions to this document are made under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>A generic API for measuring aggregate, cross-site data in a privacy
preserving manner. The potentially identifying cross-site data is
encapsulated into <em>aggregatable reports</em>. To prevent leakage, this
data is encrypted, ensuring it can only be processed by an <em>aggregation
service</em>. During processing, this service will add noise and impose
limits on how many queries can be performed.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p>This document is an individual draft proposal. It has not been adopted by the <a href="https://patcg.github.io/">Private Advertising Technology Community Group</a>, but it may be discussed in that CG’s meetings.
Please note that under the <a href="http://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.
Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#motivation"><span class="secno">1.1</span> <span class="content">Motivation</span></a>
      <li><a href="#overview"><span class="secno">1.2</span> <span class="content">Overview</span></a>
      <li><a href="#alternative-considered"><span class="secno">1.3</span> <span class="content">Alternative considered</span></a>
     </ol>
    <li><a href="#exposed-interface"><span class="secno">2</span> <span class="content">Exposed interface</span></a>
    <li><a href="#exposing"><span class="secno">3</span> <span class="content">Exposing to global scopes</span></a>
    <li>
     <a href="#structures"><span class="secno">4</span> <span class="content">Structures</span></a>
     <ol class="toc">
      <li><a href="#batching-scope"><span class="secno">4.1</span> <span class="content">Batching scope</span></a>
      <li><a href="#debug-scope"><span class="secno">4.2</span> <span class="content">Debug scope</span></a>
      <li><a href="#scoping-details"><span class="secno">4.3</span> <span class="content">Scoping details</span></a>
      <li><a href="#debug-details"><span class="secno">4.4</span> <span class="content">Debug details</span></a>
      <li><a href="#contribution-cache-entry"><span class="secno">4.5</span> <span class="content">Contribution cache entry</span></a>
      <li><a href="#aggregatable-report"><span class="secno">4.6</span> <span class="content">Aggregatable report</span></a>
      <li><a href="#aggregation-coordinator-structure"><span class="secno">4.7</span> <span class="content">Aggregation coordinator</span></a>
      <li><a href="#context-type"><span class="secno">4.8</span> <span class="content">Context type</span></a>
      <li><a href="#pre-specified-report-parameters-structure"><span class="secno">4.9</span> <span class="content">Pre-specified report parameters</span></a>
     </ol>
    <li>
     <a href="#storage"><span class="secno">5</span> <span class="content">Storage</span></a>
     <ol class="toc">
      <li><a href="#clearing-storage"><span class="secno">5.1</span> <span class="content">Clearing storage</span></a>
     </ol>
    <li><a href="#implementation-defined-values"><span class="secno">6</span> <span class="content"><span>Implementation-defined</span> values</span></a>
    <li><a href="#permissions-policy-integration"><span class="secno">7</span> <span class="content">Permissions Policy integration</span></a>
    <li>
     <a href="#algorithms"><span class="secno">8</span> <span class="content">Algorithms</span></a>
     <ol class="toc">
      <li><a href="#exported-algorithms"><span class="secno">8.1</span> <span class="content">Exported algorithms</span></a>
      <li><a href="#scheduling-reports"><span class="secno">8.2</span> <span class="content">Scheduling reports</span></a>
      <li><a href="#sending-reports"><span class="secno">8.3</span> <span class="content">Sending reports</span></a>
      <li><a href="#serializing-reports"><span class="secno">8.4</span> <span class="content">Serializing reports</span></a>
     </ol>
    <li>
     <a href="#user-agent-automation"><span class="secno">9</span> <span class="content">User-agent automation</span></a>
     <ol class="toc">
      <li><a href="#set-local-testing-mode"><span class="secno">9.1</span> <span class="content">Set local testing mode</span></a>
     </ol>
    <li><a href="#shared-storage-api-monkey-patches"><span class="secno">10</span> <span class="content">Shared Storage API monkey patches</span></a>
    <li>
     <a href="#protected-audience-api-monkey-patches"><span class="secno">11</span> <span class="content">Protected Audience API monkey patches</span></a>
     <ol class="toc">
      <li><a href="#protected-audience-api-specific-webidl"><span class="secno">11.1</span> <span class="content">New WebIDL</span></a>
      <li><a href="#protected-audience-api-webidl-modifications"><span class="secno">11.2</span> <span class="content">WebIDL modifications</span></a>
      <li>
       <a href="#protected-audience-api-specific-structures"><span class="secno">11.3</span> <span class="content">Structures</span></a>
       <ol class="toc">
        <li><a href="#extending-auction-config"><span class="secno">11.3.1</span> <span class="content">Extending auction config</span></a>
        <li><a href="#extending-interest-group"><span class="secno">11.3.2</span> <span class="content">Extending interest group</span></a>
        <li><a href="#permissions-policy-state"><span class="secno">11.3.3</span> <span class="content">Permissions policy state</span></a>
        <li><a href="#signal-base-value"><span class="secno">11.3.4</span> <span class="content">Signal base value</span></a>
        <li><a href="#worklet-function"><span class="secno">11.3.5</span> <span class="content">Worklet function</span></a>
        <li><a href="#on-event-contribution-cache-entry"><span class="secno">11.3.6</span> <span class="content">On event contribution cache entry</span></a>
        <li><a href="#on-event-contribution-cache"><span class="secno">11.3.7</span> <span class="content">On event contribution cache</span></a>
        <li><a href="#extending-interestgroupscriptrunnerglobalscope"><span class="secno">11.3.8</span> <span class="content">Extending
InterestGroupScriptRunnerGlobalScope</span></a>
        <li><a href="#extending-interestgroupreportingscriptrunnerglobalscope"><span class="secno">11.3.9</span> <span class="content">Extending
InterestGroupReportingScriptRunnerGlobalScope</span></a>
       </ol>
      <li><a href="#protected-audience-api-algorithm-modifications"><span class="secno">11.4</span> <span class="content">Algorithm modifications</span></a>
      <li><a href="#protected-audience-api-specific-new-algorithms"><span class="secno">11.5</span> <span class="content">New algorithms</span></a>
     </ol>
    <li>
     <a href="#privacy-considerations"><span class="secno">12</span> <span class="content">Privacy considerations</span></a>
     <ol class="toc">
      <li>
       <a href="#cross-site-information-disclosure"><span class="secno">12.1</span> <span class="content">Cross-site information disclosure</span></a>
       <ol class="toc">
        <li><a href="#restricted-contribution-processing"><span class="secno">12.1.1</span> <span class="content">Restricted contribution processing</span></a>
        <li><a href="#unencrypted-metadata"><span class="secno">12.1.2</span> <span class="content">Unencrypted metadata</span></a>
        <li><a href="#protecting-against-leaks-via-the-number-of-reports"><span class="secno">12.1.3</span> <span class="content">Protecting against leaks via the number of reports</span></a>
        <li><a href="#protecting-against-leaks-via-payload-size"><span class="secno">12.1.4</span> <span class="content">Protecting against leaks via payload size</span></a>
        <li><a href="#temporary-debugging-mechanism"><span class="secno">12.1.5</span> <span class="content">Temporary debugging mechanism</span></a>
        <li><a href="#privacy-parameters"><span class="secno">12.1.6</span> <span class="content">Privacy parameters</span></a>
       </ol>
      <li><a href="#clearing-site-data"><span class="secno">12.2</span> <span class="content">Clearing site data</span></a>
      <li>
       <a href="#reporting-delay-concerns"><span class="secno">12.3</span> <span class="content">Reporting delay concerns</span></a>
       <ol class="toc">
        <li><a href="#cross-network-reporting-origin-leakage"><span class="secno">12.3.1</span> <span class="content">Cross-network reporting origin leakage</span></a>
        <li><a href="#user-presence-tracking"><span class="secno">12.3.2</span> <span class="content">User-presence tracking</span></a>
       </ol>
     </ol>
    <li>
     <a href="#security-considerations"><span class="secno">13</span> <span class="content">Security considerations</span></a>
     <ol class="toc">
      <li><a href="#same-origin-policy"><span class="secno">13.1</span> <span class="content">Same-origin policy</span></a>
      <li><a href="#protecting-the-histogram-contributions"><span class="secno">13.2</span> <span class="content">Protecting the histogram contributions</span></a>
     </ol>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <h3 class="heading settled" data-level="1.1" id="motivation"><span class="secno">1.1. </span><span class="content">Motivation</span><a class="self-link" href="#motivation"></a></h3>
   <p>Browsers are now working to prevent cross-site user tracking, including by
partitioning storage and removing third-party cookies. There are a range of API
proposals to continue supporting legitimate use cases in a way that respects
user privacy. Many of these APIs, including the <a href="https://wicg.github.io/shared-storage/">Shared Storage API</a> and the <a href="https://wicg.github.io/turtledove/">Protected Audience API</a>, isolate
potentially identifying cross-site data in special contexts, which ensures that
the data cannot escape the user agent.</p>
   <p>Relative to cross-site data from an individual user, aggregate data about groups
of users can be less sensitive and yet would be sufficient for a wide range of
use cases. An aggregation service has been built to allow reporting noisy,
aggregated cross-site data. This service was originally created for use by the <a href="https://wicg.github.io/attribution-reporting-api/">Attribution
Reporting API</a>, but allowing more general aggregation supports additional use
cases. In particular, the Protected Audience and Shared Storage APIs expect this
functionality to be available.</p>
   <h3 class="heading settled" data-level="1.2" id="overview"><span class="secno">1.2. </span><span class="content">Overview</span><a class="self-link" href="#overview"></a></h3>
   <p>This document oulines a general-purpose API that can be called from isolated
contexts that have access to cross-site data (such as a Shared Storage worklet).
Within these contexts, potentially identifying data can be encapsulated into
"aggregatable reports". To prevent leakage, the cross-site data in these reports
is encrypted to ensure it can only be processed by the aggregation service.
During processing, this service adds noise and imposes limits on how many
queries can be performed.</p>
   <p>This API provides functions that allow the origin to construct an aggregatable
report and specify the values to be embedded into its encrypted payload (for
later computation via the aggregation service). These calls result in the
aggregatable report being queued to be sent to the reporting endpoint of the
script’s origin after a delay. After the endpoint receives the reports, it will
batch the reports and send them to the aggregation service for processing. The
output of that process is a summary report containing the (approximate) result,
which is dispatched back to the script’s origin.</p>
   <h3 class="heading settled" data-level="1.3" id="alternative-considered"><span class="secno">1.3. </span><span class="content">Alternative considered</span><a class="self-link" href="#alternative-considered"></a></h3>
   <p>Instead of the chosen API shape, we considered aligning with a design that is
much closer to <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#dom-global-fetch" id="ref-for-dom-global-fetch">fetch()</a></code>. However, there are a few
key differences which make this unfavorable:</p>
   <ul>
    <li data-md>
     <p>This API is designed to be used in isolated contexts where <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#dom-global-fetch" id="ref-for-dom-global-fetch①">fetch()</a></code> is not available.</p>
    <li data-md>
     <p>It’s an anti-goal to give the developer control over when <a data-link-type="dfn" href="#aggregatable-report" id="ref-for-aggregatable-report">aggregatable
reports</a> are being sent or knowledge that they were sent (outside of the
isolated context). Note, however, the exception when providing a context ID
from <em>outside</em> the isolated context, see <a href="#protecting-against-leaks-via-the-number-of-reports">Protecting against leaks
via the number of
reports</a> below.</p>
    <li data-md>
     <p>The reports cannot be sent to arbitrary reporting endpoints, only a
particular <code><a data-link-type="biblio" href="#biblio-rfc8615" title="Well-Known Uniform Resource Identifiers (URIs)">.well-known</a></code> path on the script origin.</p>
    <li data-md>
     <p>The report’s input is very specific (an array of <code class="idl"><a data-link-type="idl" href="#dictdef-pahistogramcontribution" id="ref-for-dictdef-pahistogramcontribution">PAHistogramContribution</a></code>s)
and is not amenable to <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#dom-global-fetch" id="ref-for-dom-global-fetch②">fetch()</a></code>'s general
purpose contents.</p>
    <li data-md>
     <p>There is no concept of a response.</p>
   </ul>
   <p>So, we chose the more tailored API shape detailed below.</p>
   <h2 class="heading settled" data-level="2" id="exposed-interface"><span class="secno">2. </span><span class="content">Exposed interface</span><a class="self-link" href="#exposed-interface"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>InterestGroupScriptRunnerGlobalScope</c->,<c- n>SharedStorageWorklet</c->),
 <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="privateaggregation"><code><c- g>PrivateAggregation</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-privateaggregation-contributetohistogram" id="ref-for-dom-privateaggregation-contributetohistogram"><c- g>contributeToHistogram</c-></a>(<a data-link-type="idl-name" href="#dictdef-pahistogramcontribution" id="ref-for-dictdef-pahistogramcontribution①"><c- n>PAHistogramContribution</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAggregation/contributeToHistogram(contribution)" data-dfn-type="argument" data-export id="dom-privateaggregation-contributetohistogram-contribution-contribution"><code><c- g>contribution</c-></code></dfn>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined①"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-privateaggregation-enabledebugmode" id="ref-for-dom-privateaggregation-enabledebugmode"><c- g>enableDebugMode</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-padebugmodeoptions" id="ref-for-dictdef-padebugmodeoptions"><c- n>PADebugModeOptions</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAggregation/enableDebugMode(options), PrivateAggregation/enableDebugMode()" data-dfn-type="argument" data-export id="dom-privateaggregation-enabledebugmode-options-options"><code><c- g>options</c-></code></dfn> = {});
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-pahistogramcontribution"><code><c- g>PAHistogramContribution</c-></code></dfn> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint" id="ref-for-idl-bigint"><c- b>bigint</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PAHistogramContribution" data-dfn-type="dict-member" data-export data-type="bigint" id="dom-pahistogramcontribution-bucket"><code><c- g>bucket</c-></code></dfn>;
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long" id="ref-for-idl-long"><c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PAHistogramContribution" data-dfn-type="dict-member" data-export data-type="long" id="dom-pahistogramcontribution-value"><code><c- g>value</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint" id="ref-for-idl-bigint①"><c- b>bigint</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PAHistogramContribution" data-dfn-type="dict-member" data-export data-type="bigint" id="dom-pahistogramcontribution-filteringid"><code><c- g>filteringId</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-padebugmodeoptions"><code><c- g>PADebugModeOptions</c-></code></dfn> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint" id="ref-for-idl-bigint②"><c- b>bigint</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PADebugModeOptions" data-dfn-type="dict-member" data-export data-type="bigint" id="dom-padebugmodeoptions-debugkey"><code><c- g>debugKey</c-></code></dfn>;
};
</pre>
   <p class="issue" id="issue-e92da1fd"><a class="self-link" href="#issue-e92da1fd"></a> Per the <a href="https://www.w3.org/TR/design-principles/#numeric-types"> Web Platform Design Principles</a>, we should consider switching <code>long</code> to <code>[EnforceRange] long long</code>.</p>
   <p class="issue" id="issue-3dccb76e"><a class="self-link" href="#issue-3dccb76e"></a> <code class="idl"><a data-link-type="idl" href="#dom-privateaggregation-enabledebugmode" id="ref-for-dom-privateaggregation-enabledebugmode①">enableDebugMode(options)</a></code>'s argument should not
    have a default value of <code>{}</code>. Alternatively, <code class="idl"><a data-link-type="idl" href="#dom-padebugmodeoptions-debugkey" id="ref-for-dom-padebugmodeoptions-debugkey">debugKey</a></code> should not be required in <code class="idl"><a data-link-type="idl" href="#dictdef-padebugmodeoptions" id="ref-for-dictdef-padebugmodeoptions①">PADebugModeOptions</a></code>.</p>
   <p>Each <code class="idl"><a data-link-type="idl" href="#privateaggregation" id="ref-for-privateaggregation">PrivateAggregation</a></code> object has the following fields:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="PrivateAggregation" data-dfn-type="dfn" data-noexport id="privateaggregation-scoping-details">scoping details</dfn> (default null)
    <dd data-md>
     <p>A <a data-link-type="dfn" href="#scoping-details" id="ref-for-scoping-details">scoping details</a> or null</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="PrivateAggregation" data-dfn-type="dfn" data-noexport id="privateaggregation-allowed-to-use">allowed to use</dfn> (default false)
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean">boolean</a></p>
   </dl>
   <p class="note" role="note"><span class="marker">Note:</span> See <a href="#exposing">Exposing to global scopes</a> below.</p>
   <div class="algorithm" data-algorithm="contributeToHistogram(PAHistogramContribution contribution)" data-algorithm-for="PrivateAggregation"> The <dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAggregation" data-dfn-type="method" data-export data-lt="contributeToHistogram(contribution)" id="dom-privateaggregation-contributetohistogram"><code> contributeToHistogram(PAHistogramContribution contribution)</code></dfn> method steps
are: </div>
   <ol>
    <li data-md>
     <p>If <var>contribution</var>["<code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-bucket" id="ref-for-dom-pahistogramcontribution-bucket">bucket</a></code>"] is not in the range
[0, 2<sup>128</sup>−1], <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw">throw</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror">RangeError</a></code>.</p>
    <li data-md>
     <p>If <var>contribution</var>["<code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-value" id="ref-for-dom-pahistogramcontribution-value">value</a></code>"] is negative, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①">throw</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror①">RangeError</a></code>.</p>
    <li data-md>
     <p>Let <var>scopingDetails</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a>'s <a data-link-type="dfn" href="#privateaggregation-scoping-details" id="ref-for-privateaggregation-scoping-details">scoping details</a>.</p>
    <li data-md>
     <p>Let <var>batchingScope</var> be the result of running <var>scopingDetails</var>’ <a data-link-type="dfn" href="#scoping-details-get-batching-scope-steps" id="ref-for-scoping-details-get-batching-scope-steps">get batching scope steps</a>.</p>
    <li data-md>
     <p>Let <var>filteringIdByteSize</var> be 1.</p>
    <li data-md>
     <p>Let <var>preSpecifiedParamsMap</var> be the <a data-link-type="dfn" href="#pre-specified-report-parameters-map" id="ref-for-pre-specified-report-parameters-map">pre-specified report parameters map</a>.</p>
    <li data-md>
     <p>If <var>preSpecifiedParamsMap</var>[<var>batchingScope</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">exists</a>:</p>
     <ol>
      <li data-md>
       <p>Set <var>filteringIdByteSize</var> to <var>preSpecifiedParamsMap</var>[<var>batchingScope</var>]'s <a data-link-type="dfn" href="#pre-specified-report-parameters-filtering-id-byte-size" id="ref-for-pre-specified-report-parameters-filtering-id-byte-size">filtering ID byte size</a>.</p>
     </ol>
    <li data-md>
     <p>If <var>contribution</var>["<code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-filteringid" id="ref-for-dom-pahistogramcontribution-filteringid">filteringId</a></code>] is not in the
range [0, 256<sup><var>filteringIdByteSize</var></sup>−1], <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw②">throw</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror②">RangeError</a></code>.</p>
    <li data-md>
     <p>Let <var>entry</var> be a new <a data-link-type="dfn" href="#contribution-cache-entry" id="ref-for-contribution-cache-entry">contribution cache entry</a> with the items:</p>
     <dl>
      <dt data-md><a data-link-type="dfn" href="#contribution-cache-entry-contribution" id="ref-for-contribution-cache-entry-contribution">contribution</a>
      <dd data-md>
       <p><var>contribution</var></p>
      <dt data-md><a data-link-type="dfn" href="#contribution-cache-entry-batching-scope" id="ref-for-contribution-cache-entry-batching-scope">batching scope</a>
      <dd data-md>
       <p><var>batchingScope</var></p>
      <dt data-md><a data-link-type="dfn" href="#contribution-cache-entry-debug-scope" id="ref-for-contribution-cache-entry-debug-scope">debug scope</a>
      <dd data-md>
       <p>The result of running <var>scopingDetails</var>’ <a data-link-type="dfn" href="#scoping-details-get-debug-scope-steps" id="ref-for-scoping-details-get-debug-scope-steps">get debug scope
steps</a>.</p>
     </dl>
    <li data-md>
     <p><a data-link-type="dfn" href="#append-an-entry-to-the-contribution-cache" id="ref-for-append-an-entry-to-the-contribution-cache">Append</a> <var>entry</var> to the <a data-link-type="dfn" href="#contribution-cache" id="ref-for-contribution-cache">contribution cache</a>.</p>
   </ol>
   <p class="issue" id="issue-2f48ed07"><a class="self-link" href="#issue-2f48ed07"></a> Ensure errors are of an appropriate type, e.g. <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidaccesserror" id="ref-for-invalidaccesserror">InvalidAccessError</a></code> is
    deprecated.</p>
   <p class="issue" id="issue-e90e23c5"><a class="self-link" href="#issue-e90e23c5"></a> Consider accepting an array of contributions. <a href="https://github.com/patcg-individual-drafts/private-aggregation-api/issues/44">[Issue #44]</a></p>
   <div class="algorithm" data-algorithm="enableDebugMode(optional PADebugModeOptions options)" data-algorithm-for="PrivateAggregation"> The <dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAggregation" data-dfn-type="method" data-export data-lt="enableDebugMode(options)|enableDebugMode()" id="dom-privateaggregation-enabledebugmode"><code> enableDebugMode(optional PADebugModeOptions options)</code></dfn> method steps are: </div>
   <ol>
    <li data-md>
     <p>Let <var>scopingDetails</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①">this</a>'s <a data-link-type="dfn" href="#privateaggregation-scoping-details" id="ref-for-privateaggregation-scoping-details①">scoping details</a>.</p>
    <li data-md>
     <p>Let <var>debugScope</var> be the result of running <var>scopingDetails</var>’ <a data-link-type="dfn" href="#scoping-details-get-debug-scope-steps" id="ref-for-scoping-details-get-debug-scope-steps①">get debug scope steps</a>.</p>
    <li data-md>
     <p>Let <var>debugScopeMap</var> be the <a data-link-type="dfn" href="#debug-scope-map" id="ref-for-debug-scope-map">debug scope map</a>.</p>
    <li data-md>
     <p>If <var>debugScopeMap</var>[<var>debugScope</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">exists</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw③">throw</a> a
"<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
     <p class="note" role="note"><span class="marker">Note:</span> This would occur if <code>enableDebugMode()</code> has already been run for this <a data-link-type="dfn" href="#debug-scope" id="ref-for-debug-scope">debug scope</a>.</p>
    <li data-md>
     <p>Let <var>debugKey</var> be null.</p>
    <li data-md>
     <p>If <var>options</var> was given:</p>
     <ol>
      <li data-md>
       <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-padebugmodeoptions-debugkey" id="ref-for-dom-padebugmodeoptions-debugkey①">debugKey</a></code>] is not in the range
[0, 2<sup>64</sup>−1], <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw④">throw</a> a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror①">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>.</p>
      <li data-md>
       <p>Set <var>debugKey</var> to <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-padebugmodeoptions-debugkey" id="ref-for-dom-padebugmodeoptions-debugkey②">debugKey</a></code>].</p>
     </ol>
    <li data-md>
     <p>Let <var>debugDetails</var> be a new <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details">debug details</a> with the items:</p>
     <dl>
      <dt data-md><a data-link-type="dfn" href="#debug-details-enabled" id="ref-for-debug-details-enabled">enabled</a>
      <dd data-md>
       <p>true</p>
      <dt data-md><a data-link-type="dfn" href="#debug-details-key" id="ref-for-debug-details-key">key</a>
      <dd data-md>
       <p><var>debugKey</var></p>
     </dl>
    <li data-md>
     <p>Optionally, set <var>debugDetails</var> to a new <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details①">debug details</a>.</p>
     <p class="note" role="note"><span class="marker">Note:</span> This allows the user agent to make debug mode unavailable globally or
    just for certain callers.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set">Set</a> <var>debugScopeMap</var>[<var>debugScope</var>] to <var>debugDetails</var>.</p>
   </ol>
   <p class="issue" id="issue-2f48ed07①"><a class="self-link" href="#issue-2f48ed07①"></a> Ensure errors are of an appropriate type, e.g. <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidaccesserror" id="ref-for-invalidaccesserror①">InvalidAccessError</a></code> is
    deprecated.</p>
   <h2 class="heading settled" data-level="3" id="exposing"><span class="secno">3. </span><span class="content">Exposing to global scopes</span><a class="self-link" href="#exposing"></a></h2>
   <p>To expose this API to a global scope, a <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-read-only" id="ref-for-dfn-read-only">read only</a> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-attribute" id="ref-for-dfn-attribute">attribute</a> <code>privateAggregation</code> of type <code class="idl"><a data-link-type="idl" href="#privateaggregation" id="ref-for-privateaggregation①">PrivateAggregation</a></code> should be exposed on the
global scope. Its <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#getter-steps" id="ref-for-getter-steps">getter steps</a> should be set to the <a data-link-type="dfn" href="#get-the-privateaggregation" id="ref-for-get-the-privateaggregation">get the
privateAggregation</a> steps given <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②">this</a>.</p>
   <p>Each global scope should set the <a data-link-type="dfn" href="#privateaggregation-allowed-to-use" id="ref-for-privateaggregation-allowed-to-use">allowed to use</a> for the <code class="idl"><a data-link-type="idl" href="#privateaggregation" id="ref-for-privateaggregation②">PrivateAggregation</a></code> object it exposes based on whether a relevant <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">document</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use" id="ref-for-allowed-to-use">allowed to use</a> the "<code><a data-link-type="dfn" href="#private-aggregation" id="ref-for-private-aggregation">private-aggregation</a></code>" <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" id="ref-for-policy-controlled-feature">policy-controlled feature</a>.</p>
   <p>Additionally, each global scope should set the <a data-link-type="dfn" href="#privateaggregation-scoping-details" id="ref-for-privateaggregation-scoping-details②">scoping
details</a> for the <code class="idl"><a data-link-type="idl" href="#privateaggregation" id="ref-for-privateaggregation③">PrivateAggregation</a></code> object it exposes to a non-null value.
The global scope should wait to set the field until the API is intended to be
available.</p>
   <div class="example" id="shared-storage-only-within-operations">
    <a class="self-link" href="#shared-storage-only-within-operations"></a> Shared Storage only allows Private Aggregation when an operation is being
    invoked, not in the top-level context: 
<pre class="highlight"><c- a>class</c-> ExampleOperation <c- p>{</c->
  <c- k>async</c-> run<c- p>(</c->data<c- p>)</c-> <c- p>{</c->
    privateAggregation<c- p>.</c->contributeToHistogram<c- p>(...)</c->  <c- c1>// This is allowed.</c->
  <c- p>}</c->
<c- p>}</c->
register<c- p>(</c-><c- t>'example-operation'</c-><c- p>,</c-> ExampleOperation<c- p>);</c->

privateAggregation<c- p>.</c->contributeToHistogram<c- p>(...)</c->  <c- c1>// This would cause an error.</c->
</pre>
    <p>So, Shared Storage sets the <a data-link-type="dfn" href="#privateaggregation-scoping-details" id="ref-for-privateaggregation-scoping-details③">scoping details</a> immediately after the initial execution of the module script is complete.</p>
   </div>
   <p>For any <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope">batching scope</a> returned by the <a data-link-type="dfn" href="#scoping-details-get-batching-scope-steps" id="ref-for-scoping-details-get-batching-scope-steps①">get batching scope
steps</a>, the <a data-link-type="dfn" href="#process-contributions-for-a-batching-scope" id="ref-for-process-contributions-for-a-batching-scope">process contributions for a batching scope</a> steps should later
be performed given that same batching scope, the global scope’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant
settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin">origin</a>, some <a data-link-type="dfn" href="#context-type" id="ref-for-context-type">context
type</a> and a timeout (or null).</p>
   <p class="note" role="note"><span class="marker">Note:</span> This last requirement means that global scopes with different origins
    cannot share the same batching scope, see <a href="#same-origin-policy">Same-origin
    policy</a> discussion.</p>
   <p>For any <a data-link-type="dfn" href="#debug-scope" id="ref-for-debug-scope①">debug scope</a> returned by the <a data-link-type="dfn" href="#scoping-details-get-debug-scope-steps" id="ref-for-scoping-details-get-debug-scope-steps②">get debug scope
steps</a>, the <a data-link-type="dfn" href="#mark-a-debug-scope-complete" id="ref-for-mark-a-debug-scope-complete">mark a debug scope complete</a> steps should later be performed
given that same <a data-link-type="dfn" href="#debug-scope" id="ref-for-debug-scope②">debug scope</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> A later algorithm <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert">asserts</a> that, for any <a data-link-type="dfn" href="#contribution-cache-entry" id="ref-for-contribution-cache-entry①">contribution cache entry</a> in the <a data-link-type="dfn" href="#contribution-cache" id="ref-for-contribution-cache①">contribution cache</a>, the <a data-link-type="dfn" href="#mark-a-debug-scope-complete" id="ref-for-mark-a-debug-scope-complete①">mark a debug scope complete</a> steps
    were performed given the entry’s <a data-link-type="dfn" href="#contribution-cache-entry-debug-scope" id="ref-for-contribution-cache-entry-debug-scope①">debug scope</a> before the <a data-link-type="dfn" href="#process-contributions-for-a-batching-scope" id="ref-for-process-contributions-for-a-batching-scope①">process contributions for a batching scope</a> steps are
    performed given the entry’s <a data-link-type="dfn" href="#contribution-cache-entry-batching-scope" id="ref-for-contribution-cache-entry-batching-scope①">batching scope</a>.</p>
   <h2 class="heading settled" data-level="4" id="structures"><span class="secno">4. </span><span class="content">Structures</span><a class="self-link" href="#structures"></a></h2>
   <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="4.1" data-lt="Batching scope" data-noexport id="batching-scope"><span class="secno">4.1. </span><span class="content">Batching scope</span><a class="self-link" href="#batching-scope" id="ref-for-batching-scope①⑨"></a></h3>
    A batching scope is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#unique-internal-value" id="ref-for-unique-internal-value">unique internal value</a> that identifies
which <code class="idl"><a data-link-type="idl" href="#dictdef-pahistogramcontribution" id="ref-for-dictdef-pahistogramcontribution②">PAHistogramContribution</a></code>s should be sent in the same <a data-link-type="dfn" href="#aggregatable-report" id="ref-for-aggregatable-report①">aggregatable
report</a> unless their <a data-link-type="dfn" href="#aggregatable-report-debug-details" id="ref-for-aggregatable-report-debug-details">debug details</a> differ. 
   <p class="issue" id="issue-24767e0c"><a class="self-link" href="#issue-24767e0c"></a> Unique internal value is not an exported definition. See <a href="https://github.com/whatwg/infra/issues/583">infra/583</a>.</p>
   <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="4.2" data-lt="Debug scope" data-noexport id="debug-scope"><span class="secno">4.2. </span><span class="content">Debug scope</span><a class="self-link" href="#debug-scope" id="ref-for-debug-scope①⑤"></a></h3>
    A debug scope is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#unique-internal-value" id="ref-for-unique-internal-value①">unique internal value</a> that identifies which <code class="idl"><a data-link-type="idl" href="#dictdef-pahistogramcontribution" id="ref-for-dictdef-pahistogramcontribution③">PAHistogramContribution</a></code>s should have their <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details②">debug details</a> affected by the
presence or absence of a call to <code class="idl"><a data-link-type="idl" href="#dom-privateaggregation-enabledebugmode" id="ref-for-dom-privateaggregation-enabledebugmode②">enableDebugMode()</a></code> in the
same period of execution. 
   <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="4.3" data-lt="Scoping details" data-noexport id="scoping-details"><span class="secno">4.3. </span><span class="content">Scoping details</span><a class="self-link" href="#scoping-details" id="ref-for-scoping-details③"></a></h3>
    A scoping details is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> with the following items: 
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="scoping details" data-dfn-type="dfn" data-noexport id="scoping-details-get-batching-scope-steps">get batching scope steps</dfn>
    <dd data-md>
     <p>An algorithm returning a <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope①">batching scope</a></p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="scoping details" data-dfn-type="dfn" data-noexport id="scoping-details-get-debug-scope-steps">get debug scope steps</dfn>
    <dd data-md>
     <p>An algorithm returning a <a data-link-type="dfn" href="#debug-scope" id="ref-for-debug-scope③">debug scope</a></p>
   </dl>
   <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="4.4" data-lt="Debug details" data-noexport id="debug-details"><span class="secno">4.4. </span><span class="content">Debug details</span><a class="self-link" href="#debug-details" id="ref-for-debug-details①⑧"></a></h3>
    A debug details is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct①">struct</a> with the following items: 
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="debug details" data-dfn-type="dfn" data-noexport id="debug-details-enabled">enabled</dfn> (default false)
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean①">boolean</a></p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="debug details" data-dfn-type="dfn" data-noexport id="debug-details-key">key</dfn> (default null)
    <dd data-md>
     <p>An unsigned 64-bit integer or null. The key must be null if <a data-link-type="dfn" href="#debug-details-enabled" id="ref-for-debug-details-enabled①">enabled</a> is false.</p>
   </dl>
   <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="4.5" data-lt="Contribution cache entry" data-noexport id="contribution-cache-entry"><span class="secno">4.5. </span><span class="content">Contribution cache entry</span><a class="self-link" href="#contribution-cache-entry" id="ref-for-contribution-cache-entry⑥"></a></h3>
    A contribution cache entry is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct②">struct</a> with the following items: 
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="contribution cache entry" data-dfn-type="dfn" data-noexport id="contribution-cache-entry-contribution">contribution</dfn>
    <dd data-md>
     <p>A <code class="idl"><a data-link-type="idl" href="#dictdef-pahistogramcontribution" id="ref-for-dictdef-pahistogramcontribution④">PAHistogramContribution</a></code></p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="contribution cache entry" data-dfn-type="dfn" data-noexport id="contribution-cache-entry-batching-scope">batching scope</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope②">batching scope</a></p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="contribution cache entry" data-dfn-type="dfn" data-noexport id="contribution-cache-entry-debug-scope">debug scope</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="#debug-scope" id="ref-for-debug-scope④">debug scope</a></p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="contribution cache entry" data-dfn-type="dfn" data-noexport id="contribution-cache-entry-debug-details">debug details</dfn> (default null)
    <dd data-md>
     <p>A <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details③">debug details</a> or null</p>
   </dl>
   <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="4.6" data-lt="Aggregatable report" data-noexport id="aggregatable-report"><span class="secno">4.6. </span><span class="content">Aggregatable report</span><a class="self-link" href="#aggregatable-report" id="ref-for-aggregatable-report①⑤"></a></h3>
   <p>An aggregatable report is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct③">struct</a> with the following items:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="aggregatable report" data-dfn-type="dfn" data-noexport id="aggregatable-report-reporting-origin">reporting origin</dfn>
    <dd data-md>
     <p>An <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin">origin</a></p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="aggregatable report" data-dfn-type="dfn" data-noexport id="aggregatable-report-original-report-time">original report time</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment">moment</a></p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="aggregatable report" data-dfn-type="dfn" data-noexport id="aggregatable-report-report-time">report time</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment①">moment</a></p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="aggregatable report" data-dfn-type="dfn" data-noexport id="aggregatable-report-contributions">contributions</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> of <code class="idl"><a data-link-type="idl" href="#dictdef-pahistogramcontribution" id="ref-for-dictdef-pahistogramcontribution⑤">PAHistogramContribution</a></code>s</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="aggregatable report" data-dfn-type="dfn" data-noexport id="aggregatable-report-api">api</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="#context-type" id="ref-for-context-type①">context type</a></p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="aggregatable report" data-dfn-type="dfn" data-noexport id="aggregatable-report-report-id">report ID</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string">string</a></p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="aggregatable report" data-dfn-type="dfn" data-noexport id="aggregatable-report-debug-details">debug details</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details④">debug details</a></p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="aggregatable report" data-dfn-type="dfn" data-noexport id="aggregatable-report-aggregation-coordinator">aggregation coordinator</dfn>
    <dd data-md>
     <p>An <a data-link-type="dfn" href="#aggregation-coordinator" id="ref-for-aggregation-coordinator">aggregation coordinator</a></p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="aggregatable report" data-dfn-type="dfn" data-noexport id="aggregatable-report-context-id">context ID</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string①">string</a> or null</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="aggregatable report" data-dfn-type="dfn" data-noexport id="aggregatable-report-filtering-id-byte-size">filtering ID byte size</dfn>
    <dd data-md>
     <p>A positive integer</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="aggregatable report" data-dfn-type="dfn" data-noexport id="aggregatable-report-queued">queued</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean②">boolean</a></p>
   </dl>
   <h3 class="heading settled" data-level="4.7" id="aggregation-coordinator-structure"><span class="secno">4.7. </span><span class="content">Aggregation coordinator</span><a class="self-link" href="#aggregation-coordinator-structure"></a></h3>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="aggregation-coordinator">aggregation coordinator</dfn> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin①">origin</a> that the <a data-link-type="dfn" href="#allowed-aggregation-coordinator-set" id="ref-for-allowed-aggregation-coordinator-set">allowed
aggregation coordinator set</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain">contains</a>.</p>
   <p class="issue" id="issue-d61741c5"><a class="self-link" href="#issue-d61741c5"></a> Consider switching to the <a data-link-type="dfn" href="https://wicg.github.io/attribution-reporting-api/#suitable-origin" id="ref-for-suitable-origin">suitable
origin</a> concept used by the Attribution Reporting API here and elsewhere.</p>
   <p class="issue" id="issue-eb41e1cd"><a class="self-link" href="#issue-eb41e1cd"></a> Move other structures to be defined inline instead of via a header.
    Consider also removing all the subheadings.</p>
   <h3 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="4.8" data-lt="Context type" data-noexport id="context-type"><span class="secno">4.8. </span><span class="content">Context type</span><a class="self-link" href="#context-type" id="ref-for-context-type⑦"></a></h3>
    A context type is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string②">string</a> indicating what kind of global scope the <code class="idl"><a data-link-type="idl" href="#privateaggregation" id="ref-for-privateaggregation④">PrivateAggregation</a></code> object was exposed in. Each API exposing Private
Aggregation should pick a unique string (or multiple) for this. 
   <h3 class="heading settled" data-level="4.9" id="pre-specified-report-parameters-structure"><span class="secno">4.9. </span><span class="content">Pre-specified report parameters</span><a class="self-link" href="#pre-specified-report-parameters-structure"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="pre-specified-report-parameters">pre-specified report parameters</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct④">struct</a> with the following
items:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="pre-specified report parameters" data-dfn-type="dfn" data-noexport id="pre-specified-report-parameters-context-id">context ID</dfn> (default null)
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string③">string</a> or null</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="pre-specified report parameters" data-dfn-type="dfn" data-noexport id="pre-specified-report-parameters-filtering-id-byte-size">filtering ID byte size</dfn> (default 1)
    <dd data-md>
     <p>A positive integer.</p>
   </dl>
   <h2 class="heading settled" data-level="5" id="storage"><span class="secno">5. </span><span class="content">Storage</span><a class="self-link" href="#storage"></a></h2>
   <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent">user agent</a> holds an <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="aggregatable-report-cache">aggregatable report cache</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①">list</a> of <a data-link-type="dfn" href="#aggregatable-report" id="ref-for-aggregatable-report②">aggregatable reports</a>.</p>
   <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①">user agent</a> holds an <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="aggregation-coordinator-map">aggregation coordinator map</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a> from <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope③">batching scopes</a> to <a data-link-type="dfn" href="#aggregation-coordinator" id="ref-for-aggregation-coordinator①">aggregation coordinators</a>.</p>
   <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent②">user agent</a> holds a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="pre-specified-report-parameters-map">pre-specified report parameters map</dfn>, which
is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a> from <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope④">batching scopes</a> to <a data-link-type="dfn" href="#pre-specified-report-parameters" id="ref-for-pre-specified-report-parameters">pre-specified report parameters</a>.</p>
   <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent③">user agent</a> holds a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="contribution-cache">contribution cache</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②">list</a> of <a data-link-type="dfn" href="#contribution-cache-entry" id="ref-for-contribution-cache-entry②">contribution cache entries</a>.</p>
   <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent④">user agent</a> holds a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="debug-scope-map">debug scope map</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map②">map</a> from <a data-link-type="dfn" href="#debug-scope" id="ref-for-debug-scope⑤">debug scopes</a> to <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details⑤">debug details</a>.</p>
   <p class="issue" id="issue-34950ed5"><a class="self-link" href="#issue-34950ed5"></a> Elsewhere, link to definition when using <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent⑤">user agent</a>.</p>
   <h3 class="heading settled" data-level="5.1" id="clearing-storage"><span class="secno">5.1. </span><span class="content">Clearing storage</span><a class="self-link" href="#clearing-storage"></a></h3>
   <p>The user agent must expose controls that allow the user to delete data from
the <a data-link-type="dfn" href="#aggregatable-report-cache" id="ref-for-aggregatable-report-cache">aggregatable report cache</a> as well as any contribution history data
stored for the <a data-link-type="dfn" href="#consume-budget-if-permitted" id="ref-for-consume-budget-if-permitted">consume budget if permitted</a> algorithm.</p>
   <p>The user agent may expose controls that allow the user to delete data from the <a data-link-type="dfn" href="#contribution-cache" id="ref-for-contribution-cache②">contribution cache</a>, the <a data-link-type="dfn" href="#debug-scope-map" id="ref-for-debug-scope-map①">debug scope map</a> and the <a data-link-type="dfn" href="#pre-specified-report-parameters-map" id="ref-for-pre-specified-report-parameters-map①">pre-specified report
parameters map</a>.</p>
   <h2 class="heading settled" data-level="6" id="implementation-defined-values"><span class="secno">6. </span><span class="content"><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined">Implementation-defined</a> values</span><a class="self-link" href="#implementation-defined-values"></a></h2>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="allowed-aggregation-coordinator-set">Allowed aggregation coordinator set</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">set</a> of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin②">origins</a> that
controls which <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin③">origins</a> are valid <a data-link-type="dfn" href="#aggregation-coordinator" id="ref-for-aggregation-coordinator②">aggregation coordinators</a>. Every <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-item" id="ref-for-list-item">item</a> in this <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">set</a> must be a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-origin" id="ref-for-potentially-trustworthy-origin">potentially trustworthy origin</a>.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="default-aggregation-coordinator">Default aggregation coordinator</dfn> is an <a data-link-type="dfn" href="#aggregation-coordinator" id="ref-for-aggregation-coordinator③">aggregation coordinator</a> that controls which is used for a report if none is explicitly selected.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="maximum-report-contributions">Maximum report contributions</dfn> is a positive integer that controls how
many contributions can be present in a single report.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="minimum-report-delay">Minimum report delay</dfn> is a non-negative <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration">duration</a> that controls the
minimum delay to deliver an <a data-link-type="dfn" href="#aggregatable-report" id="ref-for-aggregatable-report③">aggregatable report</a>.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="randomized-report-delay">Randomized report delay</dfn> is a positive <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration①">duration</a> that controls the
random delay to deliver an <a data-link-type="dfn" href="#aggregatable-report" id="ref-for-aggregatable-report④">aggregatable report</a>. This delay is additional to
the <a data-link-type="dfn" href="#minimum-report-delay" id="ref-for-minimum-report-delay">minimum report delay</a>.</p>
   <h2 class="heading settled" data-level="7" id="permissions-policy-integration"><span class="secno">7. </span><span class="content">Permissions Policy integration</span><a class="self-link" href="#permissions-policy-integration"></a></h2>
   <p>This specification defines a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" id="ref-for-policy-controlled-feature①">policy-controlled feature</a> identified by the
string "<code><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="private-aggregation">private-aggregation</dfn></code>". Its <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist">default allowlist</a> is "<code>*</code>".</p>
   <p class="note" role="note"><span class="marker">Note:</span> The <a data-link-type="dfn" href="#privateaggregation-allowed-to-use" id="ref-for-privateaggregation-allowed-to-use①">allowed to use</a> field is set by other
    specifications that integrate with this API according to this <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" id="ref-for-policy-controlled-feature②">policy-controlled feature</a>.</p>
   <h2 class="heading settled" data-level="8" id="algorithms"><span class="secno">8. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h2>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="serialize-an-integer">serialize an integer</dfn>, represent it as a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string④">string</a> of the shortest
possible decimal number.</p>
   <p class="issue" id="issue-6b252736"><a class="self-link" href="#issue-6b252736"></a> This would ideally be replaced by a more descriptive algorithm in Infra.
    See <a href="https://github.com/whatwg/infra/issues/201">infra/201</a>.</p>
   <h3 class="heading settled" data-level="8.1" id="exported-algorithms"><span class="secno">8.1. </span><span class="content">Exported algorithms</span><a class="self-link" href="#exported-algorithms"></a></h3>
   <p class="note" role="note"><span class="marker">Note:</span> These algorithms allow other specifications to integrate with this API.</p>
   <p>To <dfn class="dfn-paneled algorithm" data-algorithm="get the privateAggregation" data-dfn-type="dfn" data-export id="get-the-privateaggregation">get the privateAggregation</dfn> given a <code class="idl"><a data-link-type="idl" href="#privateaggregation" id="ref-for-privateaggregation⑤">PrivateAggregation</a></code> <var>this</var>:</p>
   <ol>
    <li data-md>
     <p>Let <var>scopingDetails</var> be <var>this</var>’s <a data-link-type="dfn" href="#privateaggregation-scoping-details" id="ref-for-privateaggregation-scoping-details④">scoping details</a>.</p>
    <li data-md>
     <p>If <var>scopingDetails</var> is null, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw⑤">throw</a> a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>.</p>
     <p class="note" role="note"><span class="marker">Note:</span> This indicates the API is not yet available, for example, because the
    initial execution of the script after loading is not complete.</p>
     <p class="issue" id="issue-1c64074f"><a class="self-link" href="#issue-1c64074f"></a> Consider improving developer ergonomics here (e.g. a way to detect
    this case).</p>
    <li data-md>
     <p>If <var>this</var>’s <a data-link-type="dfn" href="#privateaggregation-allowed-to-use" id="ref-for-privateaggregation-allowed-to-use②">allowed to use</a> is false, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw⑥"> throw</a> an "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidaccesserror" id="ref-for-invalidaccesserror②">InvalidAccessError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>.</p>
    <li data-md>
     <p>Return <var>this</var>.</p>
   </ol>
   <p class="issue" id="issue-2f48ed07②"><a class="self-link" href="#issue-2f48ed07②"></a> Ensure errors are of an appropriate type, e.g. <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidaccesserror" id="ref-for-invalidaccesserror③">InvalidAccessError</a></code> is
    deprecated.</p>
   <p>To <dfn class="dfn-paneled algorithm" data-algorithm="append an entry to the contribution cache" data-dfn-type="dfn" data-export id="append-an-entry-to-the-contribution-cache">append an entry to the contribution cache</dfn> given a <a data-link-type="dfn" href="#contribution-cache-entry" id="ref-for-contribution-cache-entry③">contribution cache entry</a> <var>entry</var>:</p>
   <ol>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append">Append</a> <var>entry</var> to the <a data-link-type="dfn" href="#contribution-cache" id="ref-for-contribution-cache③">contribution cache</a>.</p>
   </ol>
   <p>To <dfn class="dfn-paneled algorithm" data-algorithm="get a debug details" data-dfn-type="dfn" data-export id="get-a-debug-details">get a debug details</dfn> given a <a data-link-type="dfn" href="#debug-scope" id="ref-for-debug-scope⑥">debug scope</a> <var>debugScope</var>, perform the following steps. They return a <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details⑥">debug details</a>.</p>
   <ol>
    <li data-md>
     <p>Let <var>debugScopeMap</var> be the <a data-link-type="dfn" href="#debug-scope-map" id="ref-for-debug-scope-map②">debug scope map</a>.</p>
    <li data-md>
     <p>If <var>debugScopeMap</var>[<var>debugScope</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②">exists</a>, return <var>debugScopeMap</var>[<var>debugScope</var>].</p>
    <li data-md>
     <p>Otherwise, return a new <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details⑦">debug details</a>.</p>
   </ol>
   <p>To <dfn class="dfn-paneled algorithm" data-algorithm="mark a debug scope complete" data-dfn-type="dfn" data-export id="mark-a-debug-scope-complete">mark a debug scope complete</dfn> given a <a data-link-type="dfn" href="#debug-scope" id="ref-for-debug-scope⑦">debug
scope</a> <var>debugScope</var> and an optional <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details⑧">debug details</a> or null <var>debugDetailsOverride</var> (default null):</p>
   <ol>
    <li data-md>
     <p>Let <var>debugDetails</var> be <var>debugDetailsOverride</var>.</p>
    <li data-md>
     <p>Let <var>debugScopeMap</var> be the <a data-link-type="dfn" href="#debug-scope-map" id="ref-for-debug-scope-map③">debug scope map</a>.</p>
    <li data-md>
     <p>If <var>debugScopeMap</var>[<var>debugScope</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists③">exists</a>:</p>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①">Assert</a>: <var>debugDetailsOverride</var> is null.</p>
       <p class="note" role="note"><span class="marker">Note:</span> The override can be provided if the debug details have not been
    set otherwise.</p>
      <li data-md>
       <p>Set <var>debugDetails</var> to <var>debugScopeMap</var>[<var>debugScope</var>].</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove" id="ref-for-map-remove">Remove</a> <var>debugScopeMap</var>[<var>debugScope</var>].</p>
      <li data-md>
       <p>If <var>debugDetails</var>’s <a data-link-type="dfn" href="#debug-details-key" id="ref-for-debug-details-key①">key</a> is not null, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert②">assert</a>: <var>debugDetails</var>’s <a data-link-type="dfn" href="#debug-details-enabled" id="ref-for-debug-details-enabled②">enabled</a> is true.</p>
     </ol>
    <li data-md>
     <p>If <var>debugDetails</var> is null, set <var>debugDetails</var> to a new <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details⑨">debug details</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>entry</var> of the <a data-link-type="dfn" href="#contribution-cache" id="ref-for-contribution-cache④">contribution cache</a>:</p>
     <ol>
      <li data-md>
       <p>If <var>entry</var>’s <a data-link-type="dfn" href="#contribution-cache-entry-debug-scope" id="ref-for-contribution-cache-entry-debug-scope②">debug scope</a> is <var>debugScope</var>,
set <var>entry</var>’s <a data-link-type="dfn" href="#contribution-cache-entry-debug-details" id="ref-for-contribution-cache-entry-debug-details">debug details</a> to <var>debugDetails</var>.</p>
     </ol>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="determine-if-a-null-report-should-be-sent">determine if a null report should be sent</dfn> given a <a data-link-type="dfn" href="#pre-specified-report-parameters" id="ref-for-pre-specified-report-parameters①">pre-specified
report parameters</a> <var>preSpecifiedParams</var>, perform the following steps. They
return a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean③">boolean</a>:</p>
   <ol>
    <li data-md>
     <p>If <var>preSpecifiedParams</var>’ <a data-link-type="dfn" href="#pre-specified-report-parameters-context-id" id="ref-for-pre-specified-report-parameters-context-id">context ID</a> is
not null, return true.</p>
    <li data-md>
     <p>If <var>preSpecifiedParams</var>’ <a data-link-type="dfn" href="#pre-specified-report-parameters-filtering-id-byte-size" id="ref-for-pre-specified-report-parameters-filtering-id-byte-size①">filtering ID byte
size</a> is not 1, return true.</p>
    <li data-md>
     <p>Return false.</p>
   </ol>
   <p class="note" role="note"><span class="marker">Note:</span> If a context ID or non-default filtering ID byte size was specified, a
    report is sent, even if there are no contributions or there is insufficent
    budget for the requested contributions. See <a href="#protecting-against-leaks-via-the-number-of-reports">Protecting against leaks via
    the number of reports</a>.</p>
   <p>To <dfn class="dfn-paneled algorithm" data-algorithm="process contributions for a batching scope" data-dfn-type="dfn" data-export id="process-contributions-for-a-batching-scope">process contributions for a batching scope</dfn> given
a <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope⑤">batching scope</a> <var>batchingScope</var>, an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin④">origin</a> <var>reportingOrigin</var>, a <a data-link-type="dfn" href="#context-type" id="ref-for-context-type②">context type</a> <var>contextType</var> and a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment②">moment</a> or null <var>timeout</var>:</p>
   <ol>
    <li data-md>
     <p>Let <var>batchEntries</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list③">list</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①">For each</a> <var>entry</var> of the <a data-link-type="dfn" href="#contribution-cache" id="ref-for-contribution-cache⑤">contribution cache</a>:</p>
     <ol>
      <li data-md>
       <p>If <var>entry</var>’s <a data-link-type="dfn" href="#contribution-cache-entry-batching-scope" id="ref-for-contribution-cache-entry-batching-scope②">batching scope</a> is <var>batchingScope</var>:</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert③">Assert</a>: <var>entry</var>’s <a data-link-type="dfn" href="#contribution-cache-entry-debug-details" id="ref-for-contribution-cache-entry-debug-details①">debug details</a> is
not null.</p>
         <p class="note" role="note"><span class="marker">Note:</span> This asserts that the <a data-link-type="dfn" href="#mark-a-debug-scope-complete" id="ref-for-mark-a-debug-scope-complete②">mark a debug scope complete</a> steps
    were run before the <a data-link-type="dfn" href="#process-contributions-for-a-batching-scope" id="ref-for-process-contributions-for-a-batching-scope②">process contributions for a batching
    scope</a> steps.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append①">Append</a> <var>entry</var> to <var>batchEntries</var>.</p>
       </ol>
     </ol>
    <li data-md>
     <p>Let <var>aggregationCoordinator</var> be the <a data-link-type="dfn" href="#default-aggregation-coordinator" id="ref-for-default-aggregation-coordinator">default aggregation coordinator</a>.</p>
    <li data-md>
     <p>Let <var>aggregationCoordinatorMap</var> be the <a data-link-type="dfn" href="#aggregation-coordinator-map" id="ref-for-aggregation-coordinator-map">aggregation coordinator map</a>.</p>
    <li data-md>
     <p>If <var>aggregationCoordinatorMap</var>[<var>batchingScope</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists④">exists</a>:</p>
     <ol>
      <li data-md>
       <p>Set <var>aggregationCoordinator</var> to <var>aggregationCoordinatorMap</var>[<var>batchingScope</var>].</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove" id="ref-for-map-remove①">Remove</a> <var>aggregationCoordinatorMap</var>[<var>batchingScope</var>].</p>
     </ol>
    <li data-md>
     <p>Let <var>preSpecifiedParams</var> be a new <a data-link-type="dfn" href="#pre-specified-report-parameters" id="ref-for-pre-specified-report-parameters②">pre-specified report parameters</a>.</p>
    <li data-md>
     <p>Let <var>preSpecifiedParamsMap</var> be the <a data-link-type="dfn" href="#pre-specified-report-parameters-map" id="ref-for-pre-specified-report-parameters-map②">pre-specified report parameters map</a>.</p>
    <li data-md>
     <p>If <var>preSpecifiedParamsMap</var>[<var>batchingScope</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists⑤">exists</a>:</p>
     <ol>
      <li data-md>
       <p>Set <var>preSpecifiedParams</var> to <var>preSpecifiedParamsMap</var>[<var>batchingScope</var>].</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove" id="ref-for-map-remove②">Remove</a> <var>preSpecifiedParamsMap</var>[<var>batchingScope</var>].</p>
     </ol>
    <li data-md>
     <p>Let <var>isDeterministicReport</var> be the result of <a data-link-type="dfn" href="#determine-if-a-null-report-should-be-sent" id="ref-for-determine-if-a-null-report-should-be-sent">determining if a null report
should be sent</a> given <var>preSpecifiedParams</var>.</p>
    <li data-md>
     <p>If <var>isDeterministicReport</var> is false, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert④">assert</a>: <var>timeout</var> is null.</p>
     <p class="note" role="note"><span class="marker">Note:</span> Timeouts can only be used for deterministic reports.</p>
    <li data-md>
     <p>If <var>batchEntries</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty">is empty</a> and <var>isDeterministicReport</var> is false,
return.</p>
    <li data-md>
     <p>Let <var>batchedContributions</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map③">ordered map</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate②">For each</a> <var>entry</var> of <var>batchEntries</var>:</p>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove">Remove</a> <var>entry</var> from the <a data-link-type="dfn" href="#contribution-cache" id="ref-for-contribution-cache⑥">contribution cache</a>.</p>
      <li data-md>
       <p>Let <var>debugDetails</var> be <var>entry</var>’s <a data-link-type="dfn" href="#contribution-cache-entry-debug-details" id="ref-for-contribution-cache-entry-debug-details②">debug
details</a>.</p>
      <li data-md>
       <p>If <var>batchedContributions</var>[<var>debugDetails</var>] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists⑥">exist</a>:</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set①">Set</a> <var>batchedContributions</var>[<var>debugDetails</var>] to a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list④">list</a>.</p>
       </ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append②">Append</a> <var>entry</var>’s <a data-link-type="dfn" href="#contribution-cache-entry-contribution" id="ref-for-contribution-cache-entry-contribution①">contribution</a> to <var>batchedContributions</var>[<var>debugDetails</var>].</p>
     </ol>
    <li data-md>
     <p>If <var>batchedContributions</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-is-empty" id="ref-for-map-is-empty">is empty</a>:</p>
     <ol>
      <li data-md>
       <p>Let <var>debugDetails</var> be a new <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details①⓪">debug details</a>.</p>
      <li data-md>
       <p>Set <var>batchedContributions</var>[<var>debugDetails</var>] to a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑤">list</a>.</p>
     </ol>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate">For each</a> <var>debugDetails</var> → <var>contributions</var> of <var>batchedContributions</var>:</p>
     <ol>
      <li data-md>
       <p>Perform the <a data-link-type="dfn" href="#report-creation-and-scheduling-steps" id="ref-for-report-creation-and-scheduling-steps">report creation and scheduling steps</a> with <var>reportingOrigin</var>, <var>contextType</var>, <var>contributions</var>, <var>debugDetails</var>, <var>aggregationCoordinator</var>, <var>preSpecifiedParams</var> and <var>timeout</var>.</p>
     </ol>
   </ol>
   <p class="note" role="note"><span class="marker">Note:</span> These steps break up the contributions based on their <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details①①">debug details</a> as
    each report can only have one set of metadata.</p>
   <div class="algorithm" data-algorithm="determine if an origin is an aggregation coordinator">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="determine-if-an-origin-is-an-aggregation-coordinator">determine if an origin is an aggregation coordinator</dfn> given
an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin⑤">origin</a> <var>origin</var>, perform the following steps. They return a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean④">boolean</a>. 
    <ol>
     <li data-md>
      <p>Return whether <var>origin</var> is an <a data-link-type="dfn" href="#aggregation-coordinator" id="ref-for-aggregation-coordinator④">aggregation coordinator</a>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="set the aggregation coordinator for a batching scope">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="set-the-aggregation-coordinator-for-a-batching-scope">set the aggregation coordinator for a batching scope</dfn> given
an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin⑥">origin</a> <var>origin</var> and a <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope⑥">batching scope</a> <var>batchingScope</var>: 
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert⑤">Assert</a>: <var>origin</var> is an <a data-link-type="dfn" href="#aggregation-coordinator" id="ref-for-aggregation-coordinator⑤">aggregation coordinator</a>.</p>
     <li data-md>
      <p>Let <var>aggregationCoordinatorMap</var> be the <a data-link-type="dfn" href="#aggregation-coordinator-map" id="ref-for-aggregation-coordinator-map①">aggregation coordinator map</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set②">Set</a> <var>aggregationCoordinatorMap</var>[<var>batchingScope</var>] to <var>origin</var>.</p>
    </ol>
   </div>
   <p class="issue" id="issue-216f1bbd"><a class="self-link" href="#issue-216f1bbd"></a> Elsewhere, surround algorithms in a <code>&lt;div algorithm></code> block to match, and
    add styling for all algorithms per <a href="https://github.com/speced/bikeshed/issues/1472">bikeshed/1472</a>.</p>
   <p>To <dfn class="dfn-paneled algorithm" data-algorithm="set the pre-specified report parameters for a batching scope" data-dfn-type="dfn" data-export data-lt="set the pre-specified report parameters for a batching scope" id="set-the-pre-specified-report-parameters-for-a-batching-scope">set the pre-specified report parameters for a batching
scope</dfn> given a <a data-link-type="dfn" href="#pre-specified-report-parameters" id="ref-for-pre-specified-report-parameters③">pre-specified report parameters</a> <var>params</var> and a <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope⑦">batching scope</a> <var>batchingScope</var>:</p>
   <ol>
    <li data-md>
     <p>Let <var>contextId</var> be <var>params</var>’ <a data-link-type="dfn" href="#pre-specified-report-parameters-context-id" id="ref-for-pre-specified-report-parameters-context-id①">context ID</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert⑥">Assert</a>: <var>contextId</var> is null or <var>contextId</var>’s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-length" id="ref-for-string-length">length</a> is not
larger than 64.</p>
    <li data-md>
     <p>Let <var>filteringIdByteSize</var> be <var>params</var>’ <a data-link-type="dfn" href="#pre-specified-report-parameters-filtering-id-byte-size" id="ref-for-pre-specified-report-parameters-filtering-id-byte-size②"> filtering ID byte size</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert⑦">Assert</a>: <var>filteringIdByteSize</var> is an integer in the range [1, 8].</p>
    <li data-md>
     <p>Let <var>paramsMap</var> be the <a data-link-type="dfn" href="#pre-specified-report-parameters-map" id="ref-for-pre-specified-report-parameters-map③">pre-specified report parameters map</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set③">Set</a> <var>paramsMap</var>[<var>batchingScope</var>] to <var>params</var>.</p>
   </ol>
   <h3 class="heading settled" data-level="8.2" id="scheduling-reports"><span class="secno">8.2. </span><span class="content">Scheduling reports</span><a class="self-link" href="#scheduling-reports"></a></h3>
   <p>To perform the <dfn class="dfn-paneled algorithm" data-algorithm="report creation and scheduling steps" data-dfn-type="dfn" data-noexport id="report-creation-and-scheduling-steps">report creation and scheduling steps</dfn> with an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin⑦">origin</a> <var>reportingOrigin</var>, a <a data-link-type="dfn" href="#context-type" id="ref-for-context-type③">context type</a> <var>api</var>, a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑥">list</a> of <code class="idl"><a data-link-type="idl" href="#dictdef-pahistogramcontribution" id="ref-for-dictdef-pahistogramcontribution⑥">PAHistogramContribution</a></code>s <var>contributions</var>, a <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details①②">debug details</a> <var>debugDetails</var>, an <a data-link-type="dfn" href="#aggregation-coordinator" id="ref-for-aggregation-coordinator⑥">aggregation coordinator</a> <var>aggregationCoordinator</var>, a <a data-link-type="dfn" href="#pre-specified-report-parameters" id="ref-for-pre-specified-report-parameters④">pre-specified report parameters</a> <var>preSpecifiedParams</var> and a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment③">moment</a> or
null <var>timeout</var>:</p>
   <ol>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert⑧">Assert</a>: <var>reportingOrigin</var> is a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-origin" id="ref-for-potentially-trustworthy-origin①">potentially trustworthy origin</a>.</p>
    <li data-md>
     <p>Optionally, return.</p>
     <p class="note" role="note"><span class="marker">Note:</span> This <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined①">implementation-defined</a> condition is intended to allow <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent⑥">user
    agents</a> to drop reports for a number of reasons, for example user
    opt-out or an origin not being <a href="https://github.com/privacysandbox/attestation">enrolled</a>.</p>
    <li data-md>
     <p>Let <var>truncatedContributions</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑦">list</a>.</p>
    <li data-md>
     <p>If <var>contributions</var> has a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size">size</a> greater than <a data-link-type="dfn" href="#maximum-report-contributions" id="ref-for-maximum-report-contributions">maximum report
contributions</a>:</p>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate③">For each</a> <var>n</var> of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#the-exclusive-range" id="ref-for-the-exclusive-range">the range</a> 0 to <a data-link-type="dfn" href="#maximum-report-contributions" id="ref-for-maximum-report-contributions①">maximum
report contributions</a>, exclusive:</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append">Append</a> <var>contributions</var>[<var>n</var>] to <var>truncatedContributions</var>.</p>
       </ol>
     </ol>
    <li data-md>
     <p>Otherwise, set <var>truncatedContributions</var> to <var>contributions</var>.</p>
    <li data-md>
     <p>Let <var>contributionSum</var> be 0.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate④">For each</a> <var>contribution</var> of <var>truncatedContributions</var>:</p>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert⑨">Assert</a>: <var>contribution</var>["<var>value</var>"] is non-negative.</p>
      <li data-md>
       <p>Add <var>contribution</var>["<var>value</var>"] to <var>contributionSum</var>.</p>
     </ol>
    <li data-md>
     <p>Let <var>currentWallTime</var> be the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-current-wall-time" id="ref-for-dfn-current-wall-time">current wall time</a>.</p>
    <li data-md>
     <p>Let <var>sufficientBudget</var> be the result of <a data-link-type="dfn" href="#consume-budget-if-permitted" id="ref-for-consume-budget-if-permitted①">consuming budget if permitted</a> given <var>contributionSum</var>, <var>reportingOrigin</var>, <var>api</var> and <var>currentWallTime</var>.</p>
    <li data-md>
     <p>If <var>sufficientBudget</var> is false:</p>
     <ol>
      <li data-md>
       <p>Let <var>isDeterministicReport</var> be the result of <a data-link-type="dfn" href="#determine-if-a-null-report-should-be-sent" id="ref-for-determine-if-a-null-report-should-be-sent①">determining if a null
report should be sent</a> given <var>preSpecifiedParams</var>.</p>
      <li data-md>
       <p>If <var>isDeterministicReport</var> is false, return.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty">Empty</a> <var>truncatedContributions</var>.</p>
     </ol>
    <li data-md>
     <p>Let <var>report</var> be the result of <a data-link-type="dfn" href="#obtain-an-aggregatable-report" id="ref-for-obtain-an-aggregatable-report">obtaining an aggregatable report</a> given <var>reportingOrigin</var>, <var>api</var>, <var>truncatedContributions</var>, <var>debugDetails</var>, <var>aggregationCoordinator</var>, <var>preSpecifiedParams</var>, <var>timeout</var> and <var>currentWallTime</var>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append①">Append</a> <var>report</var> to the user agent’s <a data-link-type="dfn" href="#aggregatable-report-cache" id="ref-for-aggregatable-report-cache①">aggregatable report cache</a>.</p>
   </ol>
   <p>To <dfn class="dfn-paneled algorithm" data-algorithm="consume budget if permitted" data-dfn-type="dfn" data-noexport id="consume-budget-if-permitted">consume budget if permitted</dfn> given a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-long" id="ref-for-idl-long①">long</a></code> <var>value</var>, an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin⑧">origin</a> <var>origin</var>, a <a data-link-type="dfn" href="#context-type" id="ref-for-context-type④">context type</a> <var>api</var> and a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment④">moment</a> <var>currentTime</var>, perform <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined②">implementation-defined</a> steps. They return
a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean⑤">boolean</a>, which indicates whether there is sufficient 'contribution budget'
left to send the requested contribution <var>value</var>. This budget should be bound to
usage over time, e.g. the contribution sum over the last 24 hours. The algorithm
should assume that the contribution will be sent if and only if true is
returned, i.e. it should consume the budget in that case. If <var>value</var> is zero,
this algorithm should return true.</p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-an-aggregatable-report">obtain an aggregatable report</dfn> given an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin⑨">origin</a> <var>reportingOrigin</var>, a <a data-link-type="dfn" href="#context-type" id="ref-for-context-type⑤">context type</a> <var>api</var>, a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑧">list</a> of <code class="idl"><a data-link-type="idl" href="#dictdef-pahistogramcontribution" id="ref-for-dictdef-pahistogramcontribution⑦">PAHistogramContribution</a></code>s <var>contributions</var>, a <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details①③">debug details</a> <var>debugDetails</var>, an <a data-link-type="dfn" href="#aggregation-coordinator" id="ref-for-aggregation-coordinator⑦">aggregation coordinator</a> <var>aggregationCoordinator</var>, a <a data-link-type="dfn" href="#pre-specified-report-parameters" id="ref-for-pre-specified-report-parameters⑤">pre-specified report parameters</a> <var>preSpecifiedParams</var>, a [=moment] or null <var>timeout</var> and a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment⑤">moment</a> <var>currentTime</var>,
perform the following steps. They return an <a data-link-type="dfn" href="#aggregatable-report" id="ref-for-aggregatable-report⑤">aggregatable report</a>.</p>
   <ol>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①⓪">Assert</a>: <var>reportingOrigin</var> is a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-origin" id="ref-for-potentially-trustworthy-origin②">potentially trustworthy origin</a>.</p>
    <li data-md>
     <p>Let <var>reportTime</var> be the result of running <a data-link-type="dfn" href="#obtain-a-report-delivery-time" id="ref-for-obtain-a-report-delivery-time">obtain a report delivery time</a> given <var>currentTime</var> and <var>timeout</var>.</p>
    <li data-md>
     <p>Let <var>report</var> be a new <a data-link-type="dfn" href="#aggregatable-report" id="ref-for-aggregatable-report⑥">aggregatable report</a> with the items:</p>
     <dl>
      <dt data-md><a data-link-type="dfn" href="#aggregatable-report-reporting-origin" id="ref-for-aggregatable-report-reporting-origin">reporting origin</a>
      <dd data-md>
       <p><var>reportingOrigin</var></p>
      <dt data-md><a data-link-type="dfn" href="#aggregatable-report-original-report-time" id="ref-for-aggregatable-report-original-report-time">original report time</a>
      <dd data-md>
       <p><var>reportTime</var></p>
      <dt data-md><a data-link-type="dfn" href="#aggregatable-report-report-time" id="ref-for-aggregatable-report-report-time">report time</a>
      <dd data-md>
       <p><var>reportTime</var></p>
      <dt data-md><a data-link-type="dfn" href="#aggregatable-report-contributions" id="ref-for-aggregatable-report-contributions">contributions</a>
      <dd data-md>
       <p><var>contributions</var></p>
      <dt data-md><a data-link-type="dfn" href="#aggregatable-report-api" id="ref-for-aggregatable-report-api">api</a>
      <dd data-md>
       <p><var>api</var></p>
      <dt data-md><a data-link-type="dfn" href="#aggregatable-report-report-id" id="ref-for-aggregatable-report-report-id">report ID</a>
      <dd data-md>
       <p>The result of <a data-link-type="dfn" href="https://w3c.github.io/webcrypto/#dfn-generate-a-random-uuid" id="ref-for-dfn-generate-a-random-uuid">generating a random UUID</a>.</p>
      <dt data-md><a data-link-type="dfn" href="#aggregatable-report-debug-details" id="ref-for-aggregatable-report-debug-details①">debug details</a>
      <dd data-md>
       <p><var>debugDetails</var></p>
      <dt data-md><a data-link-type="dfn" href="#aggregatable-report-aggregation-coordinator" id="ref-for-aggregatable-report-aggregation-coordinator">aggregation coordinator</a>
      <dd data-md>
       <p><var>aggregationCoordinator</var></p>
      <dt data-md><a data-link-type="dfn" href="#aggregatable-report-context-id" id="ref-for-aggregatable-report-context-id">context ID</a>
      <dd data-md>
       <p><var>preSpecifiedParams</var>’ <a data-link-type="dfn" href="#pre-specified-report-parameters-context-id" id="ref-for-pre-specified-report-parameters-context-id②">context ID</a></p>
      <dt data-md><a data-link-type="dfn" href="#aggregatable-report-filtering-id-byte-size" id="ref-for-aggregatable-report-filtering-id-byte-size">filtering ID byte size</a>
      <dd data-md>
       <p><var>preSpecifiedParams</var>’ <a data-link-type="dfn" href="#pre-specified-report-parameters-filtering-id-byte-size" id="ref-for-pre-specified-report-parameters-filtering-id-byte-size③">filtering ID byte
size</a></p>
      <dt data-md><a data-link-type="dfn" href="#aggregatable-report-queued" id="ref-for-aggregatable-report-queued">queued</a>
      <dd data-md>
       <p>false</p>
     </dl>
    <li data-md>
     <p>Return <var>report</var>.</p>
   </ol>
   <p>To <dfn class="dfn-paneled algorithm" data-algorithm="obtain a report delivery time" data-dfn-type="dfn" data-noexport id="obtain-a-report-delivery-time">obtain a report delivery time</dfn> given a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment⑥">moment</a> <var>currentTime</var> and a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment⑦">moment</a> or null <var>timeout</var>, perform the following steps.
They return a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment⑧">moment</a>.</p>
   <ol>
    <li data-md>
     <p>If <var>timeout</var> is not null:</p>
     <ol>
      <li data-md>
       <p>Return <var>timeout</var>.</p>
     </ol>
    <li data-md>
     <p>If <a data-link-type="dfn" href="#automation-local-testing-mode-enabled" id="ref-for-automation-local-testing-mode-enabled">automation local testing mode enabled</a> is true, return <var>currentTime</var>.</p>
    <li data-md>
     <p>Let <var>r</var> be a random double between 0 (inclusive) and 1 (exclusive) with
uniform probability.</p>
    <li data-md>
     <p>Return <var>currentTime</var> + <a data-link-type="dfn" href="#minimum-report-delay" id="ref-for-minimum-report-delay①">minimum report delay</a> + <var>r</var> * <a data-link-type="dfn" href="#randomized-report-delay" id="ref-for-randomized-report-delay">randomized report
delay</a>.</p>
   </ol>
   <h3 class="heading settled" data-level="8.3" id="sending-reports"><span class="secno">8.3. </span><span class="content">Sending reports</span><a class="self-link" href="#sending-reports"></a></h3>
   <p class="note" role="note"><span class="marker">Note:</span> This section is largely copied from the <a href="https://wicg.github.io/attribution-reporting-api/">Attribution
    Reporting API spec</a>, adapting as necessary.</p>
   <p class="issue" id="issue-2485156c"><a class="self-link" href="#issue-2485156c"></a> Do we have to use the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task">queue a task</a> algorithm here?</p>
   <p>The user agent must periodically <a data-link-type="dfn" href="#attempt-to-queue-reports-for-sending" id="ref-for-attempt-to-queue-reports-for-sending">attempt to queue reports for sending</a> given
its <a data-link-type="dfn" href="#aggregatable-report-cache" id="ref-for-aggregatable-report-cache②">aggregatable report cache</a>.</p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="attempt-to-queue-reports-for-sending">attempt to queue reports for sending</dfn> given a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑨">list</a> of <a data-link-type="dfn" href="#aggregatable-report" id="ref-for-aggregatable-report⑦">aggregatable reports</a> <var>reports</var>:</p>
   <ol>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑤">For each</a> <var>report</var> of <var>reports</var>, run these steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in
parallel</a>:</p>
     <ol>
      <li data-md>
       <p>Run these steps, but <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#abort-when" id="ref-for-abort-when">abort when</a> the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent⑦">user agent</a> shuts down:</p>
       <ol>
        <li data-md>
         <p>If <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-queued" id="ref-for-aggregatable-report-queued①">queued</a> value is true, return.</p>
        <li data-md>
         <p>Set <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-queued" id="ref-for-aggregatable-report-queued②">queued</a> value to true.</p>
        <li data-md>
         <p>Let <var>currentWallTime</var> be the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-current-wall-time" id="ref-for-dfn-current-wall-time①">current wall time</a>.</p>
        <li data-md>
         <p>If <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-report-time" id="ref-for-aggregatable-report-report-time①">report time</a> is before <var>currentWallTime</var>, set <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-report-time" id="ref-for-aggregatable-report-report-time②">report
time</a> to <var>currentWallTime</var> plus an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined③">implementation-defined</a> random non-negative <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration②">duration</a>.</p>
         <p class="note" role="note"><span class="marker">Note:</span> On startup, it is possible the user agent will need to send
    many reports whose report times passed while the browser was
    closed. Adding random delay prevents temporal joining of
    reports.</p>
        <li data-md>
         <p>Wait until the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-current-wall-time" id="ref-for-dfn-current-wall-time②">current wall time</a> is equal to or after <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-report-time" id="ref-for-aggregatable-report-report-time③">report time</a>.</p>
        <li data-md>
         <p>Optionally, wait a further <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined④">implementation-defined</a> non-negative <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration③">duration</a>.</p>
         <p class="note" role="note"><span class="marker">Note:</span> This is intended to allow user agents to optimize device
    resource usage and wait for the user agent to be online.</p>
        <li data-md>
         <p>Run <a data-link-type="dfn" href="#attempt-to-deliver-a-report" id="ref-for-attempt-to-deliver-a-report">attempt to deliver a report</a> with <var>report</var>.</p>
       </ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#if-aborted" id="ref-for-if-aborted">If aborted</a>, set <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-queued" id="ref-for-aggregatable-report-queued③">queued</a> value to
false.</p>
       <p class="note" role="note"><span class="marker">Note:</span> It might be more practical to perform this step when the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent⑧">user
    agent</a> next starts up.</p>
     </ol>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="attempt-to-deliver-a-report">attempt to deliver a report</dfn> given an <a data-link-type="dfn" href="#aggregatable-report" id="ref-for-aggregatable-report⑧">aggregatable report</a> <var>report</var>:</p>
   <ol>
    <li data-md>
     <p>Let <var>url</var> be the result of <a data-link-type="dfn" href="#obtain-a-reporting-endpoint" id="ref-for-obtain-a-reporting-endpoint">obtaining a reporting endpoint</a> given <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-reporting-origin" id="ref-for-aggregatable-report-reporting-origin①">reporting origin</a> and <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-api" id="ref-for-aggregatable-report-api①">api</a>.</p>
    <li data-md>
     <p>Let <var>data</var> be the result of <a data-link-type="dfn" href="#serialize-an-aggregatable-report" id="ref-for-serialize-an-aggregatable-report">serializing an aggregatable report</a> given <var>report</var>.</p>
    <li data-md>
     <p>If <var>data</var> is an error, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove①">remove</a> <var>report</var> from the <a data-link-type="dfn" href="#aggregatable-report-cache" id="ref-for-aggregatable-report-cache③">aggregatable
report cache</a>.</p>
     <p class="issue" id="issue-380e314b"><a class="self-link" href="#issue-380e314b"></a> Do we need to queue this task?</p>
    <li data-md>
     <p>Let <var>request</var> be the result of <a data-link-type="dfn" href="#create-a-report-request" id="ref-for-create-a-report-request">creating a report request</a> given <var>url</var> and <var>data</var>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①">Queue a task</a> to <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch">fetch</a> <var>request</var> with <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#process-response" id="ref-for-process-response">processResponse</a> being
the following steps:</p>
     <ol>
      <li data-md>
       <p>Let <var>shouldRetry</var> be an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined⑤">implementation-defined</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean⑥">boolean</a>. The value
should be false if no error occurred.</p>
      <li data-md>
       <p>If <var>shouldRetry</var> is true:</p>
       <ol>
        <li data-md>
         <p>Set <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-report-time" id="ref-for-aggregatable-report-report-time④">report time</a> to the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-current-wall-time" id="ref-for-dfn-current-wall-time③">current
wall time</a> plus an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined⑥">implementation-defined</a> non-negative <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration④">duration</a>.</p>
        <li data-md>
         <p>Set <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-queued" id="ref-for-aggregatable-report-queued④">queued</a> value to false.</p>
       </ol>
      <li data-md>
       <p>Otherwise, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove②">remove</a> <var>report</var> from the <a data-link-type="dfn" href="#aggregatable-report-cache" id="ref-for-aggregatable-report-cache④">aggregatable report
cache</a>.</p>
     </ol>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-a-reporting-endpoint">obtain a reporting endpoint</dfn> given an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin①⓪">origin</a> <var>reportingOrigin</var> and <a data-link-type="dfn" href="#context-type" id="ref-for-context-type⑥">context type</a> <var>api</var>, perform the following steps. They return a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a>.</p>
   <ol>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①①">Assert</a>: <var>reportingOrigin</var> is a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-origin" id="ref-for-potentially-trustworthy-origin③">potentially trustworthy origin</a>.</p>
    <li data-md>
     <p>Let <var>path</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-concatenate" id="ref-for-string-concatenate">concatenation</a> of
«"<code><a data-link-type="biblio" href="#biblio-rfc8615" title="Well-Known Uniform Resource Identifiers (URIs)">.well-known</a>/private-aggregation/report-</code>", <var>api</var>».</p>
     <p class="issue" id="issue-6bd15926"><a class="self-link" href="#issue-6bd15926"></a> Register this well-known directory. <a href="https://github.com/patcg-individual-drafts/private-aggregation-api/issues/67">[Issue #67]</a></p>
    <li data-md>
     <p>Let <var>base</var> be the result on running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser">URL parser</a> on the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin">serialization</a> of <var>reportingOrigin</var>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①②">Assert</a>: <var>base</var> is not failure.</p>
    <li data-md>
     <p>Let <var>result</var> be the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser①">URL parser</a> on <var>path</var> with <var>base</var>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①③">Assert</a>: <var>result</var> is not failure.</p>
    <li data-md>
     <p>Return <var>result</var>.</p>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-report-request">create a report request</dfn> given a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①">URL</a> <var>url</var> and a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence">byte
sequence</a> <var>body</var>:</p>
   <ol>
    <li data-md>
     <p>Let <var>request</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a> with the following properties:</p>
     <dl>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method" id="ref-for-concept-request-method">method</a>
      <dd data-md>
       <p>"<code>POST</code>"</p>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url">URL</a>
      <dd data-md>
       <p><var>url</var></p>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list">header list</a>
      <dd data-md>
       <p>«("<code>Content-Type</code>", "<code>application/json</code>")»</p>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#unsafe-request-flag" id="ref-for-unsafe-request-flag">unsafe-request flag</a>
      <dd data-md>
       <p>set</p>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-body" id="ref-for-concept-request-body">body</a>
      <dd data-md>
       <p><var>body</var></p>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client">client</a>
      <dd data-md>
       <p><code>null</code></p>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-window" id="ref-for-concept-request-window">window</a>
      <dd data-md>
       <p>"<code>no-window</code>"</p>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#request-service-workers-mode" id="ref-for-request-service-workers-mode">service-workers mode</a>
      <dd data-md>
       <p>"<code>none</code>"</p>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-initiator" id="ref-for-concept-request-initiator">initiator</a>
      <dd data-md>
       <p>""</p>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-referrer" id="ref-for-concept-request-referrer">referrer</a>
      <dd data-md>
       <p>"<code>no-referrer</code>"</p>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-mode" id="ref-for-concept-request-mode">mode</a>
      <dd data-md>
       <p>"<code>cors</code>"</p>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode" id="ref-for-concept-request-credentials-mode">credentials mode</a>
      <dd data-md>
       <p>"<code>omit</code>"</p>
      <dt data-md><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-cache-mode" id="ref-for-concept-request-cache-mode">cache mode</a>
      <dd data-md>
       <p>"<code>no-store</code>"</p>
     </dl>
    <li data-md>
     <p>Return <var>request</var>.</p>
   </ol>
   <h3 class="heading settled" data-level="8.4" id="serializing-reports"><span class="secno">8.4. </span><span class="content">Serializing reports</span><a class="self-link" href="#serializing-reports"></a></h3>
   <p class="note" role="note"><span class="marker">Note:</span> This section is largely copied from the <a href="https://wicg.github.io/attribution-reporting-api/">Attribution
    Reporting API spec</a>, adapting as necessary.</p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="serialize-an-aggregatable-report">serialize an aggregatable report</dfn> given an <a data-link-type="dfn" href="#aggregatable-report" id="ref-for-aggregatable-report⑨">aggregatable report</a> <var>report</var>, perform the following steps. They return a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①">byte sequence</a> or an
error.</p>
   <ol>
    <li data-md>
     <p>Let <var>shouldUseNewReportVersion</var> be false.</p>
    <li data-md>
     <p>If <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-debug-details" id="ref-for-aggregatable-report-debug-details②">debug details</a>'s <a data-link-type="dfn" href="#debug-details-enabled" id="ref-for-debug-details-enabled③"> enabled</a> is true:</p>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑥">For each</a> <var>contribution</var> of <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-contributions" id="ref-for-aggregatable-report-contributions①"> contributions</a>:</p>
       <ol>
        <li data-md>
         <p>If <var>contribution</var>[<code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-filteringid" id="ref-for-dom-pahistogramcontribution-filteringid①">filteringId</a></code>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists⑦"> exists</a>:</p>
         <ol>
          <li data-md>
           <p>Set <var>shouldUseNewReportVersion</var> to true.</p>
          <li data-md>
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-break" id="ref-for-iteration-break">Break</a>.</p>
         </ol>
       </ol>
     </ol>
     <p class="note" role="note"><span class="marker">Note:</span> For now, we only upgrade a report to version 1.0 if debug mode is
    enabled and a filteringId was specified. This avoids affecting existing
    flows while there are current Aggregation Service releases that do not
    support reports with version 1.0. We additionally require debug mode so
    that the report version cannot be used to leak any new information. Once
    all current Aggregation Service releases support version 1.0, we can
    change this behavior to always use the new report version.</p>
    <li data-md>
     <p>Let <var>aggregationServicePayloads</var> be the result of <a data-link-type="dfn" href="#obtain-the-aggregation-service-payloads" id="ref-for-obtain-the-aggregation-service-payloads">obtaining the aggregation
service payloads</a> given <var>report</var> and <var>shouldUseNewReportVersion</var>.</p>
    <li data-md>
     <p>If <var>aggregationServicePayloads</var> is an error, return <var>aggregationServicePayloads</var>.</p>
    <li data-md>
     <p>Let <var>data</var> be an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map④">ordered map</a> of the following key/value pairs:</p>
     <dl>
      <dt data-md>"<code>aggregation_coordinator_origin</code>"
      <dd data-md>
       <p><var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-aggregation-coordinator" id="ref-for-aggregatable-report-aggregation-coordinator①">aggregation coordinator</a>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin①">serialized</a>.</p>
      <dt data-md>"<code>aggregation_service_payloads</code>"
      <dd data-md>
       <p><var>aggregationServicePayloads</var></p>
      <dt data-md>"<code>shared_info</code>"
      <dd data-md>
       <p>The result of <a data-link-type="dfn" href="#obtain-a-reports-shared-info" id="ref-for-obtain-a-reports-shared-info">obtaining a report’s shared info</a> given <var>report</var> and <var>shouldUseNewReportVersion</var>.</p>
     </dl>
    <li data-md>
     <p>Let <var>debugKey</var> be <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-debug-details" id="ref-for-aggregatable-report-debug-details③">debug details</a>'s <a data-link-type="dfn" href="#debug-details-key" id="ref-for-debug-details-key②">key</a>.</p>
    <li data-md>
     <p>If <var>debugKey</var> is not null, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set④">set</a> <var>data</var>["<code>debug_key</code>"] to <var>debugKey</var>.</p>
    <li data-md>
     <p>Let <var>contextId</var> be <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-context-id" id="ref-for-aggregatable-report-context-id①">context ID</a>.</p>
    <li data-md>
     <p>If <var>contextId</var> is not null, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set⑤">set</a> <var>data</var>["<code>context_id</code>"] to <var>contextId</var>.</p>
    <li data-md>
     <p>Return the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence②">byte sequence</a> resulting from executing <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes" id="ref-for-serialize-an-infra-value-to-json-bytes">serialize an infra
value to JSON bytes</a> on <var>data</var>.</p>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-the-aggregation-service-payloads">obtain the aggregation service payloads</dfn> given an <a data-link-type="dfn" href="#aggregatable-report" id="ref-for-aggregatable-report①⓪">aggregatable
report</a> <var>report</var> and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean⑦">boolean</a> <var>shouldUseNewReportVersion</var>, perform the
following steps. They return a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①⓪">list</a> of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map⑤">maps</a> or an error.</p>
   <ol>
    <li data-md>
     <p>Let <var>publicKeyTuple</var> be the result of <a data-link-type="dfn" href="#obtain-the-public-key-for-encryption" id="ref-for-obtain-the-public-key-for-encryption">obtaining the public key for
encryption</a> given <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-aggregation-coordinator" id="ref-for-aggregatable-report-aggregation-coordinator②">aggregation
coordinator</a>.</p>
    <li data-md>
     <p>If <var>publicKeyTuple</var> is an error, return <var>publicKeyTuple</var>.</p>
    <li data-md>
     <p>Let (<var>pkR</var>, <var>keyId</var>) be <var>publicKeyTuple</var>.</p>
    <li data-md>
     <p>Let <var>plaintextPayload</var> be the result of <a data-link-type="dfn" href="#obtain-the-plaintext-payload" id="ref-for-obtain-the-plaintext-payload">obtaining the plaintext payload</a> given <var>report</var> and <var>shouldUseNewReportVersion</var>.</p>
    <li data-md>
     <p>Let <var>sharedInfo</var> be the result of <a data-link-type="dfn" href="#obtain-a-reports-shared-info" id="ref-for-obtain-a-reports-shared-info①">obtaining a report’s shared info</a> given <var>report</var> and <var>shouldUseNewReportVersion</var>.</p>
    <li data-md>
     <p>Let <var>encryptedPayload</var> be the result of <a data-link-type="dfn" href="#encrypt-the-payload" id="ref-for-encrypt-the-payload">encrypting the payload</a> given <var>plaintextPayload</var>, <var>pkR</var> and <var>sharedInfo</var>.</p>
    <li data-md>
     <p>If <var>encryptedPayload</var> is an error, return <var>encryptedPayload</var>.</p>
    <li data-md>
     <p>Let <var>aggregationServicePayloads</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①①">list</a>.</p>
    <li data-md>
     <p>Let <var>aggregationServicePayload</var> be an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map⑥">ordered map</a> of the following
key/value pairs:</p>
     <dl>
      <dt data-md>"<code>key_id</code>"
      <dd data-md>
       <p><var>keyId</var></p>
      <dt data-md>"<code>payload</code>"
      <dd data-md>
       <p><var>encryptedPayload</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#forgiving-base64-encode" id="ref-for-forgiving-base64-encode">base64 encoded</a></p>
     </dl>
    <li data-md>
     <p>If <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-debug-details" id="ref-for-aggregatable-report-debug-details④">debug details</a>'s <a data-link-type="dfn" href="#debug-details-enabled" id="ref-for-debug-details-enabled④"> enabled</a> field is true:</p>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set⑥">Set</a> <var>aggregationServicePayload</var>[<code>debug_cleartext_payload</code>] to <var>plaintextPayload</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#forgiving-base64-encode" id="ref-for-forgiving-base64-encode①">base64 encoded</a>.</p>
     </ol>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append③">Append</a> <var>aggregationServicePayload</var> to <var>aggregationServicePayloads</var>.</p>
    <li data-md>
     <p>Return <var>aggregationServicePayloads</var>.</p>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-the-public-key-for-encryption">obtain the public key for encryption</dfn> given an <a data-link-type="dfn" href="#aggregation-coordinator" id="ref-for-aggregation-coordinator⑧">aggregation
coordinator</a> <var>aggregationCoordinator</var>, perform the following steps. They return
a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple">tuple</a> consisting of a public key and a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑤">string</a>, or an error.</p>
   <ol>
    <li data-md>
     <p>Let <var>url</var> be a new <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url②">URL record</a>.</p>
    <li data-md>
     <p>Set <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme">scheme</a> to <var>aggregationCoordinator</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme" id="ref-for-concept-origin-scheme">scheme</a>.</p>
    <li data-md>
     <p>Set <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host" id="ref-for-concept-url-host">host</a> to <var>aggregationCoordinator</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host" id="ref-for-concept-origin-host">host</a>.</p>
    <li data-md>
     <p>Set <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-port" id="ref-for-concept-url-port">port</a> to <var>aggregationCoordinator</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-port" id="ref-for-concept-origin-port">port</a>.</p>
    <li data-md>
     <p>Set <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path" id="ref-for-concept-url-path">path</a> to «"<code>.well-known</code>", "<code>aggregation-service</code>",
"<code>v1</code>", "<code>public-keys</code>"».</p>
    <li data-md>
     <p>Return an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined⑦">implementation-defined</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple①">tuple</a> consisting of a public key
from <var>url</var> and a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑥">string</a> that should uniquely identify the public key or,
in the event that the user agent failed to obtain the public key from <var>url</var>,
an error. This step may be asynchronous.</p>
   </ol>
   <p class="issue" id="issue-35055690"><a class="self-link" href="#issue-35055690"></a> Specify this in terms of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch①">fetch</a>. Add details about which encryption
    standards to use, length requirements, etc.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The user agent is encouraged to enforce regular key rotation. If there are
    multiple keys, the user agent can independently pick a key uniformly at
    random for every encryption operation.</p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-the-plaintext-payload">obtain the plaintext payload</dfn> given an <a data-link-type="dfn" href="#aggregatable-report" id="ref-for-aggregatable-report①①">aggregatable report</a> <var>report</var> and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean⑧">boolean</a> <var>shouldUseNewReportVersion</var>, perform the following
    steps. They return a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence③">byte sequence</a>.</p>
   <ol>
    <li data-md>
     <p>Let <var>payloadData</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①②">list</a>.</p>
    <li data-md>
     <p>Let <var>contributions</var> be <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-contributions" id="ref-for-aggregatable-report-contributions②">contributions</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①④">Assert</a>: <var>contributions</var>’ <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size①">size</a> is not greater than <a data-link-type="dfn" href="#maximum-report-contributions" id="ref-for-maximum-report-contributions②">maximum
report contributions</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-while" id="ref-for-iteration-while">While</a> <var>contributions</var>’ <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size②">size</a> is less than <a data-link-type="dfn" href="#maximum-report-contributions" id="ref-for-maximum-report-contributions③">maximum
report contributions</a>:</p>
     <ol>
      <li data-md>
       <p>Let <var>nullContribution</var> be a new <code class="idl"><a data-link-type="idl" href="#dictdef-pahistogramcontribution" id="ref-for-dictdef-pahistogramcontribution⑧">PAHistogramContribution</a></code> with the
items:</p>
       <dl>
        <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-bucket" id="ref-for-dom-pahistogramcontribution-bucket①">bucket</a></code>
        <dd data-md>
         <p>0</p>
        <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-value" id="ref-for-dom-pahistogramcontribution-value①">value</a></code>
        <dd data-md>
         <p>0</p>
        <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-filteringid" id="ref-for-dom-pahistogramcontribution-filteringid②">filteringId</a></code>
        <dd data-md>
         <p>0</p>
       </dl>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append④">Append</a> <var>nullContribution</var> to <var>contributions</var>.</p>
     </ol>
     <p class="note" role="note"><span class="marker">Note:</span> This padding protects against the number of contributions being leaked
    through the encrypted payload size, see discussion <a href="#protecting-against-leaks-via-payload-size">below</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑦">For each</a> <var>contribution</var> of <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-contributions" id="ref-for-aggregatable-report-contributions③"> contributions</a>:</p>
     <ol>
      <li data-md>
       <p>Let <var>contributionData</var> be an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map⑦">ordered map</a> of the following key/value
pairs:</p>
       <dl>
        <dt data-md>"<code>bucket</code>"
        <dd data-md>
         <p>The result of <a data-link-type="dfn" href="#encode-an-integer-for-the-payload" id="ref-for-encode-an-integer-for-the-payload">encoding an integer for the payload</a> given <var>contribution</var>["<code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-bucket" id="ref-for-dom-pahistogramcontribution-bucket②">bucket</a></code>"] and 128.</p>
        <dt data-md>"<code>value</code>"
        <dd data-md>
         <p>The result of <a data-link-type="dfn" href="#encode-an-integer-for-the-payload" id="ref-for-encode-an-integer-for-the-payload①">encoding an integer for the payload</a> given <var>contribution</var>["<code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-value" id="ref-for-dom-pahistogramcontribution-value②">value</a></code>"] and 32.</p>
       </dl>
      <li data-md>
       <p>Let <var>filteringIdBitSize</var> be the product of 8 and <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-filtering-id-byte-size" id="ref-for-aggregatable-report-filtering-id-byte-size①">filtering id byte size</a>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①⑤">Assert</a>: <var>contribution</var>["<code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-filteringid" id="ref-for-dom-pahistogramcontribution-filteringid③">filteringId</a></code>"] is
in the range [0, 2<sup><var>filteringIdBitSize</var></sup>−1].</p>
      <li data-md>
       <p>If <var>shouldUseNewReportVersion</var>:</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set⑦">Set</a> <var>contributionData</var>["<code>id</code>"] to the result of <a data-link-type="dfn" href="#encode-an-integer-for-the-payload" id="ref-for-encode-an-integer-for-the-payload②">encoding an
integer for the payload</a> given <var>contribution</var>["<code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-filteringid" id="ref-for-dom-pahistogramcontribution-filteringid④">filteringId</a></code>"] and <var>filteringIdBitSize</var>.</p>
         <p class="issue" id="issue-fda1ec2d"><a class="self-link" href="#issue-fda1ec2d"></a> Be consistent about bytes or bits as units here.</p>
       </ol>
       <p class="issue" id="issue-222c62f7"><a class="self-link" href="#issue-222c62f7"></a> Be consistent about if boolean vs if boolean is true.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append⑤">Append</a> <var>contributionData</var> to <var>payloadData</var>.</p>
     </ol>
    <li data-md>
     <p>Let <var>payload</var> be an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map⑧">ordered map</a> of the following key/value pairs:</p>
     <dl>
      <dt data-md>"<code>data</code>"
      <dd data-md>
       <p><var>payloadData</var></p>
      <dt data-md>"<code>operation</code>"
      <dd data-md>
       <p>"<code>histogram</code>"</p>
     </dl>
    <li data-md>
     <p>Return the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence④">byte sequence</a> resulting from <a data-link-type="biblio" href="#biblio-rfc8949" title="Concise Binary Object Representation (CBOR)">CBOR encoding</a> <var>payload</var>.</p>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="encrypt-the-payload">encrypt the payload</dfn> given a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence⑤">byte sequence</a> <var>plaintextPayload</var>,
public key <var>pkR</var> and a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑦">string</a> <var>sharedInfo</var>, perform the following steps.
They return a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence⑥">byte sequence</a> or an error.</p>
   <ol>
    <li data-md>
     <p>Let <var>info</var> be the result of <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8-encode" id="ref-for-utf-8-encode">UTF-8 encoding</a> the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-concatenate" id="ref-for-string-concatenate①">concatenation</a> of « "<code>aggregation_service</code>", <var>sharedInfo</var> ».</p>
    <li data-md>
     <p>Let (<var>kem_id</var>, <var>kdf_id</var>, <var>aead_id</var>) be (0x0020, 0x0001, 0x0003).</p>
     <p class="note" role="note"><span class="marker">Note:</span> These indicate the HPKE algorithm identifiers, specifying the KEM
    function as DHKEM(X25519, HKDF-SHA256), the KDF function as HKDF-SHA256
    and the AEAD function as ChaCha20Poly1305.</p>
    <li data-md>
     <p>Let <var>hpkeContext</var> be the result of setting up an <a data-link-type="biblio" href="#biblio-rfc9180" title="Hybrid Public Key Encryption">HPKE</a> <a href="https://www.rfc-editor.org/rfc/rfc9180#name-encryption-to-a-public-key">sender’s context</a> with <var>pkR</var>, <var>info</var>, <var>kem_id</var>, <var>kdf_id</var> and <var>aead_id</var>.</p>
    <li data-md>
     <p>Let <var>aad</var> be `` (an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence⑦">byte sequence</a>).</p>
    <li data-md>
     <p>Let <var>encryptedPayload</var> be the result of <a href="https://www.rfc-editor.org/rfc/rfc9180#name-encryption-and-decryption">encrypting</a> <var>plaintextPayload</var> with <var>hpkeContext</var> and <var>aad</var>.</p>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="encode-an-integer-for-the-payload">encode an integer for the payload</dfn> given an integer <var>intToEncode</var> and an integer <var>bitLength</var>, return the representation of <var>intToEncode</var> as a
big-endian <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence⑧">byte sequence</a> of length <var>bitLength</var> / 8, left padding with zeroes
as necessary.</p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-a-reports-shared-info">obtain a report’s shared info</dfn> given an <a data-link-type="dfn" href="#aggregatable-report" id="ref-for-aggregatable-report①②">aggregatable report</a> <var>report</var> and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean⑨">boolean</a> <var>shouldUseNewReportVersion</var>, perform the following
steps. They return a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑧">string</a>.</p>
   <ol>
    <li data-md>
     <p>Let <var>scheduledReportTime</var> be the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration-from" id="ref-for-dfn-duration-from">duration from</a> the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-unix-epoch" id="ref-for-dfn-unix-epoch">UNIX epoch</a> to <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-original-report-time" id="ref-for-aggregatable-report-original-report-time①">original report time</a>.</p>
    <li data-md>
     <p>Let <var>sharedInfo</var> be an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map⑨">ordered map</a> of the following key/value pairs:</p>
     <dl>
      <dt data-md>"<code>api</code>"
      <dd data-md>
       <p><var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-api" id="ref-for-aggregatable-report-api②">api</a></p>
      <dt data-md>"<code>report_id</code>"
      <dd data-md>
       <p><var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-report-id" id="ref-for-aggregatable-report-report-id①">report ID</a></p>
      <dt data-md>"<code>reporting_origin</code>"
      <dd data-md>
       <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin②">serialization</a> of <var>report</var>’s <a data-link-type="dfn" href="#aggregatable-report-reporting-origin" id="ref-for-aggregatable-report-reporting-origin②">reporting origin</a></p>
      <dt data-md>"<code>scheduled_report_time</code>"
      <dd data-md>
       <p>The number of seconds in <var>scheduledReportTime</var>, rounded down to the
nearest number of whole seconds and <a data-link-type="dfn" href="#serialize-an-integer" id="ref-for-serialize-an-integer">serialized</a></p>
      <dt data-md>"<code>version</code>"
      <dd data-md>
       <p>"<code>1.0</code>" if <var>shouldUseNewReportVersion</var> and "<code>0.1</code>" otherwise</p>
     </dl>
    <li data-md>
     <p>Return the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#serialize-an-infra-value-to-a-json-string" id="ref-for-serialize-an-infra-value-to-a-json-string">serializing an infra value to a json string</a> given <var>sharedInfo</var>.</p>
   </ol>
   <h2 class="heading settled" data-level="9" id="user-agent-automation"><span class="secno">9. </span><span class="content">User-agent automation</span><a class="self-link" href="#user-agent-automation"></a></h2>
   <p>A user agent holds a boolean <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="automation-local-testing-mode-enabled">automation local testing mode enabled</dfn> (default false).</p>
   <p>For the purposes of user-agent automation and website testing, this document
defines the below <a data-link-type="biblio" href="#biblio-webdriver" title="WebDriver">[WebDriver]</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-extension-commands" id="ref-for-dfn-extension-commands">extension commands</a> to control the API
configuration.</p>
   <h3 class="heading settled" data-level="9.1" id="set-local-testing-mode"><span class="secno">9.1. </span><span class="content">Set local testing mode</span><a class="self-link" href="#set-local-testing-mode"></a></h3>
   <figure class="table" id="table-webdriver-setlocaltestingmode">
    <table class="data">
     <thead>
      <tr>
       <th>HTTP Method
       <th>URI Template
     <tbody>
      <tr>
       <td>POST
       <td><code>/session/{session id}/private-aggregation/</code><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="localtestingmode"><code>localtestingmode</code></dfn>
    </table>
   </figure>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-end-steps" id="ref-for-dfn-remote-end-steps">remote end steps</a> are:</p>
   <ol>
    <li data-md>
     <p>If <var>parameters</var> is not a JSON-formatted <a href="https://tc39.es/ecma262/multipage/overview.html#sec-objects">Object</a>,
return a <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error" id="ref-for-dfn-error">WebDriver error</a> with <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error-code" id="ref-for-dfn-error-code">error code</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-invalid-argument" id="ref-for-dfn-invalid-argument">invalid argument</a>.</p>
    <li data-md>
     <p>Let <var>enabled</var> be the result of <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-getting-properties" id="ref-for-dfn-getting-properties">getting a property</a> named <code>"enabled"</code> from <var>parameters</var>.</p>
    <li data-md>
     <p>If <var>enabled</var> is <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined②">undefined</a></code> or is not a boolean, return a <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error" id="ref-for-dfn-error①">WebDriver
error</a> with <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error-code" id="ref-for-dfn-error-code①">error code</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-invalid-argument" id="ref-for-dfn-invalid-argument①">invalid argument</a>.</p>
    <li data-md>
     <p>Set <a data-link-type="dfn" href="#automation-local-testing-mode-enabled" id="ref-for-automation-local-testing-mode-enabled①">automation local testing mode enabled</a> to <var>enabled</var>.</p>
    <li data-md>
     <p>Return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success">success</a> with data <code>null</code>.</p>
   </ol>
   <p class="note" role="note"><span class="marker">Note:</span> Without this, <a data-link-type="dfn" href="#aggregatable-report" id="ref-for-aggregatable-report①③">aggregatable reports</a> would be subject to delays, making
    testing difficult.</p>
   <h2 class="heading settled" data-level="10" id="shared-storage-api-monkey-patches"><span class="secno">10. </span><span class="content">Shared Storage API monkey patches</span><a class="self-link" href="#shared-storage-api-monkey-patches"></a></h2>
   <p class="issue" id="issue-03919572"><a class="self-link" href="#issue-03919572"></a> This should be moved to the Shared Storage spec. <a href="https://github.com/patcg-individual-drafts/private-aggregation-api/issues/43">[Issue #43]</a></p>
   <p class="issue" id="issue-e413f917"><a class="self-link" href="#issue-e413f917"></a> Go through all monkey patches and ensure every definition (including)
    structures that is needed is exported.</p>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://wicg.github.io/shared-storage/#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope"><c- g>SharedStorageWorkletGlobalScope</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#privateaggregation" id="ref-for-privateaggregation⑥"><c- n>PrivateAggregation</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorageWorkletGlobalScope" data-dfn-type="attribute" data-export data-readonly data-type="PrivateAggregation" id="dom-sharedstorageworkletglobalscope-privateaggregation"><code><c- g>privateAggregation</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-sharedstorageprivateaggregationconfig"><code><c- g>SharedStoragePrivateAggregationConfig</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString"><c- b>USVString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStoragePrivateAggregationConfig" data-dfn-type="dict-member" data-export data-type="USVString" id="dom-sharedstorageprivateaggregationconfig-aggregationcoordinatororigin"><code><c- g>aggregationCoordinatorOrigin</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①"><c- b>USVString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStoragePrivateAggregationConfig" data-dfn-type="dict-member" data-export data-type="USVString" id="dom-sharedstorageprivateaggregationconfig-contextid"><code><c- g>contextId</c-></code></dfn>;
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#EnforceRange" id="ref-for-EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStoragePrivateAggregationConfig" data-dfn-type="dict-member" data-export data-type="unsigned long long" id="dom-sharedstorageprivateaggregationconfig-filteringidbytesize"><code><c- g>filteringIdByteSize</c-></code></dfn>;
};

<c- b>partial</c-> <c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="https://wicg.github.io/shared-storage/#dictdef-sharedstoragerunoperationmethodoptions" id="ref-for-dictdef-sharedstoragerunoperationmethodoptions"><c- g>SharedStorageRunOperationMethodOptions</c-></a> {
  <a data-link-type="idl-name" href="#dictdef-sharedstorageprivateaggregationconfig" id="ref-for-dictdef-sharedstorageprivateaggregationconfig"><c- n>SharedStoragePrivateAggregationConfig</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorageRunOperationMethodOptions" data-dfn-type="dict-member" data-export data-type="SharedStoragePrivateAggregationConfig" id="dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig"><code><c- g>privateAggregationConfig</c-></code></dfn>;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-sharedstorageworkletglobalscope-privateaggregation" id="ref-for-dom-sharedstorageworkletglobalscope-privateaggregation">privateAggregation</a></code> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#getter-steps" id="ref-for-getter-steps①">getter steps</a> are
to <a data-link-type="dfn" href="#get-the-privateaggregation" id="ref-for-get-the-privateaggregation①">get the privateAggregation</a> given <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this③">this</a>.</p>
   <p>Add the following algorithm in the subsection
"<a href="https://wicg.github.io/shared-storage/#run-op">Run Operation
Methods</a>":</p>
   <p>To <dfn class="dfn-paneled algorithm" data-algorithm="obtain the aggregation coordinator" data-dfn-type="dfn" data-noexport id="obtain-the-aggregation-coordinator">obtain the aggregation coordinator</dfn> given a <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/shared-storage/#dictdef-sharedstoragerunoperationmethodoptions" id="ref-for-dictdef-sharedstoragerunoperationmethodoptions①">SharedStorageRunOperationMethodOptions</a></code> <var>options</var>, perform the following
steps. They return an <a data-link-type="dfn" href="#aggregation-coordinator" id="ref-for-aggregation-coordinator⑨">aggregation coordinator</a>, null or a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>:</p>
   <ol>
    <li data-md>
     <p>If <var>options</var>["<code>privateAggregationConfig</code>"] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists⑧">exist</a>, return
null.</p>
    <li data-md>
     <p>If <var>options</var>["<code>privateAggregationConfig</code>"]["<code>aggregatonCoordinatorOrigin</code>"]
does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists⑨">exist</a>, return null.</p>
    <li data-md>
     <p>Let <var>url</var> be the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser②">URL parser</a> on <var>options</var>["<code>privateAggregationConfig</code>"]["<code>aggregatonCoordinatorOrigin</code>"].</p>
    <li data-md>
     <p>If <var>url</var> is failure or null, return a new <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code> with name
"<code>SyntaxError</code>".</p>
     <p class="issue" id="issue-5cfca5be"><a class="self-link" href="#issue-5cfca5be"></a> Consider throwing an error if the path is not empty.</p>
    <li data-md>
     <p>Let <var>origin</var> be <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin">origin</a>.</p>
    <li data-md>
     <p>If the result of <a data-link-type="dfn" href="#determine-if-an-origin-is-an-aggregation-coordinator" id="ref-for-determine-if-an-origin-is-an-aggregation-coordinator">determining if an origin is an aggregation coordinator</a> given <var>origin</var> is false, return a new <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑥">DOMException</a></code> with name
"<code>DataError</code>".</p>
    <li data-md>
     <p>Return <var>origin</var>.</p>
   </ol>
   <p>To <dfn class="dfn-paneled algorithm" data-algorithm="obtain the pre-specified report parameters" data-dfn-type="dfn" data-noexport id="obtain-the-pre-specified-report-parameters">obtain the pre-specified report parameters</dfn> given a <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/shared-storage/#dictdef-sharedstoragerunoperationmethodoptions" id="ref-for-dictdef-sharedstoragerunoperationmethodoptions②">SharedStorageRunOperationMethodOptions</a></code> <var>options</var>, perform the following
steps. They return a <a data-link-type="dfn" href="#pre-specified-report-parameters" id="ref-for-pre-specified-report-parameters⑥">pre-specified report parameters</a>, null, or a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑦">DOMException</a></code>:</p>
   <ol>
    <li data-md>
     <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig" id="ref-for-dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig">privateAggregationConfig</a></code>"]
does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①⓪">exist</a>, return null.</p>
    <li data-md>
     <p>Let <var>contextId</var> be null.</p>
    <li data-md>
     <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig" id="ref-for-dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig①">privateAggregationConfig</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-sharedstorageprivateaggregationconfig-contextid" id="ref-for-dom-sharedstorageprivateaggregationconfig-contextid">contextId</a></code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①①">exists</a>, set <var>contextId</var> to <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig" id="ref-for-dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig②">privateAggregationConfig</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-sharedstorageprivateaggregationconfig-contextid" id="ref-for-dom-sharedstorageprivateaggregationconfig-contextid①">contextId</a></code>"].</p>
    <li data-md>
     <p>If <var>contextId</var>’s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-length" id="ref-for-string-length①">length</a> is greater than 64, return a new <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑧">DOMException</a></code> with name "<code>DataError</code>".</p>
    <li data-md>
     <p>Let <var>filteringIdByteSize</var> be 1.</p>
    <li data-md>
     <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig" id="ref-for-dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig③">privateAggregationConfig</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-sharedstorageprivateaggregationconfig-filteringidbytesize" id="ref-for-dom-sharedstorageprivateaggregationconfig-filteringidbytesize">filteringIdByteSize</a></code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①②">exists</a>, set <var>filteringIdByteSize</var> to <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig" id="ref-for-dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig④">privateAggregationConfig</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-sharedstorageprivateaggregationconfig-filteringidbytesize" id="ref-for-dom-sharedstorageprivateaggregationconfig-filteringidbytesize①">filteringIdByteSize</a></code>"].</p>
    <li data-md>
     <p>If <var>filteringIdByteSize</var> is less than 1 or more than 8, return a new <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑨">DOMException</a></code> with name "<code>DataError</code>".</p>
    <li data-md>
     <p>Return a new <a data-link-type="dfn" href="#pre-specified-report-parameters" id="ref-for-pre-specified-report-parameters⑦">pre-specified report parameters</a> with the items:</p>
     <dl>
      <dt data-md><a data-link-type="dfn" href="#pre-specified-report-parameters-context-id" id="ref-for-pre-specified-report-parameters-context-id③">context ID</a>
      <dd data-md>
       <p><var>contextId</var></p>
      <dt data-md><a data-link-type="dfn" href="#pre-specified-report-parameters-filtering-id-byte-size" id="ref-for-pre-specified-report-parameters-filtering-id-byte-size④">filtering ID byte size</a>
      <dd data-md>
       <p><var>filteringIdByteSize</var></p>
     </dl>
   </ol>
   <p>The <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/shared-storage/#windowsharedstorage" id="ref-for-windowsharedstorage">WindowSharedStorage</a></code>'s <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/shared-storage/#dom-windowsharedstorage-run" id="ref-for-dom-windowsharedstorage-run">run()</a></code> method steps are
modified in four ways. First, add the following steps just after step 2 ("If <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule" id="ref-for-dom-worklet-addmodule">addModule()</a></code> has not yet been called, ..."), renumbering later steps
as appropriate:</p>
   <div class="algorithm" data-algorithm="shared-storage-run-monkey-patch-1">
    <ol start="3">
     <li data-md>
      <p>Let <var>preSpecifiedParams</var> be the result of <a data-link-type="dfn" href="#obtain-the-pre-specified-report-parameters" id="ref-for-obtain-the-pre-specified-report-parameters">obtaining the pre-specified
report parameters</a> given <var>options</var>.</p>
     <li data-md>
      <p>If <var>preSpecifiedParams</var> is a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①⓪">DOMException</a></code>, return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with">a promise rejected
with</a> <var>preSpecifiedParams</var>.</p>
     <li data-md>
      <p>Let <var>aggregationCoordinator</var> be the result of <a data-link-type="dfn" href="#obtain-the-aggregation-coordinator" id="ref-for-obtain-the-aggregation-coordinator">obtaining the aggregation
coordinator</a> given <var>options</var>.</p>
     <li data-md>
      <p>If <var>aggregationCoordinator</var> is a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①①">DOMException</a></code>, return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with①">a promise
rejected with</a> <var>aggregationCoordinator</var>.</p>
    </ol>
   </div>
    Second, add the following steps in the nested scope just after "Let <var>operation</var> be <var>operationMap</var>[<var>name</var>]." (renumbering later steps as appropriate): 
   <div class="algorithm" data-algorithm="shared-storage-run-monkey-patch-2">
    <ol start="2">
     <li data-md>
      <p>Let <var>batchingScope</var> be a new <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope⑧">batching scope</a>.</p>
     <li data-md>
      <p>Let <var>debugScope</var> be a new <a data-link-type="dfn" href="#debug-scope" id="ref-for-debug-scope⑧">debug scope</a>.</p>
     <li data-md>
      <p>Let <var>privateAggregationTimeout</var> be null.</p>
     <li data-md>
      <p>If <var>preSpecifiedParams</var> is not null:</p>
      <ol>
       <li data-md>
        <p>Let <var>isDeterministicReport</var> be the result of <a data-link-type="dfn" href="#determine-if-a-null-report-should-be-sent" id="ref-for-determine-if-a-null-report-should-be-sent②">determining if a null
report should be sent</a> given <var>preSpecifiedParams</var>.</p>
       <li data-md>
        <p>If <var>isDeterministicReport</var>:</p>
        <ol>
         <li data-md>
          <p>Set <var>privateAggregationTimeout</var> to the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-current-wall-time" id="ref-for-dfn-current-wall-time④">current wall time</a> plus a
non-negative <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined⑧">implementation-defined</a> <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration⑤">duration</a>.</p>
        </ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#set-the-pre-specified-report-parameters-for-a-batching-scope" id="ref-for-set-the-pre-specified-report-parameters-for-a-batching-scope">Set the pre-specified report parameters for a batching scope</a> given <var>preSpecifiedParams</var> and <var>batchingScope</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>aggregationCoordinator</var> is not null, <a data-link-type="dfn" href="#set-the-aggregation-coordinator-for-a-batching-scope" id="ref-for-set-the-aggregation-coordinator-for-a-batching-scope">set the aggregation coordinator
for a batching scope</a> given <var>aggregationCoordinator</var> and <var>batchingScope</var>.</p>
    </ol>
   </div>
   <p>Third, add the following steps in the same nested scope just before the current
last step ("Otherwise, <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-call" id="ref-for-sec-call">call</a> operation without any arguments list",
renumbering the last step as appropriate):</p>
   <div class="algorithm" data-algorithm="shared-storage-run-monkey-patch-3">
    <ol>
     <li data-md>
      <p>Let <var>hasRunPrivateAggregationCompletionTask</var> be false.</p>
     <li data-md>
      <p>Let <var>privateAggregationCompletionTask</var> be an algorithm to perform the
following steps:</p>
      <ol>
       <li data-md>
        <p>If <var>hasRunPrivateAggregationCompletionTask</var>, return.</p>
       <li data-md>
        <p>Set <var>hasRunPrivateAggregationCompletionTask</var> to true.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#mark-a-debug-scope-complete" id="ref-for-mark-a-debug-scope-complete③">Mark a debug scope complete</a> given <var>debugScope</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#process-contributions-for-a-batching-scope" id="ref-for-process-contributions-for-a-batching-scope③">Process contributions for a batching scope</a> given <var>batchingScope</var>, <var>outsideSettings</var>’ <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin①">origin</a>, "<code>shared-storage</code>" and <var>privateAggregationTimeout</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>preSpecifiedParams</var> is not null:</p>
      <ol>
       <li data-md>
        <p>Let <var>isDeterministicReport</var> be the result of <a data-link-type="dfn" href="#determine-if-a-null-report-should-be-sent" id="ref-for-determine-if-a-null-report-should-be-sent③">determining if a null
report should be sent</a> given <var>preSpecifiedParams</var>.</p>
       <li data-md>
        <p>If <var>isDeterministicReport</var>:</p>
        <ol>
         <li data-md>
          <p>Set <var>privateAggregationTimeout</var> to the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-current-wall-time" id="ref-for-dfn-current-wall-time⑤">current wall time</a> plus a
non-negative <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined⑨">implementation-defined</a> <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration⑥">duration</a>.</p>
        </ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#set-the-pre-specified-report-parameters-for-a-batching-scope" id="ref-for-set-the-pre-specified-report-parameters-for-a-batching-scope①">Set the pre-specified report parameters for a batching scope</a> given <var>preSpecifiedParams</var> and <var>batchingScope</var>.</p>
       <li data-md>
        <p>If <var>isDeterministicReport</var>, run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①">in parallel</a>:</p>
        <ol>
         <li data-md>
          <p>Wait until <var>privateAggregationTimeout</var>.</p>
         <li data-md>
          <p>Run <var>privateAggregationCompletionTask</var>.</p>
        </ol>
      </ol>
    </ol>
   </div>
   <p>Finally, at the end of the same nested scope, add the following step:</p>
   <div class="algorithm" data-algorithm="shared-storage-run-monkey-patch-4">
    <ol start="9">
     <li data-md>
      <p>When the above <a data-link-type="dfn" href="https://tc39.es/ecma262/#sec-call" id="ref-for-sec-call①">call</a> returns, perform the following steps:</p>
      <ol>
       <li data-md>
        <p>Run <var>privateAggregationCompletionTask</var>.</p>
      </ol>
    </ol>
   </div>
   <p>The <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/shared-storage/#windowsharedstorage" id="ref-for-windowsharedstorage①">WindowSharedStorage</a></code>'s <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/shared-storage/#dom-windowsharedstorage-selecturl" id="ref-for-dom-windowsharedstorage-selecturl">selectURL()</a></code> method steps
are modified in three ways. First, add the following steps just after step 5
("If <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule" id="ref-for-dom-worklet-addmodule①">addModule()</a></code> has not yet been called, ..."), renumbering later
steps:</p>
   <div class="algorithm" data-algorithm="shared-storage-selecturl-monkey-patch-1">
    <ol start="6">
     <li data-md>
      <p>Let <var>preSpecifiedParams</var> be the result of <a data-link-type="dfn" href="#obtain-the-pre-specified-report-parameters" id="ref-for-obtain-the-pre-specified-report-parameters①">obtaining the pre-specified
report parameters</a> given <var>options</var>.</p>
     <li data-md>
      <p>If <var>preSpecifiedParams</var> is a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①②">DOMException</a></code>, return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with②">a promise rejected
with</a> <var>preSpecifiedParams</var>.</p>
     <li data-md>
      <p>Let <var>aggregationCoordinator</var> be the result of <a data-link-type="dfn" href="#obtain-the-aggregation-coordinator" id="ref-for-obtain-the-aggregation-coordinator①">obtaining the aggregation
coordinator</a> given <var>options</var>.</p>
     <li data-md>
      <p>If <var>aggregationCoordinator</var> is a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①③">DOMException</a></code>, return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with③">a promise
rejected with</a> <var>aggregationCoordinator</var>.</p>
    </ol>
   </div>
    Second, add the following steps in the nested scope just after "Let <var>operation</var> be <var>operationMap</var>[<var>name</var>]." (renumbering later steps as appropriate): 
   <div class="algorithm" data-algorithm="shared-storage-selecturl-monkey-patch-2">
    <ol start="2">
     <li data-md>
      <p>Let <var>batchingScope</var> be a new <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope⑨">batching scope</a>.</p>
     <li data-md>
      <p>Let <var>debugScope</var> be a new <a data-link-type="dfn" href="#debug-scope" id="ref-for-debug-scope⑨">debug scope</a>.</p>
     <li data-md>
      <p>Let <var>privateAggregationTimeout</var> be null.</p>
     <li data-md>
      <p>Let <var>hasRunPrivateAggregationCompletionTask</var> be false.</p>
     <li data-md>
      <p>Let <var>privateAggregationCompletionTask</var> be an algorithm to perform the
following steps:</p>
      <ol>
       <li data-md>
        <p>If <var>hasRunPrivateAggregationCompletionTask</var>, return.</p>
       <li data-md>
        <p>Set <var>hasRunPrivateAggregationCompletionTask</var> to true.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#mark-a-debug-scope-complete" id="ref-for-mark-a-debug-scope-complete④">Mark a debug scope complete</a> given <var>debugScope</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#process-contributions-for-a-batching-scope" id="ref-for-process-contributions-for-a-batching-scope④">Process contributions for a batching scope</a> given <var>batchingScope</var>, <var>outsideSettings</var>’ <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin②">origin</a>, "<code>shared-storage</code>"
and <var>privateAggregationTimeout</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>aggregationCoordinator</var> is not null, <a data-link-type="dfn" href="#set-the-aggregation-coordinator-for-a-batching-scope" id="ref-for-set-the-aggregation-coordinator-for-a-batching-scope①">set the aggregation coordinator
for a batching scope</a> given <var>aggregationCoordinator</var> and <var>batchingScope</var>.</p>
     <li data-md>
      <p>If <var>preSpecifiedParams</var> is not null:</p>
      <ol>
       <li data-md>
        <p>Let <var>isDeterministicReport</var> be the result of <a data-link-type="dfn" href="#determine-if-a-null-report-should-be-sent" id="ref-for-determine-if-a-null-report-should-be-sent④">determining if a null
report should be sent</a> given <var>preSpecifiedParams</var>.</p>
       <li data-md>
        <p>If <var>isDeterministicReport</var>:</p>
        <ol>
         <li data-md>
          <p>Set <var>privateAggregationTimeout</var> to the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-current-wall-time" id="ref-for-dfn-current-wall-time⑥">current wall time</a> plus a
non-negative <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined①⓪">implementation-defined</a> <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration⑦">duration</a>.</p>
        </ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#set-the-pre-specified-report-parameters-for-a-batching-scope" id="ref-for-set-the-pre-specified-report-parameters-for-a-batching-scope②">Set the pre-specified report parameters for a batching scope</a> given <var>preSpecifiedParams</var> and <var>batchingScope</var>.</p>
       <li data-md>
        <p>If <var>isDeterministicReport</var>, run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②">in parallel</a>:</p>
        <ol>
         <li data-md>
          <p>Wait until <var>privateAggregationTimeout</var>.</p>
         <li data-md>
          <p>Run <var>privateAggregationCompletionTask</var>.</p>
        </ol>
      </ol>
    </ol>
   </div>
    Finally, at the end of the same nested scope, add the following steps: 
   <div class="algorithm" data-algorithm="shared-storage-selecturl-monkey-patch-3">
    <ol start="13">
     <li data-md>
      <p>Run <var>privateAggregationCompletionTask</var>.</p>
    </ol>
   </div>
   <p class="issue" id="issue-be3d1d22"><a class="self-link" href="#issue-be3d1d22"></a> Once <a href="https://github.com/wicg/shared-storage/issues/88"> shared-storage/88</a> is resolved, align the above monkey patches with how <code>keepAlive</code> is handled at operation completion.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule" id="ref-for-dom-worklet-addmodule②">addModule()</a></code> steps are modified to add a new step just before
the final step ("Return <var>promise</var>."), renumbering the last step
as appropriate:</p>
   <div class="algorithm" data-algorithm="shared-storage-addmodule-monkey-patch">
    <ol start="7">
     <li data-md>
      <p>If <var>this</var> is a <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/shared-storage/#sharedstorageworklet" id="ref-for-sharedstorageworklet">SharedStorageWorklet</a></code>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#upon-fulfillment" id="ref-for-upon-fulfillment">upon fulfillment</a> of <var>promise</var> or <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#upon-rejection" id="ref-for-upon-rejection">upon rejection</a> of <var>promise</var>, run the following steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>globalScopes</var> be <var>this</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/worklets.html#concept-worklet-global-scopes" id="ref-for-concept-worklet-global-scopes">global scopes</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①⑥">Assert</a>: <var>globalScopes</var>’ <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size③">size</a> equals 1.</p>
       <li data-md>
        <p>Let <var>privateAggregationObj</var> be <var>globalScopes</var>[0]'s <code class="idl"><a data-link-type="idl" href="#dom-sharedstorageworkletglobalscope-privateaggregation" id="ref-for-dom-sharedstorageworkletglobalscope-privateaggregation①">privateAggregation</a></code>.</p>
       <li data-md>
        <p>Set <var>privateAggregationObj</var>’s <a data-link-type="dfn" href="#privateaggregation-allowed-to-use" id="ref-for-privateaggregation-allowed-to-use③">allowed to use</a> to
the result of determining whether <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this④">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global">relevant global
object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" id="ref-for-concept-document-window">associated document</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use" id="ref-for-allowed-to-use①">allowed to use</a> the
"<code><a data-link-type="dfn" href="#private-aggregation" id="ref-for-private-aggregation①">private-aggregation</a></code>" <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" id="ref-for-policy-controlled-feature③">policy-controlled feature</a>.</p>
        <p class="issue" id="issue-fccec62f"><a class="self-link" href="#issue-fccec62f"></a> Consider adding an early return here (and equivalently for
    Protected Audience) if the permissions policy check is made first.</p>
       <li data-md>
        <p>Set <var>privateAggregationObj</var>’s <a data-link-type="dfn" href="#privateaggregation-scoping-details" id="ref-for-privateaggregation-scoping-details⑤">scoping details</a> to a
    new <a data-link-type="dfn" href="#scoping-details" id="ref-for-scoping-details①">scoping details</a> with the items:</p>
        <dl>
         <dt data-md><a data-link-type="dfn" href="#scoping-details-get-batching-scope-steps" id="ref-for-scoping-details-get-batching-scope-steps②">get batching scope steps</a>
         <dd data-md>
          <p>An algorithm that returns the <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope①⓪">batching scope</a> that is scheduled to
be passed to <a data-link-type="dfn" href="#process-contributions-for-a-batching-scope" id="ref-for-process-contributions-for-a-batching-scope⑤">process contributions for a batching scope</a> when the
call currently executing in <var>scope</var> returns.</p>
         <dt data-md><a data-link-type="dfn" href="#scoping-details-get-debug-scope-steps" id="ref-for-scoping-details-get-debug-scope-steps③">get debug scope steps</a>
         <dd data-md>
          <p>An algorithm that returns the <a data-link-type="dfn" href="#debug-scope" id="ref-for-debug-scope①⓪">debug scope</a> that is scheduled to be
passed to <a data-link-type="dfn" href="#mark-a-debug-scope-complete" id="ref-for-mark-a-debug-scope-complete⑤">mark a debug scope complete</a> when the call currently
executing in <var>scope</var> returns.</p>
        </dl>
        <p class="note" role="note"><span class="marker">Note:</span> Multiple operation invocations can be in-progress at the same
time, each with a different batching scope and debug scope. However,
only one can be currently executing.</p>
      </ol>
    </ol>
   </div>
   <p class="issue" id="issue-9d79975e"><a class="self-link" href="#issue-9d79975e"></a> Once <a href="https://github.com/wicg/shared-storage/issues/89"> shared-storage/89</a> is resolved, align the above monkey patch with how
    access to <code>sharedStorage</code> is prevented in <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/shared-storage/#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope①">SharedStorageWorkletGlobalScope</a></code>s until <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule" id="ref-for-dom-worklet-addmodule③">addModule()</a></code>'s initial
    execution is complete.</p>
   <p class="note" role="note"><span class="marker">Note:</span> This extends Shared Storage’s existing <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule" id="ref-for-dom-worklet-addmodule④">addModule()</a></code> <a href="https://wicg.github.io/shared-storage/#worklet-monkey-patch"> monkey patch</a>.</p>
   <h2 class="heading settled" data-level="11" id="protected-audience-api-monkey-patches"><span class="secno">11. </span><span class="content">Protected Audience API monkey patches</span><a class="self-link" href="#protected-audience-api-monkey-patches"></a></h2>
   <p class="issue" id="issue-eecd6fa0"><a class="self-link" href="#issue-eecd6fa0"></a> This should be moved to the Protected Audience spec, along with any
    other Protected Audience-specific details. <a href="https://github.com/patcg-individual-drafts/private-aggregation-api/issues/43">[Issue #43]</a></p>
   <h3 class="heading settled" data-level="11.1" id="protected-audience-api-specific-webidl"><span class="secno">11.1. </span><span class="content">New WebIDL</span><a class="self-link" href="#protected-audience-api-specific-webidl"></a></h3>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://wicg.github.io/turtledove/#interestgroupscriptrunnerglobalscope" id="ref-for-interestgroupscriptrunnerglobalscope"><c- g>InterestGroupScriptRunnerGlobalScope</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#privateaggregation" id="ref-for-privateaggregation⑦"><c- n>PrivateAggregation</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="InterestGroupScriptRunnerGlobalScope" data-dfn-type="attribute" data-export data-readonly data-type="PrivateAggregation" id="dom-interestgroupscriptrunnerglobalscope-privateaggregation"><code><c- g>privateAggregation</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-pasignalvalue"><code><c- g>PASignalValue</c-></code></dfn> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PASignalValue" data-dfn-type="dict-member" data-export data-type="DOMString" id="dom-pasignalvalue-basevalue"><code><c- g>baseValue</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PASignalValue" data-dfn-type="dict-member" data-export data-type="double" id="dom-pasignalvalue-scale"><code><c- g>scale</c-></code></dfn>;
  (<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint" id="ref-for-idl-bigint③"><c- b>bigint</c-></a> <c- b>or</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long" id="ref-for-idl-long②"><c- b>long</c-></a>) <dfn class="dfn-paneled idl-code" data-dfn-for="PASignalValue" data-dfn-type="dict-member" data-export data-type="(bigint or long)" id="dom-pasignalvalue-offset"><code><c- g>offset</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-paextendedhistogramcontribution"><code><c- g>PAExtendedHistogramContribution</c-></code></dfn> {
  <c- b>required</c-> (<a data-link-type="idl-name" href="#dictdef-pasignalvalue" id="ref-for-dictdef-pasignalvalue"><c- n>PASignalValue</c-></a> <c- b>or</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint" id="ref-for-idl-bigint④"><c- b>bigint</c-></a>) <dfn class="dfn-paneled idl-code" data-dfn-for="PAExtendedHistogramContribution" data-dfn-type="dict-member" data-export data-type="(PASignalValue or bigint)" id="dom-paextendedhistogramcontribution-bucket"><code><c- g>bucket</c-></code></dfn>;
  <c- b>required</c-> (<a data-link-type="idl-name" href="#dictdef-pasignalvalue" id="ref-for-dictdef-pasignalvalue①"><c- n>PASignalValue</c-></a> <c- b>or</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long" id="ref-for-idl-long③"><c- b>long</c-></a>) <dfn class="dfn-paneled idl-code" data-dfn-for="PAExtendedHistogramContribution" data-dfn-type="dict-member" data-export data-type="(PASignalValue or long)" id="dom-paextendedhistogramcontribution-value"><code><c- g>value</c-></code></dfn>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>InterestGroupScriptRunnerGlobalScope</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext①"><c- g>SecureContext</c-></a>]
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="#privateaggregation" id="ref-for-privateaggregation⑧"><c- g>PrivateAggregation</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined③"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-privateaggregation-contributetohistogramonevent" id="ref-for-dom-privateaggregation-contributetohistogramonevent"><c- g>contributeToHistogramOnEvent</c-></a>(
      <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAggregation/contributeToHistogramOnEvent(event, contribution)" data-dfn-type="argument" data-export id="dom-privateaggregation-contributetohistogramonevent-event-contribution-event"><code><c- g>event</c-></code></dfn>, <a data-link-type="idl-name" href="#dictdef-paextendedhistogramcontribution" id="ref-for-dictdef-paextendedhistogramcontribution"><c- n>PAExtendedHistogramContribution</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAggregation/contributeToHistogramOnEvent(event, contribution)" data-dfn-type="argument" data-export id="dom-privateaggregation-contributetohistogramonevent-event-contribution-contribution"><code><c- g>contribution</c-></code></dfn>);
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-auctionreportbuyersconfig"><code><c- g>AuctionReportBuyersConfig</c-></code></dfn> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint" id="ref-for-idl-bigint⑤"><c- b>bigint</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="AuctionReportBuyersConfig" data-dfn-type="dict-member" data-export data-type="bigint" id="dom-auctionreportbuyersconfig-bucket"><code><c- g>bucket</c-></code></dfn>;
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double①"><c- b>double</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="AuctionReportBuyersConfig" data-dfn-type="dict-member" data-export data-type="double" id="dom-auctionreportbuyersconfig-scale"><code><c- g>scale</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-auctionreportbuyerdebugmodeconfig"><code><c- g>AuctionReportBuyerDebugModeConfig</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-default="false" data-dfn-for="AuctionReportBuyerDebugModeConfig" data-dfn-type="dict-member" data-export data-type="boolean" id="dom-auctionreportbuyerdebugmodeconfig-enabled"><code><c- g>enabled</c-></code></dfn> = <c- b>false</c->;

  // Must only be provided if `enabled` is true.
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint" id="ref-for-idl-bigint⑥"><c- b>bigint</c-></a>? <dfn class="dfn-paneled idl-code" data-dfn-for="AuctionReportBuyerDebugModeConfig" data-dfn-type="dict-member" data-export data-type="bigint?" id="dom-auctionreportbuyerdebugmodeconfig-debugkey"><code><c- g>debugKey</c-></code></dfn>;
};

<c- b>partial</c-> <c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="https://wicg.github.io/turtledove/#dictdef-auctionadconfig" id="ref-for-dictdef-auctionadconfig"><c- g>AuctionAdConfig</c-></a> {
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint" id="ref-for-idl-bigint⑦"><c- b>bigint</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="AuctionAdConfig" data-dfn-type="dict-member" data-export data-type="sequence<bigint>" id="dom-auctionadconfig-auctionreportbuyerkeys"><code><c- g>auctionReportBuyerKeys</c-></code></dfn>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-record" id="ref-for-idl-record"><c- b>record</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a>, <a data-link-type="idl-name" href="#dictdef-auctionreportbuyersconfig" id="ref-for-dictdef-auctionreportbuyersconfig"><c- n>AuctionReportBuyersConfig</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="AuctionAdConfig" data-dfn-type="dict-member" data-export data-type="record<DOMString, AuctionReportBuyersConfig>" id="dom-auctionadconfig-auctionreportbuyers"><code><c- g>auctionReportBuyers</c-></code></dfn>;
  <a data-link-type="idl-name" href="#dictdef-auctionreportbuyerdebugmodeconfig" id="ref-for-dictdef-auctionreportbuyerdebugmodeconfig"><c- n>AuctionReportBuyerDebugModeConfig</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="AuctionAdConfig" data-dfn-type="dict-member" data-export data-type="AuctionReportBuyerDebugModeConfig" id="dom-auctionadconfig-auctionreportbuyerdebugmodeconfig"><code><c- g>auctionReportBuyerDebugModeConfig</c-></code></dfn>;
};
</pre>
   <p class="note" role="note"><span class="marker">Note:</span> <code>requiredSellerCapabilities</code> is defined in the <a href="https://wicg.github.io/turtledove/#dictdef-auctionadconfig" id="536688c80">Protected
    Audience spec</a>.</p>
   <p class="issue" id="issue-6c6263d3"><a class="self-link" href="#issue-6c6263d3"></a> Do we want to align naming with implementation?</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-interestgroupscriptrunnerglobalscope-privateaggregation" id="ref-for-dom-interestgroupscriptrunnerglobalscope-privateaggregation">privateAggregation</a></code> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#getter-steps" id="ref-for-getter-steps②">getter steps</a> are to <a data-link-type="dfn" href="#get-the-privateaggregation" id="ref-for-get-the-privateaggregation②">get the privateAggregation</a> given <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑤">this</a>.</p>
   <div class="algorithm" data-algorithm="contributeToHistogramOnEvent(DOMString event, PAExtendedHistogramContribution contribution)" data-algorithm-for="PrivateAggregation"> The <dfn class="dfn-paneled idl-code" data-dfn-for="PrivateAggregation" data-dfn-type="method" data-export data-lt="contributeToHistogramOnEvent(event, contribution)" id="dom-privateaggregation-contributetohistogramonevent"><code>contributeToHistogramOnEvent(DOMString
event, PAExtendedHistogramContribution contribution)</code></dfn> method steps are: </div>
   <ol>
    <li data-md>
     <p>Let <var>scopingDetails</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑥">this</a>'s <a data-link-type="dfn" href="#privateaggregation-scoping-details" id="ref-for-privateaggregation-scoping-details⑥">scoping details</a>.</p>
    <li data-md>
     <p>If <var>event</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-starts-with" id="ref-for-string-starts-with">starts with</a> "<code>reserved.</code>" and « "<code>reserved.always</code>",
"<code>reserved.loss</code>", "<code>reserved.win</code>" » does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain①">contain</a> <var>event</var>,
return.</p>
     <p class="note" role="note"><span class="marker">Note:</span> No error is thrown to allow forward compatibility if additional
    reserved event types are added later.</p>
    <li data-md>
     <p>Let <var>bucket</var> be <var>contribution</var>["<code class="idl"><a data-link-type="idl" href="#dom-paextendedhistogramcontribution-bucket" id="ref-for-dom-paextendedhistogramcontribution-bucket">bucket</a></code>"].</p>
    <li data-md>
     <p>If <var>bucket</var> is a <code class="idl"><a data-link-type="idl" href="#dictdef-pasignalvalue" id="ref-for-dictdef-pasignalvalue②">PASignalValue</a></code>:</p>
     <ol>
      <li data-md>
       <p>If <var>bucket</var>["<code class="idl"><a data-link-type="idl" href="#dom-pasignalvalue-basevalue" id="ref-for-dom-pasignalvalue-basevalue">baseValue</a></code>"] is not a valid <a data-link-type="dfn" href="#signal-base-value" id="ref-for-signal-base-value">signal base
value</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw⑦">throw</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror">TypeError</a></code>.</p>
      <li data-md>
       <p>If <var>bucket</var>["<code class="idl"><a data-link-type="idl" href="#dom-pasignalvalue-offset" id="ref-for-dom-pasignalvalue-offset">offset</a></code>"] is not a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-bigint" id="ref-for-idl-bigint⑧">bigint</a></code>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw⑧"> throw</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror①">TypeError</a></code>.</p>
     </ol>
    <li data-md>
     <p>Otherwise, if <var>contribution</var>["<code class="idl"><a data-link-type="idl" href="#dom-paextendedhistogramcontribution-bucket" id="ref-for-dom-paextendedhistogramcontribution-bucket①">bucket</a></code>"] is
not in the range [0, 2<sup>128</sup>−1], <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw⑨">throw</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror②">TypeError</a></code>.</p>
     <p class="issue" id="issue-19bb6635"><a class="self-link" href="#issue-19bb6635"></a> Make the error type consistent with <code class="idl"><a data-link-type="idl" href="#dom-privateaggregation-contributetohistogram" id="ref-for-dom-privateaggregation-contributetohistogram①">contributeToHistogram(contribution)</a></code>.</p>
    <li data-md>
     <p>Let <var>value</var> be <var>contribution</var>["<code class="idl"><a data-link-type="idl" href="#dom-paextendedhistogramcontribution-value" id="ref-for-dom-paextendedhistogramcontribution-value">value</a></code>"].</p>
    <li data-md>
     <p>If <var>value</var> is a <code class="idl"><a data-link-type="idl" href="#dictdef-pasignalvalue" id="ref-for-dictdef-pasignalvalue③">PASignalValue</a></code>:</p>
     <ol>
      <li data-md>
       <p>If <var>value</var>["<code class="idl"><a data-link-type="idl" href="#dom-pasignalvalue-basevalue" id="ref-for-dom-pasignalvalue-basevalue①">baseValue</a></code>"] is not a valid <a data-link-type="dfn" href="#signal-base-value" id="ref-for-signal-base-value①">signal base
value</a>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①⓪">throw</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror③">TypeError</a></code>.</p>
      <li data-md>
       <p>If <var>value</var>["<code class="idl"><a data-link-type="idl" href="#dom-pasignalvalue-offset" id="ref-for-dom-pasignalvalue-offset①">offset</a></code>"] is a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-bigint" id="ref-for-idl-bigint⑨">bigint</a></code>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①①"> throw</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror④">TypeError</a></code>.</p>
     </ol>
    <li data-md>
     <p>Otherwise, if <var>contribution</var>["<code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-value" id="ref-for-dom-pahistogramcontribution-value③">value</a></code>"] is
negative, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①②">throw</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑤">TypeError</a></code>.</p>
    <li data-md>
     <p>If <var>contribution</var>["<code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-filteringid" id="ref-for-dom-pahistogramcontribution-filteringid⑤">filteringId</a></code>] is not in the
range [0, 255], <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①③">throw</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑥">TypeError</a></code>.</p>
     <p class="issue" id="issue-3f41aae0"><a class="self-link" href="#issue-3f41aae0"></a> Make the error types on validation issues here and above consistent
    with <code class="idl"><a data-link-type="idl" href="#dom-privateaggregation-contributetohistogram" id="ref-for-dom-privateaggregation-contributetohistogram②">contributeToHistogram(contribution)</a></code>.</p>
     <p class="note" role="note"><span class="marker">Note:</span> It is not currently possible to set a non-default filtering ID byte
    size for Protected Audience.</p>
    <li data-md>
     <p>Let <var>batchingScope</var> be null.</p>
    <li data-md>
     <p>If <var>event</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-starts-with" id="ref-for-string-starts-with①">starts with</a> "<code>reserved.</code>", set <var>batchingScope</var> to the
result of running <var>scopingDetails</var>’ <a data-link-type="dfn" href="#scoping-details-get-batching-scope-steps" id="ref-for-scoping-details-get-batching-scope-steps③">get batching scope
steps</a>.</p>
     <p class="note" role="note"><span class="marker">Note:</span> Each non-reserved <var>event</var> will have a different <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope①①">batching scope</a> that is created later.</p>
    <li data-md>
     <p>Let <var>entry</var> be a new <a data-link-type="dfn" href="#on-event-contribution-cache-entry" id="ref-for-on-event-contribution-cache-entry">on event contribution cache entry</a> with the items:</p>
     <dl>
      <dt data-md><a data-link-type="dfn" href="#on-event-contribution-cache-entry-contribution" id="ref-for-on-event-contribution-cache-entry-contribution">contribution</a>
      <dd data-md>
       <p><var>contribution</var></p>
      <dt data-md><a data-link-type="dfn" href="#on-event-contribution-cache-entry-batching-scope" id="ref-for-on-event-contribution-cache-entry-batching-scope">batching scope</a>
      <dd data-md>
       <p><var>batchingScope</var></p>
      <dt data-md><a data-link-type="dfn" href="#on-event-contribution-cache-entry-debug-scope" id="ref-for-on-event-contribution-cache-entry-debug-scope">debug scope</a>
      <dd data-md>
       <p>The result of running <var>scopingDetails</var>’ <a data-link-type="dfn" href="#scoping-details-get-debug-scope-steps" id="ref-for-scoping-details-get-debug-scope-steps④">get debug scope
steps</a>.</p>
      <dt data-md><a data-link-type="dfn" href="#on-event-contribution-cache-entry-worklet-function" id="ref-for-on-event-contribution-cache-entry-worklet-function">worklet function</a>
      <dd data-md>
       <p>The <a data-link-type="dfn" href="#worklet-function" id="ref-for-worklet-function">worklet function</a> that is currently being executed.</p>
     </dl>
    <li data-md>
     <p>Let <var>global</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑦">this</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①">relevant global object</a>.</p>
    <li data-md>
     <p>Let <var>auctionConfig</var> be <var>global</var>’s <a data-link-type="dfn" href="#interestgroupscriptrunnerglobalscope-auction-config" id="ref-for-interestgroupscriptrunnerglobalscope-auction-config">auction config</a>.</p>
    <li data-md>
     <p>Let <var>ig</var> be the result of <a data-link-type="dfn" href="#maybe-obtain-an-interest-group" id="ref-for-maybe-obtain-an-interest-group">maybe obtaining an
interest group</a> given <var>global</var>.</p>
    <li data-md>
     <p>Let <var>cacheMap</var> be <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-per-bid-or-seller-on-event-contribution-cache" id="ref-for-auction-config-per-bid-or-seller-on-event-contribution-cache">per-bid or seller on
event contribution cache</a>.</p>
    <li data-md>
     <p>If <var>cacheMap</var>[<var>ig</var>] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①③">exist</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set⑧">set</a> <var>cacheMap</var>[<var>ig</var>] to
a new <a data-link-type="dfn" href="#on-event-contribution-cache" id="ref-for-on-event-contribution-cache">on event contribution cache</a>.</p>
    <li data-md>
     <p>Let <var>onEventContributionCache</var> be <var>cacheMap</var>[<var>ig</var>].</p>
    <li data-md>
     <p>If <var>onEventContributionCache</var>[<var>event</var>] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①④">exist</a>, set <var>onEventContributionCache</var>[<var>event</var>] to a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①③">list</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append⑥">Append</a> <var>entry</var> to <var>onEventContributionCache</var>[<var>event</var>].</p>
   </ol>
   <p class="issue" id="issue-2f48ed07③"><a class="self-link" href="#issue-2f48ed07③"></a> Ensure errors are of an appropriate type, e.g. <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidaccesserror" id="ref-for-invalidaccesserror④">InvalidAccessError</a></code> is
    deprecated.</p>
   <p class="issue" id="issue-e90e23c5①"><a class="self-link" href="#issue-e90e23c5①"></a> Consider accepting an array of contributions. <a href="https://github.com/patcg-individual-drafts/private-aggregation-api/issues/44">[Issue #44]</a></p>
   <h3 class="heading settled" data-level="11.2" id="protected-audience-api-webidl-modifications"><span class="secno">11.2. </span><span class="content">WebIDL modifications</span><a class="self-link" href="#protected-audience-api-webidl-modifications"></a></h3>
   <p>The <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/turtledove/#dictdef-auctionadconfig" id="ref-for-dictdef-auctionadconfig①">AuctionAdConfig</a></code> and <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/turtledove/#dictdef-auctionadinterestgroup" id="ref-for-dictdef-auctionadinterestgroup">AuctionAdInterestGroup</a></code> dictionaries are
modified to add a new field:</p>
<pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-protectedaudienceprivateaggregationconfig"><code><c- g>ProtectedAudiencePrivateAggregationConfig</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString②"><c- b>USVString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="ProtectedAudiencePrivateAggregationConfig" data-dfn-type="dict-member" data-export data-type="USVString" id="dom-protectedaudienceprivateaggregationconfig-aggregationcoordinatororigin"><code><c- g>aggregationCoordinatorOrigin</c-></code></dfn>;
};

<c- b>partial</c-> <c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="https://wicg.github.io/turtledove/#dictdef-auctionadconfig" id="ref-for-dictdef-auctionadconfig②"><c- g>AuctionAdConfig</c-></a> {
  <a data-link-type="idl-name" href="#dictdef-protectedaudienceprivateaggregationconfig" id="ref-for-dictdef-protectedaudienceprivateaggregationconfig"><c- n>ProtectedAudiencePrivateAggregationConfig</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="AuctionAdConfig" data-dfn-type="dict-member" data-export data-type="ProtectedAudiencePrivateAggregationConfig" id="dom-auctionadconfig-privateaggregationconfig"><code><c- g>privateAggregationConfig</c-></code></dfn>;
};

<c- b>partial</c-> <c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="https://wicg.github.io/turtledove/#dictdef-auctionadinterestgroup" id="ref-for-dictdef-auctionadinterestgroup①"><c- g>AuctionAdInterestGroup</c-></a> {
  <a data-link-type="idl-name" href="#dictdef-protectedaudienceprivateaggregationconfig" id="ref-for-dictdef-protectedaudienceprivateaggregationconfig①"><c- n>ProtectedAudiencePrivateAggregationConfig</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="AuctionAdInterestGroup" data-dfn-type="dict-member" data-export data-type="ProtectedAudiencePrivateAggregationConfig" id="dom-auctionadinterestgroup-privateaggregationconfig"><code><c- g>privateAggregationConfig</c-></code></dfn>;
};
</pre>
   <p class="note" role="note"><span class="marker">Note:</span> <code>sellerCapabilities</code> is defined in the <a href="https://wicg.github.io/turtledove#dictdef-generatebidinterestgroup">Protected
    Audience spec</a></p>
   <h3 class="heading settled" data-level="11.3" id="protected-audience-api-specific-structures"><span class="secno">11.3. </span><span class="content">Structures</span><a class="self-link" href="#protected-audience-api-specific-structures"></a></h3>
   <h4 class="heading settled" data-level="11.3.1" id="extending-auction-config"><span class="secno">11.3.1. </span><span class="content">Extending auction config</span><a class="self-link" href="#extending-auction-config"></a></h4>
   <p>Extend the <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#auction-config" id="ref-for-auction-config">auction config</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct⑤">struct</a> to add new fields:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="auction config" data-dfn-type="dfn" data-noexport id="auction-config-per-bid-or-seller-on-event-contribution-cache">per-bid or seller on event contribution cache</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①⓪">map</a> from <a data-link-type="dfn" href="https://www.w3.org/Consortium/Process/#GroupsIG" id="ref-for-GroupsIG">interest group</a> or null to a <a data-link-type="dfn" href="#on-event-contribution-cache" id="ref-for-on-event-contribution-cache①">on event contribution
cache</a>.</p>
     <p class="note" role="note"><span class="marker">Note:</span> a null key represents the seller.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="auction config" data-dfn-type="dfn" data-noexport id="auction-config-batching-scope-map">batching scope map</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①①">map</a> from a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple②">tuple</a> consisting of an <dfn data-var-ignore>origin</dfn> (an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin①①">origin</a>) and a <dfn data-var-ignore>coordinator</dfn> (an <a data-link-type="dfn" href="#aggregation-coordinator" id="ref-for-aggregation-coordinator①⓪">aggregation
coordinator</a>) to a <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope①②">batching scope</a>.</p>
     <p class="note" role="note"><span class="marker">Note:</span> Does not include <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope①③">batching scopes</a> for contributions conditional on
    non-reserved events.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="auction config" data-dfn-type="dfn" data-noexport id="auction-config-permissions-policy-state">permissions policy state</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="#permissions-policy-state" id="ref-for-permissions-policy-state">permissions policy state</a>.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="auction config" data-dfn-type="dfn" data-noexport id="auction-config-seller-private-aggregation-coordinator">seller Private Aggregation coordinator</dfn>
    <dd data-md>
     <p>An <a data-link-type="dfn" href="#aggregation-coordinator" id="ref-for-aggregation-coordinator①①">aggregation coordinator</a>. Defaults to the <a data-link-type="dfn" href="#default-aggregation-coordinator" id="ref-for-default-aggregation-coordinator①">default aggregation
coordinator</a>.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="auction config" data-dfn-type="dfn" data-noexport id="auction-config-auction-report-buyer-keys">auction report buyer keys</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①②">map</a> from buyer <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin①②">origins</a> to <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-bigint" id="ref-for-idl-bigint①⓪">bigint</a></code>s.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="auction config" data-dfn-type="dfn" data-noexport id="auction-config-auction-report-buyers">auction report buyers</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①③">map</a> from <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑨">strings</a> to <code class="idl"><a data-link-type="idl" href="#dictdef-auctionreportbuyersconfig" id="ref-for-dictdef-auctionreportbuyersconfig①">AuctionReportBuyersConfig</a></code>s.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="auction config" data-dfn-type="dfn" data-noexport id="auction-config-auction-report-buyer-debug-details">auction report buyer debug details</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details①④">debug details</a>.</p>
     <p class="issue" id="issue-96d1f594"><a class="self-link" href="#issue-96d1f594"></a> Consider replacing the strings above with specific enum types.</p>
   </dl>
   <h4 class="heading settled" data-level="11.3.2" id="extending-interest-group"><span class="secno">11.3.2. </span><span class="content">Extending interest group</span><a class="self-link" href="#extending-interest-group"></a></h4>
   <p>Extend the <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#interest-group" id="ref-for-interest-group">interest group</a> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct⑥">struct</a> to add a new
field:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="interest group" data-dfn-type="dfn" data-noexport id="interest-group-private-aggregation-coordinator">Private Aggregation coordinator</dfn>
    <dd data-md>
     <p>An <a data-link-type="dfn" href="#aggregation-coordinator" id="ref-for-aggregation-coordinator①②">aggregation coordinator</a> or null.</p>
     <p class="note" role="note"><span class="marker">Note:</span> a null value specifies the default coordinator.</p>
   </dl>
   <p><br> Add the following definitions in a new subsection at the end of <a href="https://wicg.github.io/turtledove/#structures">Structures</a>,
renumbered appropriately.</p>
   <h4 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="11.3.3" data-lt="Permissions policy state" data-noexport id="permissions-policy-state"><span class="secno">11.3.3. </span><span class="content">Permissions policy state</span><a class="self-link" href="#permissions-policy-state" id="ref-for-permissions-policy-state②"></a></h4>
    A permissions policy state is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct⑦">struct</a> with the following items: 
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="permissions policy state" data-dfn-type="dfn" data-noexport id="permissions-policy-state-private-aggregation-enabled">private aggregation enabled</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean①⓪">boolean</a> (default false)</p>
   </dl>
   <h4 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="11.3.4" data-lt="Signal base value" data-noexport id="signal-base-value"><span class="secno">11.3.4. </span><span class="content">Signal base value</span><a class="self-link" href="#signal-base-value" id="ref-for-signal-base-value④"></a></h4>
    A signal base value is one of the following: 
   <dl>
    <dt data-md>"<dfn class="dfn-paneled" data-dfn-for="signal base value" data-dfn-type="dfn" data-noexport id="signal-base-value-winning-bid"><code>winning-bid</code></dfn>"
    <dd data-md>
     <p>The numeric value is the bid value of the winning bid.</p>
    <dt data-md>"<dfn class="dfn-paneled" data-dfn-for="signal base value" data-dfn-type="dfn" data-noexport id="signal-base-value-highest-scoring-other-bid"><code>highest-scoring-other-bid</code></dfn>"
    <dd data-md>
     <p>The numeric value is the bid value of the highest scoring bid that did not
win.</p>
    <dt data-md>"<dfn class="dfn-paneled" data-dfn-for="signal base value" data-dfn-type="dfn" data-noexport id="signal-base-value-script-run-time"><code>script-run-time</code></dfn>"
    <dd data-md>
     <p>The numeric value is the number of milliseconds of CPU time the calling
function (e.g. <code>generateBid()</code>) took to run.</p>
    <dt data-md>"<dfn class="dfn-paneled" data-dfn-for="signal base value" data-dfn-type="dfn" data-noexport id="signal-base-value-signals-fetch-time"><code>signals-fetch-time</code></dfn>"
    <dd data-md>
     <p>The numeric value is the number of milliseconds it took for the trusted
bidding or scoring signals fetch to complete, when called from <code>generateBid()</code> or <code>scoreAd()</code>, respectively.</p>
     <p class="issue" id="issue-a30a4985"><a class="self-link" href="#issue-a30a4985"></a> Can this value be used in <code>reportWin()</code> or <code>reportResult()</code>?</p>
    <dt data-md>"<dfn class="dfn-paneled" data-dfn-for="signal base value" data-dfn-type="dfn" data-noexport id="signal-base-value-bid-reject-reason"><code>bid-reject-reason</code></dfn>"
    <dd data-md>
     <p>The numeric value is an integer representing the reason a bid was rejected.</p>
     <p class="note" role="note"><span class="marker">Note:</span> this mapping to an integer is defined in <a data-link-type="dfn" href="#determine-a-signals-numeric-value" id="ref-for-determine-a-signals-numeric-value">determine a signal’s
    numeric value</a>.</p>
   </dl>
   <h4 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="11.3.5" data-lt="Worklet function" data-noexport id="worklet-function"><span class="secno">11.3.5. </span><span class="content">Worklet function</span><a class="self-link" href="#worklet-function" id="ref-for-worklet-function④"></a></h4>
    A worklet function is one of the following: 
   <dl>
    <dt data-md>"<dfn class="dfn-paneled" data-dfn-for="worklet function" data-dfn-type="dfn" data-noexport id="worklet-function-generate-bid"><code>generate-bid</code></dfn>"
    <dd data-md>
     <p>The <code>generateBid()</code> function.</p>
    <dt data-md>"<dfn class="dfn-paneled" data-dfn-for="worklet function" data-dfn-type="dfn" data-noexport id="worklet-function-score-ad"><code>score-ad</code></dfn>"
    <dd data-md>
     <p>The <code>scoreAd()</code> function.</p>
    <dt data-md>"<dfn class="dfn-paneled" data-dfn-for="worklet function" data-dfn-type="dfn" data-noexport id="worklet-function-report-result"><code>report-result</code></dfn>"
    <dd data-md>
     <p>The <code>reportResult()</code> function.</p>
    <dt data-md>"<dfn class="dfn-paneled" data-dfn-for="worklet function" data-dfn-type="dfn" data-noexport id="worklet-function-report-win"><code>report-win</code></dfn>"
    <dd data-md>
     <p>The <code>reportWin()</code> function.</p>
   </dl>
   <h4 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="11.3.6" data-lt="On event contribution cache entry" data-noexport id="on-event-contribution-cache-entry"><span class="secno">11.3.6. </span><span class="content">On event contribution cache entry</span><a class="self-link" href="#on-event-contribution-cache-entry" id="ref-for-on-event-contribution-cache-entry②"></a></h4>
    An on event contribution cache entry is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct⑧">struct</a> with the following items: 
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="on event contribution cache entry" data-dfn-type="dfn" data-noexport id="on-event-contribution-cache-entry-contribution">contribution</dfn>
    <dd data-md>
     <p>A <code class="idl"><a data-link-type="idl" href="#dictdef-paextendedhistogramcontribution" id="ref-for-dictdef-paextendedhistogramcontribution①">PAExtendedHistogramContribution</a></code></p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="on event contribution cache entry" data-dfn-type="dfn" data-noexport id="on-event-contribution-cache-entry-batching-scope">batching scope</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope①④">batching scope</a> or null</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="on event contribution cache entry" data-dfn-type="dfn" data-noexport id="on-event-contribution-cache-entry-debug-scope">debug scope</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="#debug-scope" id="ref-for-debug-scope①①">debug scope</a></p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="on event contribution cache entry" data-dfn-type="dfn" data-noexport id="on-event-contribution-cache-entry-debug-details">debug details</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details①⑤">debug details</a> or null (default null)</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="on event contribution cache entry" data-dfn-type="dfn" data-noexport id="on-event-contribution-cache-entry-worklet-function">worklet function</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="#worklet-function" id="ref-for-worklet-function①">worklet function</a></p>
   </dl>
   <h4 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="11.3.7" data-lt="On event contribution cache" data-noexport id="on-event-contribution-cache"><span class="secno">11.3.7. </span><span class="content">On event contribution cache</span><a class="self-link" href="#on-event-contribution-cache" id="ref-for-on-event-contribution-cache②"></a></h4>
    An on event contribution cache is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①④">map</a> from <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string①⓪">string</a> to a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①④">list</a> of <a data-link-type="dfn" href="#on-event-contribution-cache-entry" id="ref-for-on-event-contribution-cache-entry①">on event contribution cache entries</a>. 
   <h4 class="heading settled" data-level="11.3.8" id="extending-interestgroupscriptrunnerglobalscope"><span class="secno">11.3.8. </span><span class="content">Extending
InterestGroupScriptRunnerGlobalScope</span><a class="self-link" href="#extending-interestgroupscriptrunnerglobalscope"></a></h4>
   <p>Extend the <a href="https://wicg.github.io/turtledove/#global-scopes">global
scopes</a> subsection to add:</p>
   <p>Each <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/turtledove/#interestgroupscriptrunnerglobalscope" id="ref-for-interestgroupscriptrunnerglobalscope①">InterestGroupScriptRunnerGlobalScope</a></code> has an:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="InterestGroupScriptRunnerGlobalScope" data-dfn-type="dfn" data-noexport id="interestgroupscriptrunnerglobalscope-auction-config">auction config</dfn>
    <dd data-md>
     <p>An <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#auction-config" id="ref-for-auction-config①">auction config</a></p>
   </dl>
   <h4 class="heading settled" data-level="11.3.9" id="extending-interestgroupreportingscriptrunnerglobalscope"><span class="secno">11.3.9. </span><span class="content">Extending
InterestGroupReportingScriptRunnerGlobalScope</span><a class="self-link" href="#extending-interestgroupreportingscriptrunnerglobalscope"></a></h4>
   <p>Extend the <a href="https://wicg.github.io/turtledove/#reporting-global-scope">InterestGroupReportingScriptRunnerGlobalScope</a> subsection to add an extra field to the end of the list beginning
"Each <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope" id="ref-for-interestgroupreportingscriptrunnerglobalscope">InterestGroupReportingScriptRunnerGlobalScope</a></code> has a":</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="InterestGroupReportingScriptRunnerGlobalScope" data-dfn-type="dfn" data-noexport id="interestgroupreportingscriptrunnerglobalscope-interest-group">interest group</dfn>
    <dd data-md>
     <p>Null or an <a data-link-type="dfn" href="https://www.w3.org/Consortium/Process/#GroupsIG" id="ref-for-GroupsIG①">interest group</a>. Null for seller reporting
(i.e. <code>reportResult()</code>).</p>
   </dl>
   <h3 class="heading settled" data-level="11.4" id="protected-audience-api-algorithm-modifications"><span class="secno">11.4. </span><span class="content">Algorithm modifications</span><a class="self-link" href="#protected-audience-api-algorithm-modifications"></a></h3>
   <p>The <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/turtledove/#dom-navigator-joinadinterestgroup" id="ref-for-dom-navigator-joinadinterestgroup">joinAdInterestGroup()</a></code> method steps are modified to add the
following steps at the end of the scope nested under step 5 ("Validate the given <var>group</var> and ..."):</p>
   <div class="algorithm" data-algorithm="protected-audience-joinadig-monkey-patch">
    <ol start="17">
     <li data-md>
      <p>If <var>group</var>[<code class="idl"><a data-link-type="idl" href="#dom-auctionadinterestgroup-privateaggregationconfig" id="ref-for-dom-auctionadinterestgroup-privateaggregationconfig">privateAggregationConfig</a></code>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①⑤">exists</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>aggregationCoordinator</var> be the result of <a data-link-type="dfn" href="#obtain-the-private-aggregation-coordinator" id="ref-for-obtain-the-private-aggregation-coordinator">obtaining the Private
Aggregation coordinator</a> given <var>group</var>[<code class="idl"><a data-link-type="idl" href="#dom-auctionadinterestgroup-privateaggregationconfig" id="ref-for-dom-auctionadinterestgroup-privateaggregationconfig①">privateAggregationConfig</a></code>].</p>
       <li data-md>
        <p>If <var>aggregationCoordinator</var> is a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①④">DOMException</a></code>, then <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①④">throw</a> <var>aggregationCoordinator</var>.</p>
       <li data-md>
        <p>Set <var>interestGroup</var>’s <a data-link-type="dfn" href="#interest-group-private-aggregation-coordinator" id="ref-for-interest-group-private-aggregation-coordinator">Private
Aggregation coordinator</a> to <var>aggregationCoordinator</var>.</p>
      </ol>
    </ol>
   </div>
   <p>The <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/turtledove/#dom-navigator-runadauction" id="ref-for-dom-navigator-runadauction">runAdAuction()</a></code> method steps are modified to add the
following step just after step 5 ("If <var>auctionConfig</var> is a
failure, then..."), renumbering the later steps as appropriate:</p>
   <div class="algorithm" data-algorithm="protected-audience-runadauction-monkey-patch">
    <ol start="6">
     <li data-md>
      <p>Set <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-permissions-policy-state" id="ref-for-auction-config-permissions-policy-state">permissions policy
state</a> to a new <a data-link-type="dfn" href="#permissions-policy-state" id="ref-for-permissions-policy-state①">permissions policy state</a> with the items:</p>
      <dl>
       <dt data-md><a data-link-type="dfn" href="#permissions-policy-state-private-aggregation-enabled" id="ref-for-permissions-policy-state-private-aggregation-enabled">private aggregation enabled</a>
       <dd data-md>
        <p>The result of determining whether <var>global</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" id="ref-for-concept-document-window①">associated
Document</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use" id="ref-for-allowed-to-use②">allowed to use</a> the
"<code><a data-link-type="dfn" href="#private-aggregation" id="ref-for-private-aggregation②">private-aggregation</a></code>" <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" id="ref-for-policy-controlled-feature④">policy-controlled feature</a>.</p>
      </dl>
    </ol>
   </div>
   <p>The <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#validate-and-convert-auction-ad-config" id="ref-for-validate-and-convert-auction-ad-config">validate and convert auction ad config</a> steps are
modified to add the following steps just before the last step ("Return <var>auctionConfig</var>"), renumbering the later step as appropriate:</p>
   <div class="algorithm" data-algorithm="protected-audience-validate-config-monkey-patch">
    <ol start="31">
     <li data-md>
      <p>If <var>config</var>["<code><code class="idl"><a data-link-type="idl" href="#dom-auctionadconfig-auctionreportbuyerkeys" id="ref-for-dom-auctionadconfig-auctionreportbuyerkeys">auctionReportBuyerKeys</a></code></code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①⑥">exists</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>interestGroupBuyers</var> be <var>auctionConfig</var>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#auction-config-interest-group-buyers" id="ref-for-auction-config-interest-group-buyers">interest group buyers</a>.</p>
       <li data-md>
        <p>If <var>interestGroupBuyers</var> is null, set <var>interestGroupBuyers</var> to a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①⑤">list</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑧">For each</a> <var>index</var> of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#the-exclusive-range" id="ref-for-the-exclusive-range①">the range</a> 0 to <var>config</var>["<code><code class="idl"><a data-link-type="idl" href="#dom-auctionadconfig-auctionreportbuyerkeys" id="ref-for-dom-auctionadconfig-auctionreportbuyerkeys①">auctionReportBuyerKeys</a></code></code>"]'s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size④">size</a>, exclusive:</p>
        <ol>
         <li data-md>
          <p>Let <var>key</var> be <var>config</var>["<code><code class="idl"><a data-link-type="idl" href="#dom-auctionadconfig-auctionreportbuyerkeys" id="ref-for-dom-auctionadconfig-auctionreportbuyerkeys②">auctionReportBuyerKeys</a></code></code>"][<var>index</var>].</p>
         <li data-md>
          <p>If <var>key</var> is not in the range [0, 2<sup>128</sup>−1], <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①⑤">throw</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑦">TypeError</a></code>.</p>
         <li data-md>
          <p>If <var>index</var> is equal to or greater than <var>interestGroupBuyers</var>’ <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size⑤"> size</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue">continue</a>.</p>
          <p class="note" role="note"><span class="marker">Note:</span> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①">Continue</a> is used (instead of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-break" id="ref-for-iteration-break①"> break</a>) to match validation logic for all given buyer keys.</p>
         <li data-md>
          <p>Let <var>origin</var> be <var>interestGroupBuyers</var>[<var>index</var>].</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set⑨">Set</a> <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-auction-report-buyer-keys" id="ref-for-auction-config-auction-report-buyer-keys">auction report buyer
keys</a>[<var>origin</var>] to <var>key</var>.</p>
          <p class="issue" id="issue-748cd0cd"><a class="self-link" href="#issue-748cd0cd"></a> Check behavior when an origin is repeated in <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/turtledove/#dom-auctionadconfig-interestgroupbuyers" id="ref-for-dom-auctionadconfig-interestgroupbuyers">interestGroupBuyers</a></code>.</p>
        </ol>
      </ol>
     <li data-md>
      <p>If <var>config</var>["<code><code class="idl"><a data-link-type="idl" href="#dom-auctionadconfig-auctionreportbuyers" id="ref-for-dom-auctionadconfig-auctionreportbuyers">auctionReportBuyers</a></code></code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①⑦"> exists</a>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate①">For each</a> <var>reportType</var> → <var>reportBuyerConfig</var> of <var>config</var>["<code><code class="idl"><a data-link-type="idl" href="#dom-auctionadconfig-auctionreportbuyers" id="ref-for-dom-auctionadconfig-auctionreportbuyers①">auctionReportBuyers</a></code></code>"]:</p>
        <ol>
         <li data-md>
          <p>If « "<code>interestGroupCount</code>", "<code>bidCount</code>",
"<code>totalGenerateBidLatency</code>", "<code>totalSignalsFetchLatency</code>" » does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain②">contain</a> <var>reportType</var>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue②">continue</a>.</p>
          <p class="note" role="note"><span class="marker">Note:</span> No error is thrown to allow forward compatibility if
    additional report types are added later.</p>
          <p class="issue" id="issue-dc306cf6"><a class="self-link" href="#issue-dc306cf6"></a> Should these strings be dash delimited?</p>
         <li data-md>
          <p>If <var>reportBuyerConfig</var>["<code><code class="idl"><a data-link-type="idl" href="#dom-auctionreportbuyersconfig-bucket" id="ref-for-dom-auctionreportbuyersconfig-bucket">bucket</a></code></code>"] is not in the range [0, 2<sup>128</sup>−1], <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①⑥">throw</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑧">TypeError</a></code>.</p>
          <p class="issue" id="issue-f9af52a1"><a class="self-link" href="#issue-f9af52a1"></a> Consider validating the case where the bucket used (after
    summing) is too large. Currently, the implementation appears to
    overflow. See <a href="https://github.com/WICG/turtledove/issues/1040"> protected-audience/1040</a>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set①⓪">Set</a> <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-auction-report-buyers" id="ref-for-auction-config-auction-report-buyers">auction report
buyers</a>[<var>reportType</var>] to <var>reportBuyerConfig</var>.</p>
        </ol>
      </ol>
     <li data-md>
      <p>Set <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-auction-report-buyer-debug-details" id="ref-for-auction-config-auction-report-buyer-debug-details">auction report buyer debug details</a> to a new <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details①⑥">debug details</a>.</p>
     <li data-md>
      <p>If <var>config</var>[<code class="idl"><a data-link-type="idl" href="#dom-auctionadconfig-auctionreportbuyerdebugmodeconfig" id="ref-for-dom-auctionadconfig-auctionreportbuyerdebugmodeconfig">auctionReportBuyerDebugModeConfig</a></code>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①⑧">exists</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>debugModeConfig</var> be <var>config</var>[<code class="idl"><a data-link-type="idl" href="#dom-auctionadconfig-auctionreportbuyerdebugmodeconfig" id="ref-for-dom-auctionadconfig-auctionreportbuyerdebugmodeconfig①">auctionReportBuyerDebugModeConfig</a></code>].</p>
       <li data-md>
        <p>Let <var>enabled</var> be <var>debugModeConfig</var>[<code class="idl"><a data-link-type="idl" href="#dom-auctionreportbuyerdebugmodeconfig-enabled" id="ref-for-dom-auctionreportbuyerdebugmodeconfig-enabled">enabled</a></code>].</p>
       <li data-md>
        <p>Let <var>debugKey</var> be <var>debugModeConfig</var>[<code class="idl"><a data-link-type="idl" href="#dom-auctionreportbuyerdebugmodeconfig-debugkey" id="ref-for-dom-auctionreportbuyerdebugmodeconfig-debugkey">debugKey</a></code>].</p>
       <li data-md>
        <p>If <var>debugKey</var> is not null:</p>
        <ol>
         <li data-md>
          <p>If <var>debugKey</var> is not in the range [0, 2<sup>64</sup>−1], <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①⑦"> throw</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑨">TypeError</a></code>.</p>
         <li data-md>
          <p>If <var>enabled</var> is false, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①⑧">throw</a> a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror①⓪">TypeError</a></code>.</p>
        </ol>
       <li data-md>
        <p>Set <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-auction-report-buyer-debug-details" id="ref-for-auction-config-auction-report-buyer-debug-details①">auction report buyer debug
details</a> to a new <a data-link-type="dfn" href="#debug-details" id="ref-for-debug-details①⑦">debug details</a> with the items:</p>
        <dl>
         <dt data-md><a data-link-type="dfn" href="#debug-details-enabled" id="ref-for-debug-details-enabled⑤">enabled</a>
         <dd data-md>
          <p><var>enabled</var></p>
         <dt data-md><a data-link-type="dfn" href="#debug-details-key" id="ref-for-debug-details-key③">key</a>
         <dd data-md>
          <p><var>debugKey</var></p>
        </dl>
      </ol>
     <li data-md>
      <p>If <var>config</var>[<code class="idl"><a data-link-type="idl" href="#dom-auctionadconfig-privateaggregationconfig" id="ref-for-dom-auctionadconfig-privateaggregationconfig">privateAggregationConfig</a></code>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①⑨">exists</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>aggregationCoordinator</var> be the result of <a data-link-type="dfn" href="#obtain-the-private-aggregation-coordinator" id="ref-for-obtain-the-private-aggregation-coordinator①">obtaining the Private
Aggregation coordinator</a> given <var>config</var>[<code class="idl"><a data-link-type="idl" href="#dom-auctionadconfig-privateaggregationconfig" id="ref-for-dom-auctionadconfig-privateaggregationconfig①">privateAggregationConfig</a></code>].</p>
       <li data-md>
        <p>If <var>aggregationCoordinator</var> is a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①⑤">DOMException</a></code>, return failure.</p>
       <li data-md>
        <p>Set <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-seller-private-aggregation-coordinator" id="ref-for-auction-config-seller-private-aggregation-coordinator">seller Private
Aggregation coordinator</a> to <var>aggregationCoordinator</var>.</p>
      </ol>
    </ol>
    <p class="issue" id="issue-f42384db"><a class="self-link" href="#issue-f42384db"></a> Make all map indexing links (throughout the spec) where possible, i.e.
    matching this section.</p>
   </div>
   <p>The <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#generate-and-score-bids" id="ref-for-generate-and-score-bids">generate and score bids</a> algorithm is modified by
inserting the following step before each of the two "Return <var>leadingBidInfo</var>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#leading-bid-info-leading-bid" id="ref-for-leading-bid-info-leading-bid">leading bid</a>" steps (one in a
nested scope), renumbering this and later steps as necessary.</p>
   <div class="algorithm" data-algorithm="protected-audience-generate-and-score-bids-monkey-patch">
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="#process-the-private-aggregation-contributions-for-an-auction" id="ref-for-process-the-private-aggregation-contributions-for-an-auction">Process the Private Aggregation contributions for an auction</a> given <var>auctionConfig</var> and <var>leadingBidInfo</var>.</p>
    </ol>
   </div>
   <p>The <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#evaluate-a-script" id="ref-for-evaluate-a-script">evaluate a script</a> steps are modified in two ways.
First, we add the following steps after step 11 ("If <var>evaluationStatus</var> is an <a data-link-type="dfn" href="https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type" id="ref-for-sec-completion-record-specification-type">abrupt completion</a>..."),
renumbering later steps as appropriate:</p>
   <div class="algorithm" data-algorithm="protected-audience-evaluate-a-script-monkey-patch">
    <ol start="12">
     <li data-md>
      <p>Set <var>global</var>’s <code class="idl"><a data-link-type="idl" href="#dom-interestgroupscriptrunnerglobalscope-privateaggregation" id="ref-for-dom-interestgroupscriptrunnerglobalscope-privateaggregation①">privateAggregation</a></code>'s <a data-link-type="dfn" href="#privateaggregation-allowed-to-use" id="ref-for-privateaggregation-allowed-to-use④">allowed to use</a> to <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-permissions-policy-state" id="ref-for-auction-config-permissions-policy-state①"> permissions policy state</a>'s <a data-link-type="dfn" href="#permissions-policy-state-private-aggregation-enabled" id="ref-for-permissions-policy-state-private-aggregation-enabled①">private aggregation
enabled</a>.</p>
     <li data-md>
      <p>Let <var>debugScope</var> be a new <a data-link-type="dfn" href="#debug-scope" id="ref-for-debug-scope①②">debug scope</a>.</p>
     <li data-md>
      <p>Set <var>global</var>’s <code class="idl"><a data-link-type="idl" href="#dom-interestgroupscriptrunnerglobalscope-privateaggregation" id="ref-for-dom-interestgroupscriptrunnerglobalscope-privateaggregation②">privateAggregation</a></code>'s <a data-link-type="dfn" href="#privateaggregation-scoping-details" id="ref-for-privateaggregation-scoping-details⑦">scoping details</a> to a new <a data-link-type="dfn" href="#scoping-details" id="ref-for-scoping-details②">scoping details</a> with the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item">items</a>:</p>
      <dl>
       <dt data-md><a data-link-type="dfn" href="#scoping-details-get-batching-scope-steps" id="ref-for-scoping-details-get-batching-scope-steps④">get batching scope steps</a>
       <dd data-md>
        <p>An algorithm that performs the following steps:</p>
        <ol>
         <li data-md>
          <p>Let <var>origin</var> be <var>realm</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-settings-object" id="ref-for-concept-realm-settings-object">settings object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin" id="ref-for-concept-settings-object-origin③">origin</a>.</p>
         <li data-md>
          <p>Let <var>ig</var> be the result of <a data-link-type="dfn" href="#maybe-obtain-an-interest-group" id="ref-for-maybe-obtain-an-interest-group①">maybe
obtaining an interest group</a> given <var>realm</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global" id="ref-for-concept-realm-global">global
object</a>.</p>
         <li data-md>
          <p>Let <var>aggregationCoordinator</var> be null.</p>
         <li data-md>
          <p>If <var>ig</var> is not null, set <var>aggregationCoordinator</var> to <var>ig</var>’s <a data-link-type="dfn" href="#interest-group-private-aggregation-coordinator" id="ref-for-interest-group-private-aggregation-coordinator①">Private Aggregation coordinator</a>.</p>
         <li data-md>
          <p>Otherwise, set <var>aggregationCoordinator</var> to <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-seller-private-aggregation-coordinator" id="ref-for-auction-config-seller-private-aggregation-coordinator①">seller Private Aggregation coordinator</a>.</p>
         <li data-md>
          <p>If <var>aggregationCoordinator</var> is null, set <var>aggregationCoordinator</var> to
the <a data-link-type="dfn" href="#default-aggregation-coordinator" id="ref-for-default-aggregation-coordinator②">default aggregation coordinator</a>.</p>
         <li data-md>
          <p>Return the result of running <a data-link-type="dfn" href="#get-or-create-a-batching-scope" id="ref-for-get-or-create-a-batching-scope">get or create a batching scope</a> given <var>origin</var>, <var>aggregationCoordinator</var> and <var>auctionConfig</var>.</p>
        </ol>
       <dt data-md><a data-link-type="dfn" href="#scoping-details-get-debug-scope-steps" id="ref-for-scoping-details-get-debug-scope-steps⑤">get debug scope steps</a>
       <dd data-md>
        <p>An algorithm that returns <var>debugScope</var>.</p>
      </dl>
    </ol>
   </div>
   <p class="issue" id="issue-c0bfec19"><a class="self-link" href="#issue-c0bfec19"></a> Once <a href="https://github.com/wicg/turtledove/issues/615"> protected-audience/615</a> is resolved, align the above monkey patch with
    how access to other functions is prevented in <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/turtledove/#interestgroupscriptrunnerglobalscope" id="ref-for-interestgroupscriptrunnerglobalscope②">InterestGroupScriptRunnerGlobalScope</a></code>s until the script’s initial
    execution is complete.</p>
   <p>Second, in the nested scope of the last step, we insert a new step just after
the step labelled "Clean up after script", renumbering the later step as
appropriate:</p>
   <div class="algorithm" data-algorithm="protected-audience-evaluate-a-script-monkey-patch-2">
    <ol start="2">
     <li data-md>
      <p>Let <var>debugDetails</var> be the result of <a data-link-type="dfn" href="#get-a-debug-details" id="ref-for-get-a-debug-details">get a debug details</a> given <var>debugScope</var>.</p>
     <li data-md>
      <p>Let <var>ig</var> be the result of <a data-link-type="dfn" href="#maybe-obtain-an-interest-group" id="ref-for-maybe-obtain-an-interest-group②">maybe obtaining an
interest group</a> given <var>global</var>.</p>
     <li data-md>
      <p>Let <var>onEventContributionCache</var> be <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-per-bid-or-seller-on-event-contribution-cache" id="ref-for-auction-config-per-bid-or-seller-on-event-contribution-cache①">per-bid or seller on event contribution cache</a>[<var>ig</var>].</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate②">For each</a> <var>event</var> → <var>entries</var> of <var>onEventContributionCache</var>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑨">For each</a> <var>onEventEntry</var> of <var>entries</var>:</p>
        <ol>
         <li data-md>
          <p>If <var>onEventEntry</var>’s <a data-link-type="dfn" href="#on-event-contribution-cache-entry-debug-scope" id="ref-for-on-event-contribution-cache-entry-debug-scope①">debug scope</a> is <var>debugScope</var>, set <var>onEventEntry</var>’s <a data-link-type="dfn" href="#on-event-contribution-cache-entry-debug-details" id="ref-for-on-event-contribution-cache-entry-debug-details">debug details</a> to <var>debugDetails</var>.</p>
        </ol>
      </ol>
     <li data-md>
      <p><a data-link-type="dfn" href="#mark-a-debug-scope-complete" id="ref-for-mark-a-debug-scope-complete⑥">Mark a debug scope complete</a> given <var>debugScope</var>.</p>
    </ol>
   </div>
   <p>The <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#evaluate-a-bidding-script" id="ref-for-evaluate-a-bidding-script">evaluate a bidding script</a> steps are modified in the
following two ways. First, we add a new parameter <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#auction-config" id="ref-for-auction-config②">auction
config</a> <var>auctionConfig</var>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> This algorithm already takes an <a data-link-type="dfn" href="https://www.w3.org/Consortium/Process/#GroupsIG" id="ref-for-GroupsIG②">interest group</a> parameter <var>ig</var>.</p>
   <p>Second, we add the following step after step 6 ("Set <var>global</var>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-interest-group" id="ref-for-interestgroupbiddingscriptrunnerglobalscope-interest-group">interest
group</a> to <var>ig</var>"), renumbering later steps as appropriate:</p>
   <div class="algorithm" data-algorithm="protected-audience-evaluate-a-bidding-script-monkey-patch">
    <ol start="7">
     <li data-md>
      <p>Set <var>global</var>’s <a data-link-type="dfn" href="#interestgroupscriptrunnerglobalscope-auction-config" id="ref-for-interestgroupscriptrunnerglobalscope-auction-config①">auction
config</a> to <var>auctionConfig</var>.</p>
    </ol>
   </div>
   <p>The <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#evaluate-a-scoring-script" id="ref-for-evaluate-a-scoring-script">evaluate a scoring script</a> steps are modified in the
following two ways. First, we add a new parameter <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#auction-config" id="ref-for-auction-config③">auction
config</a> <var>auctionConfig</var>.</p>
   <p>Second, we add the following step after step 1 ("Let <var>global</var> be a new <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/turtledove/#interestgroupscoringscriptrunnerglobalscope" id="ref-for-interestgroupscoringscriptrunnerglobalscope">InterestGroupScoringScriptRunnerGlobalScope</a></code>."),
renumbering the later step as appropriate:</p>
   <div class="algorithm" data-algorithm="protected-audience-evaluate-a-scoring-script-monkey-patch">
    <ol start="2">
     <li data-md>
      <p>Set <var>global</var>’s <a data-link-type="dfn" href="#interestgroupscriptrunnerglobalscope-auction-config" id="ref-for-interestgroupscriptrunnerglobalscope-auction-config②">auction
config</a> to <var>auctionConfig</var>.</p>
    </ol>
   </div>
   <p>The <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#evaluate-a-reporting-script" id="ref-for-evaluate-a-reporting-script">evaluate a reporting script</a> steps are modified in
the following two ways. First, we add two new parameters: an <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#auction-config" id="ref-for-auction-config④">auction config</a> <var>auctionConfig</var> and an <a data-link-type="dfn" href="https://www.w3.org/Consortium/Process/#GroupsIG" id="ref-for-GroupsIG③">interest
group</a> or null <var>ig</var>.</p>
   <p>Second, we add the following step after step 1 ("Let <var>global</var> be a new <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope" id="ref-for-interestgroupreportingscriptrunnerglobalscope①">InterestGroupReportingScriptRunnerGlobalScope</a></code>."),
renumbering the later step as appropriate:</p>
   <div class="algorithm" data-algorithm="protected-audience-evaluate-a-reporting-script-monkey-patch">
    <ol start="2">
     <li data-md>
      <p>Set <var>global</var>’s <a data-link-type="dfn" href="#interestgroupscriptrunnerglobalscope-auction-config" id="ref-for-interestgroupscriptrunnerglobalscope-auction-config③">auction config</a> to <var>auctionConfig</var>.</p>
     <li data-md>
      <p>Set <var>global</var>’s <a data-link-type="dfn" href="#interestgroupreportingscriptrunnerglobalscope-interest-group" id="ref-for-interestgroupreportingscriptrunnerglobalscope-interest-group">interest
group</a> to <var>ig</var>.</p>
    </ol>
   </div>
   <p>Then, we modify the invocations of the above algorithms to plumb the new
parameters in:</p>
   <p>The <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#generate-a-bid" id="ref-for-generate-a-bid">generate a bid</a> algorithm is modified to add a new <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#auction-config" id="ref-for-auction-config⑤">auction config</a> parameter <var>auctionConfig</var>. Additionally,
its last step is modified by adding the argument <var>auctionConfig</var> to the
invocation of <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#evaluate-a-bidding-script" id="ref-for-evaluate-a-bidding-script①">evaluating a bidding script</a>. Further, the <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#generate-and-score-bids" id="ref-for-generate-and-score-bids①">generate and score bids</a> algorithm is modified by
adding the argument <var>auctionConfig</var> to both invocations of <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#generate-a-bid" id="ref-for-generate-a-bid①">generate a bid</a>.</p>
   <p>The <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#score-and-rank-a-bid" id="ref-for-score-and-rank-a-bid">score and rank a bid</a> algorithm is modified by
adding the argument <var>auctionConfig</var> to the invocation of <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#evaluate-a-scoring-script" id="ref-for-evaluate-a-scoring-script①">evaluating a scoring script</a>.</p>
   <p>The <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#report-result" id="ref-for-report-result">report result</a> algorithm is modified by passing in
the arguments <var>auctionConfig</var> and null to the invocation of <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#evaluate-a-reporting-script" id="ref-for-evaluate-a-reporting-script①">evaluate a reporting script</a>.</p>
   <p>The <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#report-win" id="ref-for-report-win">report win</a> algorithm is modified by passing in
the arguments <var>auctionConfig</var> and <var>winner</var>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#generated-bid-interest-group" id="ref-for-generated-bid-interest-group">interest group</a> to the invocation of <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#evaluate-a-reporting-script" id="ref-for-evaluate-a-reporting-script②">evaluate a reporting script</a>.</p>
   <p>The <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#interest-group-estimated-size" id="ref-for-interest-group-estimated-size">estimated size</a> of an interest
group algorithm is modified to add the following line at the end of the sum:</p>
   <div class="algorithm" data-algorithm="protected-audience-estimated-size-monkey-patch">
    <ol start="16">
     <li data-md>
      <p>The <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-length" id="ref-for-string-length②">length</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin③">serialization</a> of <var>ig</var>’s <a data-link-type="dfn" href="#interest-group-private-aggregation-coordinator" id="ref-for-interest-group-private-aggregation-coordinator②">Private Aggregation coordinator</a> if
the field is not null.</p>
    </ol>
   </div>
   <p>The <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#interest-group-update" id="ref-for-interest-group-update">update interest groups</a> steps are modified to add the following case at the end of the "Switch on <var>key</var>" step.</p>
   <div class="algorithm" data-algorithm="protected-audience-update-interest-groups-monkey-patch">
    <dl class="switch">
     <dt data-md>"<code>privateAggregationConfig</code>"
     <dd data-md>
      <ol>
       <li data-md>
        <p>If <var>value</var> is not a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①⑤">map</a> whose <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-getting-the-keys" id="ref-for-map-getting-the-keys">keys</a> are <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string①①">strings</a>, jump to
the step labeled Abort update.</p>
       <li data-md>
        <p>If <var>value</var>["<code>aggregationCoordinatorOrigin</code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②⓪">exists</a>:</p>
        <ol>
         <li data-md>
          <p>If <var>value</var>["<code>aggregationCoordinatorOrigin</code>"] is not a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string①②">string</a>,
jump to the step labeled Abort update.</p>
         <li data-md>
          <p>Let <var>aggregationCoordinator</var> be the result of <a data-link-type="dfn" href="#obtain-the-private-aggregation-coordinator-from-a-string" id="ref-for-obtain-the-private-aggregation-coordinator-from-a-string">obtaining the Private
Aggregation coordinator</a> given <var>value</var>["<code>aggregationCoordinatorOrigin</code>"].</p>
         <li data-md>
          <p>If <var>aggregationCoordinator</var> is a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①⑥">DOMException</a></code>, jump to the step
labeled Abort update.</p>
         <li data-md>
          <p>Otherwise, set <var>ig</var>’s <a data-link-type="dfn" href="#interest-group-private-aggregation-coordinator" id="ref-for-interest-group-private-aggregation-coordinator③">Private
Aggregation coordinator</a> to <var>aggregationCoordinator</var>.</p>
        </ol>
      </ol>
    </dl>
   </div>
   <h3 class="heading settled" data-level="11.5" id="protected-audience-api-specific-new-algorithms"><span class="secno">11.5. </span><span class="content">New algorithms</span><a class="self-link" href="#protected-audience-api-specific-new-algorithms"></a></h3>
   <p>Add the following definitions:</p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="process-the-private-aggregation-contributions-for-an-auction">process the Private Aggregation contributions for an auction</dfn> given
an <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#auction-config" id="ref-for-auction-config⑥">auction config</a> <var>auctionConfig</var> and a <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#leading-bid-info" id="ref-for-leading-bid-info">leading bid info</a> <var>leadingBidInfo</var>:</p>
   <ol>
    <li data-md>
     <p>Let <var>winnerOrigin</var> be null.</p>
    <li data-md>
     <p>If <var>leadingBidInfo</var>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#leading-bid-info-leading-bid" id="ref-for-leading-bid-info-leading-bid①">leading
bid</a> is not null, set <var>winnerOrigin</var> to <var>leadingBidInfo</var>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#leading-bid-info-leading-bid" id="ref-for-leading-bid-info-leading-bid②">leading bid</a>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#generated-bid-interest-group" id="ref-for-generated-bid-interest-group①">interest group</a>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#interest-group-owner" id="ref-for-interest-group-owner">owner</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate③">For each</a> <var>ig</var> → <var>onEventContributionCache</var> of <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-per-bid-or-seller-on-event-contribution-cache" id="ref-for-auction-config-per-bid-or-seller-on-event-contribution-cache②">per-bid or seller on event contribution
cache</a>:</p>
     <ol>
      <li data-md>
       <p>Let <var>origin</var> be null.</p>
      <li data-md>
       <p>If <var>ig</var> is null, set <var>origin</var> to <var>auctionConfig</var>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#auction-config-seller" id="ref-for-auction-config-seller">seller</a>.</p>
      <li data-md>
       <p>Otherwise, set <var>origin</var> to <var>ig</var>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#interest-group-owner" id="ref-for-interest-group-owner①">owner</a>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate④">For each</a> <var>event</var> → <var>entries</var> of <var>onEventContributionCache</var>:</p>
       <ol>
        <li data-md>
         <p>If <var>event</var> is "<code>reserved.win</code>" or does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-starts-with" id="ref-for-string-starts-with②">start with</a> "<code>reserved.</code>":</p>
         <ol>
          <li data-md>
           <p>If <var>origin</var> is not <var>winnerOrigin</var>, return.</p>
         </ol>
        <li data-md>
         <p>If <var>event</var> is "<code>reserved.loss</code>" and <var>origin</var> is <var>winnerOrigin</var>,
return.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①⓪">For each</a> <var>onEventEntry</var> of <var>entries</var>:</p>
         <ol>
          <li data-md>
           <p>Let <var>filledInContribution</var> be the result of <a data-link-type="dfn" href="#fill-in-the-contribution" id="ref-for-fill-in-the-contribution">filling in the
contribution</a> given <var>onEventEntry</var>’s <a data-link-type="dfn" href="#on-event-contribution-cache-entry-contribution" id="ref-for-on-event-contribution-cache-entry-contribution①">contribution</a> and <var>leadingBidInfo</var>.</p>
           <p class="issue" id="issue-72654077"><a class="self-link" href="#issue-72654077"></a> Once <a href="https://github.com/WICG/turtledove/issues/627"> protected-audience/627</a> is resolved, align 'filling in'
    logic with <code>forDebuggingOnly</code>.</p>
          <li data-md>
           <p>If <var>event</var> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-starts-with" id="ref-for-string-starts-with③">start with</a> "<code>reserved.</code>":</p>
           <ol>
            <li data-md>
             <p>Store <var>event</var>, <var>filledInContribution</var>, <var>onEventEntry</var>’s <a data-link-type="dfn" href="#on-event-contribution-cache-entry-debug-details" id="ref-for-on-event-contribution-cache-entry-debug-details①">debug details</a> in the <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/fenced-frame/#fencedframeconfig" id="ref-for-fencedframeconfig">FencedFrameConfig</a></code> as appropriate.</p>
             <p class="note" role="note"><span class="marker">Note:</span> Each non-reserved <var>event</var> will have a different <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope①⑤">batching scope</a>.</p>
             <p class="issue" id="issue-c54b92f8"><a class="self-link" href="#issue-c54b92f8"></a> Once <a href="https://github.com/WICG/turtledove/issues/616"> protected-audience/616</a> and any successors are
    landed, align integration and fill in fenced frame’s <a data-link-type="dfn" href="https://wicg.github.io/fenced-frame/#report-a-private-aggregation-event" id="ref-for-report-a-private-aggregation-event">report a private aggregation
    event</a>.</p>
            <li data-md>
             <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue③">Continue</a>.</p>
           </ol>
          <li data-md>
           <p>Let <var>entry</var> be a new <a data-link-type="dfn" href="#contribution-cache-entry" id="ref-for-contribution-cache-entry④">contribution cache entry</a> with the items:</p>
           <dl>
            <dt data-md><a data-link-type="dfn" href="#contribution-cache-entry-contribution" id="ref-for-contribution-cache-entry-contribution②">contribution</a>
            <dd data-md>
             <p><var>filledInContribution</var></p>
            <dt data-md><a data-link-type="dfn" href="#contribution-cache-entry-batching-scope" id="ref-for-contribution-cache-entry-batching-scope③">batching scope</a>
            <dd data-md>
             <p><var>onEventEntry</var>’s <a data-link-type="dfn" href="#on-event-contribution-cache-entry-batching-scope" id="ref-for-on-event-contribution-cache-entry-batching-scope①">batching
scope</a></p>
            <dt data-md><a data-link-type="dfn" href="#contribution-cache-entry-debug-scope" id="ref-for-contribution-cache-entry-debug-scope③">debug scope</a>
            <dd data-md>
             <p><var>onEventEntry</var>’s <a data-link-type="dfn" href="#on-event-contribution-cache-entry-debug-scope" id="ref-for-on-event-contribution-cache-entry-debug-scope②">debug
scope</a></p>
            <dt data-md><a data-link-type="dfn" href="#contribution-cache-entry-debug-details" id="ref-for-contribution-cache-entry-debug-details③">debug details</a>
            <dd data-md>
             <p><var>onEventEntry</var>’s <a data-link-type="dfn" href="#on-event-contribution-cache-entry-debug-details" id="ref-for-on-event-contribution-cache-entry-debug-details②">debug
details</a></p>
           </dl>
          <li data-md>
           <p><a data-link-type="dfn" href="#append-an-entry-to-the-contribution-cache" id="ref-for-append-an-entry-to-the-contribution-cache①">Append</a> <var>entry</var> to
the <a data-link-type="dfn" href="#contribution-cache" id="ref-for-contribution-cache⑦">contribution cache</a>.</p>
         </ol>
       </ol>
     </ol>
    <li data-md>
     <p>Let <var>sellerBatchingScope</var> be the result of <a data-link-type="dfn" href="#get-or-create-a-batching-scope" id="ref-for-get-or-create-a-batching-scope①">getting or creating a batching scope</a> given <var>auctionConfig</var>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#auction-config-seller" id="ref-for-auction-config-seller①">seller</a>, <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-seller-private-aggregation-coordinator" id="ref-for-auction-config-seller-private-aggregation-coordinator②">seller Private Aggregation coordinator</a>, and <var>auctionConfig</var>.</p>
    <li data-md>
     <p>Let <var>auctionReportBuyersDebugScope</var> be a new <a data-link-type="dfn" href="#debug-scope" id="ref-for-debug-scope①③">debug scope</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate⑤">For each</a> <var>reportType</var> → <var>reportBuyerConfig</var> of <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-auction-report-buyers" id="ref-for-auction-config-auction-report-buyers①">auction report buyers</a>:</p>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate⑥">For each</a> <var>buyerOrigin</var> → <var>buyerOffset</var> of <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-auction-report-buyer-keys" id="ref-for-auction-config-auction-report-buyer-keys①">auction report buyer keys</a>:</p>
       <ol>
        <li data-md>
         <p>Let <var>bucket</var> be the sum of <var>buyerOffset</var> and <var>reportBuyerConfig</var>’s <code class="idl"><a data-link-type="idl" href="#dom-auctionreportbuyersconfig-bucket" id="ref-for-dom-auctionreportbuyersconfig-bucket①">bucket</a></code>.</p>
         <p class="issue" id="issue-2593d8e1"><a class="self-link" href="#issue-2593d8e1"></a> Handle overflow here or in validation. See <a href="https://github.com/WICG/turtledove/issues/1040"> protected-audience/1040</a>.</p>
        <li data-md>
         <p>Let <var>value</var> be the result (a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double②">double</a></code>) of switching on <var>reportType</var>:</p>
         <dl class="switch">
          <dt data-md>"<code>interestGroupCount</code>"
          <dd data-md>
           <p>The number of interest groups in the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent⑨">user agent</a>'s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#interest-group-set" id="ref-for-interest-group-set">interest group set</a> whose <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#interest-group-owner" id="ref-for-interest-group-owner②">owner</a> is <var>buyerOrigin</var>.</p>
          <dt data-md>"<code>bidCount</code>"
          <dd data-md>
           <p>The number of valid bids generated by interest groups whose <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#interest-group-owner" id="ref-for-interest-group-owner③">owner</a> is <var>buyerOrigin</var>.</p>
          <dt data-md>"<code>totalGenerateBidLatency</code>"
          <dd data-md>
           <p>The sum of execution time in milliseconds for all <code>generateBid()</code> calls in the auction for interest groups whose <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#interest-group-owner" id="ref-for-interest-group-owner④">owner</a> is <var>buyerOrigin</var>.</p>
          <dt data-md>"<code>totalSignalsFetchLatency</code>"
          <dd data-md>
           <p>The total time spent fetching trusted buyer signals in
milliseconds, or 0 if the interest group didn’t fetch any
trusted signals.</p>
          <dt data-md>None of the above values
          <dd data-md>
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①⑦">Assert</a>: false</p>
           <p class="note" role="note"><span class="marker">Note:</span> This enum value is validated in <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#validate-and-convert-auction-ad-config" id="ref-for-validate-and-convert-auction-ad-config①">validate and convert auction ad
    config</a>.</p>
         </dl>
         <p class="issue" id="issue-af95efe2"><a class="self-link" href="#issue-af95efe2"></a> More formally spec the values here.</p>
        <li data-md>
         <p>Set <var>value</var> to the result of multiplying <var>reportBuyerConfig</var>’s <code class="idl"><a data-link-type="idl" href="#dom-auctionreportbuyersconfig-scale" id="ref-for-dom-auctionreportbuyersconfig-scale">scale</a></code> with <var>value</var>.</p>
        <li data-md>
         <p>Set <var>value</var> to the maximum of 0.0 and <var>value</var>.</p>
        <li data-md>
         <p>Set <var>value</var> to the result of converting <var>value</var> to an integer by
truncating its fractional part.</p>
        <li data-md>
         <p>Set <var>value</var> to the minimum of <var>value</var> and 2<sup>31</sup>−1.</p>
        <li data-md>
         <p>Let <var>contribution</var> be a new <code class="idl"><a data-link-type="idl" href="#dictdef-pahistogramcontribution" id="ref-for-dictdef-pahistogramcontribution⑨">PAHistogramContribution</a></code> with the
items:</p>
         <dl>
          <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-bucket" id="ref-for-dom-pahistogramcontribution-bucket③">bucket</a></code>
          <dd data-md>
           <p><var>bucket</var></p>
          <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-value" id="ref-for-dom-pahistogramcontribution-value④">value</a></code>
          <dd data-md>
           <p><var>value</var></p>
         </dl>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate⑦">For each</a> <var>ig</var> of the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①⓪">user agent</a>'s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#interest-group-set" id="ref-for-interest-group-set①"> interest group set</a> whose <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#interest-group-owner" id="ref-for-interest-group-owner⑤">owner</a> is <var>buyerOrigin</var>:</p>
         <ol>
          <li data-md>
           <p>If seller capabilities don’t allow this reporting, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue④"> continue</a>.</p>
           <p class="issue" id="issue-c6ba2539"><a class="self-link" href="#issue-c6ba2539"></a> Align behavior with seller capabilities handling once <a href="https://github.com/WICG/turtledove/issues/966"> protected-audience/966</a> is resolved.</p>
          <li data-md>
           <p>Let <var>entry</var> be a new <a data-link-type="dfn" href="#contribution-cache-entry" id="ref-for-contribution-cache-entry⑤">contribution cache entry</a> with the items:</p>
           <dl>
            <dt data-md><a data-link-type="dfn" href="#contribution-cache-entry-contribution" id="ref-for-contribution-cache-entry-contribution③">contribution</a>
            <dd data-md>
             <p><var>contribution</var></p>
            <dt data-md><a data-link-type="dfn" href="#contribution-cache-entry-batching-scope" id="ref-for-contribution-cache-entry-batching-scope④">batching scope</a>
            <dd data-md>
             <p><var>sellerBatchingScope</var></p>
            <dt data-md><a data-link-type="dfn" href="#contribution-cache-entry-debug-scope" id="ref-for-contribution-cache-entry-debug-scope④">debug scope</a>
            <dd data-md>
             <p><var>auctionReportBuyersDebugScope</var></p>
           </dl>
          <li data-md>
           <p><a data-link-type="dfn" href="#append-an-entry-to-the-contribution-cache" id="ref-for-append-an-entry-to-the-contribution-cache②">Append</a> <var>entry</var> to
the <a data-link-type="dfn" href="#contribution-cache" id="ref-for-contribution-cache⑧">contribution cache</a>.</p>
         </ol>
       </ol>
     </ol>
    <li data-md>
     <p><a data-link-type="dfn" href="#mark-a-debug-scope-complete" id="ref-for-mark-a-debug-scope-complete⑦">Mark a debug scope complete</a> given <var>auctionReportBuyersDebugScope</var> and <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-auction-report-buyer-debug-details" id="ref-for-auction-config-auction-report-buyer-debug-details②">auction report buyer debug details</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate⑧">For each</a> (<var>origin</var>, <var>aggregationCoordinator</var>) → <var>batchingScope</var> of <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-batching-scope-map" id="ref-for-auction-config-batching-scope-map">batching scope map</a>:</p>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="#process-contributions-for-a-batching-scope" id="ref-for-process-contributions-for-a-batching-scope⑥">Process contributions for a batching scope</a> given <var>batchingScope</var>, <var>origin</var>, "<code>protected-audience</code>" and null.</p>
     </ol>
   </ol>
   <p class="issue" id="issue-c1e53695"><a class="self-link" href="#issue-c1e53695"></a> Verify interaction with component auctions.</p>
   <p class="issue" id="issue-6c500be3"><a class="self-link" href="#issue-6c500be3"></a> Use <code>[=map/For each=]</code> where possible.</p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-or-create-a-batching-scope">get or create a batching scope</dfn> given an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin①③">origin</a> <var>origin</var>, an <a data-link-type="dfn" href="#aggregation-coordinator" id="ref-for-aggregation-coordinator①③">aggregation coordinator</a> <var>aggregationCoordinator</var> and an <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#auction-config" id="ref-for-auction-config⑦">auction config</a> <var>auctionConfig</var>, perform the following
steps. They return a <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope①⑥">batching scope</a>.</p>
   <ol>
    <li data-md>
     <p>Let <var>batchingScopeMap</var> be <var>auctionConfig</var>’s <a data-link-type="dfn" href="#auction-config-batching-scope-map" id="ref-for-auction-config-batching-scope-map①">batching scope
map</a>.</p>
    <li data-md>
     <p>Let <var>tuple</var> be (<var>origin</var>, <var>aggregationCoordinator</var>).</p>
    <li data-md>
     <p>If <var>batchingScopeMap</var>[<var>tuple</var>] does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②①">exist</a>:</p>
     <ol>
      <li data-md>
       <p>Set <var>batchingScopeMap</var>[<var>tuple</var>] to a new <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope①⑦">batching scope</a>.</p>
      <li data-md>
       <p>If <var>aggregationCoordinator</var> is not null, <a data-link-type="dfn" href="#set-the-aggregation-coordinator-for-a-batching-scope" id="ref-for-set-the-aggregation-coordinator-for-a-batching-scope②">set the aggregation
coordinator for a batching scope</a> given <var>aggregationCoordinator</var> and <var>batchingScopeMap</var>[<var>tuple</var>].</p>
     </ol>
    <li data-md>
     <p>Return <var>batchingScopeMap</var>[<var>tuple</var>].</p>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="fill-in-the-contribution">fill in the contribution</dfn> given a <code class="idl"><a data-link-type="idl" href="#dictdef-paextendedhistogramcontribution" id="ref-for-dictdef-paextendedhistogramcontribution②">PAExtendedHistogramContribution</a></code> <var>contribution</var> and a <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#leading-bid-info" id="ref-for-leading-bid-info①">leading bid info</a> <var>leadingBidInfo</var>, perform the
following steps. They return a <code class="idl"><a data-link-type="idl" href="#dictdef-pahistogramcontribution" id="ref-for-dictdef-pahistogramcontribution①⓪">PAHistogramContribution</a></code>.</p>
   <ol>
    <li data-md>
     <p>Let <var>bucket</var> be <var>contribution</var>["<code class="idl"><a data-link-type="idl" href="#dom-paextendedhistogramcontribution-bucket" id="ref-for-dom-paextendedhistogramcontribution-bucket②">bucket</a></code>"].</p>
    <li data-md>
     <p>If <var>bucket</var> is a <code class="idl"><a data-link-type="idl" href="#dictdef-pasignalvalue" id="ref-for-dictdef-pasignalvalue④">PASignalValue</a></code>, set <var>bucket</var> to the result of <a data-link-type="dfn" href="#fill-in-the-signal-value" id="ref-for-fill-in-the-signal-value">filling
in the signal value</a> given <var>bucket</var>, 2<sup>128</sup>−1 and <var>leadingBidInfo</var>.</p>
    <li data-md>
     <p>Let <var>value</var> be <var>contribution</var>["<code class="idl"><a data-link-type="idl" href="#dom-paextendedhistogramcontribution-value" id="ref-for-dom-paextendedhistogramcontribution-value①">value</a></code>"].</p>
    <li data-md>
     <p>If <var>value</var> is a <code class="idl"><a data-link-type="idl" href="#dictdef-pasignalvalue" id="ref-for-dictdef-pasignalvalue⑤">PASignalValue</a></code>, set <var>value</var> to the result of <a data-link-type="dfn" href="#fill-in-the-signal-value" id="ref-for-fill-in-the-signal-value①">filling in
the signal value</a> given <var>value</var>, 2<sup>31</sup>−1 and <var>leadingBidInfo</var>.</p>
    <li data-md>
     <p>Return a new <code class="idl"><a data-link-type="idl" href="#dictdef-pahistogramcontribution" id="ref-for-dictdef-pahistogramcontribution①①">PAHistogramContribution</a></code> with the items:</p>
     <dl>
      <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-bucket" id="ref-for-dom-pahistogramcontribution-bucket④">bucket</a></code>
      <dd data-md>
       <p><var>bucket</var></p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-pahistogramcontribution-value" id="ref-for-dom-pahistogramcontribution-value⑤">value</a></code>
      <dd data-md>
       <p><var>value</var></p>
     </dl>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="fill-in-the-signal-value">fill in the signal value</dfn> given a <code class="idl"><a data-link-type="idl" href="#dictdef-pasignalvalue" id="ref-for-dictdef-pasignalvalue⑥">PASignalValue</a></code> <var>value</var>, an
integer <var>maxAllowed</var> and a <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#leading-bid-info" id="ref-for-leading-bid-info②">leading bid info</a> <var>leadingBidInfo</var>, perform the following steps. They return an integer.</p>
   <ol>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①⑧">Assert</a>: <var>value</var>["<code class="idl"><a data-link-type="idl" href="#dom-pasignalvalue-basevalue" id="ref-for-dom-pasignalvalue-basevalue②">baseValue</a></code>"] is a valid <a data-link-type="dfn" href="#signal-base-value" id="ref-for-signal-base-value②">signal base
value</a>.</p>
    <li data-md>
     <p>Let <var>returnValue</var> be the result of <a data-link-type="dfn" href="#determine-a-signals-numeric-value" id="ref-for-determine-a-signals-numeric-value①">determining a signal’s numeric value</a> given <var>value</var>["<code class="idl"><a data-link-type="idl" href="#dom-pasignalvalue-basevalue" id="ref-for-dom-pasignalvalue-basevalue③">baseValue</a></code>"] and <var>leadingBidInfo</var>.</p>
    <li data-md>
     <p>If <var>value</var>["<code class="idl"><a data-link-type="idl" href="#dom-pasignalvalue-scale" id="ref-for-dom-pasignalvalue-scale">scale</a></code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②②">exists</a>, set <var>returnValue</var> to
the result of multiplying <var>value</var>["<code class="idl"><a data-link-type="idl" href="#dom-pasignalvalue-scale" id="ref-for-dom-pasignalvalue-scale①">scale</a></code>"] with <var>returnValue</var>.</p>
    <li data-md>
     <p>Set <var>returnValue</var> to the result of converting <var>returnValue</var> to an integer by
truncating its fractional part.</p>
    <li data-md>
     <p>If <var>value</var>["<code class="idl"><a data-link-type="idl" href="#dom-pasignalvalue-offset" id="ref-for-dom-pasignalvalue-offset②">offset</a></code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②③">exists</a>, set <var>returnValue</var> to
the result of adding <var>returnValue</var> to <var>value</var>["<code class="idl"><a data-link-type="idl" href="#dom-pasignalvalue-offset" id="ref-for-dom-pasignalvalue-offset③">offset</a></code>"].</p>
    <li data-md>
     <p>Clamp <var>returnValue</var> to the range [0, <var>maxAllowed</var>] and return the result.</p>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="determine-a-signals-numeric-value">determine a signal’s numeric value</dfn> given a <a data-link-type="dfn" href="#signal-base-value" id="ref-for-signal-base-value③">signal base value</a> <var>signalBaseValue</var> and a <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#leading-bid-info" id="ref-for-leading-bid-info③">leading bid info</a> <var>leadingBidInfo</var>, perform the following steps. They return a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double③">double</a></code>.</p>
   <ol>
    <li data-md>
     <p>If <var>signalBaseValue</var> is "<code><a data-link-type="dfn" href="#signal-base-value-winning-bid" id="ref-for-signal-base-value-winning-bid">winning-bid</a></code>":</p>
     <ol>
      <li data-md>
       <p>If <var>leadingBidInfo</var>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#leading-bid-info-leading-bid" id="ref-for-leading-bid-info-leading-bid③">leading
bid</a> is null, return 0.</p>
      <li data-md>
       <p>Otherwise, return <var>leadingBidInfo</var>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#leading-bid-info-leading-bid" id="ref-for-leading-bid-info-leading-bid④">leading bid</a>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#generated-bid-bid" id="ref-for-generated-bid-bid">bid</a>.</p>
     </ol>
    <li data-md>
     <p>If <var>signalBaseValue</var> is
"<code><a data-link-type="dfn" href="#signal-base-value-highest-scoring-other-bid" id="ref-for-signal-base-value-highest-scoring-other-bid">highest-scoring-other-bid</a></code>":</p>
     <ol>
      <li data-md>
       <p>If <var>leadingBidInfo</var>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bid" id="ref-for-leading-bid-info-highest-scoring-other-bid">highest
scoring other bid</a> is null, return 0.</p>
      <li data-md>
       <p>Otherwise, return <var>leadingBidInfo</var>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bid" id="ref-for-leading-bid-info-highest-scoring-other-bid①">highest scoring other
bid</a>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#generated-bid-bid" id="ref-for-generated-bid-bid①">bid</a>.</p>
     </ol>
    <li data-md>
     <p>If <var>signalBaseValue</var> is "<code><a data-link-type="dfn" href="#signal-base-value-script-run-time" id="ref-for-signal-base-value-script-run-time">script-run-time</a></code>":</p>
     <ol>
      <li data-md>
       <p>Return the number of milliseconds of CPU time that the calling function
(e.g. <code>generateBid()</code>) took to run.</p>
     </ol>
    <li data-md>
     <p>If <var>signalBaseValue</var> is
"<code><a data-link-type="dfn" href="#signal-base-value-signals-fetch-time" id="ref-for-signal-base-value-signals-fetch-time">signals-fetch-time</a></code>":
Switch on the associated <a data-link-type="dfn" href="#worklet-function" id="ref-for-worklet-function②">worklet function</a>:</p>
     <dl class="switch">
      <dt data-md><code><a data-link-type="dfn" href="#worklet-function-generate-bid" id="ref-for-worklet-function-generate-bid">generate-bid</a></code>
      <dd data-md>
       <p>Return the number of milliseconds it took for the trusted bidding signals
fetch to complete, or 0 if no fetch was made.</p>
      <dt data-md><code><a data-link-type="dfn" href="#worklet-function-score-ad" id="ref-for-worklet-function-score-ad">score-ad</a></code>
      <dd data-md>
       <p>Return the number of milliseconds it took for the trusted scoring signals
fetch to complete or 0 if no fetch was made.</p>
      <dt data-md><code><a data-link-type="dfn" href="#worklet-function-report-result" id="ref-for-worklet-function-report-result">report-result</a></code>
      <dt data-md><code><a data-link-type="dfn" href="#worklet-function-report-win" id="ref-for-worklet-function-report-win">report-win</a></code>
      <dd data-md>
       <p>Return 0.</p>
     </dl>
     <p class="issue" id="issue-8f50da01"><a class="self-link" href="#issue-8f50da01"></a> Consider disallowing this in the latter two <a data-link-type="dfn" href="#worklet-function" id="ref-for-worklet-function③">worklet functions</a>.</p>
    <li data-md>
     <p>If <var>signalBaseValue</var> is
"<code><a data-link-type="dfn" href="#signal-base-value-bid-reject-reason" id="ref-for-signal-base-value-bid-reject-reason">bid-reject-reason</a></code>":</p>
     <ol>
      <li data-md>
       <p>If the bid did not succeed purely because it didn’t meet the required <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#k-anonymity-threshold" id="ref-for-k-anonymity-threshold">k-anonymity threshold</a>, return 8.</p>
      <li data-md>
       <p>Let <var>bidRejectReason</var> be "<code>not-available</code>".</p>
      <li data-md>
       <p>If the seller provided a reject reason, set <var>bidRejectReason</var> to that
value.</p>
      <li data-md>
       <p>If <var>bidRejectReason</var> is:</p>
       <dl class="switch">
        <dt data-md>"<code>not-available</code>"
        <dd data-md>
         <p>Return 0.</p>
        <dt data-md>"<code>invalid-bid</code>"
        <dd data-md>
         <p>Return 1.</p>
        <dt data-md>"<code>bid-below-auction-floor</code>"
        <dd data-md>
         <p>Return 2.</p>
        <dt data-md>"<code>pending-approval-by-exchange</code>"
        <dd data-md>
         <p>Return 3.</p>
        <dt data-md>"<code>disapproved-by-exchange</code>"
        <dd data-md>
         <p>Return 4.</p>
        <dt data-md>"<code>blocked-by-publisher</code>"
        <dd data-md>
         <p>Return 5.</p>
        <dt data-md>"<code>language-exclusions</code>"
        <dd data-md>
         <p>Return 6.</p>
        <dt data-md>"<code>category-exclusions</code>"
        <dd data-md>
         <p>Return 7.</p>
        <dt data-md>None of the above values
        <dd data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①⑨">Assert</a>: false</p>
         <p class="note" role="note"><span class="marker">Note:</span> this enum value is validated in <code>scoreAd()</code>.</p>
         <p class="issue" id="issue-7f9c7f3c"><a class="self-link" href="#issue-7f9c7f3c"></a> Verify this once <a href="https://github.com/WICG/turtledove/issues/627"> protected-audience/627</a> is resolved.</p>
         <p class="issue" id="issue-6002541a"><a class="self-link" href="#issue-6002541a"></a> Once <a href="https://github.com/WICG/turtledove/pull/594">protected-audience/594</a> lands, update this mapping to align.</p>
         <p class="issue" id="issue-d55586bb"><a class="self-link" href="#issue-d55586bb"></a> Verify handling when the bid was not rejected.</p>
       </dl>
       <p class="issue" id="issue-e5ce0922"><a class="self-link" href="#issue-e5ce0922"></a> Consider disallowing this from reportWin() and reportResult().</p>
     </ol>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="maybe-obtain-an-interest-group">maybe obtain an interest group</dfn> given an <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/turtledove/#interestgroupscriptrunnerglobalscope" id="ref-for-interestgroupscriptrunnerglobalscope③">InterestGroupScriptRunnerGlobalScope</a></code> <var>global</var>, perform the following steps.
They return an <a data-link-type="dfn" href="https://www.w3.org/Consortium/Process/#GroupsIG" id="ref-for-GroupsIG④">interest group</a> or null:</p>
   <ol>
    <li data-md>
     <p>Switch on <var>global</var>’s type:</p>
     <dl class="switch">
      <dt data-md><code class="idl"><a data-link-type="idl" href="https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope" id="ref-for-interestgroupbiddingscriptrunnerglobalscope">InterestGroupBiddingScriptRunnerGlobalScope</a></code>
      <dd data-md>
       <p>Return <var>global</var>’s <a data-link-type="dfn" href="https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-interest-group" id="ref-for-interestgroupbiddingscriptrunnerglobalscope-interest-group①">interest group</a>.</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="https://wicg.github.io/turtledove/#interestgroupscoringscriptrunnerglobalscope" id="ref-for-interestgroupscoringscriptrunnerglobalscope①">InterestGroupScoringScriptRunnerGlobalScope</a></code>
      <dd data-md>
       <p>Return null.</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope" id="ref-for-interestgroupreportingscriptrunnerglobalscope②">InterestGroupReportingScriptRunnerGlobalScope</a></code>
      <dd data-md>
       <p>Return <var>global</var>’s <a data-link-type="dfn" href="#interestgroupreportingscriptrunnerglobalscope-interest-group" id="ref-for-interestgroupreportingscriptrunnerglobalscope-interest-group①">interest
group</a>.</p>
     </dl>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-the-private-aggregation-coordinator">obtain the Private Aggregation coordinator</dfn> given a <code class="idl"><a data-link-type="idl" href="#dictdef-protectedaudienceprivateaggregationconfig" id="ref-for-dictdef-protectedaudienceprivateaggregationconfig②">ProtectedAudiencePrivateAggregationConfig</a></code> <var>config</var>, perform the following
steps. They return an <a data-link-type="dfn" href="#aggregation-coordinator" id="ref-for-aggregation-coordinator①④">aggregation coordinator</a>, null or a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①⑦">DOMException</a></code>.</p>
   <ol>
    <li data-md>
     <p>If <var>config</var>["<code class="idl"><a data-link-type="idl" href="#dom-protectedaudienceprivateaggregationconfig-aggregationcoordinatororigin" id="ref-for-dom-protectedaudienceprivateaggregationconfig-aggregationcoordinatororigin">aggregationCoordinatorOrigin</a></code>"]
does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②④">exist</a>, return null.</p>
    <li data-md>
     <p>Return the result of <a data-link-type="dfn" href="#obtain-the-private-aggregation-coordinator-from-a-string" id="ref-for-obtain-the-private-aggregation-coordinator-from-a-string①">obtaining the Private Aggregation coordinator</a> given <var>config</var>["<code class="idl"><a data-link-type="idl" href="#dom-protectedaudienceprivateaggregationconfig-aggregationcoordinatororigin" id="ref-for-dom-protectedaudienceprivateaggregationconfig-aggregationcoordinatororigin①">aggregationCoordinatorOrigin</a></code>"].</p>
   </ol>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="obtain the Private Aggregation coordinator from a string" data-noexport id="obtain-the-private-aggregation-coordinator-from-a-string">obtain the
Private Aggregation coordinator</dfn> given a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString③">USVString</a></code> <var>originString</var>,
perform the following steps. They return an <a data-link-type="dfn" href="#aggregation-coordinator" id="ref-for-aggregation-coordinator①⑤">aggregation coordinator</a> or a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①⑧">DOMException</a></code>.</p>
   <ol>
    <li data-md>
     <p>Let <var>url</var> be the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser③">URL parser</a> on <var>originString</var>.</p>
    <li data-md>
     <p>If <var>url</var> is failure or null, return a new <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①⑨">DOMException</a></code> with name
"<code>SyntaxError</code>".</p>
     <p class="issue" id="issue-5cfca5be①"><a class="self-link" href="#issue-5cfca5be①"></a> Consider throwing an error if the path is not empty.</p>
    <li data-md>
     <p>Let <var>origin</var> be <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin①">origin</a>.</p>
    <li data-md>
     <p>If the result of <a data-link-type="dfn" href="#determine-if-an-origin-is-an-aggregation-coordinator" id="ref-for-determine-if-an-origin-is-an-aggregation-coordinator①">determining if an origin is an aggregation coordinator</a> given <var>origin</var> is false, return a new <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②⓪">DOMException</a></code> with name
"<code>DataError</code>".</p>
    <li data-md>
     <p>Return <var>origin</var>.</p>
   </ol>
   <h2 class="heading settled" data-level="12" id="privacy-considerations"><span class="secno">12. </span><span class="content">Privacy considerations</span><a class="self-link" href="#privacy-considerations"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <h3 class="heading settled" data-level="12.1" id="cross-site-information-disclosure"><span class="secno">12.1. </span><span class="content">Cross-site information disclosure</span><a class="self-link" href="#cross-site-information-disclosure"></a></h3>
   <p>This API lets isolated contexts with access to cross-site data (i.e. <a href="https://wicg.github.io/shared-storage/">Shared Storage</a> worklets/<a href="https://wicg.github.io/turtledove/">Protected Audience</a> script runners)
send aggregatable reports over the network.</p>
   <p>Aggregatable reports contain encrypted high entropy cross-site information, in
the form of key-value pairs (i.e. contributions to a histogram). The information
embedded in the contributions is arbitrary but can include things like browsing
history and other cross-site activity. The API aims to protect this information
from being passed from one site to another.</p>
   <h4 class="heading settled" data-level="12.1.1" id="restricted-contribution-processing"><span class="secno">12.1.1. </span><span class="content">Restricted contribution processing</span><a class="self-link" href="#restricted-contribution-processing"></a></h4>
   <p>The histogram contributions are not exposed directly. Instead, they are
encrypted so that they can only be processed by a trusted aggregation service.
This trusted aggregation service sums the values across the reports for each key
and adds noise to each of these values to produce ‘summary reports’.</p>
   <p>The output of that processing will be an aggregated, noised histogram. The
service ensures that any report can not be processed multiple times. Further,
information exposure is limited by contribution budgets on the user agent. In
principle, this framework can support specifying a noise parameter which
satisfies differential privacy.</p>
   <h4 class="heading settled" data-level="12.1.2" id="unencrypted-metadata"><span class="secno">12.1.2. </span><span class="content">Unencrypted metadata</span><a class="self-link" href="#unencrypted-metadata"></a></h4>
   <p>These reports also expose a limited amount of metadata, which is not based on
cross-site data. The recipient of the report may also be able to observe
side-channel information such as the time when the report was sent, or IP
address of the sender.</p>
   <h4 class="heading settled" data-level="12.1.3" id="protecting-against-leaks-via-the-number-of-reports"><span class="secno">12.1.3. </span><span class="content">Protecting against leaks via the number of reports</span><a class="self-link" href="#protecting-against-leaks-via-the-number-of-reports"></a></h4>
   <p>However, the number of reports with the given metadata could expose some
cross-site information. To protect against this, the API delays sending reports
by a randomized amount of time to make it difficult to determine whether a
report was sent or not from any particular event. In the case that a <a data-link-type="dfn" href="#aggregatable-report-context-id" id="ref-for-aggregatable-report-context-id②">context ID</a> is supplied or a non-default <a data-link-type="dfn" href="#aggregatable-report-filtering-id-byte-size" id="ref-for-aggregatable-report-filtering-id-byte-size②">filtering ID byte size</a> is specified, the API makes the number of
reports sent deterministic (sending 'null reports' if necessary -- each
containing only a contribution with a value of 0 in the payload). Additional
mitigations may also be possible in the future, e.g. adding noise to the report
count.</p>
   <h4 class="heading settled" data-level="12.1.4" id="protecting-against-leaks-via-payload-size"><span class="secno">12.1.4. </span><span class="content">Protecting against leaks via payload size</span><a class="self-link" href="#protecting-against-leaks-via-payload-size"></a></h4>
   <p>The length of the payload could additionally expose some cross-site information,
namely how many contributions are included. To protect against this, the payload
is padded to a fixed number of contributions.</p>
   <h4 class="heading settled" data-level="12.1.5" id="temporary-debugging-mechanism"><span class="secno">12.1.5. </span><span class="content">Temporary debugging mechanism</span><a class="self-link" href="#temporary-debugging-mechanism"></a></h4>
   <p>The <code><code class="idl"><a data-link-type="idl" href="#dom-privateaggregation-enabledebugmode" id="ref-for-dom-privateaggregation-enabledebugmode③">enableDebugMode()</a></code></code> method allows for many
of the protections of this API to be bypassed to ease testing and integration.
Specifically, the contents of the payload, i.e. the histogram contributions, are
revealed in the clear when the debug mode is enabled. Optionally, a debug key
can also be set to associate the report with the calling context. In the future,
this mechanism will only be available for callers that are eligible to set
third-party cookies. In that case, the API caller already has the ability to
communicate information cross-site.</p>
   <p class="issue" id="issue-d97fad0c"><a class="self-link" href="#issue-d97fad0c"></a> Tie <code><code class="idl"><a data-link-type="idl" href="#dom-privateaggregation-enabledebugmode" id="ref-for-dom-privateaggregation-enabledebugmode④">enableDebugMode()</a></code></code> to
    third-party cookie eligibility. <a href="https://github.com/patcg-individual-drafts/private-aggregation-api/issues/57">[Issue #57]</a></p>
   <h4 class="heading settled" data-level="12.1.6" id="privacy-parameters"><span class="secno">12.1.6. </span><span class="content">Privacy parameters</span><a class="self-link" href="#privacy-parameters"></a></h4>
   <p>The amount of information exposed by this API is a product of the privacy
parameters used (e.g. contribution limits and the noise distribution used in the
aggregation service). While we aim to minimize the amount of information
exposed, we also aim to support a wide range of use cases. The privacy
parameters are left <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined①①">implementation-defined</a> to allow different and evolving
choices in the tradeoffs between information exposure and utility.</p>
   <h3 class="heading settled" data-level="12.2" id="clearing-site-data"><span class="secno">12.2. </span><span class="content">Clearing site data</span><a class="self-link" href="#clearing-site-data"></a></h3>
   <p>The <a data-link-type="dfn" href="#aggregatable-report-cache" id="ref-for-aggregatable-report-cache⑤">aggregatable report cache</a> as well as any contribution history data
stored for the <a data-link-type="dfn" href="#consume-budget-if-permitted" id="ref-for-consume-budget-if-permitted②">consume budget if permitted</a> algorithm contain data about a
user’s web activity. As such, user controls to delete this data are required,
see <a href="#clearing-storage">clearing storage</a>.</p>
   <p>On the other hand, the <a data-link-type="dfn" href="#contribution-cache" id="ref-for-contribution-cache⑨">contribution cache</a>, the <a data-link-type="dfn" href="#debug-scope-map" id="ref-for-debug-scope-map④">debug scope map</a> and the <a data-link-type="dfn" href="#pre-specified-report-parameters-map" id="ref-for-pre-specified-report-parameters-map④">pre-specified report parameters map</a> only contain short-lived data tied to
particular <a data-link-type="dfn" href="#batching-scope" id="ref-for-batching-scope①⑧">batching scopes</a> and <a data-link-type="dfn" href="#debug-scope" id="ref-for-debug-scope①④">debug scopes</a>, so controls are not
required.</p>
   <h3 class="heading settled" data-level="12.3" id="reporting-delay-concerns"><span class="secno">12.3. </span><span class="content">Reporting delay concerns</span><a class="self-link" href="#reporting-delay-concerns"></a></h3>
   <p>Delaying sending reports after API invocation can enable side-channel leakage in
some situations.</p>
   <h4 class="heading settled" data-level="12.3.1" id="cross-network-reporting-origin-leakage"><span class="secno">12.3.1. </span><span class="content">Cross-network reporting origin leakage</span><a class="self-link" href="#cross-network-reporting-origin-leakage"></a></h4>
   <p>A report may be stored while the browser is connected to one network but sent
while the browser is connected to a different network, potentially enabling
cross-network leakage of the reporting origin.</p>
   <p>Example: A user runs the browser with a particular browsing profile on their
home network. An aggregatable report with a particular reporting origin is
stored with a report time in the future. After the report time is reached, the
user runs the browser with the same browsing profile on their employer’s
network, at which point the browser sends the report to the reporting origin.
Although the report itself may be sent over HTTPS, the reporting origin may be
visible to the network administrator via DNS or the TLS client hello (which can
be mitigated with ECH). Some reporting origins may be known to operate only or
primarily on sensitive sites, so this could leak information about the user’s
browsing activity to the user’s employer without their knowledge or consent.</p>
   <p>Possible mitigations include:</p>
   <ol>
    <li data-md>
     <p>Only sending reports with a given reporting origin when the browser has
already made a request to that origin on the same network: This prevents the
network administrator from gaining additional information from the Private
Aggregation API. However, it increases report loss and report delays, which
reduces the utility of the API for the reporting origin. It might also
increase the effectiveness of timing attacks, as the origin may be able to
better link the report with the user’s request that allowed the report to be
released.</p>
    <li data-md>
     <p>Send reports immediately: This reduces the likelihood of a report being
stored and sent on different networks. However, it increases the likelihood
that the reporting origin can correlate the original API invocation to the
report being sent, which weakens the privacy controls of the API, see <a href="#protecting-against-leaks-via-the-number-of-reports">Protecting against leaks via the number of
reports</a>.</p>
    <li data-md>
     <p>Use a trusted proxy server to send reports: This effectively moves the
reporting origin into the report body, so only the proxy server would be
visible to the network administrator.</p>
    <li data-md>
     <p>Require <a data-link-type="biblio" href="#biblio-rfc8484" title="DNS Queries over HTTPS (DoH)">DNS over HTTPS</a>: This effectively hides the reporting
origin from the network administrator, but is likely impractical to enforce
and is itself perhaps circumventable by the network administrator, e.g. by
monitoring IP addresses instead.</p>
   </ol>
   <h4 class="heading settled" data-level="12.3.2" id="user-presence-tracking"><span class="secno">12.3.2. </span><span class="content">User-presence tracking</span><a class="self-link" href="#user-presence-tracking"></a></h4>
   <p>The browser only tries to send reports while it is running and while it has
internet connectivity (even without an explicit check for connectivity,
naturally the report will fail to be sent if there is none), so receiving or not
receiving a (<a data-link-type="dfn" href="#serialize-an-aggregatable-report" id="ref-for-serialize-an-aggregatable-report①">serialized</a>) <a data-link-type="dfn" href="#aggregatable-report" id="ref-for-aggregatable-report①④">aggregatable
report</a> at the <a data-link-type="dfn" href="#aggregatable-report-original-report-time" id="ref-for-aggregatable-report-original-report-time②">original report time</a> leaks information
about the user’s presence. Additionally, because the report request inherently
includes an IP address, this could reveal the user’s IP-derived location to the
reporting origin, including at-home vs. at-work or approximate real-world
geolocation, or reveal patterns in the user’s browsing activity.</p>
   <p>Possible mitigations include:</p>
   <ol>
    <li data-md>
     <p>Send reports immediately: This effectively eliminates the presence tracking,
as the original request made to the reporting origin is in close temporal
proximity to the report request. However, it increases the likelihood that
the reporting origin can correlate the original API invocation to the report
being sent, which weakens the privacy controls of the API, see <a href="#protecting-against-leaks-via-the-number-of-reports">Protecting
against leaks via the number of
reports</a>.</p>
    <li data-md>
     <p>Send reports immediately to a trusted proxy server, which would itself apply
additional delay: This would effectively hide both the user’s IP address and
their online-offline presence from the reporting origin.</p>
   </ol>
   <h2 class="heading settled" data-level="13" id="security-considerations"><span class="secno">13. </span><span class="content">Security considerations</span><a class="self-link" href="#security-considerations"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <h3 class="heading settled" data-level="13.1" id="same-origin-policy"><span class="secno">13.1. </span><span class="content">Same-origin policy</span><a class="self-link" href="#same-origin-policy"></a></h3>
   <p>Writes to the <a data-link-type="dfn" href="#aggregatable-report-cache" id="ref-for-aggregatable-report-cache⑥">aggregatable report cache</a>, <a data-link-type="dfn" href="#contribution-cache" id="ref-for-contribution-cache①⓪">contribution cache</a>, <a data-link-type="dfn" href="#debug-scope-map" id="ref-for-debug-scope-map⑤">debug
scope map</a> and <a data-link-type="dfn" href="#pre-specified-report-parameters-map" id="ref-for-pre-specified-report-parameters-map⑤">pre-specified report parameters map</a> are separated by the
reporting <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin①④">origin</a> and the data included in any report with a given reporting <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin①⑤">origin</a> are generated with only data from that <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin①⑥">origin</a>.</p>
   <p>One notable exception is the <a data-link-type="dfn" href="#consume-budget-if-permitted" id="ref-for-consume-budget-if-permitted③">consume budget if permitted</a> algorithm which is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined①②">implementation-defined</a> and can consider contribution history from other <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin①⑦">origins</a>. For example, the algorithm could consider all history from a
particular <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site">site</a>. This would be an explicit relaxation of the same-origin
policy as multiple origins would be able to influence the API’s behavior. One
particular risk of these kinds of shared limits is the introduction of denial of
service attacks, where a group of origins could collude to intentionally consume
all available budget, causing subsequent origins to be unable to access the API.
This trades off security for privacy, in that the limits are there to reduce the
efficacy of many origins colluding together to violate privacy. However, this
security risk is lessened if the set of origins limited are all <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-site" id="ref-for-same-site">same site</a>. <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①①">User agents</a> should consider these tradeoffs when choosing the <a data-link-type="dfn" href="#consume-budget-if-permitted" id="ref-for-consume-budget-if-permitted④">consume
budget if permitted</a> algorithm.</p>
   <h3 class="heading settled" data-level="13.2" id="protecting-the-histogram-contributions"><span class="secno">13.2. </span><span class="content">Protecting the histogram contributions</span><a class="self-link" href="#protecting-the-histogram-contributions"></a></h3>
   <p>As discussed <a href="#restricted-contribution-processing">above</a>, the processing of
histogram contributions is limited to protect privacy. This limitation relies on
only the trusted aggregation service being able to access the unencrypted
histogram contributions.</p>
   <p>To ensure this, this API uses <a data-link-type="biblio" href="#biblio-rfc9180" title="Hybrid Public Key Encryption">HPKE</a>, a modern encryption
specification. Additionally, each <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①②">user agent</a> is encouraged to require
regular key rotation by the aggregation service. This limits the amount of data
encrypted with the same key and thus the amount of vulnerable data in the case
of a key being compromised.</p>
   <p>While not specified here, each <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①③">user agent</a> is strongly encouraged to consider
the security of any aggregation service design before allowing its public keys
to be returned by <a data-link-type="dfn" href="#obtain-the-public-key-for-encryption" id="ref-for-obtain-the-public-key-for-encryption①">obtain the public key for encryption</a>.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#aggregatable-report">Aggregatable report</a><span>, in § 4.5</span>
   <li><a href="#aggregatable-report-cache">aggregatable report cache</a><span>, in § 5</span>
   <li>
    aggregation coordinator
    <ul>
     <li><a href="#aggregation-coordinator">definition of</a><span>, in § 4.7</span>
     <li><a href="#aggregatable-report-aggregation-coordinator">dfn for aggregatable report</a><span>, in § 4.6</span>
    </ul>
   <li><a href="#aggregation-coordinator-map">aggregation coordinator map</a><span>, in § 5</span>
   <li>
    aggregationCoordinatorOrigin
    <ul>
     <li><a href="#dom-protectedaudienceprivateaggregationconfig-aggregationcoordinatororigin">dict-member for ProtectedAudiencePrivateAggregationConfig</a><span>, in § 11.2</span>
     <li><a href="#dom-sharedstorageprivateaggregationconfig-aggregationcoordinatororigin">dict-member for SharedStoragePrivateAggregationConfig</a><span>, in § 10</span>
    </ul>
   <li><a href="#allowed-aggregation-coordinator-set">Allowed aggregation coordinator set</a><span>, in § 6</span>
   <li><a href="#privateaggregation-allowed-to-use">allowed to use</a><span>, in § 2</span>
   <li><a href="#aggregatable-report-api">api</a><span>, in § 4.6</span>
   <li><a href="#append-an-entry-to-the-contribution-cache">append an entry to the contribution cache</a><span>, in § 8.1</span>
   <li><a href="#attempt-to-deliver-a-report">attempt to deliver a report</a><span>, in § 8.3</span>
   <li><a href="#attempt-to-queue-reports-for-sending">attempt to queue reports for sending</a><span>, in § 8.3</span>
   <li><a href="#interestgroupscriptrunnerglobalscope-auction-config">auction config</a><span>, in § 11.3.8</span>
   <li><a href="#auction-config-auction-report-buyer-debug-details">auction report buyer debug details</a><span>, in § 11.3.1</span>
   <li><a href="#dictdef-auctionreportbuyerdebugmodeconfig">AuctionReportBuyerDebugModeConfig</a><span>, in § 11.1</span>
   <li><a href="#dom-auctionadconfig-auctionreportbuyerdebugmodeconfig">auctionReportBuyerDebugModeConfig</a><span>, in § 11.1</span>
   <li><a href="#auction-config-auction-report-buyer-keys">auction report buyer keys</a><span>, in § 11.3.1</span>
   <li><a href="#dom-auctionadconfig-auctionreportbuyerkeys">auctionReportBuyerKeys</a><span>, in § 11.1</span>
   <li><a href="#auction-config-auction-report-buyers">auction report buyers</a><span>, in § 11.3.1</span>
   <li><a href="#dom-auctionadconfig-auctionreportbuyers">auctionReportBuyers</a><span>, in § 11.1</span>
   <li><a href="#dictdef-auctionreportbuyersconfig">AuctionReportBuyersConfig</a><span>, in § 11.1</span>
   <li><a href="#automation-local-testing-mode-enabled">automation local testing mode enabled</a><span>, in § 9</span>
   <li><a href="#dom-pasignalvalue-basevalue">baseValue</a><span>, in § 11.1</span>
   <li><a href="#batching-scope">Batching scope</a><span>, in § 4</span>
   <li>
    batching scope
    <ul>
     <li><a href="#contribution-cache-entry-batching-scope">dfn for contribution cache entry</a><span>, in § 4.5</span>
     <li><a href="#on-event-contribution-cache-entry-batching-scope">dfn for on event contribution cache entry</a><span>, in § 11.3.6</span>
    </ul>
   <li><a href="#auction-config-batching-scope-map">batching scope map</a><span>, in § 11.3.1</span>
   <li><a href="#signal-base-value-bid-reject-reason">bid-reject-reason</a><span>, in § 11.3.4</span>
   <li>
    bucket
    <ul>
     <li><a href="#dom-auctionreportbuyersconfig-bucket">dict-member for AuctionReportBuyersConfig</a><span>, in § 11.1</span>
     <li><a href="#dom-paextendedhistogramcontribution-bucket">dict-member for PAExtendedHistogramContribution</a><span>, in § 11.1</span>
     <li><a href="#dom-pahistogramcontribution-bucket">dict-member for PAHistogramContribution</a><span>, in § 2</span>
    </ul>
   <li><a href="#consume-budget-if-permitted">consume budget if permitted</a><span>, in § 8.2</span>
   <li>
    context ID
    <ul>
     <li><a href="#aggregatable-report-context-id">dfn for aggregatable report</a><span>, in § 4.6</span>
     <li><a href="#pre-specified-report-parameters-context-id">dfn for pre-specified report parameters</a><span>, in § 4.9</span>
    </ul>
   <li><a href="#dom-sharedstorageprivateaggregationconfig-contextid">contextId</a><span>, in § 10</span>
   <li><a href="#context-type">Context type</a><span>, in § 4.7</span>
   <li><a href="#dom-privateaggregation-contributetohistogram">contributeToHistogram(contribution)</a><span>, in § 2</span>
   <li><a href="#dom-privateaggregation-contributetohistogramonevent">contributeToHistogramOnEvent(event, contribution)</a><span>, in § 11.1</span>
   <li>
    contribution
    <ul>
     <li><a href="#contribution-cache-entry-contribution">dfn for contribution cache entry</a><span>, in § 4.5</span>
     <li><a href="#on-event-contribution-cache-entry-contribution">dfn for on event contribution cache entry</a><span>, in § 11.3.6</span>
    </ul>
   <li><a href="#contribution-cache">contribution cache</a><span>, in § 5</span>
   <li><a href="#contribution-cache-entry">Contribution cache entry</a><span>, in § 4.4</span>
   <li><a href="#aggregatable-report-contributions">contributions</a><span>, in § 4.6</span>
   <li><a href="#create-a-report-request">create a report request</a><span>, in § 8.3</span>
   <li><a href="#debug-details">Debug details</a><span>, in § 4.3</span>
   <li>
    debug details
    <ul>
     <li><a href="#aggregatable-report-debug-details">dfn for aggregatable report</a><span>, in § 4.6</span>
     <li><a href="#contribution-cache-entry-debug-details">dfn for contribution cache entry</a><span>, in § 4.5</span>
     <li><a href="#on-event-contribution-cache-entry-debug-details">dfn for on event contribution cache entry</a><span>, in § 11.3.6</span>
    </ul>
   <li>
    debugKey
    <ul>
     <li><a href="#dom-auctionreportbuyerdebugmodeconfig-debugkey">dict-member for AuctionReportBuyerDebugModeConfig</a><span>, in § 11.1</span>
     <li><a href="#dom-padebugmodeoptions-debugkey">dict-member for PADebugModeOptions</a><span>, in § 2</span>
    </ul>
   <li><a href="#debug-scope">Debug scope</a><span>, in § 4.1</span>
   <li>
    debug scope
    <ul>
     <li><a href="#contribution-cache-entry-debug-scope">dfn for contribution cache entry</a><span>, in § 4.5</span>
     <li><a href="#on-event-contribution-cache-entry-debug-scope">dfn for on event contribution cache entry</a><span>, in § 11.3.6</span>
    </ul>
   <li><a href="#debug-scope-map">debug scope map</a><span>, in § 5</span>
   <li><a href="#default-aggregation-coordinator">Default aggregation coordinator</a><span>, in § 6</span>
   <li><a href="#determine-a-signals-numeric-value">determine a signal’s numeric value</a><span>, in § 11.5</span>
   <li><a href="#determine-if-an-origin-is-an-aggregation-coordinator">determine if an origin is an aggregation coordinator</a><span>, in § 8.1</span>
   <li><a href="#determine-if-a-null-report-should-be-sent">determine if a null report should be sent</a><span>, in § 8.1</span>
   <li>
    enabled
    <ul>
     <li><a href="#debug-details-enabled">dfn for debug details</a><span>, in § 4.4</span>
     <li><a href="#dom-auctionreportbuyerdebugmodeconfig-enabled">dict-member for AuctionReportBuyerDebugModeConfig</a><span>, in § 11.1</span>
    </ul>
   <li><a href="#dom-privateaggregation-enabledebugmode">enableDebugMode()</a><span>, in § 2</span>
   <li><a href="#dom-privateaggregation-enabledebugmode">enableDebugMode(options)</a><span>, in § 2</span>
   <li><a href="#encode-an-integer-for-the-payload">encode an integer for the payload</a><span>, in § 8.4</span>
   <li><a href="#encrypt-the-payload">encrypt the payload</a><span>, in § 8.4</span>
   <li><a href="#fill-in-the-contribution">fill in the contribution</a><span>, in § 11.5</span>
   <li><a href="#fill-in-the-signal-value">fill in the signal value</a><span>, in § 11.5</span>
   <li><a href="#dom-pahistogramcontribution-filteringid">filteringId</a><span>, in § 2</span>
   <li>
    filtering ID byte size
    <ul>
     <li><a href="#aggregatable-report-filtering-id-byte-size">dfn for aggregatable report</a><span>, in § 4.6</span>
     <li><a href="#pre-specified-report-parameters-filtering-id-byte-size">dfn for pre-specified report parameters</a><span>, in § 4.9</span>
    </ul>
   <li><a href="#dom-sharedstorageprivateaggregationconfig-filteringidbytesize">filteringIdByteSize</a><span>, in § 10</span>
   <li><a href="#worklet-function-generate-bid">generate-bid</a><span>, in § 11.3.5</span>
   <li><a href="#get-a-debug-details">get a debug details</a><span>, in § 8.1</span>
   <li><a href="#scoping-details-get-batching-scope-steps">get batching scope steps</a><span>, in § 4.3</span>
   <li><a href="#scoping-details-get-debug-scope-steps">get debug scope steps</a><span>, in § 4.3</span>
   <li><a href="#get-or-create-a-batching-scope">get or create a batching scope</a><span>, in § 11.5</span>
   <li><a href="#get-the-privateaggregation">get the privateAggregation</a><span>, in § 8.1</span>
   <li><a href="#signal-base-value-highest-scoring-other-bid">highest-scoring-other-bid</a><span>, in § 11.3.4</span>
   <li><a href="#interestgroupreportingscriptrunnerglobalscope-interest-group">interest group</a><span>, in § 11.3.9</span>
   <li><a href="#debug-details-key">key</a><span>, in § 4.4</span>
   <li><a href="#localtestingmode">localtestingmode</a><span>, in § 9.1</span>
   <li><a href="#mark-a-debug-scope-complete">mark a debug scope complete</a><span>, in § 8.1</span>
   <li><a href="#maximum-report-contributions">Maximum report contributions</a><span>, in § 6</span>
   <li><a href="#maybe-obtain-an-interest-group">maybe obtain an interest group</a><span>, in § 11.5</span>
   <li><a href="#minimum-report-delay">Minimum report delay</a><span>, in § 6</span>
   <li><a href="#obtain-an-aggregatable-report">obtain an aggregatable report</a><span>, in § 8.2</span>
   <li><a href="#obtain-a-report-delivery-time">obtain a report delivery time</a><span>, in § 8.2</span>
   <li><a href="#obtain-a-reporting-endpoint">obtain a reporting endpoint</a><span>, in § 8.3</span>
   <li><a href="#obtain-a-reports-shared-info">obtain a report’s shared info</a><span>, in § 8.4</span>
   <li><a href="#obtain-the-aggregation-coordinator">obtain the aggregation coordinator</a><span>, in § 10</span>
   <li><a href="#obtain-the-aggregation-service-payloads">obtain the aggregation service payloads</a><span>, in § 8.4</span>
   <li><a href="#obtain-the-plaintext-payload">obtain the plaintext payload</a><span>, in § 8.4</span>
   <li><a href="#obtain-the-pre-specified-report-parameters">obtain the pre-specified report parameters</a><span>, in § 10</span>
   <li><a href="#obtain-the-private-aggregation-coordinator">obtain the Private Aggregation coordinator</a><span>, in § 11.5</span>
   <li><a href="#obtain-the-private-aggregation-coordinator-from-a-string">obtain the Private Aggregation coordinator from a string</a><span>, in § 11.5</span>
   <li><a href="#obtain-the-public-key-for-encryption">obtain the public key for encryption</a><span>, in § 8.4</span>
   <li><a href="#dom-pasignalvalue-offset">offset</a><span>, in § 11.1</span>
   <li><a href="#on-event-contribution-cache">On event contribution cache</a><span>, in § 11.3.6</span>
   <li><a href="#on-event-contribution-cache-entry">On event contribution cache entry</a><span>, in § 11.3.5</span>
   <li><a href="#aggregatable-report-original-report-time">original report time</a><span>, in § 4.6</span>
   <li><a href="#dictdef-padebugmodeoptions">PADebugModeOptions</a><span>, in § 2</span>
   <li><a href="#dictdef-paextendedhistogramcontribution">PAExtendedHistogramContribution</a><span>, in § 11.1</span>
   <li><a href="#dictdef-pahistogramcontribution">PAHistogramContribution</a><span>, in § 2</span>
   <li><a href="#dictdef-pasignalvalue">PASignalValue</a><span>, in § 11.1</span>
   <li><a href="#auction-config-per-bid-or-seller-on-event-contribution-cache">per-bid or seller on event contribution cache</a><span>, in § 11.3.1</span>
   <li><a href="#permissions-policy-state">Permissions policy state</a><span>, in § 11.3.2</span>
   <li><a href="#auction-config-permissions-policy-state">permissions policy state</a><span>, in § 11.3.1</span>
   <li><a href="#pre-specified-report-parameters">pre-specified report parameters</a><span>, in § 4.9</span>
   <li><a href="#pre-specified-report-parameters-map">pre-specified report parameters map</a><span>, in § 5</span>
   <li><a href="#private-aggregation">private-aggregation</a><span>, in § 7</span>
   <li><a href="#privateaggregation">PrivateAggregation</a><span>, in § 2</span>
   <li>
    privateAggregation
    <ul>
     <li><a href="#dom-interestgroupscriptrunnerglobalscope-privateaggregation">attribute for InterestGroupScriptRunnerGlobalScope</a><span>, in § 11.1</span>
     <li><a href="#dom-sharedstorageworkletglobalscope-privateaggregation">attribute for SharedStorageWorkletGlobalScope</a><span>, in § 10</span>
    </ul>
   <li>
    privateAggregationConfig
    <ul>
     <li><a href="#dom-auctionadconfig-privateaggregationconfig">dict-member for AuctionAdConfig</a><span>, in § 11.2</span>
     <li><a href="#dom-auctionadinterestgroup-privateaggregationconfig">dict-member for AuctionAdInterestGroup</a><span>, in § 11.2</span>
     <li><a href="#dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig">dict-member for SharedStorageRunOperationMethodOptions</a><span>, in § 10</span>
    </ul>
   <li><a href="#interest-group-private-aggregation-coordinator">Private Aggregation coordinator</a><span>, in § 11.3.2</span>
   <li><a href="#permissions-policy-state-private-aggregation-enabled">private aggregation enabled</a><span>, in § 11.3.3</span>
   <li><a href="#process-contributions-for-a-batching-scope">process contributions for a batching scope</a><span>, in § 8.1</span>
   <li><a href="#process-the-private-aggregation-contributions-for-an-auction">process the Private Aggregation contributions for an auction</a><span>, in § 11.5</span>
   <li><a href="#dictdef-protectedaudienceprivateaggregationconfig">ProtectedAudiencePrivateAggregationConfig</a><span>, in § 11.2</span>
   <li><a href="#aggregatable-report-queued">queued</a><span>, in § 4.6</span>
   <li><a href="#randomized-report-delay">Randomized report delay</a><span>, in § 6</span>
   <li><a href="#report-creation-and-scheduling-steps">report creation and scheduling steps</a><span>, in § 8.2</span>
   <li><a href="#aggregatable-report-report-id">report ID</a><span>, in § 4.6</span>
   <li><a href="#aggregatable-report-reporting-origin">reporting origin</a><span>, in § 4.6</span>
   <li><a href="#worklet-function-report-result">report-result</a><span>, in § 11.3.5</span>
   <li><a href="#aggregatable-report-report-time">report time</a><span>, in § 4.6</span>
   <li><a href="#worklet-function-report-win">report-win</a><span>, in § 11.3.5</span>
   <li>
    scale
    <ul>
     <li><a href="#dom-auctionreportbuyersconfig-scale">dict-member for AuctionReportBuyersConfig</a><span>, in § 11.1</span>
     <li><a href="#dom-pasignalvalue-scale">dict-member for PASignalValue</a><span>, in § 11.1</span>
    </ul>
   <li><a href="#scoping-details">Scoping details</a><span>, in § 4.2</span>
   <li><a href="#privateaggregation-scoping-details">scoping details</a><span>, in § 2</span>
   <li><a href="#worklet-function-score-ad">score-ad</a><span>, in § 11.3.5</span>
   <li><a href="#signal-base-value-script-run-time">script-run-time</a><span>, in § 11.3.4</span>
   <li><a href="#auction-config-seller-private-aggregation-coordinator">seller Private Aggregation coordinator</a><span>, in § 11.3.1</span>
   <li><a href="#serialize-an-aggregatable-report">serialize an aggregatable report</a><span>, in § 8.4</span>
   <li><a href="#serialize-an-integer">serialize an integer</a><span>, in § 8</span>
   <li><a href="#set-the-aggregation-coordinator-for-a-batching-scope">set the aggregation coordinator for a batching scope</a><span>, in § 8.1</span>
   <li><a href="#set-the-pre-specified-report-parameters-for-a-batching-scope">set the pre-specified report parameters for a batching scope</a><span>, in § 8.1</span>
   <li><a href="#dictdef-sharedstorageprivateaggregationconfig">SharedStoragePrivateAggregationConfig</a><span>, in § 10</span>
   <li><a href="#signal-base-value">Signal base value</a><span>, in § 11.3.3</span>
   <li><a href="#signal-base-value-signals-fetch-time">signals-fetch-time</a><span>, in § 11.3.4</span>
   <li>
    value
    <ul>
     <li><a href="#dom-paextendedhistogramcontribution-value">dict-member for PAExtendedHistogramContribution</a><span>, in § 11.1</span>
     <li><a href="#dom-pahistogramcontribution-value">dict-member for PAHistogramContribution</a><span>, in § 2</span>
    </ul>
   <li><a href="#signal-base-value-winning-bid">winning-bid</a><span>, in § 11.3.4</span>
   <li><a href="#worklet-function">Worklet function</a><span>, in § 11.3.4</span>
   <li><a href="#on-event-contribution-cache-entry-worklet-function">worklet function</a><span>, in § 11.3.6</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="5d106754">InterestGroupBiddingScriptRunnerGlobalScope</span>
     <li><span class="dfn-paneled" id="5b92b08e">InterestGroupReportingScriptRunnerGlobalScope</span>
     <li><span class="dfn-paneled" id="a0f5bba3">InterestGroupScoringScriptRunnerGlobalScope</span>
     <li><span class="dfn-paneled" id="33b5a16f">InterestGroupScriptRunnerGlobalScope</span>
     <li><span class="dfn-paneled" id="013993f9">SharedStorageWorklet</span>
     <li><span class="dfn-paneled" id="79bc063f">SharedStorageWorkletGlobalScope</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ATTRIBUTION-REPORTING-API]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1f6ec8d6">suitable origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a973e0fe">document</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ECMASCRIPT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="c6bfef29">abrupt completion</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ENCODING]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0303e8e5">utf-8 encode</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FENCED-FRAME]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="24f2f8da">FencedFrameConfig</span>
     <li><span class="dfn-paneled" id="68510b3d">report a private aggregation event</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="8e9945a0">body</span>
     <li><span class="dfn-paneled" id="688f9669">cache mode</span>
     <li><span class="dfn-paneled" id="857d5516">client</span>
     <li><span class="dfn-paneled" id="902380f7">credentials mode</span>
     <li><span class="dfn-paneled" id="a33db89a">fetch</span>
     <li><span class="dfn-paneled" id="2ce6f6bb">fetch(input)</span>
     <li><span class="dfn-paneled" id="6ee0eab1">header list</span>
     <li><span class="dfn-paneled" id="fa4ea124">initiator</span>
     <li><span class="dfn-paneled" id="50b05fad">method</span>
     <li><span class="dfn-paneled" id="cb98f71f">mode</span>
     <li><span class="dfn-paneled" id="bd2fe71e">processresponse</span>
     <li><span class="dfn-paneled" id="358f1dbd">referrer</span>
     <li><span class="dfn-paneled" id="55213b5b">request</span>
     <li><span class="dfn-paneled" id="6d1db60d">service-workers mode</span>
     <li><span class="dfn-paneled" id="6f7f62df">unsafe-request flag</span>
     <li><span class="dfn-paneled" id="dc1cd39b">url</span>
     <li><span class="dfn-paneled" id="1ab127d6">window</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HR-TIME-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a09bfce2">current wall time</span>
     <li><span class="dfn-paneled" id="4b2c8c72">duration</span>
     <li><span class="dfn-paneled" id="c9a0df83">duration from</span>
     <li><span class="dfn-paneled" id="1e2edd5b">moment</span>
     <li><span class="dfn-paneled" id="be5dbc8c">unix epoch</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="eec46e27">addModule(moduleURL, options)</span>
     <li><span class="dfn-paneled" id="3610bd67">allowed to use</span>
     <li><span class="dfn-paneled" id="3349d69f">associated document</span>
     <li><span class="dfn-paneled" id="f1d11a13">call</span>
     <li><span class="dfn-paneled" id="168f1b6e">global object</span>
     <li><span class="dfn-paneled" id="6f738b30">global scopes</span>
     <li><span class="dfn-paneled" id="77a2ee6e">host</span>
     <li><span class="dfn-paneled" id="a72449dd">in parallel</span>
     <li><span class="dfn-paneled" id="086e3aff">origin</span>
     <li><span class="dfn-paneled" id="43ac8374">origin <small>(for environment settings object)</small></span>
     <li><span class="dfn-paneled" id="98e31e77">port</span>
     <li><span class="dfn-paneled" id="9a517a7d">queue a task</span>
     <li><span class="dfn-paneled" id="e99bd18e">relevant global object</span>
     <li><span class="dfn-paneled" id="9c4c1e66">relevant settings object</span>
     <li><span class="dfn-paneled" id="feac4ab3">same site</span>
     <li><span class="dfn-paneled" id="a23d12a9">scheme</span>
     <li><span class="dfn-paneled" id="dae0bfde">serialization of an origin</span>
     <li><span class="dfn-paneled" id="7deb6835">settings object</span>
     <li><span class="dfn-paneled" id="fb9bb722">site</span>
     <li><span class="dfn-paneled" id="45a22199">unique internal value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1adcc035">abort when</span>
     <li><span class="dfn-paneled" id="53275e46">append <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="a3b18719">append <small>(for set)</small></span>
     <li><span class="dfn-paneled" id="77b4c09a">assert</span>
     <li><span class="dfn-paneled" id="36858240">boolean</span>
     <li><span class="dfn-paneled" id="7b0d918d">break</span>
     <li><span class="dfn-paneled" id="3de9e659">byte sequence</span>
     <li><span class="dfn-paneled" id="e28ccd60">concatenation</span>
     <li><span class="dfn-paneled" id="ae8def21">contain</span>
     <li><span class="dfn-paneled" id="f937b7b6">continue</span>
     <li><span class="dfn-paneled" id="03afaf9c">empty</span>
     <li><span class="dfn-paneled" id="1243a891">exist</span>
     <li><span class="dfn-paneled" id="16d07e10">for each <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="45209803">for each <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="b012ccb2">forgiving-base64 encode</span>
     <li><span class="dfn-paneled" id="715f22e4">if aborted</span>
     <li><span class="dfn-paneled" id="860300d4">implementation-defined</span>
     <li><span class="dfn-paneled" id="6b815fdd">is empty <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="dc3369de">is empty <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="5afbefcd">item <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="c88f3887">item <small>(for struct)</small></span>
     <li><span class="dfn-paneled" id="f02cd417">iterate <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="efe8653e">iterate <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="31db57e6">keys</span>
     <li><span class="dfn-paneled" id="0fa357c3">length</span>
     <li><span class="dfn-paneled" id="649608b9">list</span>
     <li><span class="dfn-paneled" id="3fca5a9e">map</span>
     <li><span class="dfn-paneled" id="84b454ff">ordered map</span>
     <li><span class="dfn-paneled" id="99c988d6">remove <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="7d4424b2">remove <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="4c07280e">serialize an infra value to json bytes</span>
     <li><span class="dfn-paneled" id="2d1093cd">serializing an infra value to a json string</span>
     <li><span class="dfn-paneled" id="15e48c39">set</span>
     <li><span class="dfn-paneled" id="0e6b2056">set <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="0204d188">size</span>
     <li><span class="dfn-paneled" id="54627f47">starts with</span>
     <li><span class="dfn-paneled" id="0698d556">string</span>
     <li><span class="dfn-paneled" id="984221ca">struct</span>
     <li><span class="dfn-paneled" id="cf6542b2">the exclusive range</span>
     <li><span class="dfn-paneled" id="0e8de730">tuple</span>
     <li><span class="dfn-paneled" id="6d19ac93">user agent</span>
     <li><span class="dfn-paneled" id="cbdc89b4">while</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PERMISSIONS-POLICY-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1570624a">default allowlist</span>
     <li><span class="dfn-paneled" id="cc890cc1">policy-controlled feature</span>
    </ul>
   <li>
    <a data-link-type="biblio">[SECURE-CONTEXTS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="96dabee7">potentially trustworthy origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[SHARED-STORAGE]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3c763838">SharedStorageRunOperationMethodOptions</span>
     <li><span class="dfn-paneled" id="54f6011e">WindowSharedStorage</span>
     <li><span class="dfn-paneled" id="e9211cfb">run(name)</span>
     <li><span class="dfn-paneled" id="31b8df52">selectURL(name, urls)</span>
    </ul>
   <li>
    <a data-link-type="biblio">[TURTLEDOVE]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="e77d2744">AuctionAdConfig</span>
     <li><span class="dfn-paneled" id="c0199225">AuctionAdInterestGroup</span>
     <li><span class="dfn-paneled" id="b8af7072">auction config</span>
     <li><span class="dfn-paneled" id="079b4ff9">bid</span>
     <li><span class="dfn-paneled" id="2742f1dc">estimated size</span>
     <li><span class="dfn-paneled" id="e3258dae">evaluate a bidding script</span>
     <li><span class="dfn-paneled" id="dac6239a">evaluate a reporting script</span>
     <li><span class="dfn-paneled" id="ea2d3b07">evaluate a scoring script</span>
     <li><span class="dfn-paneled" id="64108305">evaluate a script</span>
     <li><span class="dfn-paneled" id="211c7588">generate a bid</span>
     <li><span class="dfn-paneled" id="8aa72f2c">generate and score bids</span>
     <li><span class="dfn-paneled" id="3ba6be6a">highest scoring other bid</span>
     <li><span class="dfn-paneled" id="610171dd">interest group</span>
     <li><span class="dfn-paneled" id="b871aae0">interest group <small>(for InterestGroupBiddingScriptRunnerGlobalScope)</small></span>
     <li><span class="dfn-paneled" id="654cec7d">interest group <small>(for generated bid)</small></span>
     <li><span class="dfn-paneled" id="79027840">interest group buyers</span>
     <li><span class="dfn-paneled" id="98c9b3d9">interest group set</span>
     <li><span class="dfn-paneled" id="fe84cc4a">interest group update</span>
     <li><span class="dfn-paneled" id="532887db">interestGroupBuyers</span>
     <li><span class="dfn-paneled" id="cd58f473">joinAdInterestGroup(group)</span>
     <li><span class="dfn-paneled" id="b74dcd49">k-anonymity threshold</span>
     <li><span class="dfn-paneled" id="9e4d25d5">leading bid</span>
     <li><span class="dfn-paneled" id="4d8f32a4">leading bid info</span>
     <li><span class="dfn-paneled" id="e865646f">owner</span>
     <li><span class="dfn-paneled" id="b2e02dd6">report result</span>
     <li><span class="dfn-paneled" id="abcdb0cf">report win</span>
     <li><span class="dfn-paneled" id="45ebf49f">runAdAuction(config)</span>
     <li><span class="dfn-paneled" id="de407e5e">score and rank a bid</span>
     <li><span class="dfn-paneled" id="a99627c2">seller</span>
     <li><span class="dfn-paneled" id="02922269">validate and convert auction ad config</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b85ee3be">host</span>
     <li><span class="dfn-paneled" id="959ad97b">origin</span>
     <li><span class="dfn-paneled" id="c0868016">path</span>
     <li><span class="dfn-paneled" id="852ada56">port</span>
     <li><span class="dfn-paneled" id="3a711be7">scheme</span>
     <li><span class="dfn-paneled" id="dcffbccd">url</span>
     <li><span class="dfn-paneled" id="ca3ca4ae">url parser</span>
     <li><span class="dfn-paneled" id="a8c7461b">url record</span>
    </ul>
   <li>
    <a data-link-type="biblio">[W3C-PROCESS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="9f3224b9">interest groups</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebCryptoAPI]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="73df93a8">generate a random uuid</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebDriver]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="c8ff8493">error code</span>
     <li><span class="dfn-paneled" id="5b668531">getting a property</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBDRIVER2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="bb4c269e">error</span>
     <li><span class="dfn-paneled" id="09daa25c">extension commands</span>
     <li><span class="dfn-paneled" id="8da4d1e3">invalid argument</span>
     <li><span class="dfn-paneled" id="82c23298">remote end steps</span>
     <li><span class="dfn-paneled" id="4be6272b">success</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
     <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
     <li><span class="dfn-paneled" id="24fec0b4">DataError</span>
     <li><span class="dfn-paneled" id="c01cbda0">EnforceRange</span>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="37afd48d">InvalidAccessError</span>
     <li><span class="dfn-paneled" id="ba556545">NotAllowedError</span>
     <li><span class="dfn-paneled" id="ec878a66">RangeError</span>
     <li><span class="dfn-paneled" id="b75bb3bd">SecureContext</span>
     <li><span class="dfn-paneled" id="82ca3efc">TypeError</span>
     <li><span class="dfn-paneled" id="b0d7f3c3">USVString</span>
     <li><span class="dfn-paneled" id="d0b4a948">a promise rejected with</span>
     <li><span class="dfn-paneled" id="5bf9ea61">attribute</span>
     <li><span class="dfn-paneled" id="bdcd112d">bigint</span>
     <li><span class="dfn-paneled" id="5372cca8">boolean</span>
     <li><span class="dfn-paneled" id="8c800cdf">double</span>
     <li><span class="dfn-paneled" id="833154f2">getter steps</span>
     <li><span class="dfn-paneled" id="f8de33a3">long</span>
     <li><span class="dfn-paneled" id="bfc48225">read only</span>
     <li><span class="dfn-paneled" id="7787d359">record</span>
     <li><span class="dfn-paneled" id="9cce47fd">sequence</span>
     <li><span class="dfn-paneled" id="4013a022">this</span>
     <li><span class="dfn-paneled" id="b4cfa5ce">throw</span>
     <li><span class="dfn-paneled" id="5f90bbfb">undefined</span>
     <li><span class="dfn-paneled" id="f14b47b8">unsigned long long</span>
     <li><span class="dfn-paneled" id="24bd7d25">upon fulfillment</span>
     <li><span class="dfn-paneled" id="f14ed351">upon rejection</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-attribution-reporting-api">[ATTRIBUTION-REPORTING-API]
   <dd><a href="https://wicg.github.io/attribution-reporting-api/"><cite>Attribution Reporting</cite></a>. Draft Community Group Report. URL: <a href="https://wicg.github.io/attribution-reporting-api/">https://wicg.github.io/attribution-reporting-api/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-ecmascript">[ECMASCRIPT]
   <dd><a href="https://tc39.es/ecma262/multipage/"><cite>ECMAScript Language Specification</cite></a>. URL: <a href="https://tc39.es/ecma262/multipage/">https://tc39.es/ecma262/multipage/</a>
   <dt id="biblio-encoding">[ENCODING]
   <dd>Anne van Kesteren. <a href="https://encoding.spec.whatwg.org/"><cite>Encoding Standard</cite></a>. Living Standard. URL: <a href="https://encoding.spec.whatwg.org/">https://encoding.spec.whatwg.org/</a>
   <dt id="biblio-fenced-frame">[FENCED-FRAME]
   <dd><a href="https://wicg.github.io/fenced-frame/"><cite>Fenced Frame</cite></a>. Draft Community Group Report. URL: <a href="https://wicg.github.io/fenced-frame/">https://wicg.github.io/fenced-frame/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-hr-time-3">[HR-TIME-3]
   <dd>Yoav Weiss. <a href="https://w3c.github.io/hr-time/"><cite>High Resolution Time</cite></a>. URL: <a href="https://w3c.github.io/hr-time/">https://w3c.github.io/hr-time/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-permissions-policy-1">[PERMISSIONS-POLICY-1]
   <dd>Ian Clelland. <a href="https://w3c.github.io/webappsec-permissions-policy/"><cite>Permissions Policy</cite></a>. URL: <a href="https://w3c.github.io/webappsec-permissions-policy/">https://w3c.github.io/webappsec-permissions-policy/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-rfc8949">[RFC8949]
   <dd>C. Bormann; P. Hoffman. <a href="https://www.rfc-editor.org/rfc/rfc8949"><cite>Concise Binary Object Representation (CBOR)</cite></a>. December 2020. Internet Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8949">https://www.rfc-editor.org/rfc/rfc8949</a>
   <dt id="biblio-rfc9180">[RFC9180]
   <dd>R. Barnes; et al. <a href="https://www.rfc-editor.org/rfc/rfc9180"><cite>Hybrid Public Key Encryption</cite></a>. February 2022. Informational. URL: <a href="https://www.rfc-editor.org/rfc/rfc9180">https://www.rfc-editor.org/rfc/rfc9180</a>
   <dt id="biblio-secure-contexts">[SECURE-CONTEXTS]
   <dd>Mike West. <a href="https://w3c.github.io/webappsec-secure-contexts/"><cite>Secure Contexts</cite></a>. URL: <a href="https://w3c.github.io/webappsec-secure-contexts/">https://w3c.github.io/webappsec-secure-contexts/</a>
   <dt id="biblio-shared-storage">[SHARED-STORAGE]
   <dd><a href="https://wicg.github.io/shared-storage/"><cite>Shared Storage API</cite></a>. Draft Community Group Report. URL: <a href="https://wicg.github.io/shared-storage/">https://wicg.github.io/shared-storage/</a>
   <dt id="biblio-turtledove">[TURTLEDOVE]
   <dd><a href="https://wicg.github.io/turtledove/"><cite>Protected Audience (formerly FLEDGE)</cite></a>. Draft Community Group Report. URL: <a href="https://wicg.github.io/turtledove/">https://wicg.github.io/turtledove/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-w3c-process">[W3C-PROCESS]
   <dd>Elika J. Etemad (fantasai); Florian Rivoal. <a href="https://www.w3.org/Consortium/Process/"><cite>W3C Process Document</cite></a>. 2 November 2021. URL: <a href="https://www.w3.org/Consortium/Process/">https://www.w3.org/Consortium/Process/</a>
   <dt id="biblio-webcryptoapi">[WebCryptoAPI]
   <dd>Mark Watson. <a href="https://w3c.github.io/webcrypto/"><cite>Web Cryptography API</cite></a>. URL: <a href="https://w3c.github.io/webcrypto/">https://w3c.github.io/webcrypto/</a>
   <dt id="biblio-webdriver">[WebDriver]
   <dd>Simon Stewart; David Burns. <a href="https://w3c.github.io/webdriver/"><cite>WebDriver</cite></a>. URL: <a href="https://w3c.github.io/webdriver/">https://w3c.github.io/webdriver/</a>
   <dt id="biblio-webdriver2">[WEBDRIVER2]
   <dd>Simon Stewart; David Burns. <a href="https://w3c.github.io/webdriver/"><cite>WebDriver</cite></a>. URL: <a href="https://w3c.github.io/webdriver/">https://w3c.github.io/webdriver/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-rfc8484">[RFC8484]
   <dd>P. Hoffman; P. McManus. <a href="https://www.rfc-editor.org/rfc/rfc8484"><cite>DNS Queries over HTTPS (DoH)</cite></a>. October 2018. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8484">https://www.rfc-editor.org/rfc/rfc8484</a>
   <dt id="biblio-rfc8615">[RFC8615]
   <dd>M. Nottingham. <a href="https://www.rfc-editor.org/rfc/rfc8615"><cite>Well-Known Uniform Resource Identifiers (URIs)</cite></a>. May 2019. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8615">https://www.rfc-editor.org/rfc/rfc8615</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>InterestGroupScriptRunnerGlobalScope</c->,<c- n>SharedStorageWorklet</c->),
 <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <a href="#privateaggregation"><code><c- g>PrivateAggregation</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-privateaggregation-contributetohistogram"><c- g>contributeToHistogram</c-></a>(<a data-link-type="idl-name" href="#dictdef-pahistogramcontribution"><c- n>PAHistogramContribution</c-></a> <a href="#dom-privateaggregation-contributetohistogram-contribution-contribution"><code><c- g>contribution</c-></code></a>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-privateaggregation-enabledebugmode"><c- g>enableDebugMode</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-padebugmodeoptions"><c- n>PADebugModeOptions</c-></a> <a href="#dom-privateaggregation-enabledebugmode-options-options"><code><c- g>options</c-></code></a> = {});
};

<c- b>dictionary</c-> <a href="#dictdef-pahistogramcontribution"><code><c- g>PAHistogramContribution</c-></code></a> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint"><c- b>bigint</c-></a> <a data-type="bigint" href="#dom-pahistogramcontribution-bucket"><code><c- g>bucket</c-></code></a>;
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long"><c- b>long</c-></a> <a data-type="long" href="#dom-pahistogramcontribution-value"><code><c- g>value</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint"><c- b>bigint</c-></a> <a data-type="bigint" href="#dom-pahistogramcontribution-filteringid"><code><c- g>filteringId</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-padebugmodeoptions"><code><c- g>PADebugModeOptions</c-></code></a> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint"><c- b>bigint</c-></a> <a data-type="bigint" href="#dom-padebugmodeoptions-debugkey"><code><c- g>debugKey</c-></code></a>;
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://wicg.github.io/shared-storage/#sharedstorageworkletglobalscope"><c- g>SharedStorageWorkletGlobalScope</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#privateaggregation"><c- n>PrivateAggregation</c-></a> <a data-readonly data-type="PrivateAggregation" href="#dom-sharedstorageworkletglobalscope-privateaggregation"><code><c- g>privateAggregation</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-sharedstorageprivateaggregationconfig"><code><c- g>SharedStoragePrivateAggregationConfig</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a data-type="USVString" href="#dom-sharedstorageprivateaggregationconfig-aggregationcoordinatororigin"><code><c- g>aggregationCoordinatorOrigin</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a data-type="USVString" href="#dom-sharedstorageprivateaggregationconfig-contextid"><code><c- g>contextId</c-></code></a>;
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a data-type="unsigned long long" href="#dom-sharedstorageprivateaggregationconfig-filteringidbytesize"><code><c- g>filteringIdByteSize</c-></code></a>;
};

<c- b>partial</c-> <c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="https://wicg.github.io/shared-storage/#dictdef-sharedstoragerunoperationmethodoptions"><c- g>SharedStorageRunOperationMethodOptions</c-></a> {
  <a data-link-type="idl-name" href="#dictdef-sharedstorageprivateaggregationconfig"><c- n>SharedStoragePrivateAggregationConfig</c-></a> <a data-type="SharedStoragePrivateAggregationConfig" href="#dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig"><code><c- g>privateAggregationConfig</c-></code></a>;
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://wicg.github.io/turtledove/#interestgroupscriptrunnerglobalscope"><c- g>InterestGroupScriptRunnerGlobalScope</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#privateaggregation"><c- n>PrivateAggregation</c-></a> <a data-readonly data-type="PrivateAggregation" href="#dom-interestgroupscriptrunnerglobalscope-privateaggregation"><code><c- g>privateAggregation</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-pasignalvalue"><code><c- g>PASignalValue</c-></code></a> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString" href="#dom-pasignalvalue-basevalue"><code><c- g>baseValue</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-type="double" href="#dom-pasignalvalue-scale"><code><c- g>scale</c-></code></a>;
  (<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint"><c- b>bigint</c-></a> <c- b>or</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long"><c- b>long</c-></a>) <a data-type="(bigint or long)" href="#dom-pasignalvalue-offset"><code><c- g>offset</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-paextendedhistogramcontribution"><code><c- g>PAExtendedHistogramContribution</c-></code></a> {
  <c- b>required</c-> (<a data-link-type="idl-name" href="#dictdef-pasignalvalue"><c- n>PASignalValue</c-></a> <c- b>or</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint"><c- b>bigint</c-></a>) <a data-type="(PASignalValue or bigint)" href="#dom-paextendedhistogramcontribution-bucket"><code><c- g>bucket</c-></code></a>;
  <c- b>required</c-> (<a data-link-type="idl-name" href="#dictdef-pasignalvalue"><c- n>PASignalValue</c-></a> <c- b>or</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long"><c- b>long</c-></a>) <a data-type="(PASignalValue or long)" href="#dom-paextendedhistogramcontribution-value"><code><c- g>value</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>InterestGroupScriptRunnerGlobalScope</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>]
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="#privateaggregation"><c- g>PrivateAggregation</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-privateaggregation-contributetohistogramonevent"><c- g>contributeToHistogramOnEvent</c-></a>(
      <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-privateaggregation-contributetohistogramonevent-event-contribution-event"><code><c- g>event</c-></code></a>, <a data-link-type="idl-name" href="#dictdef-paextendedhistogramcontribution"><c- n>PAExtendedHistogramContribution</c-></a> <a href="#dom-privateaggregation-contributetohistogramonevent-event-contribution-contribution"><code><c- g>contribution</c-></code></a>);
};

<c- b>dictionary</c-> <a href="#dictdef-auctionreportbuyersconfig"><code><c- g>AuctionReportBuyersConfig</c-></code></a> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint"><c- b>bigint</c-></a> <a data-type="bigint" href="#dom-auctionreportbuyersconfig-bucket"><code><c- g>bucket</c-></code></a>;
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a> <a data-type="double" href="#dom-auctionreportbuyersconfig-scale"><code><c- g>scale</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-auctionreportbuyerdebugmodeconfig"><code><c- g>AuctionReportBuyerDebugModeConfig</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-default="false" data-type="boolean" href="#dom-auctionreportbuyerdebugmodeconfig-enabled"><code><c- g>enabled</c-></code></a> = <c- b>false</c->;

  // Must only be provided if `enabled` is true.
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint"><c- b>bigint</c-></a>? <a data-type="bigint?" href="#dom-auctionreportbuyerdebugmodeconfig-debugkey"><code><c- g>debugKey</c-></code></a>;
};

<c- b>partial</c-> <c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="https://wicg.github.io/turtledove/#dictdef-auctionadconfig"><c- g>AuctionAdConfig</c-></a> {
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-bigint"><c- b>bigint</c-></a>> <a data-type="sequence<bigint>" href="#dom-auctionadconfig-auctionreportbuyerkeys"><code><c- g>auctionReportBuyerKeys</c-></code></a>;
  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-record"><c- b>record</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>, <a data-link-type="idl-name" href="#dictdef-auctionreportbuyersconfig"><c- n>AuctionReportBuyersConfig</c-></a>> <a data-type="record<DOMString, AuctionReportBuyersConfig>" href="#dom-auctionadconfig-auctionreportbuyers"><code><c- g>auctionReportBuyers</c-></code></a>;
  <a data-link-type="idl-name" href="#dictdef-auctionreportbuyerdebugmodeconfig"><c- n>AuctionReportBuyerDebugModeConfig</c-></a> <a data-type="AuctionReportBuyerDebugModeConfig" href="#dom-auctionadconfig-auctionreportbuyerdebugmodeconfig"><code><c- g>auctionReportBuyerDebugModeConfig</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-protectedaudienceprivateaggregationconfig"><code><c- g>ProtectedAudiencePrivateAggregationConfig</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a data-type="USVString" href="#dom-protectedaudienceprivateaggregationconfig-aggregationcoordinatororigin"><code><c- g>aggregationCoordinatorOrigin</c-></code></a>;
};

<c- b>partial</c-> <c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="https://wicg.github.io/turtledove/#dictdef-auctionadconfig"><c- g>AuctionAdConfig</c-></a> {
  <a data-link-type="idl-name" href="#dictdef-protectedaudienceprivateaggregationconfig"><c- n>ProtectedAudiencePrivateAggregationConfig</c-></a> <a data-type="ProtectedAudiencePrivateAggregationConfig" href="#dom-auctionadconfig-privateaggregationconfig"><code><c- g>privateAggregationConfig</c-></code></a>;
};

<c- b>partial</c-> <c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="https://wicg.github.io/turtledove/#dictdef-auctionadinterestgroup"><c- g>AuctionAdInterestGroup</c-></a> {
  <a data-link-type="idl-name" href="#dictdef-protectedaudienceprivateaggregationconfig"><c- n>ProtectedAudiencePrivateAggregationConfig</c-></a> <a data-type="ProtectedAudiencePrivateAggregationConfig" href="#dom-auctionadinterestgroup-privateaggregationconfig"><code><c- g>privateAggregationConfig</c-></code></a>;
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Per the <a href="https://www.w3.org/TR/design-principles/#numeric-types"> Web Platform Design Principles</a>, we should consider switching <code>long</code> to <code>[EnforceRange] long long</code>. <a class="issue-return" href="#issue-e92da1fd" title="Jump to section">↵</a></div>
   <div class="issue"> <code class="idl"><a data-link-type="idl" href="#dom-privateaggregation-enabledebugmode">enableDebugMode(options)</a></code>'s argument should not
    have a default value of <code>{}</code>. Alternatively, <code class="idl"><a data-link-type="idl" href="#dom-padebugmodeoptions-debugkey">debugKey</a></code> should not be required in <code class="idl"><a data-link-type="idl" href="#dictdef-padebugmodeoptions">PADebugModeOptions</a></code>. <a class="issue-return" href="#issue-3dccb76e" title="Jump to section">↵</a></div>
   <div class="issue"> Ensure errors are of an appropriate type, e.g. <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidaccesserror">InvalidAccessError</a></code> is
    deprecated. <a class="issue-return" href="#issue-2f48ed07" title="Jump to section">↵</a></div>
   <div class="issue"> Consider accepting an array of contributions. <a href="https://github.com/patcg-individual-drafts/private-aggregation-api/issues/44">[Issue #44]</a> <a class="issue-return" href="#issue-e90e23c5" title="Jump to section">↵</a></div>
   <div class="issue"> Ensure errors are of an appropriate type, e.g. <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidaccesserror">InvalidAccessError</a></code> is
    deprecated. <a class="issue-return" href="#issue-2f48ed07①" title="Jump to section">↵</a></div>
   <div class="issue"> Unique internal value is not an exported definition. See <a href="https://github.com/whatwg/infra/issues/583">infra/583</a>. <a class="issue-return" href="#issue-24767e0c" title="Jump to section">↵</a></div>
   <div class="issue"> Consider switching to the <a data-link-type="dfn" href="https://wicg.github.io/attribution-reporting-api/#suitable-origin">suitable
origin</a> concept used by the Attribution Reporting API here and elsewhere. <a class="issue-return" href="#issue-d61741c5" title="Jump to section">↵</a></div>
   <div class="issue"> Move other structures to be defined inline instead of via a header.
    Consider also removing all the subheadings. <a class="issue-return" href="#issue-eb41e1cd" title="Jump to section">↵</a></div>
   <div class="issue"> Elsewhere, link to definition when using <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent">user agent</a>. <a class="issue-return" href="#issue-34950ed5" title="Jump to section">↵</a></div>
   <div class="issue"> This would ideally be replaced by a more descriptive algorithm in Infra.
    See <a href="https://github.com/whatwg/infra/issues/201">infra/201</a>. <a class="issue-return" href="#issue-6b252736" title="Jump to section">↵</a></div>
   <div class="issue"> Consider improving developer ergonomics here (e.g. a way to detect
    this case). <a class="issue-return" href="#issue-1c64074f" title="Jump to section">↵</a></div>
   <div class="issue"> Ensure errors are of an appropriate type, e.g. <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidaccesserror">InvalidAccessError</a></code> is
    deprecated. <a class="issue-return" href="#issue-2f48ed07②" title="Jump to section">↵</a></div>
   <div class="issue"> Elsewhere, surround algorithms in a <code>&lt;div algorithm></code> block to match, and
    add styling for all algorithms per <a href="https://github.com/speced/bikeshed/issues/1472">bikeshed/1472</a>. <a class="issue-return" href="#issue-216f1bbd" title="Jump to section">↵</a></div>
   <div class="issue"> Do we have to use the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">queue a task</a> algorithm here? <a class="issue-return" href="#issue-2485156c" title="Jump to section">↵</a></div>
   <div class="issue"> Do we need to queue this task? <a class="issue-return" href="#issue-380e314b" title="Jump to section">↵</a></div>
   <div class="issue"> Register this well-known directory. <a href="https://github.com/patcg-individual-drafts/private-aggregation-api/issues/67">[Issue #67]</a> <a class="issue-return" href="#issue-6bd15926" title="Jump to section">↵</a></div>
   <div class="issue"> Specify this in terms of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch">fetch</a>. Add details about which encryption
    standards to use, length requirements, etc. <a class="issue-return" href="#issue-35055690" title="Jump to section">↵</a></div>
   <div class="issue"> Be consistent about bytes or bits as units here. <a class="issue-return" href="#issue-fda1ec2d" title="Jump to section">↵</a></div>
   <div class="issue"> Be consistent about if boolean vs if boolean is true. <a class="issue-return" href="#issue-222c62f7" title="Jump to section">↵</a></div>
   <div class="issue"> This should be moved to the Shared Storage spec. <a href="https://github.com/patcg-individual-drafts/private-aggregation-api/issues/43">[Issue #43]</a> <a class="issue-return" href="#issue-03919572" title="Jump to section">↵</a></div>
   <div class="issue"> Go through all monkey patches and ensure every definition (including)
    structures that is needed is exported. <a class="issue-return" href="#issue-e413f917" title="Jump to section">↵</a></div>
   <div class="issue"> Consider throwing an error if the path is not empty. <a class="issue-return" href="#issue-5cfca5be" title="Jump to section">↵</a></div>
   <div class="issue"> Once <a href="https://github.com/wicg/shared-storage/issues/88"> shared-storage/88</a> is resolved, align the above monkey patches with how <code>keepAlive</code> is handled at operation completion. <a class="issue-return" href="#issue-be3d1d22" title="Jump to section">↵</a></div>
   <div class="issue"> Consider adding an early return here (and equivalently for
    Protected Audience) if the permissions policy check is made first. <a class="issue-return" href="#issue-fccec62f" title="Jump to section">↵</a></div>
   <div class="issue"> Once <a href="https://github.com/wicg/shared-storage/issues/89"> shared-storage/89</a> is resolved, align the above monkey patch with how
    access to <code>sharedStorage</code> is prevented in <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/shared-storage/#sharedstorageworkletglobalscope">SharedStorageWorkletGlobalScope</a></code>s until <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule">addModule()</a></code>'s initial
    execution is complete. <a class="issue-return" href="#issue-9d79975e" title="Jump to section">↵</a></div>
   <div class="issue"> This should be moved to the Protected Audience spec, along with any
    other Protected Audience-specific details. <a href="https://github.com/patcg-individual-drafts/private-aggregation-api/issues/43">[Issue #43]</a> <a class="issue-return" href="#issue-eecd6fa0" title="Jump to section">↵</a></div>
   <div class="issue"> Do we want to align naming with implementation? <a class="issue-return" href="#issue-6c6263d3" title="Jump to section">↵</a></div>
   <div class="issue"> Make the error type consistent with <code class="idl"><a data-link-type="idl" href="#dom-privateaggregation-contributetohistogram">contributeToHistogram(contribution)</a></code>. <a class="issue-return" href="#issue-19bb6635" title="Jump to section">↵</a></div>
   <div class="issue"> Make the error types on validation issues here and above consistent
    with <code class="idl"><a data-link-type="idl" href="#dom-privateaggregation-contributetohistogram">contributeToHistogram(contribution)</a></code>. <a class="issue-return" href="#issue-3f41aae0" title="Jump to section">↵</a></div>
   <div class="issue"> Ensure errors are of an appropriate type, e.g. <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidaccesserror">InvalidAccessError</a></code> is
    deprecated. <a class="issue-return" href="#issue-2f48ed07③" title="Jump to section">↵</a></div>
   <div class="issue"> Consider accepting an array of contributions. <a href="https://github.com/patcg-individual-drafts/private-aggregation-api/issues/44">[Issue #44]</a> <a class="issue-return" href="#issue-e90e23c5①" title="Jump to section">↵</a></div>
   <div class="issue"> Consider replacing the strings above with specific enum types. <a class="issue-return" href="#issue-96d1f594" title="Jump to section">↵</a></div>
   <div class="issue"> Can this value be used in <code>reportWin()</code> or <code>reportResult()</code>? <a class="issue-return" href="#issue-a30a4985" title="Jump to section">↵</a></div>
   <div class="issue"> Check behavior when an origin is repeated in <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/turtledove/#dom-auctionadconfig-interestgroupbuyers">interestGroupBuyers</a></code>. <a class="issue-return" href="#issue-748cd0cd" title="Jump to section">↵</a></div>
   <div class="issue"> Should these strings be dash delimited? <a class="issue-return" href="#issue-dc306cf6" title="Jump to section">↵</a></div>
   <div class="issue"> Consider validating the case where the bucket used (after
    summing) is too large. Currently, the implementation appears to
    overflow. See <a href="https://github.com/WICG/turtledove/issues/1040"> protected-audience/1040</a>. <a class="issue-return" href="#issue-f9af52a1" title="Jump to section">↵</a></div>
   <div class="issue"> Make all map indexing links (throughout the spec) where possible, i.e.
    matching this section. <a class="issue-return" href="#issue-f42384db" title="Jump to section">↵</a></div>
   <div class="issue"> Once <a href="https://github.com/wicg/turtledove/issues/615"> protected-audience/615</a> is resolved, align the above monkey patch with
    how access to other functions is prevented in <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/turtledove/#interestgroupscriptrunnerglobalscope">InterestGroupScriptRunnerGlobalScope</a></code>s until the script’s initial
    execution is complete. <a class="issue-return" href="#issue-c0bfec19" title="Jump to section">↵</a></div>
   <div class="issue"> Once <a href="https://github.com/WICG/turtledove/issues/627"> protected-audience/627</a> is resolved, align 'filling in'
    logic with <code>forDebuggingOnly</code>. <a class="issue-return" href="#issue-72654077" title="Jump to section">↵</a></div>
   <div class="issue"> Once <a href="https://github.com/WICG/turtledove/issues/616"> protected-audience/616</a> and any successors are
    landed, align integration and fill in fenced frame’s <a data-link-type="dfn" href="https://wicg.github.io/fenced-frame/#report-a-private-aggregation-event">report a private aggregation
    event</a>. <a class="issue-return" href="#issue-c54b92f8" title="Jump to section">↵</a></div>
   <div class="issue"> Handle overflow here or in validation. See <a href="https://github.com/WICG/turtledove/issues/1040"> protected-audience/1040</a>. <a class="issue-return" href="#issue-2593d8e1" title="Jump to section">↵</a></div>
   <div class="issue"> More formally spec the values here. <a class="issue-return" href="#issue-af95efe2" title="Jump to section">↵</a></div>
   <div class="issue"> Align behavior with seller capabilities handling once <a href="https://github.com/WICG/turtledove/issues/966"> protected-audience/966</a> is resolved. <a class="issue-return" href="#issue-c6ba2539" title="Jump to section">↵</a></div>
   <div class="issue"> Verify interaction with component auctions. <a class="issue-return" href="#issue-c1e53695" title="Jump to section">↵</a></div>
   <div class="issue"> Use <code>[=map/For each=]</code> where possible. <a class="issue-return" href="#issue-6c500be3" title="Jump to section">↵</a></div>
   <div class="issue"> Consider disallowing this in the latter two <a data-link-type="dfn" href="#worklet-function">worklet functions</a>. <a class="issue-return" href="#issue-8f50da01" title="Jump to section">↵</a></div>
   <div class="issue"> Verify this once <a href="https://github.com/WICG/turtledove/issues/627"> protected-audience/627</a> is resolved. <a class="issue-return" href="#issue-7f9c7f3c" title="Jump to section">↵</a></div>
   <div class="issue"> Once <a href="https://github.com/WICG/turtledove/pull/594">protected-audience/594</a> lands, update this mapping to align. <a class="issue-return" href="#issue-6002541a" title="Jump to section">↵</a></div>
   <div class="issue"> Verify handling when the bid was not rejected. <a class="issue-return" href="#issue-d55586bb" title="Jump to section">↵</a></div>
   <div class="issue"> Consider disallowing this from reportWin() and reportResult(). <a class="issue-return" href="#issue-e5ce0922" title="Jump to section">↵</a></div>
   <div class="issue"> Consider throwing an error if the path is not empty. <a class="issue-return" href="#issue-5cfca5be①" title="Jump to section">↵</a></div>
   <div class="issue"> Tie <code><code class="idl"><a data-link-type="idl" href="#dom-privateaggregation-enabledebugmode">enableDebugMode()</a></code></code> to
    third-party cookie eligibility. <a href="https://github.com/patcg-individual-drafts/private-aggregation-api/issues/57">[Issue #57]</a> <a class="issue-return" href="#issue-d97fad0c" title="Jump to section">↵</a></div>
  </div>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"013993f9": {"dfnID":"013993f9","dfnText":"SharedStorageWorklet","external":true,"refSections":[{"refs":[{"id":"ref-for-sharedstorageworklet"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://wicg.github.io/shared-storage/#sharedstorageworklet"},
"0204d188": {"dfnID":"0204d188","dfnText":"size","external":true,"refSections":[{"refs":[{"id":"ref-for-list-size"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-list-size\u2460"},{"id":"ref-for-list-size\u2461"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-list-size\u2462"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-list-size\u2463"},{"id":"ref-for-list-size\u2464"}],"title":"11.4. Algorithm modifications"}],"url":"https://infra.spec.whatwg.org/#list-size"},
"02922269": {"dfnID":"02922269","dfnText":"validate and convert auction ad config","external":true,"refSections":[{"refs":[{"id":"ref-for-validate-and-convert-auction-ad-config"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-validate-and-convert-auction-ad-config\u2460"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/turtledove/#validate-and-convert-auction-ad-config"},
"0303e8e5": {"dfnID":"0303e8e5","dfnText":"utf-8 encode","external":true,"refSections":[{"refs":[{"id":"ref-for-utf-8-encode"}],"title":"8.4. Serializing reports"}],"url":"https://encoding.spec.whatwg.org/#utf-8-encode"},
"03afaf9c": {"dfnID":"03afaf9c","dfnText":"empty","external":true,"refSections":[{"refs":[{"id":"ref-for-list-empty"}],"title":"8.2. Scheduling reports"}],"url":"https://infra.spec.whatwg.org/#list-empty"},
"0698d556": {"dfnID":"0698d556","dfnText":"string","external":true,"refSections":[{"refs":[{"id":"ref-for-string"},{"id":"ref-for-string\u2460"}],"title":"4.6. Aggregatable report"},{"refs":[{"id":"ref-for-string\u2461"}],"title":"4.8. Context type"},{"refs":[{"id":"ref-for-string\u2462"}],"title":"4.9. Pre-specified report parameters"},{"refs":[{"id":"ref-for-string\u2463"}],"title":"8. Algorithms"},{"refs":[{"id":"ref-for-string\u2464"},{"id":"ref-for-string\u2465"},{"id":"ref-for-string\u2466"},{"id":"ref-for-string\u2467"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-string\u2468"}],"title":"11.3.1. Extending auction config"},{"refs":[{"id":"ref-for-string\u2460\u24ea"}],"title":"11.3.7. On event contribution cache"},{"refs":[{"id":"ref-for-string\u2460\u2460"},{"id":"ref-for-string\u2460\u2461"}],"title":"11.4. Algorithm modifications"}],"url":"https://infra.spec.whatwg.org/#string"},
"079b4ff9": {"dfnID":"079b4ff9","dfnText":"bid","external":true,"refSections":[{"refs":[{"id":"ref-for-generated-bid-bid"},{"id":"ref-for-generated-bid-bid\u2460"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/turtledove/#generated-bid-bid"},
"086e3aff": {"dfnID":"086e3aff","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-origin"}],"title":"4.6. Aggregatable report"},{"refs":[{"id":"ref-for-concept-origin\u2460"}],"title":"4.7. Aggregation coordinator"},{"refs":[{"id":"ref-for-concept-origin\u2461"},{"id":"ref-for-concept-origin\u2462"}],"title":"6. Implementation-defined values"},{"refs":[{"id":"ref-for-concept-origin\u2463"},{"id":"ref-for-concept-origin\u2464"},{"id":"ref-for-concept-origin\u2465"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-concept-origin\u2466"},{"id":"ref-for-concept-origin\u2467"},{"id":"ref-for-concept-origin\u2468"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-concept-origin\u2460\u24ea"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-concept-origin\u2460\u2460"},{"id":"ref-for-concept-origin\u2460\u2461"}],"title":"11.3.1. Extending auction config"},{"refs":[{"id":"ref-for-concept-origin\u2460\u2462"}],"title":"11.5. New algorithms"},{"refs":[{"id":"ref-for-concept-origin\u2460\u2463"},{"id":"ref-for-concept-origin\u2460\u2464"},{"id":"ref-for-concept-origin\u2460\u2465"},{"id":"ref-for-concept-origin\u2460\u2466"}],"title":"13.1. Same-origin policy"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"},
"09daa25c": {"dfnID":"09daa25c","dfnText":"extension commands","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-extension-commands"}],"title":"9. User-agent automation"}],"url":"https://w3c.github.io/webdriver/#dfn-extension-commands"},
"0e6b2056": {"dfnID":"0e6b2056","dfnText":"set (for map)","external":true,"refSections":[{"refs":[{"id":"ref-for-map-set"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-map-set\u2460"},{"id":"ref-for-map-set\u2461"},{"id":"ref-for-map-set\u2462"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-map-set\u2463"},{"id":"ref-for-map-set\u2464"},{"id":"ref-for-map-set\u2465"},{"id":"ref-for-map-set\u2466"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-map-set\u2467"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-map-set\u2468"},{"id":"ref-for-map-set\u2460\u24ea"}],"title":"11.4. Algorithm modifications"}],"url":"https://infra.spec.whatwg.org/#map-set"},
"0e8de730": {"dfnID":"0e8de730","dfnText":"tuple","external":true,"refSections":[{"refs":[{"id":"ref-for-tuple"},{"id":"ref-for-tuple\u2460"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-tuple\u2461"}],"title":"11.3.1. Extending auction config"}],"url":"https://infra.spec.whatwg.org/#tuple"},
"0fa357c3": {"dfnID":"0fa357c3","dfnText":"length","external":true,"refSections":[{"refs":[{"id":"ref-for-string-length"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-string-length\u2460"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-string-length\u2461"}],"title":"11.4. Algorithm modifications"}],"url":"https://infra.spec.whatwg.org/#string-length"},
"1243a891": {"dfnID":"1243a891","dfnText":"exist","external":true,"refSections":[{"refs":[{"id":"ref-for-map-exists"},{"id":"ref-for-map-exists\u2460"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-map-exists\u2461"},{"id":"ref-for-map-exists\u2462"},{"id":"ref-for-map-exists\u2463"},{"id":"ref-for-map-exists\u2464"},{"id":"ref-for-map-exists\u2465"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-map-exists\u2466"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-map-exists\u2467"},{"id":"ref-for-map-exists\u2468"},{"id":"ref-for-map-exists\u2460\u24ea"},{"id":"ref-for-map-exists\u2460\u2460"},{"id":"ref-for-map-exists\u2460\u2461"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-map-exists\u2460\u2462"},{"id":"ref-for-map-exists\u2460\u2463"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-map-exists\u2460\u2464"},{"id":"ref-for-map-exists\u2460\u2465"},{"id":"ref-for-map-exists\u2460\u2466"},{"id":"ref-for-map-exists\u2460\u2467"},{"id":"ref-for-map-exists\u2460\u2468"},{"id":"ref-for-map-exists\u2461\u24ea"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-map-exists\u2461\u2460"},{"id":"ref-for-map-exists\u2461\u2461"},{"id":"ref-for-map-exists\u2461\u2462"},{"id":"ref-for-map-exists\u2461\u2463"}],"title":"11.5. New algorithms"}],"url":"https://infra.spec.whatwg.org/#map-exists"},
"1570624a": {"dfnID":"1570624a","dfnText":"default allowlist","external":true,"refSections":[{"refs":[{"id":"ref-for-policy-controlled-feature-default-allowlist"}],"title":"7. Permissions Policy integration"}],"url":"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist"},
"15e48c39": {"dfnID":"15e48c39","dfnText":"set","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-set"},{"id":"ref-for-ordered-set\u2460"}],"title":"6. Implementation-defined values"}],"url":"https://infra.spec.whatwg.org/#ordered-set"},
"168f1b6e": {"dfnID":"168f1b6e","dfnText":"global object","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-realm-global"}],"title":"11.4. Algorithm modifications"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global"},
"16d07e10": {"dfnID":"16d07e10","dfnText":"for each (for list)","external":true,"refSections":[{"refs":[{"id":"ref-for-list-iterate"},{"id":"ref-for-list-iterate\u2460"},{"id":"ref-for-list-iterate\u2461"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-list-iterate\u2462"},{"id":"ref-for-list-iterate\u2463"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-list-iterate\u2464"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-list-iterate\u2465"},{"id":"ref-for-list-iterate\u2466"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-list-iterate\u2467"},{"id":"ref-for-list-iterate\u2468"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-list-iterate\u2460\u24ea"}],"title":"11.5. New algorithms"}],"url":"https://infra.spec.whatwg.org/#list-iterate"},
"1ab127d6": {"dfnID":"1ab127d6","dfnText":"window","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-window"}],"title":"8.3. Sending reports"}],"url":"https://fetch.spec.whatwg.org/#concept-request-window"},
"1adcc035": {"dfnID":"1adcc035","dfnText":"abort when","external":true,"refSections":[{"refs":[{"id":"ref-for-abort-when"}],"title":"8.3. Sending reports"}],"url":"https://infra.spec.whatwg.org/#abort-when"},
"1e2edd5b": {"dfnID":"1e2edd5b","dfnText":"moment","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-moment"},{"id":"ref-for-dfn-moment\u2460"}],"title":"4.6. Aggregatable report"},{"refs":[{"id":"ref-for-dfn-moment\u2461"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-dfn-moment\u2462"},{"id":"ref-for-dfn-moment\u2463"},{"id":"ref-for-dfn-moment\u2464"},{"id":"ref-for-dfn-moment\u2465"},{"id":"ref-for-dfn-moment\u2466"},{"id":"ref-for-dfn-moment\u2467"}],"title":"8.2. Scheduling reports"}],"url":"https://w3c.github.io/hr-time/#dfn-moment"},
"1f6ec8d6": {"dfnID":"1f6ec8d6","dfnText":"suitable origin","external":true,"refSections":[{"refs":[{"id":"ref-for-suitable-origin"}],"title":"4.7. Aggregation coordinator"}],"url":"https://wicg.github.io/attribution-reporting-api/#suitable-origin"},
"211c7588": {"dfnID":"211c7588","dfnText":"generate a bid","external":true,"refSections":[{"refs":[{"id":"ref-for-generate-a-bid"},{"id":"ref-for-generate-a-bid\u2460"}],"title":"11.4. Algorithm modifications"}],"url":"https://wicg.github.io/turtledove/#generate-a-bid"},
"24bd7d25": {"dfnID":"24bd7d25","dfnText":"upon fulfillment","external":true,"refSections":[{"refs":[{"id":"ref-for-upon-fulfillment"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://webidl.spec.whatwg.org/#upon-fulfillment"},
"24f2f8da": {"dfnID":"24f2f8da","dfnText":"FencedFrameConfig","external":true,"refSections":[{"refs":[{"id":"ref-for-fencedframeconfig"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/fenced-frame/#fencedframeconfig"},
"24fec0b4": {"dfnID":"24fec0b4","dfnText":"DataError","external":true,"refSections":[{"refs":[{"id":"ref-for-dataerror"},{"id":"ref-for-dataerror\u2460"}],"title":"2. Exposed interface"}],"url":"https://webidl.spec.whatwg.org/#dataerror"},
"2742f1dc": {"dfnID":"2742f1dc","dfnText":"estimated size","external":true,"refSections":[{"refs":[{"id":"ref-for-interest-group-estimated-size"}],"title":"11.4. Algorithm modifications"}],"url":"https://wicg.github.io/turtledove/#interest-group-estimated-size"},
"2ce6f6bb": {"dfnID":"2ce6f6bb","dfnText":"fetch(input)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-global-fetch"},{"id":"ref-for-dom-global-fetch\u2460"},{"id":"ref-for-dom-global-fetch\u2461"}],"title":"1.3. Alternative considered"}],"url":"https://fetch.spec.whatwg.org/#dom-global-fetch"},
"2d1093cd": {"dfnID":"2d1093cd","dfnText":"serializing an infra value to a json string","external":true,"refSections":[{"refs":[{"id":"ref-for-serialize-an-infra-value-to-a-json-string"}],"title":"8.4. Serializing reports"}],"url":"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-a-json-string"},
"31b8df52": {"dfnID":"31b8df52","dfnText":"selectURL(name, urls)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-windowsharedstorage-selecturl"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://wicg.github.io/shared-storage/#dom-windowsharedstorage-selecturl"},
"31db57e6": {"dfnID":"31db57e6","dfnText":"keys","external":true,"refSections":[{"refs":[{"id":"ref-for-map-getting-the-keys"}],"title":"11.4. Algorithm modifications"}],"url":"https://infra.spec.whatwg.org/#map-getting-the-keys"},
"3349d69f": {"dfnID":"3349d69f","dfnText":"associated document","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-document-window"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-concept-document-window\u2460"}],"title":"11.4. Algorithm modifications"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window"},
"33b5a16f": {"dfnID":"33b5a16f","dfnText":"InterestGroupScriptRunnerGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-interestgroupscriptrunnerglobalscope"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-interestgroupscriptrunnerglobalscope\u2460"}],"title":"11.3.8. Extending\nInterestGroupScriptRunnerGlobalScope"},{"refs":[{"id":"ref-for-interestgroupscriptrunnerglobalscope\u2461"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-interestgroupscriptrunnerglobalscope\u2462"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/turtledove/#interestgroupscriptrunnerglobalscope"},
"358f1dbd": {"dfnID":"358f1dbd","dfnText":"referrer","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-referrer"}],"title":"8.3. Sending reports"}],"url":"https://fetch.spec.whatwg.org/#concept-request-referrer"},
"3610bd67": {"dfnID":"3610bd67","dfnText":"allowed to use","external":true,"refSections":[{"refs":[{"id":"ref-for-allowed-to-use"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-allowed-to-use\u2460"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-allowed-to-use\u2461"}],"title":"11.4. Algorithm modifications"}],"url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use"},
"36858240": {"dfnID":"36858240","dfnText":"boolean","external":true,"refSections":[{"refs":[{"id":"ref-for-boolean"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-boolean\u2460"}],"title":"4.4. Debug details"},{"refs":[{"id":"ref-for-boolean\u2461"}],"title":"4.6. Aggregatable report"},{"refs":[{"id":"ref-for-boolean\u2462"},{"id":"ref-for-boolean\u2463"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-boolean\u2464"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-boolean\u2465"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-boolean\u2466"},{"id":"ref-for-boolean\u2467"},{"id":"ref-for-boolean\u2468"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-boolean\u2460\u24ea"}],"title":"11.3.3. Permissions policy state"}],"url":"https://infra.spec.whatwg.org/#boolean"},
"37afd48d": {"dfnID":"37afd48d","dfnText":"InvalidAccessError","external":true,"refSections":[{"refs":[{"id":"ref-for-invalidaccesserror"},{"id":"ref-for-invalidaccesserror\u2460"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-invalidaccesserror\u2461"},{"id":"ref-for-invalidaccesserror\u2462"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-invalidaccesserror\u2463"}],"title":"11.1. New WebIDL"}],"url":"https://webidl.spec.whatwg.org/#invalidaccesserror"},
"3a711be7": {"dfnID":"3a711be7","dfnText":"scheme","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-scheme"}],"title":"8.4. Serializing reports"}],"url":"https://url.spec.whatwg.org/#concept-url-scheme"},
"3ba6be6a": {"dfnID":"3ba6be6a","dfnText":"highest scoring other bid","external":true,"refSections":[{"refs":[{"id":"ref-for-leading-bid-info-highest-scoring-other-bid"},{"id":"ref-for-leading-bid-info-highest-scoring-other-bid\u2460"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bid"},
"3c763838": {"dfnID":"3c763838","dfnText":"SharedStorageRunOperationMethodOptions","external":true,"refSections":[{"refs":[{"id":"ref-for-dictdef-sharedstoragerunoperationmethodoptions"},{"id":"ref-for-dictdef-sharedstoragerunoperationmethodoptions\u2460"},{"id":"ref-for-dictdef-sharedstoragerunoperationmethodoptions\u2461"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://wicg.github.io/shared-storage/#dictdef-sharedstoragerunoperationmethodoptions"},
"3de9e659": {"dfnID":"3de9e659","dfnText":"byte sequence","external":true,"refSections":[{"refs":[{"id":"ref-for-byte-sequence"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-byte-sequence\u2460"},{"id":"ref-for-byte-sequence\u2461"},{"id":"ref-for-byte-sequence\u2462"},{"id":"ref-for-byte-sequence\u2463"},{"id":"ref-for-byte-sequence\u2464"},{"id":"ref-for-byte-sequence\u2465"},{"id":"ref-for-byte-sequence\u2466"},{"id":"ref-for-byte-sequence\u2467"}],"title":"8.4. Serializing reports"}],"url":"https://infra.spec.whatwg.org/#byte-sequence"},
"3fca5a9e": {"dfnID":"3fca5a9e","dfnText":"map","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-map"},{"id":"ref-for-ordered-map\u2460"},{"id":"ref-for-ordered-map\u2461"}],"title":"5. Storage"},{"refs":[{"id":"ref-for-ordered-map\u2462"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-ordered-map\u2463"},{"id":"ref-for-ordered-map\u2464"},{"id":"ref-for-ordered-map\u2465"},{"id":"ref-for-ordered-map\u2466"},{"id":"ref-for-ordered-map\u2467"},{"id":"ref-for-ordered-map\u2468"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-ordered-map\u2460\u24ea"},{"id":"ref-for-ordered-map\u2460\u2460"},{"id":"ref-for-ordered-map\u2460\u2461"},{"id":"ref-for-ordered-map\u2460\u2462"}],"title":"11.3.1. Extending auction config"},{"refs":[{"id":"ref-for-ordered-map\u2460\u2463"}],"title":"11.3.7. On event contribution cache"},{"refs":[{"id":"ref-for-ordered-map\u2460\u2464"}],"title":"11.4. Algorithm modifications"}],"url":"https://infra.spec.whatwg.org/#ordered-map"},
"4013a022": {"dfnID":"4013a022","dfnText":"this","external":true,"refSections":[{"refs":[{"id":"ref-for-this"},{"id":"ref-for-this\u2460"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-this\u2461"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-this\u2462"},{"id":"ref-for-this\u2463"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-this\u2464"},{"id":"ref-for-this\u2465"},{"id":"ref-for-this\u2466"}],"title":"11.1. New WebIDL"}],"url":"https://webidl.spec.whatwg.org/#this"},
"43ac8374": {"dfnID":"43ac8374","dfnText":"origin (for environment settings object)","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-settings-object-origin"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-concept-settings-object-origin\u2460"},{"id":"ref-for-concept-settings-object-origin\u2461"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-concept-settings-object-origin\u2462"}],"title":"11.4. Algorithm modifications"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin"},
"45209803": {"dfnID":"45209803","dfnText":"for each (for map)","external":true,"refSections":[{"refs":[{"id":"ref-for-map-iterate"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-map-iterate\u2460"},{"id":"ref-for-map-iterate\u2461"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-map-iterate\u2462"},{"id":"ref-for-map-iterate\u2463"},{"id":"ref-for-map-iterate\u2464"},{"id":"ref-for-map-iterate\u2465"},{"id":"ref-for-map-iterate\u2466"},{"id":"ref-for-map-iterate\u2467"}],"title":"11.5. New algorithms"}],"url":"https://infra.spec.whatwg.org/#map-iterate"},
"45a22199": {"dfnID":"45a22199","dfnText":"unique internal value","external":true,"refSections":[{"refs":[{"id":"ref-for-unique-internal-value"}],"title":"4.1. Batching scope"},{"refs":[{"id":"ref-for-unique-internal-value\u2460"}],"title":"4.2. Debug scope"}],"url":"https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#unique-internal-value"},
"45ebf49f": {"dfnID":"45ebf49f","dfnText":"runAdAuction(config)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-navigator-runadauction"}],"title":"11.4. Algorithm modifications"}],"url":"https://wicg.github.io/turtledove/#dom-navigator-runadauction"},
"4b2c8c72": {"dfnID":"4b2c8c72","dfnText":"duration","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-duration"},{"id":"ref-for-dfn-duration\u2460"}],"title":"6. Implementation-defined values"},{"refs":[{"id":"ref-for-dfn-duration\u2461"},{"id":"ref-for-dfn-duration\u2462"},{"id":"ref-for-dfn-duration\u2463"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-dfn-duration\u2464"},{"id":"ref-for-dfn-duration\u2465"},{"id":"ref-for-dfn-duration\u2466"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://w3c.github.io/hr-time/#dfn-duration"},
"4be6272b": {"dfnID":"4be6272b","dfnText":"success","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-success"}],"title":"9.1. Set local testing mode"}],"url":"https://w3c.github.io/webdriver/#dfn-success"},
"4c07280e": {"dfnID":"4c07280e","dfnText":"serialize an infra value to json bytes","external":true,"refSections":[{"refs":[{"id":"ref-for-serialize-an-infra-value-to-json-bytes"}],"title":"8.4. Serializing reports"}],"url":"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes"},
"4d8f32a4": {"dfnID":"4d8f32a4","dfnText":"leading bid info","external":true,"refSections":[{"refs":[{"id":"ref-for-leading-bid-info"},{"id":"ref-for-leading-bid-info\u2460"},{"id":"ref-for-leading-bid-info\u2461"},{"id":"ref-for-leading-bid-info\u2462"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/turtledove/#leading-bid-info"},
"50b05fad": {"dfnID":"50b05fad","dfnText":"method","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-method"}],"title":"8.3. Sending reports"}],"url":"https://fetch.spec.whatwg.org/#concept-request-method"},
"53275e46": {"dfnID":"53275e46","dfnText":"append (for list)","external":true,"refSections":[{"refs":[{"id":"ref-for-list-append"},{"id":"ref-for-list-append\u2460"},{"id":"ref-for-list-append\u2461"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-list-append\u2462"},{"id":"ref-for-list-append\u2463"},{"id":"ref-for-list-append\u2464"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-list-append\u2465"}],"title":"11.1. New WebIDL"}],"url":"https://infra.spec.whatwg.org/#list-append"},
"532887db": {"dfnID":"532887db","dfnText":"interestGroupBuyers","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-auctionadconfig-interestgroupbuyers"}],"title":"11.4. Algorithm modifications"}],"url":"https://wicg.github.io/turtledove/#dom-auctionadconfig-interestgroupbuyers"},
"5372cca8": {"dfnID":"5372cca8","dfnText":"boolean","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-boolean"}],"title":"11.1. New WebIDL"}],"url":"https://webidl.spec.whatwg.org/#idl-boolean"},
"54627f47": {"dfnID":"54627f47","dfnText":"starts with","external":true,"refSections":[{"refs":[{"id":"ref-for-string-starts-with"},{"id":"ref-for-string-starts-with\u2460"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-string-starts-with\u2461"},{"id":"ref-for-string-starts-with\u2462"}],"title":"11.5. New algorithms"}],"url":"https://infra.spec.whatwg.org/#string-starts-with"},
"54f6011e": {"dfnID":"54f6011e","dfnText":"WindowSharedStorage","external":true,"refSections":[{"refs":[{"id":"ref-for-windowsharedstorage"},{"id":"ref-for-windowsharedstorage\u2460"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://wicg.github.io/shared-storage/#windowsharedstorage"},
"55213b5b": {"dfnID":"55213b5b","dfnText":"request","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request"}],"title":"8.3. Sending reports"}],"url":"https://fetch.spec.whatwg.org/#concept-request"},
"5afbefcd": {"dfnID":"5afbefcd","dfnText":"item (for list)","external":true,"refSections":[{"refs":[{"id":"ref-for-list-item"}],"title":"6. Implementation-defined values"}],"url":"https://infra.spec.whatwg.org/#list-item"},
"5b668531": {"dfnID":"5b668531","dfnText":"getting a property","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-getting-properties"}],"title":"9.1. Set local testing mode"}],"url":"https://w3c.github.io/webdriver/#dfn-getting-properties"},
"5b92b08e": {"dfnID":"5b92b08e","dfnText":"InterestGroupReportingScriptRunnerGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-interestgroupreportingscriptrunnerglobalscope"}],"title":"11.3.9. Extending\nInterestGroupReportingScriptRunnerGlobalScope"},{"refs":[{"id":"ref-for-interestgroupreportingscriptrunnerglobalscope\u2460"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-interestgroupreportingscriptrunnerglobalscope\u2461"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope"},
"5bf9ea61": {"dfnID":"5bf9ea61","dfnText":"attribute","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-attribute"}],"title":"3. Exposing to global scopes"}],"url":"https://webidl.spec.whatwg.org/#dfn-attribute"},
"5d106754": {"dfnID":"5d106754","dfnText":"InterestGroupBiddingScriptRunnerGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-interestgroupbiddingscriptrunnerglobalscope"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope"},
"5f90bbfb": {"dfnID":"5f90bbfb","dfnText":"undefined","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-undefined"},{"id":"ref-for-idl-undefined\u2460"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-idl-undefined\u2461"}],"title":"9.1. Set local testing mode"},{"refs":[{"id":"ref-for-idl-undefined\u2462"}],"title":"11.1. New WebIDL"}],"url":"https://webidl.spec.whatwg.org/#idl-undefined"},
"610171dd": {"dfnID":"610171dd","dfnText":"interest group","external":true,"refSections":[{"refs":[{"id":"ref-for-interest-group"}],"title":"11.3.2. Extending interest group"}],"url":"https://wicg.github.io/turtledove/#interest-group"},
"64108305": {"dfnID":"64108305","dfnText":"evaluate a script","external":true,"refSections":[{"refs":[{"id":"ref-for-evaluate-a-script"}],"title":"11.4. Algorithm modifications"}],"url":"https://wicg.github.io/turtledove/#evaluate-a-script"},
"649608b9": {"dfnID":"649608b9","dfnText":"list","external":true,"refSections":[{"refs":[{"id":"ref-for-list"}],"title":"4.6. Aggregatable report"},{"refs":[{"id":"ref-for-list\u2460"},{"id":"ref-for-list\u2461"}],"title":"5. Storage"},{"refs":[{"id":"ref-for-list\u2462"},{"id":"ref-for-list\u2463"},{"id":"ref-for-list\u2464"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-list\u2465"},{"id":"ref-for-list\u2466"},{"id":"ref-for-list\u2467"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-list\u2468"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-list\u2460\u24ea"},{"id":"ref-for-list\u2460\u2460"},{"id":"ref-for-list\u2460\u2461"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-list\u2460\u2462"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-list\u2460\u2463"}],"title":"11.3.7. On event contribution cache"},{"refs":[{"id":"ref-for-list\u2460\u2464"}],"title":"11.4. Algorithm modifications"}],"url":"https://infra.spec.whatwg.org/#list"},
"654cec7d": {"dfnID":"654cec7d","dfnText":"interest group (for generated bid)","external":true,"refSections":[{"refs":[{"id":"ref-for-generated-bid-interest-group"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-generated-bid-interest-group\u2460"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/turtledove/#generated-bid-interest-group"},
"68510b3d": {"dfnID":"68510b3d","dfnText":"report a private aggregation event","external":true,"refSections":[{"refs":[{"id":"ref-for-report-a-private-aggregation-event"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/fenced-frame/#report-a-private-aggregation-event"},
"688f9669": {"dfnID":"688f9669","dfnText":"cache mode","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-cache-mode"}],"title":"8.3. Sending reports"}],"url":"https://fetch.spec.whatwg.org/#concept-request-cache-mode"},
"6b815fdd": {"dfnID":"6b815fdd","dfnText":"is empty (for list)","external":true,"refSections":[{"refs":[{"id":"ref-for-list-is-empty"}],"title":"8.1. Exported algorithms"}],"url":"https://infra.spec.whatwg.org/#list-is-empty"},
"6d19ac93": {"dfnID":"6d19ac93","dfnText":"user agent","external":true,"refSections":[{"refs":[{"id":"ref-for-user-agent"},{"id":"ref-for-user-agent\u2460"},{"id":"ref-for-user-agent\u2461"},{"id":"ref-for-user-agent\u2462"},{"id":"ref-for-user-agent\u2463"},{"id":"ref-for-user-agent\u2464"}],"title":"5. Storage"},{"refs":[{"id":"ref-for-user-agent\u2465"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-user-agent\u2466"},{"id":"ref-for-user-agent\u2467"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-user-agent\u2468"},{"id":"ref-for-user-agent\u2460\u24ea"}],"title":"11.5. New algorithms"},{"refs":[{"id":"ref-for-user-agent\u2460\u2460"}],"title":"13.1. Same-origin policy"},{"refs":[{"id":"ref-for-user-agent\u2460\u2461"},{"id":"ref-for-user-agent\u2460\u2462"}],"title":"13.2. Protecting the histogram contributions"}],"url":"https://infra.spec.whatwg.org/#user-agent"},
"6d1db60d": {"dfnID":"6d1db60d","dfnText":"service-workers mode","external":true,"refSections":[{"refs":[{"id":"ref-for-request-service-workers-mode"}],"title":"8.3. Sending reports"}],"url":"https://fetch.spec.whatwg.org/#request-service-workers-mode"},
"6ee0eab1": {"dfnID":"6ee0eab1","dfnText":"header list","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-header-list"}],"title":"8.3. Sending reports"}],"url":"https://fetch.spec.whatwg.org/#concept-request-header-list"},
"6f738b30": {"dfnID":"6f738b30","dfnText":"global scopes","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-worklet-global-scopes"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://html.spec.whatwg.org/multipage/worklets.html#concept-worklet-global-scopes"},
"6f7f62df": {"dfnID":"6f7f62df","dfnText":"unsafe-request flag","external":true,"refSections":[{"refs":[{"id":"ref-for-unsafe-request-flag"}],"title":"8.3. Sending reports"}],"url":"https://fetch.spec.whatwg.org/#unsafe-request-flag"},
"715f22e4": {"dfnID":"715f22e4","dfnText":"if aborted","external":true,"refSections":[{"refs":[{"id":"ref-for-if-aborted"}],"title":"8.3. Sending reports"}],"url":"https://infra.spec.whatwg.org/#if-aborted"},
"73df93a8": {"dfnID":"73df93a8","dfnText":"generate a random uuid","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-generate-a-random-uuid"}],"title":"8.2. Scheduling reports"}],"url":"https://w3c.github.io/webcrypto/#dfn-generate-a-random-uuid"},
"7787d359": {"dfnID":"7787d359","dfnText":"record","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-record"}],"title":"11.1. New WebIDL"}],"url":"https://webidl.spec.whatwg.org/#idl-record"},
"77a2ee6e": {"dfnID":"77a2ee6e","dfnText":"host","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-origin-host"}],"title":"8.4. Serializing reports"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host"},
"77b4c09a": {"dfnID":"77b4c09a","dfnText":"assert","external":true,"refSections":[{"refs":[{"id":"ref-for-assert"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-assert\u2460"},{"id":"ref-for-assert\u2461"},{"id":"ref-for-assert\u2462"},{"id":"ref-for-assert\u2463"},{"id":"ref-for-assert\u2464"},{"id":"ref-for-assert\u2465"},{"id":"ref-for-assert\u2466"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-assert\u2467"},{"id":"ref-for-assert\u2468"},{"id":"ref-for-assert\u2460\u24ea"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-assert\u2460\u2460"},{"id":"ref-for-assert\u2460\u2461"},{"id":"ref-for-assert\u2460\u2462"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-assert\u2460\u2463"},{"id":"ref-for-assert\u2460\u2464"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-assert\u2460\u2465"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-assert\u2460\u2466"},{"id":"ref-for-assert\u2460\u2467"},{"id":"ref-for-assert\u2460\u2468"}],"title":"11.5. New algorithms"}],"url":"https://infra.spec.whatwg.org/#assert"},
"79027840": {"dfnID":"79027840","dfnText":"interest group buyers","external":true,"refSections":[{"refs":[{"id":"ref-for-auction-config-interest-group-buyers"}],"title":"11.4. Algorithm modifications"}],"url":"https://wicg.github.io/turtledove/#auction-config-interest-group-buyers"},
"79bc063f": {"dfnID":"79bc063f","dfnText":"SharedStorageWorkletGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-sharedstorageworkletglobalscope"},{"id":"ref-for-sharedstorageworkletglobalscope\u2460"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://wicg.github.io/shared-storage/#sharedstorageworkletglobalscope"},
"7b0d918d": {"dfnID":"7b0d918d","dfnText":"break","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-break"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-iteration-break\u2460"}],"title":"11.4. Algorithm modifications"}],"url":"https://infra.spec.whatwg.org/#iteration-break"},
"7d4424b2": {"dfnID":"7d4424b2","dfnText":"remove (for map)","external":true,"refSections":[{"refs":[{"id":"ref-for-map-remove"},{"id":"ref-for-map-remove\u2460"},{"id":"ref-for-map-remove\u2461"}],"title":"8.1. Exported algorithms"}],"url":"https://infra.spec.whatwg.org/#map-remove"},
"7deb6835": {"dfnID":"7deb6835","dfnText":"settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-realm-settings-object"}],"title":"11.4. Algorithm modifications"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-settings-object"},
"82c23298": {"dfnID":"82c23298","dfnText":"remote end steps","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-remote-end-steps"}],"title":"9.1. Set local testing mode"}],"url":"https://w3c.github.io/webdriver/#dfn-remote-end-steps"},
"82ca3efc": {"dfnID":"82ca3efc","dfnText":"TypeError","external":true,"refSections":[{"refs":[{"id":"ref-for-exceptiondef-typeerror"},{"id":"ref-for-exceptiondef-typeerror\u2460"},{"id":"ref-for-exceptiondef-typeerror\u2461"},{"id":"ref-for-exceptiondef-typeerror\u2462"},{"id":"ref-for-exceptiondef-typeerror\u2463"},{"id":"ref-for-exceptiondef-typeerror\u2464"},{"id":"ref-for-exceptiondef-typeerror\u2465"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-exceptiondef-typeerror\u2466"},{"id":"ref-for-exceptiondef-typeerror\u2467"},{"id":"ref-for-exceptiondef-typeerror\u2468"},{"id":"ref-for-exceptiondef-typeerror\u2460\u24ea"}],"title":"11.4. Algorithm modifications"}],"url":"https://webidl.spec.whatwg.org/#exceptiondef-typeerror"},
"833154f2": {"dfnID":"833154f2","dfnText":"getter steps","external":true,"refSections":[{"refs":[{"id":"ref-for-getter-steps"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-getter-steps\u2460"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-getter-steps\u2461"}],"title":"11.1. New WebIDL"}],"url":"https://webidl.spec.whatwg.org/#getter-steps"},
"84b454ff": {"dfnID":"84b454ff","dfnText":"ordered map","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-map"},{"id":"ref-for-ordered-map\u2460"},{"id":"ref-for-ordered-map\u2461"}],"title":"5. Storage"},{"refs":[{"id":"ref-for-ordered-map\u2462"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-ordered-map\u2463"},{"id":"ref-for-ordered-map\u2464"},{"id":"ref-for-ordered-map\u2465"},{"id":"ref-for-ordered-map\u2466"},{"id":"ref-for-ordered-map\u2467"},{"id":"ref-for-ordered-map\u2468"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-ordered-map\u2460\u24ea"},{"id":"ref-for-ordered-map\u2460\u2460"},{"id":"ref-for-ordered-map\u2460\u2461"},{"id":"ref-for-ordered-map\u2460\u2462"}],"title":"11.3.1. Extending auction config"},{"refs":[{"id":"ref-for-ordered-map\u2460\u2463"}],"title":"11.3.7. On event contribution cache"},{"refs":[{"id":"ref-for-ordered-map\u2460\u2464"}],"title":"11.4. Algorithm modifications"}],"url":"https://infra.spec.whatwg.org/#ordered-map"},
"852ada56": {"dfnID":"852ada56","dfnText":"port","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-port"}],"title":"8.4. Serializing reports"}],"url":"https://url.spec.whatwg.org/#concept-url-port"},
"857d5516": {"dfnID":"857d5516","dfnText":"client","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-client"}],"title":"8.3. Sending reports"}],"url":"https://fetch.spec.whatwg.org/#concept-request-client"},
"860300d4": {"dfnID":"860300d4","dfnText":"implementation-defined","external":true,"refSections":[{"refs":[{"id":"ref-for-implementation-defined"}],"title":"6. Implementation-defined values"},{"refs":[{"id":"ref-for-implementation-defined\u2460"},{"id":"ref-for-implementation-defined\u2461"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-implementation-defined\u2462"},{"id":"ref-for-implementation-defined\u2463"},{"id":"ref-for-implementation-defined\u2464"},{"id":"ref-for-implementation-defined\u2465"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-implementation-defined\u2466"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-implementation-defined\u2467"},{"id":"ref-for-implementation-defined\u2468"},{"id":"ref-for-implementation-defined\u2460\u24ea"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-implementation-defined\u2460\u2460"}],"title":"12.1.6. Privacy parameters"},{"refs":[{"id":"ref-for-implementation-defined\u2460\u2461"}],"title":"13.1. Same-origin policy"}],"url":"https://infra.spec.whatwg.org/#implementation-defined"},
"8855a9aa": {"dfnID":"8855a9aa","dfnText":"DOMString","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DOMString"},{"id":"ref-for-idl-DOMString\u2460"},{"id":"ref-for-idl-DOMString\u2461"}],"title":"11.1. New WebIDL"}],"url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"889e932f": {"dfnID":"889e932f","dfnText":"Exposed","external":true,"refSections":[{"refs":[{"id":"ref-for-Exposed"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-Exposed\u2460"}],"title":"11.1. New WebIDL"}],"url":"https://webidl.spec.whatwg.org/#Exposed"},
"8aa72f2c": {"dfnID":"8aa72f2c","dfnText":"generate and score bids","external":true,"refSections":[{"refs":[{"id":"ref-for-generate-and-score-bids"},{"id":"ref-for-generate-and-score-bids\u2460"}],"title":"11.4. Algorithm modifications"}],"url":"https://wicg.github.io/turtledove/#generate-and-score-bids"},
"8c800cdf": {"dfnID":"8c800cdf","dfnText":"double","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-double"},{"id":"ref-for-idl-double\u2460"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-idl-double\u2461"},{"id":"ref-for-idl-double\u2462"}],"title":"11.5. New algorithms"}],"url":"https://webidl.spec.whatwg.org/#idl-double"},
"8da4d1e3": {"dfnID":"8da4d1e3","dfnText":"invalid argument","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-invalid-argument"},{"id":"ref-for-dfn-invalid-argument\u2460"}],"title":"9.1. Set local testing mode"}],"url":"https://w3c.github.io/webdriver/#dfn-invalid-argument"},
"8e9945a0": {"dfnID":"8e9945a0","dfnText":"body","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-body"}],"title":"8.3. Sending reports"}],"url":"https://fetch.spec.whatwg.org/#concept-request-body"},
"902380f7": {"dfnID":"902380f7","dfnText":"credentials mode","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-credentials-mode"}],"title":"8.3. Sending reports"}],"url":"https://fetch.spec.whatwg.org/#concept-request-credentials-mode"},
"959ad97b": {"dfnID":"959ad97b","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-origin"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-concept-url-origin\u2460"}],"title":"11.5. New algorithms"}],"url":"https://url.spec.whatwg.org/#concept-url-origin"},
"96dabee7": {"dfnID":"96dabee7","dfnText":"potentially trustworthy origin","external":true,"refSections":[{"refs":[{"id":"ref-for-potentially-trustworthy-origin"}],"title":"6. Implementation-defined values"},{"refs":[{"id":"ref-for-potentially-trustworthy-origin\u2460"},{"id":"ref-for-potentially-trustworthy-origin\u2461"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-potentially-trustworthy-origin\u2462"}],"title":"8.3. Sending reports"}],"url":"https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-origin"},
"984221ca": {"dfnID":"984221ca","dfnText":"struct","external":true,"refSections":[{"refs":[{"id":"ref-for-struct"}],"title":"4.3. Scoping details"},{"refs":[{"id":"ref-for-struct\u2460"}],"title":"4.4. Debug details"},{"refs":[{"id":"ref-for-struct\u2461"}],"title":"4.5. Contribution cache entry"},{"refs":[{"id":"ref-for-struct\u2462"}],"title":"4.6. Aggregatable report"},{"refs":[{"id":"ref-for-struct\u2463"}],"title":"4.9. Pre-specified report parameters"},{"refs":[{"id":"ref-for-struct\u2464"}],"title":"11.3.1. Extending auction config"},{"refs":[{"id":"ref-for-struct\u2465"}],"title":"11.3.2. Extending interest group"},{"refs":[{"id":"ref-for-struct\u2466"}],"title":"11.3.3. Permissions policy state"},{"refs":[{"id":"ref-for-struct\u2467"}],"title":"11.3.6. On event contribution cache entry"}],"url":"https://infra.spec.whatwg.org/#struct"},
"98c9b3d9": {"dfnID":"98c9b3d9","dfnText":"interest group set","external":true,"refSections":[{"refs":[{"id":"ref-for-interest-group-set"},{"id":"ref-for-interest-group-set\u2460"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/turtledove/#interest-group-set"},
"98e31e77": {"dfnID":"98e31e77","dfnText":"port","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-origin-port"}],"title":"8.4. Serializing reports"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-port"},
"99c988d6": {"dfnID":"99c988d6","dfnText":"remove (for list)","external":true,"refSections":[{"refs":[{"id":"ref-for-list-remove"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-list-remove\u2460"},{"id":"ref-for-list-remove\u2461"}],"title":"8.3. Sending reports"}],"url":"https://infra.spec.whatwg.org/#list-remove"},
"9a517a7d": {"dfnID":"9a517a7d","dfnText":"queue a task","external":true,"refSections":[{"refs":[{"id":"ref-for-queue-a-task"},{"id":"ref-for-queue-a-task\u2460"}],"title":"8.3. Sending reports"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"},
"9c4c1e66": {"dfnID":"9c4c1e66","dfnText":"relevant settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-relevant-settings-object"}],"title":"3. Exposing to global scopes"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"},
"9cce47fd": {"dfnID":"9cce47fd","dfnText":"sequence","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-sequence"}],"title":"11.1. New WebIDL"}],"url":"https://webidl.spec.whatwg.org/#idl-sequence"},
"9e4d25d5": {"dfnID":"9e4d25d5","dfnText":"leading bid","external":true,"refSections":[{"refs":[{"id":"ref-for-leading-bid-info-leading-bid"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-leading-bid-info-leading-bid\u2460"},{"id":"ref-for-leading-bid-info-leading-bid\u2461"},{"id":"ref-for-leading-bid-info-leading-bid\u2462"},{"id":"ref-for-leading-bid-info-leading-bid\u2463"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid"},
"9f3224b9": {"dfnID":"9f3224b9","dfnText":"interest groups","external":true,"refSections":[{"refs":[{"id":"ref-for-GroupsIG"}],"title":"11.3.1. Extending auction config"},{"refs":[{"id":"ref-for-GroupsIG\u2460"}],"title":"11.3.9. Extending\nInterestGroupReportingScriptRunnerGlobalScope"},{"refs":[{"id":"ref-for-GroupsIG\u2461"},{"id":"ref-for-GroupsIG\u2462"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-GroupsIG\u2463"}],"title":"11.5. New algorithms"}],"url":"https://www.w3.org/Consortium/Process/#GroupsIG"},
"a09bfce2": {"dfnID":"a09bfce2","dfnText":"current wall time","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-current-wall-time"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-dfn-current-wall-time\u2460"},{"id":"ref-for-dfn-current-wall-time\u2461"},{"id":"ref-for-dfn-current-wall-time\u2462"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-dfn-current-wall-time\u2463"},{"id":"ref-for-dfn-current-wall-time\u2464"},{"id":"ref-for-dfn-current-wall-time\u2465"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://w3c.github.io/hr-time/#dfn-current-wall-time"},
"a0f5bba3": {"dfnID":"a0f5bba3","dfnText":"InterestGroupScoringScriptRunnerGlobalScope","external":true,"refSections":[{"refs":[{"id":"ref-for-interestgroupscoringscriptrunnerglobalscope"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-interestgroupscoringscriptrunnerglobalscope\u2460"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/turtledove/#interestgroupscoringscriptrunnerglobalscope"},
"a23d12a9": {"dfnID":"a23d12a9","dfnText":"scheme","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-origin-scheme"}],"title":"8.4. Serializing reports"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme"},
"a33db89a": {"dfnID":"a33db89a","dfnText":"fetch","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-fetch"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-concept-fetch\u2460"}],"title":"8.4. Serializing reports"}],"url":"https://fetch.spec.whatwg.org/#concept-fetch"},
"a3b18719": {"dfnID":"a3b18719","dfnText":"append (for set)","external":true,"refSections":[{"refs":[{"id":"ref-for-set-append"},{"id":"ref-for-set-append\u2460"}],"title":"8.2. Scheduling reports"}],"url":"https://infra.spec.whatwg.org/#set-append"},
"a72449dd": {"dfnID":"a72449dd","dfnText":"in parallel","external":true,"refSections":[{"refs":[{"id":"ref-for-in-parallel"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-in-parallel\u2460"},{"id":"ref-for-in-parallel\u2461"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"},
"a8c7461b": {"dfnID":"a8c7461b","dfnText":"url record","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url"},{"id":"ref-for-concept-url\u2460"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-concept-url\u2461"}],"title":"8.4. Serializing reports"}],"url":"https://url.spec.whatwg.org/#concept-url"},
"a973e0fe": {"dfnID":"a973e0fe","dfnText":"document","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-document"}],"title":"3. Exposing to global scopes"}],"url":"https://dom.spec.whatwg.org/#concept-document"},
"a99627c2": {"dfnID":"a99627c2","dfnText":"seller","external":true,"refSections":[{"refs":[{"id":"ref-for-auction-config-seller"},{"id":"ref-for-auction-config-seller\u2460"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/turtledove/#auction-config-seller"},
"abcdb0cf": {"dfnID":"abcdb0cf","dfnText":"report win","external":true,"refSections":[{"refs":[{"id":"ref-for-report-win"}],"title":"11.4. Algorithm modifications"}],"url":"https://wicg.github.io/turtledove/#report-win"},
"ae8def21": {"dfnID":"ae8def21","dfnText":"contain","external":true,"refSections":[{"refs":[{"id":"ref-for-list-contain"}],"title":"4.7. Aggregation coordinator"},{"refs":[{"id":"ref-for-list-contain\u2460"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-list-contain\u2461"}],"title":"11.4. Algorithm modifications"}],"url":"https://infra.spec.whatwg.org/#list-contain"},
"aggregatable-report": {"dfnID":"aggregatable-report","dfnText":"4.6. Aggregatable report","external":false,"refSections":[{"refs":[{"id":"ref-for-aggregatable-report"}],"title":"1.3. Alternative considered"},{"refs":[{"id":"ref-for-aggregatable-report\u2460"}],"title":"4.1. Batching scope"},{"refs":[{"id":"ref-for-aggregatable-report"}],"title":"4.6. Aggregatable report"},{"refs":[{"id":"ref-for-aggregatable-report\u2461"}],"title":"5. Storage"},{"refs":[{"id":"ref-for-aggregatable-report\u2462"},{"id":"ref-for-aggregatable-report\u2463"}],"title":"6. Implementation-defined values"},{"refs":[{"id":"ref-for-aggregatable-report\u2464"},{"id":"ref-for-aggregatable-report\u2465"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-aggregatable-report\u2466"},{"id":"ref-for-aggregatable-report\u2467"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-aggregatable-report\u2468"},{"id":"ref-for-aggregatable-report\u2460\u24ea"},{"id":"ref-for-aggregatable-report\u2460\u2460"},{"id":"ref-for-aggregatable-report\u2460\u2461"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-aggregatable-report\u2460\u2462"}],"title":"9.1. Set local testing mode"},{"refs":[{"id":"ref-for-aggregatable-report\u2460\u2463"}],"title":"12.3.2. User-presence tracking"}],"url":"#aggregatable-report"},
"aggregatable-report-aggregation-coordinator": {"dfnID":"aggregatable-report-aggregation-coordinator","dfnText":"aggregation coordinator","external":false,"refSections":[{"refs":[{"id":"ref-for-aggregatable-report-aggregation-coordinator"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-aggregatable-report-aggregation-coordinator\u2460"},{"id":"ref-for-aggregatable-report-aggregation-coordinator\u2461"}],"title":"8.4. Serializing reports"}],"url":"#aggregatable-report-aggregation-coordinator"},
"aggregatable-report-api": {"dfnID":"aggregatable-report-api","dfnText":"api","external":false,"refSections":[{"refs":[{"id":"ref-for-aggregatable-report-api"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-aggregatable-report-api\u2460"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-aggregatable-report-api\u2461"}],"title":"8.4. Serializing reports"}],"url":"#aggregatable-report-api"},
"aggregatable-report-cache": {"dfnID":"aggregatable-report-cache","dfnText":"aggregatable report cache","external":false,"refSections":[{"refs":[{"id":"ref-for-aggregatable-report-cache"}],"title":"5.1. Clearing storage"},{"refs":[{"id":"ref-for-aggregatable-report-cache\u2460"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-aggregatable-report-cache\u2461"},{"id":"ref-for-aggregatable-report-cache\u2462"},{"id":"ref-for-aggregatable-report-cache\u2463"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-aggregatable-report-cache\u2464"}],"title":"12.2. Clearing site data"},{"refs":[{"id":"ref-for-aggregatable-report-cache\u2465"}],"title":"13.1. Same-origin policy"}],"url":"#aggregatable-report-cache"},
"aggregatable-report-context-id": {"dfnID":"aggregatable-report-context-id","dfnText":"context ID","external":false,"refSections":[{"refs":[{"id":"ref-for-aggregatable-report-context-id"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-aggregatable-report-context-id\u2460"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-aggregatable-report-context-id\u2461"}],"title":"12.1.3. Protecting against leaks via the number of reports"}],"url":"#aggregatable-report-context-id"},
"aggregatable-report-contributions": {"dfnID":"aggregatable-report-contributions","dfnText":"contributions","external":false,"refSections":[{"refs":[{"id":"ref-for-aggregatable-report-contributions"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-aggregatable-report-contributions\u2460"},{"id":"ref-for-aggregatable-report-contributions\u2461"},{"id":"ref-for-aggregatable-report-contributions\u2462"}],"title":"8.4. Serializing reports"}],"url":"#aggregatable-report-contributions"},
"aggregatable-report-debug-details": {"dfnID":"aggregatable-report-debug-details","dfnText":"debug details","external":false,"refSections":[{"refs":[{"id":"ref-for-aggregatable-report-debug-details"}],"title":"4.1. Batching scope"},{"refs":[{"id":"ref-for-aggregatable-report-debug-details\u2460"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-aggregatable-report-debug-details\u2461"},{"id":"ref-for-aggregatable-report-debug-details\u2462"},{"id":"ref-for-aggregatable-report-debug-details\u2463"}],"title":"8.4. Serializing reports"}],"url":"#aggregatable-report-debug-details"},
"aggregatable-report-filtering-id-byte-size": {"dfnID":"aggregatable-report-filtering-id-byte-size","dfnText":"filtering ID byte size","external":false,"refSections":[{"refs":[{"id":"ref-for-aggregatable-report-filtering-id-byte-size"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-aggregatable-report-filtering-id-byte-size\u2460"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-aggregatable-report-filtering-id-byte-size\u2461"}],"title":"12.1.3. Protecting against leaks via the number of reports"}],"url":"#aggregatable-report-filtering-id-byte-size"},
"aggregatable-report-original-report-time": {"dfnID":"aggregatable-report-original-report-time","dfnText":"original report time","external":false,"refSections":[{"refs":[{"id":"ref-for-aggregatable-report-original-report-time"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-aggregatable-report-original-report-time\u2460"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-aggregatable-report-original-report-time\u2461"}],"title":"12.3.2. User-presence tracking"}],"url":"#aggregatable-report-original-report-time"},
"aggregatable-report-queued": {"dfnID":"aggregatable-report-queued","dfnText":"queued","external":false,"refSections":[{"refs":[{"id":"ref-for-aggregatable-report-queued"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-aggregatable-report-queued\u2460"},{"id":"ref-for-aggregatable-report-queued\u2461"},{"id":"ref-for-aggregatable-report-queued\u2462"},{"id":"ref-for-aggregatable-report-queued\u2463"}],"title":"8.3. Sending reports"}],"url":"#aggregatable-report-queued"},
"aggregatable-report-report-id": {"dfnID":"aggregatable-report-report-id","dfnText":"report ID","external":false,"refSections":[{"refs":[{"id":"ref-for-aggregatable-report-report-id"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-aggregatable-report-report-id\u2460"}],"title":"8.4. Serializing reports"}],"url":"#aggregatable-report-report-id"},
"aggregatable-report-report-time": {"dfnID":"aggregatable-report-report-time","dfnText":"report time","external":false,"refSections":[{"refs":[{"id":"ref-for-aggregatable-report-report-time"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-aggregatable-report-report-time\u2460"},{"id":"ref-for-aggregatable-report-report-time\u2461"},{"id":"ref-for-aggregatable-report-report-time\u2462"},{"id":"ref-for-aggregatable-report-report-time\u2463"}],"title":"8.3. Sending reports"}],"url":"#aggregatable-report-report-time"},
"aggregatable-report-reporting-origin": {"dfnID":"aggregatable-report-reporting-origin","dfnText":"reporting origin","external":false,"refSections":[{"refs":[{"id":"ref-for-aggregatable-report-reporting-origin"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-aggregatable-report-reporting-origin\u2460"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-aggregatable-report-reporting-origin\u2461"}],"title":"8.4. Serializing reports"}],"url":"#aggregatable-report-reporting-origin"},
"aggregation-coordinator": {"dfnID":"aggregation-coordinator","dfnText":"aggregation coordinator","external":false,"refSections":[{"refs":[{"id":"ref-for-aggregation-coordinator"}],"title":"4.6. Aggregatable report"},{"refs":[{"id":"ref-for-aggregation-coordinator\u2460"}],"title":"5. Storage"},{"refs":[{"id":"ref-for-aggregation-coordinator\u2461"},{"id":"ref-for-aggregation-coordinator\u2462"}],"title":"6. Implementation-defined values"},{"refs":[{"id":"ref-for-aggregation-coordinator\u2463"},{"id":"ref-for-aggregation-coordinator\u2464"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-aggregation-coordinator\u2465"},{"id":"ref-for-aggregation-coordinator\u2466"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-aggregation-coordinator\u2467"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-aggregation-coordinator\u2468"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-aggregation-coordinator\u2460\u24ea"},{"id":"ref-for-aggregation-coordinator\u2460\u2460"}],"title":"11.3.1. Extending auction config"},{"refs":[{"id":"ref-for-aggregation-coordinator\u2460\u2461"}],"title":"11.3.2. Extending interest group"},{"refs":[{"id":"ref-for-aggregation-coordinator\u2460\u2462"},{"id":"ref-for-aggregation-coordinator\u2460\u2463"},{"id":"ref-for-aggregation-coordinator\u2460\u2464"}],"title":"11.5. New algorithms"}],"url":"#aggregation-coordinator"},
"aggregation-coordinator-map": {"dfnID":"aggregation-coordinator-map","dfnText":"aggregation coordinator map","external":false,"refSections":[{"refs":[{"id":"ref-for-aggregation-coordinator-map"},{"id":"ref-for-aggregation-coordinator-map\u2460"}],"title":"8.1. Exported algorithms"}],"url":"#aggregation-coordinator-map"},
"allowed-aggregation-coordinator-set": {"dfnID":"allowed-aggregation-coordinator-set","dfnText":"Allowed aggregation coordinator set","external":false,"refSections":[{"refs":[{"id":"ref-for-allowed-aggregation-coordinator-set"}],"title":"4.7. Aggregation coordinator"}],"url":"#allowed-aggregation-coordinator-set"},
"append-an-entry-to-the-contribution-cache": {"dfnID":"append-an-entry-to-the-contribution-cache","dfnText":"append an entry to the contribution cache","external":false,"refSections":[{"refs":[{"id":"ref-for-append-an-entry-to-the-contribution-cache"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-append-an-entry-to-the-contribution-cache\u2460"},{"id":"ref-for-append-an-entry-to-the-contribution-cache\u2461"}],"title":"11.5. New algorithms"}],"url":"#append-an-entry-to-the-contribution-cache"},
"attempt-to-deliver-a-report": {"dfnID":"attempt-to-deliver-a-report","dfnText":"attempt to deliver a report","external":false,"refSections":[{"refs":[{"id":"ref-for-attempt-to-deliver-a-report"}],"title":"8.3. Sending reports"}],"url":"#attempt-to-deliver-a-report"},
"attempt-to-queue-reports-for-sending": {"dfnID":"attempt-to-queue-reports-for-sending","dfnText":"attempt to queue reports for sending","external":false,"refSections":[{"refs":[{"id":"ref-for-attempt-to-queue-reports-for-sending"}],"title":"8.3. Sending reports"}],"url":"#attempt-to-queue-reports-for-sending"},
"auction-config-auction-report-buyer-debug-details": {"dfnID":"auction-config-auction-report-buyer-debug-details","dfnText":"auction report buyer debug details","external":false,"refSections":[{"refs":[{"id":"ref-for-auction-config-auction-report-buyer-debug-details"},{"id":"ref-for-auction-config-auction-report-buyer-debug-details\u2460"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-auction-config-auction-report-buyer-debug-details\u2461"}],"title":"11.5. New algorithms"}],"url":"#auction-config-auction-report-buyer-debug-details"},
"auction-config-auction-report-buyer-keys": {"dfnID":"auction-config-auction-report-buyer-keys","dfnText":"auction report buyer keys","external":false,"refSections":[{"refs":[{"id":"ref-for-auction-config-auction-report-buyer-keys"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-auction-config-auction-report-buyer-keys\u2460"}],"title":"11.5. New algorithms"}],"url":"#auction-config-auction-report-buyer-keys"},
"auction-config-auction-report-buyers": {"dfnID":"auction-config-auction-report-buyers","dfnText":"auction report buyers","external":false,"refSections":[{"refs":[{"id":"ref-for-auction-config-auction-report-buyers"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-auction-config-auction-report-buyers\u2460"}],"title":"11.5. New algorithms"}],"url":"#auction-config-auction-report-buyers"},
"auction-config-batching-scope-map": {"dfnID":"auction-config-batching-scope-map","dfnText":"batching scope map","external":false,"refSections":[{"refs":[{"id":"ref-for-auction-config-batching-scope-map"},{"id":"ref-for-auction-config-batching-scope-map\u2460"}],"title":"11.5. New algorithms"}],"url":"#auction-config-batching-scope-map"},
"auction-config-per-bid-or-seller-on-event-contribution-cache": {"dfnID":"auction-config-per-bid-or-seller-on-event-contribution-cache","dfnText":"per-bid or seller on event contribution cache","external":false,"refSections":[{"refs":[{"id":"ref-for-auction-config-per-bid-or-seller-on-event-contribution-cache"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-auction-config-per-bid-or-seller-on-event-contribution-cache\u2460"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-auction-config-per-bid-or-seller-on-event-contribution-cache\u2461"}],"title":"11.5. New algorithms"}],"url":"#auction-config-per-bid-or-seller-on-event-contribution-cache"},
"auction-config-permissions-policy-state": {"dfnID":"auction-config-permissions-policy-state","dfnText":"permissions policy state","external":false,"refSections":[{"refs":[{"id":"ref-for-auction-config-permissions-policy-state"},{"id":"ref-for-auction-config-permissions-policy-state\u2460"}],"title":"11.4. Algorithm modifications"}],"url":"#auction-config-permissions-policy-state"},
"auction-config-seller-private-aggregation-coordinator": {"dfnID":"auction-config-seller-private-aggregation-coordinator","dfnText":"seller Private Aggregation coordinator","external":false,"refSections":[{"refs":[{"id":"ref-for-auction-config-seller-private-aggregation-coordinator"},{"id":"ref-for-auction-config-seller-private-aggregation-coordinator\u2460"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-auction-config-seller-private-aggregation-coordinator\u2461"}],"title":"11.5. New algorithms"}],"url":"#auction-config-seller-private-aggregation-coordinator"},
"automation-local-testing-mode-enabled": {"dfnID":"automation-local-testing-mode-enabled","dfnText":"automation local testing mode enabled","external":false,"refSections":[{"refs":[{"id":"ref-for-automation-local-testing-mode-enabled"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-automation-local-testing-mode-enabled\u2460"}],"title":"9.1. Set local testing mode"}],"url":"#automation-local-testing-mode-enabled"},
"b012ccb2": {"dfnID":"b012ccb2","dfnText":"forgiving-base64 encode","external":true,"refSections":[{"refs":[{"id":"ref-for-forgiving-base64-encode"},{"id":"ref-for-forgiving-base64-encode\u2460"}],"title":"8.4. Serializing reports"}],"url":"https://infra.spec.whatwg.org/#forgiving-base64-encode"},
"b0d7f3c3": {"dfnID":"b0d7f3c3","dfnText":"USVString","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-USVString"},{"id":"ref-for-idl-USVString\u2460"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-idl-USVString\u2461"}],"title":"11.2. WebIDL modifications"},{"refs":[{"id":"ref-for-idl-USVString\u2462"}],"title":"11.5. New algorithms"}],"url":"https://webidl.spec.whatwg.org/#idl-USVString"},
"b2e02dd6": {"dfnID":"b2e02dd6","dfnText":"report result","external":true,"refSections":[{"refs":[{"id":"ref-for-report-result"}],"title":"11.4. Algorithm modifications"}],"url":"https://wicg.github.io/turtledove/#report-result"},
"b4cfa5ce": {"dfnID":"b4cfa5ce","dfnText":"throw","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-throw"},{"id":"ref-for-dfn-throw\u2460"},{"id":"ref-for-dfn-throw\u2461"},{"id":"ref-for-dfn-throw\u2462"},{"id":"ref-for-dfn-throw\u2463"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-dfn-throw\u2464"},{"id":"ref-for-dfn-throw\u2465"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-dfn-throw\u2466"},{"id":"ref-for-dfn-throw\u2467"},{"id":"ref-for-dfn-throw\u2468"},{"id":"ref-for-dfn-throw\u2460\u24ea"},{"id":"ref-for-dfn-throw\u2460\u2460"},{"id":"ref-for-dfn-throw\u2460\u2461"},{"id":"ref-for-dfn-throw\u2460\u2462"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-dfn-throw\u2460\u2463"},{"id":"ref-for-dfn-throw\u2460\u2464"},{"id":"ref-for-dfn-throw\u2460\u2465"},{"id":"ref-for-dfn-throw\u2460\u2466"},{"id":"ref-for-dfn-throw\u2460\u2467"}],"title":"11.4. Algorithm modifications"}],"url":"https://webidl.spec.whatwg.org/#dfn-throw"},
"b74dcd49": {"dfnID":"b74dcd49","dfnText":"k-anonymity threshold","external":true,"refSections":[{"refs":[{"id":"ref-for-k-anonymity-threshold"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/turtledove/#k-anonymity-threshold"},
"b75bb3bd": {"dfnID":"b75bb3bd","dfnText":"SecureContext","external":true,"refSections":[{"refs":[{"id":"ref-for-SecureContext"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-SecureContext\u2460"}],"title":"11.1. New WebIDL"}],"url":"https://webidl.spec.whatwg.org/#SecureContext"},
"b85ee3be": {"dfnID":"b85ee3be","dfnText":"host","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-host"}],"title":"8.4. Serializing reports"}],"url":"https://url.spec.whatwg.org/#concept-url-host"},
"b871aae0": {"dfnID":"b871aae0","dfnText":"interest group (for InterestGroupBiddingScriptRunnerGlobalScope)","external":true,"refSections":[{"refs":[{"id":"ref-for-interestgroupbiddingscriptrunnerglobalscope-interest-group"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-interestgroupbiddingscriptrunnerglobalscope-interest-group\u2460"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-interest-group"},
"b8af7072": {"dfnID":"b8af7072","dfnText":"auction config","external":true,"refSections":[{"refs":[{"id":"ref-for-auction-config"}],"title":"11.3.1. Extending auction config"},{"refs":[{"id":"ref-for-auction-config\u2460"}],"title":"11.3.8. Extending\nInterestGroupScriptRunnerGlobalScope"},{"refs":[{"id":"ref-for-auction-config\u2461"},{"id":"ref-for-auction-config\u2462"},{"id":"ref-for-auction-config\u2463"},{"id":"ref-for-auction-config\u2464"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-auction-config\u2465"},{"id":"ref-for-auction-config\u2466"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/turtledove/#auction-config"},
"ba556545": {"dfnID":"ba556545","dfnText":"NotAllowedError","external":true,"refSections":[{"refs":[{"id":"ref-for-notallowederror"}],"title":"8.1. Exported algorithms"}],"url":"https://webidl.spec.whatwg.org/#notallowederror"},
"batching-scope": {"dfnID":"batching-scope","dfnText":"4.1. Batching scope","external":false,"refSections":[{"refs":[{"id":"ref-for-batching-scope"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-batching-scope"}],"title":"4.1. Batching scope"},{"refs":[{"id":"ref-for-batching-scope\u2460"}],"title":"4.3. Scoping details"},{"refs":[{"id":"ref-for-batching-scope\u2461"}],"title":"4.5. Contribution cache entry"},{"refs":[{"id":"ref-for-batching-scope\u2462"},{"id":"ref-for-batching-scope\u2463"}],"title":"5. Storage"},{"refs":[{"id":"ref-for-batching-scope\u2464"},{"id":"ref-for-batching-scope\u2465"},{"id":"ref-for-batching-scope\u2466"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-batching-scope\u2467"},{"id":"ref-for-batching-scope\u2468"},{"id":"ref-for-batching-scope\u2460\u24ea"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-batching-scope\u2460\u2460"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-batching-scope\u2460\u2461"},{"id":"ref-for-batching-scope\u2460\u2462"}],"title":"11.3.1. Extending auction config"},{"refs":[{"id":"ref-for-batching-scope\u2460\u2463"}],"title":"11.3.6. On event contribution cache entry"},{"refs":[{"id":"ref-for-batching-scope\u2460\u2464"},{"id":"ref-for-batching-scope\u2460\u2465"},{"id":"ref-for-batching-scope\u2460\u2466"}],"title":"11.5. New algorithms"},{"refs":[{"id":"ref-for-batching-scope\u2460\u2467"}],"title":"12.2. Clearing site data"}],"url":"#batching-scope"},
"bb4c269e": {"dfnID":"bb4c269e","dfnText":"error","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-error"},{"id":"ref-for-dfn-error\u2460"}],"title":"9.1. Set local testing mode"}],"url":"https://w3c.github.io/webdriver/#dfn-error"},
"bd2fe71e": {"dfnID":"bd2fe71e","dfnText":"processresponse","external":true,"refSections":[{"refs":[{"id":"ref-for-process-response"}],"title":"8.3. Sending reports"}],"url":"https://fetch.spec.whatwg.org/#process-response"},
"bdcd112d": {"dfnID":"bdcd112d","dfnText":"bigint","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-bigint"},{"id":"ref-for-idl-bigint\u2460"},{"id":"ref-for-idl-bigint\u2461"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-idl-bigint\u2462"},{"id":"ref-for-idl-bigint\u2463"},{"id":"ref-for-idl-bigint\u2464"},{"id":"ref-for-idl-bigint\u2465"},{"id":"ref-for-idl-bigint\u2466"},{"id":"ref-for-idl-bigint\u2467"},{"id":"ref-for-idl-bigint\u2468"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-idl-bigint\u2460\u24ea"}],"title":"11.3.1. Extending auction config"}],"url":"https://webidl.spec.whatwg.org/#idl-bigint"},
"be5dbc8c": {"dfnID":"be5dbc8c","dfnText":"unix epoch","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-unix-epoch"}],"title":"8.4. Serializing reports"}],"url":"https://w3c.github.io/hr-time/#dfn-unix-epoch"},
"bfc48225": {"dfnID":"bfc48225","dfnText":"read only","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-read-only"}],"title":"3. Exposing to global scopes"}],"url":"https://webidl.spec.whatwg.org/#dfn-read-only"},
"c0199225": {"dfnID":"c0199225","dfnText":"AuctionAdInterestGroup","external":true,"refSections":[{"refs":[{"id":"ref-for-dictdef-auctionadinterestgroup"},{"id":"ref-for-dictdef-auctionadinterestgroup\u2460"}],"title":"11.2. WebIDL modifications"}],"url":"https://wicg.github.io/turtledove/#dictdef-auctionadinterestgroup"},
"c01cbda0": {"dfnID":"c01cbda0","dfnText":"EnforceRange","external":true,"refSections":[{"refs":[{"id":"ref-for-EnforceRange"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://webidl.spec.whatwg.org/#EnforceRange"},
"c0868016": {"dfnID":"c0868016","dfnText":"path","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-path"}],"title":"8.4. Serializing reports"}],"url":"https://url.spec.whatwg.org/#concept-url-path"},
"c6bfef29": {"dfnID":"c6bfef29","dfnText":"abrupt completion","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-completion-record-specification-type"}],"title":"11.4. Algorithm modifications"}],"url":"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type"},
"c88f3887": {"dfnID":"c88f3887","dfnText":"item (for struct)","external":true,"refSections":[{"refs":[{"id":"ref-for-struct-item"}],"title":"11.4. Algorithm modifications"}],"url":"https://infra.spec.whatwg.org/#struct-item"},
"c8ff8493": {"dfnID":"c8ff8493","dfnText":"error code","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-error-code"},{"id":"ref-for-dfn-error-code\u2460"}],"title":"9.1. Set local testing mode"}],"url":"https://w3c.github.io/webdriver/#dfn-error-code"},
"c9a0df83": {"dfnID":"c9a0df83","dfnText":"duration from","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-duration-from"}],"title":"8.4. Serializing reports"}],"url":"https://w3c.github.io/hr-time/#dfn-duration-from"},
"ca3ca4ae": {"dfnID":"ca3ca4ae","dfnText":"url parser","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-parser"},{"id":"ref-for-concept-url-parser\u2460"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-concept-url-parser\u2461"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-concept-url-parser\u2462"}],"title":"11.5. New algorithms"}],"url":"https://url.spec.whatwg.org/#concept-url-parser"},
"cb98f71f": {"dfnID":"cb98f71f","dfnText":"mode","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-mode"}],"title":"8.3. Sending reports"}],"url":"https://fetch.spec.whatwg.org/#concept-request-mode"},
"cbdc89b4": {"dfnID":"cbdc89b4","dfnText":"while","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-while"}],"title":"8.4. Serializing reports"}],"url":"https://infra.spec.whatwg.org/#iteration-while"},
"cc890cc1": {"dfnID":"cc890cc1","dfnText":"policy-controlled feature","external":true,"refSections":[{"refs":[{"id":"ref-for-policy-controlled-feature"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-policy-controlled-feature\u2460"},{"id":"ref-for-policy-controlled-feature\u2461"}],"title":"7. Permissions Policy integration"},{"refs":[{"id":"ref-for-policy-controlled-feature\u2462"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-policy-controlled-feature\u2463"}],"title":"11.4. Algorithm modifications"}],"url":"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature"},
"cd58f473": {"dfnID":"cd58f473","dfnText":"joinAdInterestGroup(group)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-navigator-joinadinterestgroup"}],"title":"11.4. Algorithm modifications"}],"url":"https://wicg.github.io/turtledove/#dom-navigator-joinadinterestgroup"},
"cf6542b2": {"dfnID":"cf6542b2","dfnText":"the exclusive range","external":true,"refSections":[{"refs":[{"id":"ref-for-the-exclusive-range"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-the-exclusive-range\u2460"}],"title":"11.4. Algorithm modifications"}],"url":"https://infra.spec.whatwg.org/#the-exclusive-range"},
"consume-budget-if-permitted": {"dfnID":"consume-budget-if-permitted","dfnText":"consume budget if permitted","external":false,"refSections":[{"refs":[{"id":"ref-for-consume-budget-if-permitted"}],"title":"5.1. Clearing storage"},{"refs":[{"id":"ref-for-consume-budget-if-permitted\u2460"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-consume-budget-if-permitted\u2461"}],"title":"12.2. Clearing site data"},{"refs":[{"id":"ref-for-consume-budget-if-permitted\u2462"},{"id":"ref-for-consume-budget-if-permitted\u2463"}],"title":"13.1. Same-origin policy"}],"url":"#consume-budget-if-permitted"},
"context-type": {"dfnID":"context-type","dfnText":"4.8. Context type","external":false,"refSections":[{"refs":[{"id":"ref-for-context-type"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-context-type\u2460"}],"title":"4.6. Aggregatable report"},{"refs":[{"id":"ref-for-context-type"}],"title":"4.8. Context type"},{"refs":[{"id":"ref-for-context-type\u2461"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-context-type\u2462"},{"id":"ref-for-context-type\u2463"},{"id":"ref-for-context-type\u2464"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-context-type\u2465"}],"title":"8.3. Sending reports"}],"url":"#context-type"},
"contribution-cache": {"dfnID":"contribution-cache","dfnText":"contribution cache","external":false,"refSections":[{"refs":[{"id":"ref-for-contribution-cache"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-contribution-cache\u2460"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-contribution-cache\u2461"}],"title":"5.1. Clearing storage"},{"refs":[{"id":"ref-for-contribution-cache\u2462"},{"id":"ref-for-contribution-cache\u2463"},{"id":"ref-for-contribution-cache\u2464"},{"id":"ref-for-contribution-cache\u2465"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-contribution-cache\u2466"},{"id":"ref-for-contribution-cache\u2467"}],"title":"11.5. New algorithms"},{"refs":[{"id":"ref-for-contribution-cache\u2468"}],"title":"12.2. Clearing site data"},{"refs":[{"id":"ref-for-contribution-cache\u2460\u24ea"}],"title":"13.1. Same-origin policy"}],"url":"#contribution-cache"},
"contribution-cache-entry": {"dfnID":"contribution-cache-entry","dfnText":"4.5. Contribution cache entry","external":false,"refSections":[{"refs":[{"id":"ref-for-contribution-cache-entry"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-contribution-cache-entry\u2460"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-contribution-cache-entry"}],"title":"4.5. Contribution cache entry"},{"refs":[{"id":"ref-for-contribution-cache-entry\u2461"}],"title":"5. Storage"},{"refs":[{"id":"ref-for-contribution-cache-entry\u2462"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-contribution-cache-entry\u2463"},{"id":"ref-for-contribution-cache-entry\u2464"}],"title":"11.5. New algorithms"}],"url":"#contribution-cache-entry"},
"contribution-cache-entry-batching-scope": {"dfnID":"contribution-cache-entry-batching-scope","dfnText":"batching scope","external":false,"refSections":[{"refs":[{"id":"ref-for-contribution-cache-entry-batching-scope"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-contribution-cache-entry-batching-scope\u2460"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-contribution-cache-entry-batching-scope\u2461"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-contribution-cache-entry-batching-scope\u2462"},{"id":"ref-for-contribution-cache-entry-batching-scope\u2463"}],"title":"11.5. New algorithms"}],"url":"#contribution-cache-entry-batching-scope"},
"contribution-cache-entry-contribution": {"dfnID":"contribution-cache-entry-contribution","dfnText":"contribution","external":false,"refSections":[{"refs":[{"id":"ref-for-contribution-cache-entry-contribution"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-contribution-cache-entry-contribution\u2460"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-contribution-cache-entry-contribution\u2461"},{"id":"ref-for-contribution-cache-entry-contribution\u2462"}],"title":"11.5. New algorithms"}],"url":"#contribution-cache-entry-contribution"},
"contribution-cache-entry-debug-details": {"dfnID":"contribution-cache-entry-debug-details","dfnText":"debug details","external":false,"refSections":[{"refs":[{"id":"ref-for-contribution-cache-entry-debug-details"},{"id":"ref-for-contribution-cache-entry-debug-details\u2460"},{"id":"ref-for-contribution-cache-entry-debug-details\u2461"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-contribution-cache-entry-debug-details\u2462"}],"title":"11.5. New algorithms"}],"url":"#contribution-cache-entry-debug-details"},
"contribution-cache-entry-debug-scope": {"dfnID":"contribution-cache-entry-debug-scope","dfnText":"debug scope","external":false,"refSections":[{"refs":[{"id":"ref-for-contribution-cache-entry-debug-scope"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-contribution-cache-entry-debug-scope\u2460"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-contribution-cache-entry-debug-scope\u2461"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-contribution-cache-entry-debug-scope\u2462"},{"id":"ref-for-contribution-cache-entry-debug-scope\u2463"}],"title":"11.5. New algorithms"}],"url":"#contribution-cache-entry-debug-scope"},
"create-a-report-request": {"dfnID":"create-a-report-request","dfnText":"create a report request","external":false,"refSections":[{"refs":[{"id":"ref-for-create-a-report-request"}],"title":"8.3. Sending reports"}],"url":"#create-a-report-request"},
"d0b4a948": {"dfnID":"d0b4a948","dfnText":"a promise rejected with","external":true,"refSections":[{"refs":[{"id":"ref-for-a-promise-rejected-with"},{"id":"ref-for-a-promise-rejected-with\u2460"},{"id":"ref-for-a-promise-rejected-with\u2461"},{"id":"ref-for-a-promise-rejected-with\u2462"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://webidl.spec.whatwg.org/#a-promise-rejected-with"},
"dac6239a": {"dfnID":"dac6239a","dfnText":"evaluate a reporting script","external":true,"refSections":[{"refs":[{"id":"ref-for-evaluate-a-reporting-script"},{"id":"ref-for-evaluate-a-reporting-script\u2460"},{"id":"ref-for-evaluate-a-reporting-script\u2461"}],"title":"11.4. Algorithm modifications"}],"url":"https://wicg.github.io/turtledove/#evaluate-a-reporting-script"},
"dae0bfde": {"dfnID":"dae0bfde","dfnText":"serialization of an origin","external":true,"refSections":[{"refs":[{"id":"ref-for-ascii-serialisation-of-an-origin"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-ascii-serialisation-of-an-origin\u2460"},{"id":"ref-for-ascii-serialisation-of-an-origin\u2461"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-ascii-serialisation-of-an-origin\u2462"}],"title":"11.4. Algorithm modifications"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin"},
"dc1cd39b": {"dfnID":"dc1cd39b","dfnText":"url","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-url"}],"title":"8.3. Sending reports"}],"url":"https://fetch.spec.whatwg.org/#concept-request-url"},
"dc3369de": {"dfnID":"dc3369de","dfnText":"is empty (for map)","external":true,"refSections":[{"refs":[{"id":"ref-for-map-is-empty"}],"title":"8.1. Exported algorithms"}],"url":"https://infra.spec.whatwg.org/#map-is-empty"},
"dca2de17": {"dfnID":"dca2de17","dfnText":"DOMException","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DOMException"},{"id":"ref-for-idl-DOMException\u2460"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-idl-DOMException\u2461"},{"id":"ref-for-idl-DOMException\u2462"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-idl-DOMException\u2463"},{"id":"ref-for-idl-DOMException\u2464"},{"id":"ref-for-idl-DOMException\u2465"},{"id":"ref-for-idl-DOMException\u2466"},{"id":"ref-for-idl-DOMException\u2467"},{"id":"ref-for-idl-DOMException\u2468"},{"id":"ref-for-idl-DOMException\u2460\u24ea"},{"id":"ref-for-idl-DOMException\u2460\u2460"},{"id":"ref-for-idl-DOMException\u2460\u2461"},{"id":"ref-for-idl-DOMException\u2460\u2462"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-idl-DOMException\u2460\u2463"},{"id":"ref-for-idl-DOMException\u2460\u2464"},{"id":"ref-for-idl-DOMException\u2460\u2465"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-idl-DOMException\u2460\u2466"},{"id":"ref-for-idl-DOMException\u2460\u2467"},{"id":"ref-for-idl-DOMException\u2460\u2468"},{"id":"ref-for-idl-DOMException\u2461\u24ea"}],"title":"11.5. New algorithms"}],"url":"https://webidl.spec.whatwg.org/#idl-DOMException"},
"dcffbccd": {"dfnID":"dcffbccd","dfnText":"url","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url"},{"id":"ref-for-concept-url\u2460"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-concept-url\u2461"}],"title":"8.4. Serializing reports"}],"url":"https://url.spec.whatwg.org/#concept-url"},
"de407e5e": {"dfnID":"de407e5e","dfnText":"score and rank a bid","external":true,"refSections":[{"refs":[{"id":"ref-for-score-and-rank-a-bid"}],"title":"11.4. Algorithm modifications"}],"url":"https://wicg.github.io/turtledove/#score-and-rank-a-bid"},
"debug-details": {"dfnID":"debug-details","dfnText":"4.4. Debug details","external":false,"refSections":[{"refs":[{"id":"ref-for-debug-details"},{"id":"ref-for-debug-details\u2460"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-debug-details\u2461"}],"title":"4.2. Debug scope"},{"refs":[{"id":"ref-for-debug-details"}],"title":"4.4. Debug details"},{"refs":[{"id":"ref-for-debug-details\u2462"}],"title":"4.5. Contribution cache entry"},{"refs":[{"id":"ref-for-debug-details\u2463"}],"title":"4.6. Aggregatable report"},{"refs":[{"id":"ref-for-debug-details\u2464"}],"title":"5. Storage"},{"refs":[{"id":"ref-for-debug-details\u2465"},{"id":"ref-for-debug-details\u2466"},{"id":"ref-for-debug-details\u2467"},{"id":"ref-for-debug-details\u2468"},{"id":"ref-for-debug-details\u2460\u24ea"},{"id":"ref-for-debug-details\u2460\u2460"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-debug-details\u2460\u2461"},{"id":"ref-for-debug-details\u2460\u2462"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-debug-details\u2460\u2463"}],"title":"11.3.1. Extending auction config"},{"refs":[{"id":"ref-for-debug-details\u2460\u2464"}],"title":"11.3.6. On event contribution cache entry"},{"refs":[{"id":"ref-for-debug-details\u2460\u2465"},{"id":"ref-for-debug-details\u2460\u2466"}],"title":"11.4. Algorithm modifications"}],"url":"#debug-details"},
"debug-details-enabled": {"dfnID":"debug-details-enabled","dfnText":"enabled","external":false,"refSections":[{"refs":[{"id":"ref-for-debug-details-enabled"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-debug-details-enabled\u2460"}],"title":"4.4. Debug details"},{"refs":[{"id":"ref-for-debug-details-enabled\u2461"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-debug-details-enabled\u2462"},{"id":"ref-for-debug-details-enabled\u2463"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-debug-details-enabled\u2464"}],"title":"11.4. Algorithm modifications"}],"url":"#debug-details-enabled"},
"debug-details-key": {"dfnID":"debug-details-key","dfnText":"key","external":false,"refSections":[{"refs":[{"id":"ref-for-debug-details-key"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-debug-details-key\u2460"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-debug-details-key\u2461"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-debug-details-key\u2462"}],"title":"11.4. Algorithm modifications"}],"url":"#debug-details-key"},
"debug-scope": {"dfnID":"debug-scope","dfnText":"4.2. Debug scope","external":false,"refSections":[{"refs":[{"id":"ref-for-debug-scope"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-debug-scope\u2460"},{"id":"ref-for-debug-scope\u2461"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-debug-scope"}],"title":"4.2. Debug scope"},{"refs":[{"id":"ref-for-debug-scope\u2462"}],"title":"4.3. Scoping details"},{"refs":[{"id":"ref-for-debug-scope\u2463"}],"title":"4.5. Contribution cache entry"},{"refs":[{"id":"ref-for-debug-scope\u2464"}],"title":"5. Storage"},{"refs":[{"id":"ref-for-debug-scope\u2465"},{"id":"ref-for-debug-scope\u2466"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-debug-scope\u2467"},{"id":"ref-for-debug-scope\u2468"},{"id":"ref-for-debug-scope\u2460\u24ea"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-debug-scope\u2460\u2460"}],"title":"11.3.6. On event contribution cache entry"},{"refs":[{"id":"ref-for-debug-scope\u2460\u2461"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-debug-scope\u2460\u2462"}],"title":"11.5. New algorithms"},{"refs":[{"id":"ref-for-debug-scope\u2460\u2463"}],"title":"12.2. Clearing site data"}],"url":"#debug-scope"},
"debug-scope-map": {"dfnID":"debug-scope-map","dfnText":"debug scope map","external":false,"refSections":[{"refs":[{"id":"ref-for-debug-scope-map"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-debug-scope-map\u2460"}],"title":"5.1. Clearing storage"},{"refs":[{"id":"ref-for-debug-scope-map\u2461"},{"id":"ref-for-debug-scope-map\u2462"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-debug-scope-map\u2463"}],"title":"12.2. Clearing site data"},{"refs":[{"id":"ref-for-debug-scope-map\u2464"}],"title":"13.1. Same-origin policy"}],"url":"#debug-scope-map"},
"default-aggregation-coordinator": {"dfnID":"default-aggregation-coordinator","dfnText":"Default aggregation coordinator","external":false,"refSections":[{"refs":[{"id":"ref-for-default-aggregation-coordinator"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-default-aggregation-coordinator\u2460"}],"title":"11.3.1. Extending auction config"},{"refs":[{"id":"ref-for-default-aggregation-coordinator\u2461"}],"title":"11.4. Algorithm modifications"}],"url":"#default-aggregation-coordinator"},
"determine-a-signals-numeric-value": {"dfnID":"determine-a-signals-numeric-value","dfnText":"determine a signal\u2019s numeric value","external":false,"refSections":[{"refs":[{"id":"ref-for-determine-a-signals-numeric-value"}],"title":"11.3.4. Signal base value"},{"refs":[{"id":"ref-for-determine-a-signals-numeric-value\u2460"}],"title":"11.5. New algorithms"}],"url":"#determine-a-signals-numeric-value"},
"determine-if-a-null-report-should-be-sent": {"dfnID":"determine-if-a-null-report-should-be-sent","dfnText":"determine if a null report should be sent","external":false,"refSections":[{"refs":[{"id":"ref-for-determine-if-a-null-report-should-be-sent"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-determine-if-a-null-report-should-be-sent\u2460"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-determine-if-a-null-report-should-be-sent\u2461"},{"id":"ref-for-determine-if-a-null-report-should-be-sent\u2462"},{"id":"ref-for-determine-if-a-null-report-should-be-sent\u2463"}],"title":"10. Shared Storage API monkey patches"}],"url":"#determine-if-a-null-report-should-be-sent"},
"determine-if-an-origin-is-an-aggregation-coordinator": {"dfnID":"determine-if-an-origin-is-an-aggregation-coordinator","dfnText":"determine if an origin is an aggregation coordinator","external":false,"refSections":[{"refs":[{"id":"ref-for-determine-if-an-origin-is-an-aggregation-coordinator"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-determine-if-an-origin-is-an-aggregation-coordinator\u2460"}],"title":"11.5. New algorithms"}],"url":"#determine-if-an-origin-is-an-aggregation-coordinator"},
"dictdef-auctionreportbuyerdebugmodeconfig": {"dfnID":"dictdef-auctionreportbuyerdebugmodeconfig","dfnText":"AuctionReportBuyerDebugModeConfig","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-auctionreportbuyerdebugmodeconfig"}],"title":"11.1. New WebIDL"}],"url":"#dictdef-auctionreportbuyerdebugmodeconfig"},
"dictdef-auctionreportbuyersconfig": {"dfnID":"dictdef-auctionreportbuyersconfig","dfnText":"AuctionReportBuyersConfig","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-auctionreportbuyersconfig"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-dictdef-auctionreportbuyersconfig\u2460"}],"title":"11.3.1. Extending auction config"}],"url":"#dictdef-auctionreportbuyersconfig"},
"dictdef-padebugmodeoptions": {"dfnID":"dictdef-padebugmodeoptions","dfnText":"PADebugModeOptions","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-padebugmodeoptions"},{"id":"ref-for-dictdef-padebugmodeoptions\u2460"}],"title":"2. Exposed interface"}],"url":"#dictdef-padebugmodeoptions"},
"dictdef-paextendedhistogramcontribution": {"dfnID":"dictdef-paextendedhistogramcontribution","dfnText":"PAExtendedHistogramContribution","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-paextendedhistogramcontribution"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-dictdef-paextendedhistogramcontribution\u2460"}],"title":"11.3.6. On event contribution cache entry"},{"refs":[{"id":"ref-for-dictdef-paextendedhistogramcontribution\u2461"}],"title":"11.5. New algorithms"}],"url":"#dictdef-paextendedhistogramcontribution"},
"dictdef-pahistogramcontribution": {"dfnID":"dictdef-pahistogramcontribution","dfnText":"PAHistogramContribution","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-pahistogramcontribution"}],"title":"1.3. Alternative considered"},{"refs":[{"id":"ref-for-dictdef-pahistogramcontribution\u2460"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-dictdef-pahistogramcontribution\u2461"}],"title":"4.1. Batching scope"},{"refs":[{"id":"ref-for-dictdef-pahistogramcontribution\u2462"}],"title":"4.2. Debug scope"},{"refs":[{"id":"ref-for-dictdef-pahistogramcontribution\u2463"}],"title":"4.5. Contribution cache entry"},{"refs":[{"id":"ref-for-dictdef-pahistogramcontribution\u2464"}],"title":"4.6. Aggregatable report"},{"refs":[{"id":"ref-for-dictdef-pahistogramcontribution\u2465"},{"id":"ref-for-dictdef-pahistogramcontribution\u2466"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-dictdef-pahistogramcontribution\u2467"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-dictdef-pahistogramcontribution\u2468"},{"id":"ref-for-dictdef-pahistogramcontribution\u2460\u24ea"},{"id":"ref-for-dictdef-pahistogramcontribution\u2460\u2460"}],"title":"11.5. New algorithms"}],"url":"#dictdef-pahistogramcontribution"},
"dictdef-pasignalvalue": {"dfnID":"dictdef-pasignalvalue","dfnText":"PASignalValue","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-pasignalvalue"},{"id":"ref-for-dictdef-pasignalvalue\u2460"},{"id":"ref-for-dictdef-pasignalvalue\u2461"},{"id":"ref-for-dictdef-pasignalvalue\u2462"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-dictdef-pasignalvalue\u2463"},{"id":"ref-for-dictdef-pasignalvalue\u2464"},{"id":"ref-for-dictdef-pasignalvalue\u2465"}],"title":"11.5. New algorithms"}],"url":"#dictdef-pasignalvalue"},
"dictdef-protectedaudienceprivateaggregationconfig": {"dfnID":"dictdef-protectedaudienceprivateaggregationconfig","dfnText":"ProtectedAudiencePrivateAggregationConfig","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-protectedaudienceprivateaggregationconfig"},{"id":"ref-for-dictdef-protectedaudienceprivateaggregationconfig\u2460"}],"title":"11.2. WebIDL modifications"},{"refs":[{"id":"ref-for-dictdef-protectedaudienceprivateaggregationconfig\u2461"}],"title":"11.5. New algorithms"}],"url":"#dictdef-protectedaudienceprivateaggregationconfig"},
"dictdef-sharedstorageprivateaggregationconfig": {"dfnID":"dictdef-sharedstorageprivateaggregationconfig","dfnText":"SharedStoragePrivateAggregationConfig","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-sharedstorageprivateaggregationconfig"}],"title":"10. Shared Storage API monkey patches"}],"url":"#dictdef-sharedstorageprivateaggregationconfig"},
"dom-auctionadconfig-auctionreportbuyerdebugmodeconfig": {"dfnID":"dom-auctionadconfig-auctionreportbuyerdebugmodeconfig","dfnText":"auctionReportBuyerDebugModeConfig","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-auctionadconfig-auctionreportbuyerdebugmodeconfig"},{"id":"ref-for-dom-auctionadconfig-auctionreportbuyerdebugmodeconfig\u2460"}],"title":"11.4. Algorithm modifications"}],"url":"#dom-auctionadconfig-auctionreportbuyerdebugmodeconfig"},
"dom-auctionadconfig-auctionreportbuyerkeys": {"dfnID":"dom-auctionadconfig-auctionreportbuyerkeys","dfnText":"auctionReportBuyerKeys","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-auctionadconfig-auctionreportbuyerkeys"},{"id":"ref-for-dom-auctionadconfig-auctionreportbuyerkeys\u2460"},{"id":"ref-for-dom-auctionadconfig-auctionreportbuyerkeys\u2461"}],"title":"11.4. Algorithm modifications"}],"url":"#dom-auctionadconfig-auctionreportbuyerkeys"},
"dom-auctionadconfig-auctionreportbuyers": {"dfnID":"dom-auctionadconfig-auctionreportbuyers","dfnText":"auctionReportBuyers","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-auctionadconfig-auctionreportbuyers"},{"id":"ref-for-dom-auctionadconfig-auctionreportbuyers\u2460"}],"title":"11.4. Algorithm modifications"}],"url":"#dom-auctionadconfig-auctionreportbuyers"},
"dom-auctionadconfig-privateaggregationconfig": {"dfnID":"dom-auctionadconfig-privateaggregationconfig","dfnText":"privateAggregationConfig","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-auctionadconfig-privateaggregationconfig"},{"id":"ref-for-dom-auctionadconfig-privateaggregationconfig\u2460"}],"title":"11.4. Algorithm modifications"}],"url":"#dom-auctionadconfig-privateaggregationconfig"},
"dom-auctionadinterestgroup-privateaggregationconfig": {"dfnID":"dom-auctionadinterestgroup-privateaggregationconfig","dfnText":"privateAggregationConfig","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-auctionadinterestgroup-privateaggregationconfig"},{"id":"ref-for-dom-auctionadinterestgroup-privateaggregationconfig\u2460"}],"title":"11.4. Algorithm modifications"}],"url":"#dom-auctionadinterestgroup-privateaggregationconfig"},
"dom-auctionreportbuyerdebugmodeconfig-debugkey": {"dfnID":"dom-auctionreportbuyerdebugmodeconfig-debugkey","dfnText":"debugKey","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-auctionreportbuyerdebugmodeconfig-debugkey"}],"title":"11.4. Algorithm modifications"}],"url":"#dom-auctionreportbuyerdebugmodeconfig-debugkey"},
"dom-auctionreportbuyerdebugmodeconfig-enabled": {"dfnID":"dom-auctionreportbuyerdebugmodeconfig-enabled","dfnText":"enabled","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-auctionreportbuyerdebugmodeconfig-enabled"}],"title":"11.4. Algorithm modifications"}],"url":"#dom-auctionreportbuyerdebugmodeconfig-enabled"},
"dom-auctionreportbuyersconfig-bucket": {"dfnID":"dom-auctionreportbuyersconfig-bucket","dfnText":"bucket","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-auctionreportbuyersconfig-bucket"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-dom-auctionreportbuyersconfig-bucket\u2460"}],"title":"11.5. New algorithms"}],"url":"#dom-auctionreportbuyersconfig-bucket"},
"dom-auctionreportbuyersconfig-scale": {"dfnID":"dom-auctionreportbuyersconfig-scale","dfnText":"scale","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-auctionreportbuyersconfig-scale"}],"title":"11.5. New algorithms"}],"url":"#dom-auctionreportbuyersconfig-scale"},
"dom-interestgroupscriptrunnerglobalscope-privateaggregation": {"dfnID":"dom-interestgroupscriptrunnerglobalscope-privateaggregation","dfnText":"privateAggregation","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-interestgroupscriptrunnerglobalscope-privateaggregation"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-dom-interestgroupscriptrunnerglobalscope-privateaggregation\u2460"},{"id":"ref-for-dom-interestgroupscriptrunnerglobalscope-privateaggregation\u2461"}],"title":"11.4. Algorithm modifications"}],"url":"#dom-interestgroupscriptrunnerglobalscope-privateaggregation"},
"dom-padebugmodeoptions-debugkey": {"dfnID":"dom-padebugmodeoptions-debugkey","dfnText":"debugKey","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-padebugmodeoptions-debugkey"},{"id":"ref-for-dom-padebugmodeoptions-debugkey\u2460"},{"id":"ref-for-dom-padebugmodeoptions-debugkey\u2461"}],"title":"2. Exposed interface"}],"url":"#dom-padebugmodeoptions-debugkey"},
"dom-paextendedhistogramcontribution-bucket": {"dfnID":"dom-paextendedhistogramcontribution-bucket","dfnText":"bucket","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-paextendedhistogramcontribution-bucket"},{"id":"ref-for-dom-paextendedhistogramcontribution-bucket\u2460"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-dom-paextendedhistogramcontribution-bucket\u2461"}],"title":"11.5. New algorithms"}],"url":"#dom-paextendedhistogramcontribution-bucket"},
"dom-paextendedhistogramcontribution-value": {"dfnID":"dom-paextendedhistogramcontribution-value","dfnText":"value","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-paextendedhistogramcontribution-value"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-dom-paextendedhistogramcontribution-value\u2460"}],"title":"11.5. New algorithms"}],"url":"#dom-paextendedhistogramcontribution-value"},
"dom-pahistogramcontribution-bucket": {"dfnID":"dom-pahistogramcontribution-bucket","dfnText":"bucket","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-pahistogramcontribution-bucket"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-dom-pahistogramcontribution-bucket\u2460"},{"id":"ref-for-dom-pahistogramcontribution-bucket\u2461"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-dom-pahistogramcontribution-bucket\u2462"},{"id":"ref-for-dom-pahistogramcontribution-bucket\u2463"}],"title":"11.5. New algorithms"}],"url":"#dom-pahistogramcontribution-bucket"},
"dom-pahistogramcontribution-filteringid": {"dfnID":"dom-pahistogramcontribution-filteringid","dfnText":"filteringId","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-pahistogramcontribution-filteringid"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-dom-pahistogramcontribution-filteringid\u2460"},{"id":"ref-for-dom-pahistogramcontribution-filteringid\u2461"},{"id":"ref-for-dom-pahistogramcontribution-filteringid\u2462"},{"id":"ref-for-dom-pahistogramcontribution-filteringid\u2463"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-dom-pahistogramcontribution-filteringid\u2464"}],"title":"11.1. New WebIDL"}],"url":"#dom-pahistogramcontribution-filteringid"},
"dom-pahistogramcontribution-value": {"dfnID":"dom-pahistogramcontribution-value","dfnText":"value","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-pahistogramcontribution-value"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-dom-pahistogramcontribution-value\u2460"},{"id":"ref-for-dom-pahistogramcontribution-value\u2461"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-dom-pahistogramcontribution-value\u2462"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-dom-pahistogramcontribution-value\u2463"},{"id":"ref-for-dom-pahistogramcontribution-value\u2464"}],"title":"11.5. New algorithms"}],"url":"#dom-pahistogramcontribution-value"},
"dom-pasignalvalue-basevalue": {"dfnID":"dom-pasignalvalue-basevalue","dfnText":"baseValue","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-pasignalvalue-basevalue"},{"id":"ref-for-dom-pasignalvalue-basevalue\u2460"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-dom-pasignalvalue-basevalue\u2461"},{"id":"ref-for-dom-pasignalvalue-basevalue\u2462"}],"title":"11.5. New algorithms"}],"url":"#dom-pasignalvalue-basevalue"},
"dom-pasignalvalue-offset": {"dfnID":"dom-pasignalvalue-offset","dfnText":"offset","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-pasignalvalue-offset"},{"id":"ref-for-dom-pasignalvalue-offset\u2460"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-dom-pasignalvalue-offset\u2461"},{"id":"ref-for-dom-pasignalvalue-offset\u2462"}],"title":"11.5. New algorithms"}],"url":"#dom-pasignalvalue-offset"},
"dom-pasignalvalue-scale": {"dfnID":"dom-pasignalvalue-scale","dfnText":"scale","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-pasignalvalue-scale"},{"id":"ref-for-dom-pasignalvalue-scale\u2460"}],"title":"11.5. New algorithms"}],"url":"#dom-pasignalvalue-scale"},
"dom-privateaggregation-contributetohistogram": {"dfnID":"dom-privateaggregation-contributetohistogram","dfnText":"\ncontributeToHistogram(PAHistogramContribution contribution)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateaggregation-contributetohistogram"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-dom-privateaggregation-contributetohistogram\u2460"},{"id":"ref-for-dom-privateaggregation-contributetohistogram\u2461"}],"title":"11.1. New WebIDL"}],"url":"#dom-privateaggregation-contributetohistogram"},
"dom-privateaggregation-contributetohistogram-contribution-contribution": {"dfnID":"dom-privateaggregation-contributetohistogram-contribution-contribution","dfnText":"contribution","external":false,"refSections":[],"url":"#dom-privateaggregation-contributetohistogram-contribution-contribution"},
"dom-privateaggregation-contributetohistogramonevent": {"dfnID":"dom-privateaggregation-contributetohistogramonevent","dfnText":"contributeToHistogramOnEvent(DOMString\nevent, PAExtendedHistogramContribution contribution)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateaggregation-contributetohistogramonevent"}],"title":"11.1. New WebIDL"}],"url":"#dom-privateaggregation-contributetohistogramonevent"},
"dom-privateaggregation-contributetohistogramonevent-event-contribution-contribution": {"dfnID":"dom-privateaggregation-contributetohistogramonevent-event-contribution-contribution","dfnText":"contribution","external":false,"refSections":[],"url":"#dom-privateaggregation-contributetohistogramonevent-event-contribution-contribution"},
"dom-privateaggregation-contributetohistogramonevent-event-contribution-event": {"dfnID":"dom-privateaggregation-contributetohistogramonevent-event-contribution-event","dfnText":"event","external":false,"refSections":[],"url":"#dom-privateaggregation-contributetohistogramonevent-event-contribution-event"},
"dom-privateaggregation-enabledebugmode": {"dfnID":"dom-privateaggregation-enabledebugmode","dfnText":"\nenableDebugMode(optional PADebugModeOptions options)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-privateaggregation-enabledebugmode"},{"id":"ref-for-dom-privateaggregation-enabledebugmode\u2460"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-dom-privateaggregation-enabledebugmode\u2461"}],"title":"4.2. Debug scope"},{"refs":[{"id":"ref-for-dom-privateaggregation-enabledebugmode\u2462"},{"id":"ref-for-dom-privateaggregation-enabledebugmode\u2463"}],"title":"12.1.5. Temporary debugging mechanism"}],"url":"#dom-privateaggregation-enabledebugmode"},
"dom-privateaggregation-enabledebugmode-options-options": {"dfnID":"dom-privateaggregation-enabledebugmode-options-options","dfnText":"options","external":false,"refSections":[],"url":"#dom-privateaggregation-enabledebugmode-options-options"},
"dom-protectedaudienceprivateaggregationconfig-aggregationcoordinatororigin": {"dfnID":"dom-protectedaudienceprivateaggregationconfig-aggregationcoordinatororigin","dfnText":"aggregationCoordinatorOrigin","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-protectedaudienceprivateaggregationconfig-aggregationcoordinatororigin"},{"id":"ref-for-dom-protectedaudienceprivateaggregationconfig-aggregationcoordinatororigin\u2460"}],"title":"11.5. New algorithms"}],"url":"#dom-protectedaudienceprivateaggregationconfig-aggregationcoordinatororigin"},
"dom-sharedstorageprivateaggregationconfig-aggregationcoordinatororigin": {"dfnID":"dom-sharedstorageprivateaggregationconfig-aggregationcoordinatororigin","dfnText":"aggregationCoordinatorOrigin","external":false,"refSections":[],"url":"#dom-sharedstorageprivateaggregationconfig-aggregationcoordinatororigin"},
"dom-sharedstorageprivateaggregationconfig-contextid": {"dfnID":"dom-sharedstorageprivateaggregationconfig-contextid","dfnText":"contextId","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-sharedstorageprivateaggregationconfig-contextid"},{"id":"ref-for-dom-sharedstorageprivateaggregationconfig-contextid\u2460"}],"title":"10. Shared Storage API monkey patches"}],"url":"#dom-sharedstorageprivateaggregationconfig-contextid"},
"dom-sharedstorageprivateaggregationconfig-filteringidbytesize": {"dfnID":"dom-sharedstorageprivateaggregationconfig-filteringidbytesize","dfnText":"filteringIdByteSize","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-sharedstorageprivateaggregationconfig-filteringidbytesize"},{"id":"ref-for-dom-sharedstorageprivateaggregationconfig-filteringidbytesize\u2460"}],"title":"10. Shared Storage API monkey patches"}],"url":"#dom-sharedstorageprivateaggregationconfig-filteringidbytesize"},
"dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig": {"dfnID":"dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig","dfnText":"privateAggregationConfig","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig"},{"id":"ref-for-dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig\u2460"},{"id":"ref-for-dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig\u2461"},{"id":"ref-for-dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig\u2462"},{"id":"ref-for-dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig\u2463"}],"title":"10. Shared Storage API monkey patches"}],"url":"#dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig"},
"dom-sharedstorageworkletglobalscope-privateaggregation": {"dfnID":"dom-sharedstorageworkletglobalscope-privateaggregation","dfnText":"privateAggregation","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-sharedstorageworkletglobalscope-privateaggregation"},{"id":"ref-for-dom-sharedstorageworkletglobalscope-privateaggregation\u2460"}],"title":"10. Shared Storage API monkey patches"}],"url":"#dom-sharedstorageworkletglobalscope-privateaggregation"},
"e28ccd60": {"dfnID":"e28ccd60","dfnText":"concatenation","external":true,"refSections":[{"refs":[{"id":"ref-for-string-concatenate"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-string-concatenate\u2460"}],"title":"8.4. Serializing reports"}],"url":"https://infra.spec.whatwg.org/#string-concatenate"},
"e3258dae": {"dfnID":"e3258dae","dfnText":"evaluate a bidding script","external":true,"refSections":[{"refs":[{"id":"ref-for-evaluate-a-bidding-script"},{"id":"ref-for-evaluate-a-bidding-script\u2460"}],"title":"11.4. Algorithm modifications"}],"url":"https://wicg.github.io/turtledove/#evaluate-a-bidding-script"},
"e77d2744": {"dfnID":"e77d2744","dfnText":"AuctionAdConfig","external":true,"refSections":[{"refs":[{"id":"ref-for-dictdef-auctionadconfig"},{"id":"536688c80"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-dictdef-auctionadconfig\u2460"},{"id":"ref-for-dictdef-auctionadconfig\u2461"}],"title":"11.2. WebIDL modifications"}],"url":"https://wicg.github.io/turtledove/#dictdef-auctionadconfig"},
"e865646f": {"dfnID":"e865646f","dfnText":"owner","external":true,"refSections":[{"refs":[{"id":"ref-for-interest-group-owner"},{"id":"ref-for-interest-group-owner\u2460"},{"id":"ref-for-interest-group-owner\u2461"},{"id":"ref-for-interest-group-owner\u2462"},{"id":"ref-for-interest-group-owner\u2463"},{"id":"ref-for-interest-group-owner\u2464"}],"title":"11.5. New algorithms"}],"url":"https://wicg.github.io/turtledove/#interest-group-owner"},
"e9211cfb": {"dfnID":"e9211cfb","dfnText":"run(name)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-windowsharedstorage-run"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://wicg.github.io/shared-storage/#dom-windowsharedstorage-run"},
"e99bd18e": {"dfnID":"e99bd18e","dfnText":"relevant global object","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-relevant-global"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-concept-relevant-global\u2460"}],"title":"11.1. New WebIDL"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"},
"ea2d3b07": {"dfnID":"ea2d3b07","dfnText":"evaluate a scoring script","external":true,"refSections":[{"refs":[{"id":"ref-for-evaluate-a-scoring-script"},{"id":"ref-for-evaluate-a-scoring-script\u2460"}],"title":"11.4. Algorithm modifications"}],"url":"https://wicg.github.io/turtledove/#evaluate-a-scoring-script"},
"ec878a66": {"dfnID":"ec878a66","dfnText":"RangeError","external":true,"refSections":[{"refs":[{"id":"ref-for-exceptiondef-rangeerror"},{"id":"ref-for-exceptiondef-rangeerror\u2460"},{"id":"ref-for-exceptiondef-rangeerror\u2461"}],"title":"2. Exposed interface"}],"url":"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror"},
"eec46e27": {"dfnID":"eec46e27","dfnText":"addModule(moduleURL, options)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-worklet-addmodule"},{"id":"ref-for-dom-worklet-addmodule\u2460"},{"id":"ref-for-dom-worklet-addmodule\u2461"},{"id":"ref-for-dom-worklet-addmodule\u2462"},{"id":"ref-for-dom-worklet-addmodule\u2463"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule"},
"efe8653e": {"dfnID":"efe8653e","dfnText":"iterate (for map)","external":true,"refSections":[{"refs":[{"id":"ref-for-map-iterate"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-map-iterate\u2460"},{"id":"ref-for-map-iterate\u2461"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-map-iterate\u2462"},{"id":"ref-for-map-iterate\u2463"},{"id":"ref-for-map-iterate\u2464"},{"id":"ref-for-map-iterate\u2465"},{"id":"ref-for-map-iterate\u2466"},{"id":"ref-for-map-iterate\u2467"}],"title":"11.5. New algorithms"}],"url":"https://infra.spec.whatwg.org/#map-iterate"},
"encode-an-integer-for-the-payload": {"dfnID":"encode-an-integer-for-the-payload","dfnText":"encode an integer for the payload","external":false,"refSections":[{"refs":[{"id":"ref-for-encode-an-integer-for-the-payload"},{"id":"ref-for-encode-an-integer-for-the-payload\u2460"},{"id":"ref-for-encode-an-integer-for-the-payload\u2461"}],"title":"8.4. Serializing reports"}],"url":"#encode-an-integer-for-the-payload"},
"encrypt-the-payload": {"dfnID":"encrypt-the-payload","dfnText":"encrypt the payload","external":false,"refSections":[{"refs":[{"id":"ref-for-encrypt-the-payload"}],"title":"8.4. Serializing reports"}],"url":"#encrypt-the-payload"},
"f02cd417": {"dfnID":"f02cd417","dfnText":"iterate (for list)","external":true,"refSections":[{"refs":[{"id":"ref-for-list-iterate"},{"id":"ref-for-list-iterate\u2460"},{"id":"ref-for-list-iterate\u2461"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-list-iterate\u2462"},{"id":"ref-for-list-iterate\u2463"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-list-iterate\u2464"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-list-iterate\u2465"},{"id":"ref-for-list-iterate\u2466"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-list-iterate\u2467"},{"id":"ref-for-list-iterate\u2468"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-list-iterate\u2460\u24ea"}],"title":"11.5. New algorithms"}],"url":"https://infra.spec.whatwg.org/#list-iterate"},
"f14b47b8": {"dfnID":"f14b47b8","dfnText":"unsigned long long","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-unsigned-long-long"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://webidl.spec.whatwg.org/#idl-unsigned-long-long"},
"f14ed351": {"dfnID":"f14ed351","dfnText":"upon rejection","external":true,"refSections":[{"refs":[{"id":"ref-for-upon-rejection"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://webidl.spec.whatwg.org/#upon-rejection"},
"f1d11a13": {"dfnID":"f1d11a13","dfnText":"call","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-call"},{"id":"ref-for-sec-call\u2460"}],"title":"10. Shared Storage API monkey patches"}],"url":"https://tc39.es/ecma262/#sec-call"},
"f8de33a3": {"dfnID":"f8de33a3","dfnText":"long","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-long"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-idl-long\u2460"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-idl-long\u2461"},{"id":"ref-for-idl-long\u2462"}],"title":"11.1. New WebIDL"}],"url":"https://webidl.spec.whatwg.org/#idl-long"},
"f937b7b6": {"dfnID":"f937b7b6","dfnText":"continue","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-continue"},{"id":"ref-for-iteration-continue\u2460"},{"id":"ref-for-iteration-continue\u2461"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-iteration-continue\u2462"},{"id":"ref-for-iteration-continue\u2463"}],"title":"11.5. New algorithms"}],"url":"https://infra.spec.whatwg.org/#iteration-continue"},
"fa4ea124": {"dfnID":"fa4ea124","dfnText":"initiator","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-initiator"}],"title":"8.3. Sending reports"}],"url":"https://fetch.spec.whatwg.org/#concept-request-initiator"},
"fb9bb722": {"dfnID":"fb9bb722","dfnText":"site","external":true,"refSections":[{"refs":[{"id":"ref-for-site"}],"title":"13.1. Same-origin policy"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#site"},
"fe84cc4a": {"dfnID":"fe84cc4a","dfnText":"interest group update","external":true,"refSections":[{"refs":[{"id":"ref-for-interest-group-update"}],"title":"11.4. Algorithm modifications"}],"url":"https://wicg.github.io/turtledove/#interest-group-update"},
"feac4ab3": {"dfnID":"feac4ab3","dfnText":"same site","external":true,"refSections":[{"refs":[{"id":"ref-for-same-site"}],"title":"13.1. Same-origin policy"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#same-site"},
"fill-in-the-contribution": {"dfnID":"fill-in-the-contribution","dfnText":"fill in the contribution","external":false,"refSections":[{"refs":[{"id":"ref-for-fill-in-the-contribution"}],"title":"11.5. New algorithms"}],"url":"#fill-in-the-contribution"},
"fill-in-the-signal-value": {"dfnID":"fill-in-the-signal-value","dfnText":"fill in the signal value","external":false,"refSections":[{"refs":[{"id":"ref-for-fill-in-the-signal-value"},{"id":"ref-for-fill-in-the-signal-value\u2460"}],"title":"11.5. New algorithms"}],"url":"#fill-in-the-signal-value"},
"get-a-debug-details": {"dfnID":"get-a-debug-details","dfnText":"get a debug details","external":false,"refSections":[{"refs":[{"id":"ref-for-get-a-debug-details"}],"title":"11.4. Algorithm modifications"}],"url":"#get-a-debug-details"},
"get-or-create-a-batching-scope": {"dfnID":"get-or-create-a-batching-scope","dfnText":"get or create a batching scope","external":false,"refSections":[{"refs":[{"id":"ref-for-get-or-create-a-batching-scope"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-get-or-create-a-batching-scope\u2460"}],"title":"11.5. New algorithms"}],"url":"#get-or-create-a-batching-scope"},
"get-the-privateaggregation": {"dfnID":"get-the-privateaggregation","dfnText":"get the privateAggregation","external":false,"refSections":[{"refs":[{"id":"ref-for-get-the-privateaggregation"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-get-the-privateaggregation\u2460"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-get-the-privateaggregation\u2461"}],"title":"11.1. New WebIDL"}],"url":"#get-the-privateaggregation"},
"interest-group-private-aggregation-coordinator": {"dfnID":"interest-group-private-aggregation-coordinator","dfnText":"Private Aggregation coordinator","external":false,"refSections":[{"refs":[{"id":"ref-for-interest-group-private-aggregation-coordinator"},{"id":"ref-for-interest-group-private-aggregation-coordinator\u2460"},{"id":"ref-for-interest-group-private-aggregation-coordinator\u2461"},{"id":"ref-for-interest-group-private-aggregation-coordinator\u2462"}],"title":"11.4. Algorithm modifications"}],"url":"#interest-group-private-aggregation-coordinator"},
"interestgroupreportingscriptrunnerglobalscope-interest-group": {"dfnID":"interestgroupreportingscriptrunnerglobalscope-interest-group","dfnText":"interest group","external":false,"refSections":[{"refs":[{"id":"ref-for-interestgroupreportingscriptrunnerglobalscope-interest-group"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-interestgroupreportingscriptrunnerglobalscope-interest-group\u2460"}],"title":"11.5. New algorithms"}],"url":"#interestgroupreportingscriptrunnerglobalscope-interest-group"},
"interestgroupscriptrunnerglobalscope-auction-config": {"dfnID":"interestgroupscriptrunnerglobalscope-auction-config","dfnText":"auction config","external":false,"refSections":[{"refs":[{"id":"ref-for-interestgroupscriptrunnerglobalscope-auction-config"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-interestgroupscriptrunnerglobalscope-auction-config\u2460"},{"id":"ref-for-interestgroupscriptrunnerglobalscope-auction-config\u2461"},{"id":"ref-for-interestgroupscriptrunnerglobalscope-auction-config\u2462"}],"title":"11.4. Algorithm modifications"}],"url":"#interestgroupscriptrunnerglobalscope-auction-config"},
"localtestingmode": {"dfnID":"localtestingmode","dfnText":"localtestingmode","external":false,"refSections":[],"url":"#localtestingmode"},
"mark-a-debug-scope-complete": {"dfnID":"mark-a-debug-scope-complete","dfnText":"mark a debug scope complete","external":false,"refSections":[{"refs":[{"id":"ref-for-mark-a-debug-scope-complete"},{"id":"ref-for-mark-a-debug-scope-complete\u2460"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-mark-a-debug-scope-complete\u2461"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-mark-a-debug-scope-complete\u2462"},{"id":"ref-for-mark-a-debug-scope-complete\u2463"},{"id":"ref-for-mark-a-debug-scope-complete\u2464"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-mark-a-debug-scope-complete\u2465"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-mark-a-debug-scope-complete\u2466"}],"title":"11.5. New algorithms"}],"url":"#mark-a-debug-scope-complete"},
"maximum-report-contributions": {"dfnID":"maximum-report-contributions","dfnText":"Maximum report contributions","external":false,"refSections":[{"refs":[{"id":"ref-for-maximum-report-contributions"},{"id":"ref-for-maximum-report-contributions\u2460"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-maximum-report-contributions\u2461"},{"id":"ref-for-maximum-report-contributions\u2462"}],"title":"8.4. Serializing reports"}],"url":"#maximum-report-contributions"},
"maybe-obtain-an-interest-group": {"dfnID":"maybe-obtain-an-interest-group","dfnText":"maybe obtain an interest group","external":false,"refSections":[{"refs":[{"id":"ref-for-maybe-obtain-an-interest-group"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-maybe-obtain-an-interest-group\u2460"},{"id":"ref-for-maybe-obtain-an-interest-group\u2461"}],"title":"11.4. Algorithm modifications"}],"url":"#maybe-obtain-an-interest-group"},
"minimum-report-delay": {"dfnID":"minimum-report-delay","dfnText":"Minimum report delay","external":false,"refSections":[{"refs":[{"id":"ref-for-minimum-report-delay"}],"title":"6. Implementation-defined values"},{"refs":[{"id":"ref-for-minimum-report-delay\u2460"}],"title":"8.2. Scheduling reports"}],"url":"#minimum-report-delay"},
"obtain-a-report-delivery-time": {"dfnID":"obtain-a-report-delivery-time","dfnText":"obtain a report delivery time","external":false,"refSections":[{"refs":[{"id":"ref-for-obtain-a-report-delivery-time"}],"title":"8.2. Scheduling reports"}],"url":"#obtain-a-report-delivery-time"},
"obtain-a-reporting-endpoint": {"dfnID":"obtain-a-reporting-endpoint","dfnText":"obtain a reporting endpoint","external":false,"refSections":[{"refs":[{"id":"ref-for-obtain-a-reporting-endpoint"}],"title":"8.3. Sending reports"}],"url":"#obtain-a-reporting-endpoint"},
"obtain-a-reports-shared-info": {"dfnID":"obtain-a-reports-shared-info","dfnText":"obtain a report\u2019s shared info","external":false,"refSections":[{"refs":[{"id":"ref-for-obtain-a-reports-shared-info"},{"id":"ref-for-obtain-a-reports-shared-info\u2460"}],"title":"8.4. Serializing reports"}],"url":"#obtain-a-reports-shared-info"},
"obtain-an-aggregatable-report": {"dfnID":"obtain-an-aggregatable-report","dfnText":"obtain an aggregatable report","external":false,"refSections":[{"refs":[{"id":"ref-for-obtain-an-aggregatable-report"}],"title":"8.2. Scheduling reports"}],"url":"#obtain-an-aggregatable-report"},
"obtain-the-aggregation-coordinator": {"dfnID":"obtain-the-aggregation-coordinator","dfnText":"obtain the aggregation coordinator","external":false,"refSections":[{"refs":[{"id":"ref-for-obtain-the-aggregation-coordinator"},{"id":"ref-for-obtain-the-aggregation-coordinator\u2460"}],"title":"10. Shared Storage API monkey patches"}],"url":"#obtain-the-aggregation-coordinator"},
"obtain-the-aggregation-service-payloads": {"dfnID":"obtain-the-aggregation-service-payloads","dfnText":"obtain the aggregation service payloads","external":false,"refSections":[{"refs":[{"id":"ref-for-obtain-the-aggregation-service-payloads"}],"title":"8.4. Serializing reports"}],"url":"#obtain-the-aggregation-service-payloads"},
"obtain-the-plaintext-payload": {"dfnID":"obtain-the-plaintext-payload","dfnText":"obtain the plaintext payload","external":false,"refSections":[{"refs":[{"id":"ref-for-obtain-the-plaintext-payload"}],"title":"8.4. Serializing reports"}],"url":"#obtain-the-plaintext-payload"},
"obtain-the-pre-specified-report-parameters": {"dfnID":"obtain-the-pre-specified-report-parameters","dfnText":"obtain the pre-specified report parameters","external":false,"refSections":[{"refs":[{"id":"ref-for-obtain-the-pre-specified-report-parameters"},{"id":"ref-for-obtain-the-pre-specified-report-parameters\u2460"}],"title":"10. Shared Storage API monkey patches"}],"url":"#obtain-the-pre-specified-report-parameters"},
"obtain-the-private-aggregation-coordinator": {"dfnID":"obtain-the-private-aggregation-coordinator","dfnText":"obtain the Private Aggregation coordinator","external":false,"refSections":[{"refs":[{"id":"ref-for-obtain-the-private-aggregation-coordinator"},{"id":"ref-for-obtain-the-private-aggregation-coordinator\u2460"}],"title":"11.4. Algorithm modifications"}],"url":"#obtain-the-private-aggregation-coordinator"},
"obtain-the-private-aggregation-coordinator-from-a-string": {"dfnID":"obtain-the-private-aggregation-coordinator-from-a-string","dfnText":"obtain the\nPrivate Aggregation coordinator","external":false,"refSections":[{"refs":[{"id":"ref-for-obtain-the-private-aggregation-coordinator-from-a-string"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-obtain-the-private-aggregation-coordinator-from-a-string\u2460"}],"title":"11.5. New algorithms"}],"url":"#obtain-the-private-aggregation-coordinator-from-a-string"},
"obtain-the-public-key-for-encryption": {"dfnID":"obtain-the-public-key-for-encryption","dfnText":"obtain the public key for encryption","external":false,"refSections":[{"refs":[{"id":"ref-for-obtain-the-public-key-for-encryption"}],"title":"8.4. Serializing reports"},{"refs":[{"id":"ref-for-obtain-the-public-key-for-encryption\u2460"}],"title":"13.2. Protecting the histogram contributions"}],"url":"#obtain-the-public-key-for-encryption"},
"on-event-contribution-cache": {"dfnID":"on-event-contribution-cache","dfnText":"11.3.7. On event contribution cache","external":false,"refSections":[{"refs":[{"id":"ref-for-on-event-contribution-cache"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-on-event-contribution-cache\u2460"}],"title":"11.3.1. Extending auction config"},{"refs":[{"id":"ref-for-on-event-contribution-cache"}],"title":"11.3.7. On event contribution cache"}],"url":"#on-event-contribution-cache"},
"on-event-contribution-cache-entry": {"dfnID":"on-event-contribution-cache-entry","dfnText":"11.3.6. On event contribution cache entry","external":false,"refSections":[{"refs":[{"id":"ref-for-on-event-contribution-cache-entry"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-on-event-contribution-cache-entry"}],"title":"11.3.6. On event contribution cache entry"},{"refs":[{"id":"ref-for-on-event-contribution-cache-entry\u2460"}],"title":"11.3.7. On event contribution cache"}],"url":"#on-event-contribution-cache-entry"},
"on-event-contribution-cache-entry-batching-scope": {"dfnID":"on-event-contribution-cache-entry-batching-scope","dfnText":"batching scope","external":false,"refSections":[{"refs":[{"id":"ref-for-on-event-contribution-cache-entry-batching-scope"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-on-event-contribution-cache-entry-batching-scope\u2460"}],"title":"11.5. New algorithms"}],"url":"#on-event-contribution-cache-entry-batching-scope"},
"on-event-contribution-cache-entry-contribution": {"dfnID":"on-event-contribution-cache-entry-contribution","dfnText":"contribution","external":false,"refSections":[{"refs":[{"id":"ref-for-on-event-contribution-cache-entry-contribution"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-on-event-contribution-cache-entry-contribution\u2460"}],"title":"11.5. New algorithms"}],"url":"#on-event-contribution-cache-entry-contribution"},
"on-event-contribution-cache-entry-debug-details": {"dfnID":"on-event-contribution-cache-entry-debug-details","dfnText":"debug details","external":false,"refSections":[{"refs":[{"id":"ref-for-on-event-contribution-cache-entry-debug-details"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-on-event-contribution-cache-entry-debug-details\u2460"},{"id":"ref-for-on-event-contribution-cache-entry-debug-details\u2461"}],"title":"11.5. New algorithms"}],"url":"#on-event-contribution-cache-entry-debug-details"},
"on-event-contribution-cache-entry-debug-scope": {"dfnID":"on-event-contribution-cache-entry-debug-scope","dfnText":"debug scope","external":false,"refSections":[{"refs":[{"id":"ref-for-on-event-contribution-cache-entry-debug-scope"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-on-event-contribution-cache-entry-debug-scope\u2460"}],"title":"11.4. Algorithm modifications"},{"refs":[{"id":"ref-for-on-event-contribution-cache-entry-debug-scope\u2461"}],"title":"11.5. New algorithms"}],"url":"#on-event-contribution-cache-entry-debug-scope"},
"on-event-contribution-cache-entry-worklet-function": {"dfnID":"on-event-contribution-cache-entry-worklet-function","dfnText":"worklet function","external":false,"refSections":[{"refs":[{"id":"ref-for-on-event-contribution-cache-entry-worklet-function"}],"title":"11.1. New WebIDL"}],"url":"#on-event-contribution-cache-entry-worklet-function"},
"permissions-policy-state": {"dfnID":"permissions-policy-state","dfnText":"11.3.3. Permissions policy state","external":false,"refSections":[{"refs":[{"id":"ref-for-permissions-policy-state"}],"title":"11.3.1. Extending auction config"},{"refs":[{"id":"ref-for-permissions-policy-state"}],"title":"11.3.3. Permissions policy state"},{"refs":[{"id":"ref-for-permissions-policy-state\u2460"}],"title":"11.4. Algorithm modifications"}],"url":"#permissions-policy-state"},
"permissions-policy-state-private-aggregation-enabled": {"dfnID":"permissions-policy-state-private-aggregation-enabled","dfnText":"private aggregation enabled","external":false,"refSections":[{"refs":[{"id":"ref-for-permissions-policy-state-private-aggregation-enabled"},{"id":"ref-for-permissions-policy-state-private-aggregation-enabled\u2460"}],"title":"11.4. Algorithm modifications"}],"url":"#permissions-policy-state-private-aggregation-enabled"},
"pre-specified-report-parameters": {"dfnID":"pre-specified-report-parameters","dfnText":"pre-specified report parameters","external":false,"refSections":[{"refs":[{"id":"ref-for-pre-specified-report-parameters"}],"title":"5. Storage"},{"refs":[{"id":"ref-for-pre-specified-report-parameters\u2460"},{"id":"ref-for-pre-specified-report-parameters\u2461"},{"id":"ref-for-pre-specified-report-parameters\u2462"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-pre-specified-report-parameters\u2463"},{"id":"ref-for-pre-specified-report-parameters\u2464"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-pre-specified-report-parameters\u2465"},{"id":"ref-for-pre-specified-report-parameters\u2466"}],"title":"10. Shared Storage API monkey patches"}],"url":"#pre-specified-report-parameters"},
"pre-specified-report-parameters-context-id": {"dfnID":"pre-specified-report-parameters-context-id","dfnText":"context ID","external":false,"refSections":[{"refs":[{"id":"ref-for-pre-specified-report-parameters-context-id"},{"id":"ref-for-pre-specified-report-parameters-context-id\u2460"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-pre-specified-report-parameters-context-id\u2461"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-pre-specified-report-parameters-context-id\u2462"}],"title":"10. Shared Storage API monkey patches"}],"url":"#pre-specified-report-parameters-context-id"},
"pre-specified-report-parameters-filtering-id-byte-size": {"dfnID":"pre-specified-report-parameters-filtering-id-byte-size","dfnText":"filtering ID byte size","external":false,"refSections":[{"refs":[{"id":"ref-for-pre-specified-report-parameters-filtering-id-byte-size"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-pre-specified-report-parameters-filtering-id-byte-size\u2460"},{"id":"ref-for-pre-specified-report-parameters-filtering-id-byte-size\u2461"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-pre-specified-report-parameters-filtering-id-byte-size\u2462"}],"title":"8.2. Scheduling reports"},{"refs":[{"id":"ref-for-pre-specified-report-parameters-filtering-id-byte-size\u2463"}],"title":"10. Shared Storage API monkey patches"}],"url":"#pre-specified-report-parameters-filtering-id-byte-size"},
"pre-specified-report-parameters-map": {"dfnID":"pre-specified-report-parameters-map","dfnText":"pre-specified report parameters map","external":false,"refSections":[{"refs":[{"id":"ref-for-pre-specified-report-parameters-map"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-pre-specified-report-parameters-map\u2460"}],"title":"5.1. Clearing storage"},{"refs":[{"id":"ref-for-pre-specified-report-parameters-map\u2461"},{"id":"ref-for-pre-specified-report-parameters-map\u2462"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-pre-specified-report-parameters-map\u2463"}],"title":"12.2. Clearing site data"},{"refs":[{"id":"ref-for-pre-specified-report-parameters-map\u2464"}],"title":"13.1. Same-origin policy"}],"url":"#pre-specified-report-parameters-map"},
"private-aggregation": {"dfnID":"private-aggregation","dfnText":"private-aggregation","external":false,"refSections":[{"refs":[{"id":"ref-for-private-aggregation"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-private-aggregation\u2460"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-private-aggregation\u2461"}],"title":"11.4. Algorithm modifications"}],"url":"#private-aggregation"},
"privateaggregation": {"dfnID":"privateaggregation","dfnText":"PrivateAggregation","external":false,"refSections":[{"refs":[{"id":"ref-for-privateaggregation"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-privateaggregation\u2460"},{"id":"ref-for-privateaggregation\u2461"},{"id":"ref-for-privateaggregation\u2462"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-privateaggregation\u2463"}],"title":"4.8. Context type"},{"refs":[{"id":"ref-for-privateaggregation\u2464"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-privateaggregation\u2465"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-privateaggregation\u2466"},{"id":"ref-for-privateaggregation\u2467"}],"title":"11.1. New WebIDL"}],"url":"#privateaggregation"},
"privateaggregation-allowed-to-use": {"dfnID":"privateaggregation-allowed-to-use","dfnText":"allowed to use","external":false,"refSections":[{"refs":[{"id":"ref-for-privateaggregation-allowed-to-use"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-privateaggregation-allowed-to-use\u2460"}],"title":"7. Permissions Policy integration"},{"refs":[{"id":"ref-for-privateaggregation-allowed-to-use\u2461"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-privateaggregation-allowed-to-use\u2462"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-privateaggregation-allowed-to-use\u2463"}],"title":"11.4. Algorithm modifications"}],"url":"#privateaggregation-allowed-to-use"},
"privateaggregation-scoping-details": {"dfnID":"privateaggregation-scoping-details","dfnText":"scoping details","external":false,"refSections":[{"refs":[{"id":"ref-for-privateaggregation-scoping-details"},{"id":"ref-for-privateaggregation-scoping-details\u2460"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-privateaggregation-scoping-details\u2461"},{"id":"ref-for-privateaggregation-scoping-details\u2462"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-privateaggregation-scoping-details\u2463"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-privateaggregation-scoping-details\u2464"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-privateaggregation-scoping-details\u2465"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-privateaggregation-scoping-details\u2466"}],"title":"11.4. Algorithm modifications"}],"url":"#privateaggregation-scoping-details"},
"process-contributions-for-a-batching-scope": {"dfnID":"process-contributions-for-a-batching-scope","dfnText":"process contributions for a batching scope","external":false,"refSections":[{"refs":[{"id":"ref-for-process-contributions-for-a-batching-scope"},{"id":"ref-for-process-contributions-for-a-batching-scope\u2460"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-process-contributions-for-a-batching-scope\u2461"}],"title":"8.1. Exported algorithms"},{"refs":[{"id":"ref-for-process-contributions-for-a-batching-scope\u2462"},{"id":"ref-for-process-contributions-for-a-batching-scope\u2463"},{"id":"ref-for-process-contributions-for-a-batching-scope\u2464"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-process-contributions-for-a-batching-scope\u2465"}],"title":"11.5. New algorithms"}],"url":"#process-contributions-for-a-batching-scope"},
"process-the-private-aggregation-contributions-for-an-auction": {"dfnID":"process-the-private-aggregation-contributions-for-an-auction","dfnText":"process the Private Aggregation contributions for an auction","external":false,"refSections":[{"refs":[{"id":"ref-for-process-the-private-aggregation-contributions-for-an-auction"}],"title":"11.4. Algorithm modifications"}],"url":"#process-the-private-aggregation-contributions-for-an-auction"},
"randomized-report-delay": {"dfnID":"randomized-report-delay","dfnText":"Randomized report delay","external":false,"refSections":[{"refs":[{"id":"ref-for-randomized-report-delay"}],"title":"8.2. Scheduling reports"}],"url":"#randomized-report-delay"},
"report-creation-and-scheduling-steps": {"dfnID":"report-creation-and-scheduling-steps","dfnText":"report creation and scheduling steps","external":false,"refSections":[{"refs":[{"id":"ref-for-report-creation-and-scheduling-steps"}],"title":"8.1. Exported algorithms"}],"url":"#report-creation-and-scheduling-steps"},
"scoping-details": {"dfnID":"scoping-details","dfnText":"4.3. Scoping details","external":false,"refSections":[{"refs":[{"id":"ref-for-scoping-details"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-scoping-details"}],"title":"4.3. Scoping details"},{"refs":[{"id":"ref-for-scoping-details\u2460"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-scoping-details\u2461"}],"title":"11.4. Algorithm modifications"}],"url":"#scoping-details"},
"scoping-details-get-batching-scope-steps": {"dfnID":"scoping-details-get-batching-scope-steps","dfnText":"get batching scope steps","external":false,"refSections":[{"refs":[{"id":"ref-for-scoping-details-get-batching-scope-steps"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-scoping-details-get-batching-scope-steps\u2460"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-scoping-details-get-batching-scope-steps\u2461"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-scoping-details-get-batching-scope-steps\u2462"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-scoping-details-get-batching-scope-steps\u2463"}],"title":"11.4. Algorithm modifications"}],"url":"#scoping-details-get-batching-scope-steps"},
"scoping-details-get-debug-scope-steps": {"dfnID":"scoping-details-get-debug-scope-steps","dfnText":"get debug scope steps","external":false,"refSections":[{"refs":[{"id":"ref-for-scoping-details-get-debug-scope-steps"},{"id":"ref-for-scoping-details-get-debug-scope-steps\u2460"}],"title":"2. Exposed interface"},{"refs":[{"id":"ref-for-scoping-details-get-debug-scope-steps\u2461"}],"title":"3. Exposing to global scopes"},{"refs":[{"id":"ref-for-scoping-details-get-debug-scope-steps\u2462"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-scoping-details-get-debug-scope-steps\u2463"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-scoping-details-get-debug-scope-steps\u2464"}],"title":"11.4. Algorithm modifications"}],"url":"#scoping-details-get-debug-scope-steps"},
"serialize-an-aggregatable-report": {"dfnID":"serialize-an-aggregatable-report","dfnText":"serialize an aggregatable report","external":false,"refSections":[{"refs":[{"id":"ref-for-serialize-an-aggregatable-report"}],"title":"8.3. Sending reports"},{"refs":[{"id":"ref-for-serialize-an-aggregatable-report\u2460"}],"title":"12.3.2. User-presence tracking"}],"url":"#serialize-an-aggregatable-report"},
"serialize-an-integer": {"dfnID":"serialize-an-integer","dfnText":"serialize an integer","external":false,"refSections":[{"refs":[{"id":"ref-for-serialize-an-integer"}],"title":"8.4. Serializing reports"}],"url":"#serialize-an-integer"},
"set-the-aggregation-coordinator-for-a-batching-scope": {"dfnID":"set-the-aggregation-coordinator-for-a-batching-scope","dfnText":"set the aggregation coordinator for a batching scope","external":false,"refSections":[{"refs":[{"id":"ref-for-set-the-aggregation-coordinator-for-a-batching-scope"},{"id":"ref-for-set-the-aggregation-coordinator-for-a-batching-scope\u2460"}],"title":"10. Shared Storage API monkey patches"},{"refs":[{"id":"ref-for-set-the-aggregation-coordinator-for-a-batching-scope\u2461"}],"title":"11.5. New algorithms"}],"url":"#set-the-aggregation-coordinator-for-a-batching-scope"},
"set-the-pre-specified-report-parameters-for-a-batching-scope": {"dfnID":"set-the-pre-specified-report-parameters-for-a-batching-scope","dfnText":"set the pre-specified report parameters for a batching\nscope","external":false,"refSections":[{"refs":[{"id":"ref-for-set-the-pre-specified-report-parameters-for-a-batching-scope"},{"id":"ref-for-set-the-pre-specified-report-parameters-for-a-batching-scope\u2460"},{"id":"ref-for-set-the-pre-specified-report-parameters-for-a-batching-scope\u2461"}],"title":"10. Shared Storage API monkey patches"}],"url":"#set-the-pre-specified-report-parameters-for-a-batching-scope"},
"signal-base-value": {"dfnID":"signal-base-value","dfnText":"11.3.4. Signal base value","external":false,"refSections":[{"refs":[{"id":"ref-for-signal-base-value"},{"id":"ref-for-signal-base-value\u2460"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-signal-base-value"}],"title":"11.3.4. Signal base value"},{"refs":[{"id":"ref-for-signal-base-value\u2461"},{"id":"ref-for-signal-base-value\u2462"}],"title":"11.5. New algorithms"}],"url":"#signal-base-value"},
"signal-base-value-bid-reject-reason": {"dfnID":"signal-base-value-bid-reject-reason","dfnText":"bid-reject-reason","external":false,"refSections":[{"refs":[{"id":"ref-for-signal-base-value-bid-reject-reason"}],"title":"11.5. New algorithms"}],"url":"#signal-base-value-bid-reject-reason"},
"signal-base-value-highest-scoring-other-bid": {"dfnID":"signal-base-value-highest-scoring-other-bid","dfnText":"highest-scoring-other-bid","external":false,"refSections":[{"refs":[{"id":"ref-for-signal-base-value-highest-scoring-other-bid"}],"title":"11.5. New algorithms"}],"url":"#signal-base-value-highest-scoring-other-bid"},
"signal-base-value-script-run-time": {"dfnID":"signal-base-value-script-run-time","dfnText":"script-run-time","external":false,"refSections":[{"refs":[{"id":"ref-for-signal-base-value-script-run-time"}],"title":"11.5. New algorithms"}],"url":"#signal-base-value-script-run-time"},
"signal-base-value-signals-fetch-time": {"dfnID":"signal-base-value-signals-fetch-time","dfnText":"signals-fetch-time","external":false,"refSections":[{"refs":[{"id":"ref-for-signal-base-value-signals-fetch-time"}],"title":"11.5. New algorithms"}],"url":"#signal-base-value-signals-fetch-time"},
"signal-base-value-winning-bid": {"dfnID":"signal-base-value-winning-bid","dfnText":"winning-bid","external":false,"refSections":[{"refs":[{"id":"ref-for-signal-base-value-winning-bid"}],"title":"11.5. New algorithms"}],"url":"#signal-base-value-winning-bid"},
"worklet-function": {"dfnID":"worklet-function","dfnText":"11.3.5. Worklet function","external":false,"refSections":[{"refs":[{"id":"ref-for-worklet-function"}],"title":"11.1. New WebIDL"},{"refs":[{"id":"ref-for-worklet-function"}],"title":"11.3.5. Worklet function"},{"refs":[{"id":"ref-for-worklet-function\u2460"}],"title":"11.3.6. On event contribution cache entry"},{"refs":[{"id":"ref-for-worklet-function\u2461"},{"id":"ref-for-worklet-function\u2462"}],"title":"11.5. New algorithms"}],"url":"#worklet-function"},
"worklet-function-generate-bid": {"dfnID":"worklet-function-generate-bid","dfnText":"generate-bid","external":false,"refSections":[{"refs":[{"id":"ref-for-worklet-function-generate-bid"}],"title":"11.5. New algorithms"}],"url":"#worklet-function-generate-bid"},
"worklet-function-report-result": {"dfnID":"worklet-function-report-result","dfnText":"report-result","external":false,"refSections":[{"refs":[{"id":"ref-for-worklet-function-report-result"}],"title":"11.5. New algorithms"}],"url":"#worklet-function-report-result"},
"worklet-function-report-win": {"dfnID":"worklet-function-report-win","dfnText":"report-win","external":false,"refSections":[{"refs":[{"id":"ref-for-worklet-function-report-win"}],"title":"11.5. New algorithms"}],"url":"#worklet-function-report-win"},
"worklet-function-score-ad": {"dfnID":"worklet-function-score-ad","dfnText":"score-ad","external":false,"refSections":[{"refs":[{"id":"ref-for-worklet-function-score-ad"}],"title":"11.5. New algorithms"}],"url":"#worklet-function-score-ad"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#aggregatable-report": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"aggregatable report","type":"dfn","url":"#aggregatable-report"},
"#aggregatable-report-aggregation-coordinator": {"export":true,"for_":["aggregatable report"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"aggregation coordinator","type":"dfn","url":"#aggregatable-report-aggregation-coordinator"},
"#aggregatable-report-api": {"export":true,"for_":["aggregatable report"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"api","type":"dfn","url":"#aggregatable-report-api"},
"#aggregatable-report-cache": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"aggregatable report cache","type":"dfn","url":"#aggregatable-report-cache"},
"#aggregatable-report-context-id": {"export":true,"for_":["aggregatable report"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"context id","type":"dfn","url":"#aggregatable-report-context-id"},
"#aggregatable-report-contributions": {"export":true,"for_":["aggregatable report"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"contributions","type":"dfn","url":"#aggregatable-report-contributions"},
"#aggregatable-report-debug-details": {"export":true,"for_":["aggregatable report"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"debug details","type":"dfn","url":"#aggregatable-report-debug-details"},
"#aggregatable-report-filtering-id-byte-size": {"export":true,"for_":["aggregatable report"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"filtering id byte size","type":"dfn","url":"#aggregatable-report-filtering-id-byte-size"},
"#aggregatable-report-original-report-time": {"export":true,"for_":["aggregatable report"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"original report time","type":"dfn","url":"#aggregatable-report-original-report-time"},
"#aggregatable-report-queued": {"export":true,"for_":["aggregatable report"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"queued","type":"dfn","url":"#aggregatable-report-queued"},
"#aggregatable-report-report-id": {"export":true,"for_":["aggregatable report"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"report id","type":"dfn","url":"#aggregatable-report-report-id"},
"#aggregatable-report-report-time": {"export":true,"for_":["aggregatable report"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"report time","type":"dfn","url":"#aggregatable-report-report-time"},
"#aggregatable-report-reporting-origin": {"export":true,"for_":["aggregatable report"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"reporting origin","type":"dfn","url":"#aggregatable-report-reporting-origin"},
"#aggregation-coordinator": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"aggregation coordinator","type":"dfn","url":"#aggregation-coordinator"},
"#aggregation-coordinator-map": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"aggregation coordinator map","type":"dfn","url":"#aggregation-coordinator-map"},
"#allowed-aggregation-coordinator-set": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"allowed aggregation coordinator set","type":"dfn","url":"#allowed-aggregation-coordinator-set"},
"#append-an-entry-to-the-contribution-cache": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"append an entry to the contribution cache","type":"dfn","url":"#append-an-entry-to-the-contribution-cache"},
"#attempt-to-deliver-a-report": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"attempt to deliver a report","type":"dfn","url":"#attempt-to-deliver-a-report"},
"#attempt-to-queue-reports-for-sending": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"attempt to queue reports for sending","type":"dfn","url":"#attempt-to-queue-reports-for-sending"},
"#auction-config-auction-report-buyer-debug-details": {"export":true,"for_":["auction config"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"auction report buyer debug details","type":"dfn","url":"#auction-config-auction-report-buyer-debug-details"},
"#auction-config-auction-report-buyer-keys": {"export":true,"for_":["auction config"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"auction report buyer keys","type":"dfn","url":"#auction-config-auction-report-buyer-keys"},
"#auction-config-auction-report-buyers": {"export":true,"for_":["auction config"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"auction report buyers","type":"dfn","url":"#auction-config-auction-report-buyers"},
"#auction-config-batching-scope-map": {"export":true,"for_":["auction config"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"batching scope map","type":"dfn","url":"#auction-config-batching-scope-map"},
"#auction-config-per-bid-or-seller-on-event-contribution-cache": {"export":true,"for_":["auction config"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"per-bid or seller on event contribution cache","type":"dfn","url":"#auction-config-per-bid-or-seller-on-event-contribution-cache"},
"#auction-config-permissions-policy-state": {"export":true,"for_":["auction config"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"permissions policy state","type":"dfn","url":"#auction-config-permissions-policy-state"},
"#auction-config-seller-private-aggregation-coordinator": {"export":true,"for_":["auction config"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"seller private aggregation coordinator","type":"dfn","url":"#auction-config-seller-private-aggregation-coordinator"},
"#automation-local-testing-mode-enabled": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"automation local testing mode enabled","type":"dfn","url":"#automation-local-testing-mode-enabled"},
"#batching-scope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"batching scope","type":"dfn","url":"#batching-scope"},
"#consume-budget-if-permitted": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"consume budget if permitted","type":"dfn","url":"#consume-budget-if-permitted"},
"#context-type": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"context type","type":"dfn","url":"#context-type"},
"#contribution-cache": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"contribution cache","type":"dfn","url":"#contribution-cache"},
"#contribution-cache-entry": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"contribution cache entry","type":"dfn","url":"#contribution-cache-entry"},
"#contribution-cache-entry-batching-scope": {"export":true,"for_":["contribution cache entry"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"batching scope","type":"dfn","url":"#contribution-cache-entry-batching-scope"},
"#contribution-cache-entry-contribution": {"export":true,"for_":["contribution cache entry"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"contribution","type":"dfn","url":"#contribution-cache-entry-contribution"},
"#contribution-cache-entry-debug-details": {"export":true,"for_":["contribution cache entry"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"debug details","type":"dfn","url":"#contribution-cache-entry-debug-details"},
"#contribution-cache-entry-debug-scope": {"export":true,"for_":["contribution cache entry"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"debug scope","type":"dfn","url":"#contribution-cache-entry-debug-scope"},
"#create-a-report-request": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"create a report request","type":"dfn","url":"#create-a-report-request"},
"#debug-details": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"debug details","type":"dfn","url":"#debug-details"},
"#debug-details-enabled": {"export":true,"for_":["debug details"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"enabled","type":"dfn","url":"#debug-details-enabled"},
"#debug-details-key": {"export":true,"for_":["debug details"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"key","type":"dfn","url":"#debug-details-key"},
"#debug-scope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"debug scope","type":"dfn","url":"#debug-scope"},
"#debug-scope-map": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"debug scope map","type":"dfn","url":"#debug-scope-map"},
"#default-aggregation-coordinator": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"default aggregation coordinator","type":"dfn","url":"#default-aggregation-coordinator"},
"#determine-a-signals-numeric-value": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"determine a signal's numeric value","type":"dfn","url":"#determine-a-signals-numeric-value"},
"#determine-if-a-null-report-should-be-sent": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"determine if a null report should be sent","type":"dfn","url":"#determine-if-a-null-report-should-be-sent"},
"#determine-if-an-origin-is-an-aggregation-coordinator": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"determine if an origin is an aggregation coordinator","type":"dfn","url":"#determine-if-an-origin-is-an-aggregation-coordinator"},
"#dictdef-auctionreportbuyerdebugmodeconfig": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"AuctionReportBuyerDebugModeConfig","type":"dictionary","url":"#dictdef-auctionreportbuyerdebugmodeconfig"},
"#dictdef-auctionreportbuyersconfig": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"AuctionReportBuyersConfig","type":"dictionary","url":"#dictdef-auctionreportbuyersconfig"},
"#dictdef-padebugmodeoptions": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"PADebugModeOptions","type":"dictionary","url":"#dictdef-padebugmodeoptions"},
"#dictdef-paextendedhistogramcontribution": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"PAExtendedHistogramContribution","type":"dictionary","url":"#dictdef-paextendedhistogramcontribution"},
"#dictdef-pahistogramcontribution": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"PAHistogramContribution","type":"dictionary","url":"#dictdef-pahistogramcontribution"},
"#dictdef-pasignalvalue": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"PASignalValue","type":"dictionary","url":"#dictdef-pasignalvalue"},
"#dictdef-protectedaudienceprivateaggregationconfig": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"ProtectedAudiencePrivateAggregationConfig","type":"dictionary","url":"#dictdef-protectedaudienceprivateaggregationconfig"},
"#dictdef-sharedstorageprivateaggregationconfig": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"SharedStoragePrivateAggregationConfig","type":"dictionary","url":"#dictdef-sharedstorageprivateaggregationconfig"},
"#dom-auctionadconfig-auctionreportbuyerdebugmodeconfig": {"export":true,"for_":["AuctionAdConfig"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"auctionReportBuyerDebugModeConfig","type":"dict-member","url":"#dom-auctionadconfig-auctionreportbuyerdebugmodeconfig"},
"#dom-auctionadconfig-auctionreportbuyerkeys": {"export":true,"for_":["AuctionAdConfig"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"auctionReportBuyerKeys","type":"dict-member","url":"#dom-auctionadconfig-auctionreportbuyerkeys"},
"#dom-auctionadconfig-auctionreportbuyers": {"export":true,"for_":["AuctionAdConfig"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"auctionReportBuyers","type":"dict-member","url":"#dom-auctionadconfig-auctionreportbuyers"},
"#dom-auctionadconfig-privateaggregationconfig": {"export":true,"for_":["AuctionAdConfig"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"privateAggregationConfig","type":"dict-member","url":"#dom-auctionadconfig-privateaggregationconfig"},
"#dom-auctionadinterestgroup-privateaggregationconfig": {"export":true,"for_":["AuctionAdInterestGroup"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"privateAggregationConfig","type":"dict-member","url":"#dom-auctionadinterestgroup-privateaggregationconfig"},
"#dom-auctionreportbuyerdebugmodeconfig-debugkey": {"export":true,"for_":["AuctionReportBuyerDebugModeConfig"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"debugKey","type":"dict-member","url":"#dom-auctionreportbuyerdebugmodeconfig-debugkey"},
"#dom-auctionreportbuyerdebugmodeconfig-enabled": {"export":true,"for_":["AuctionReportBuyerDebugModeConfig"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"enabled","type":"dict-member","url":"#dom-auctionreportbuyerdebugmodeconfig-enabled"},
"#dom-auctionreportbuyersconfig-bucket": {"export":true,"for_":["AuctionReportBuyersConfig"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"bucket","type":"dict-member","url":"#dom-auctionreportbuyersconfig-bucket"},
"#dom-auctionreportbuyersconfig-scale": {"export":true,"for_":["AuctionReportBuyersConfig"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"scale","type":"dict-member","url":"#dom-auctionreportbuyersconfig-scale"},
"#dom-interestgroupscriptrunnerglobalscope-privateaggregation": {"export":true,"for_":["InterestGroupScriptRunnerGlobalScope"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"privateAggregation","type":"attribute","url":"#dom-interestgroupscriptrunnerglobalscope-privateaggregation"},
"#dom-padebugmodeoptions-debugkey": {"export":true,"for_":["PADebugModeOptions"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"debugKey","type":"dict-member","url":"#dom-padebugmodeoptions-debugkey"},
"#dom-paextendedhistogramcontribution-bucket": {"export":true,"for_":["PAExtendedHistogramContribution"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"bucket","type":"dict-member","url":"#dom-paextendedhistogramcontribution-bucket"},
"#dom-paextendedhistogramcontribution-value": {"export":true,"for_":["PAExtendedHistogramContribution"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"value","type":"dict-member","url":"#dom-paextendedhistogramcontribution-value"},
"#dom-pahistogramcontribution-bucket": {"export":true,"for_":["PAHistogramContribution"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"bucket","type":"dict-member","url":"#dom-pahistogramcontribution-bucket"},
"#dom-pahistogramcontribution-filteringid": {"export":true,"for_":["PAHistogramContribution"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"filteringId","type":"dict-member","url":"#dom-pahistogramcontribution-filteringid"},
"#dom-pahistogramcontribution-value": {"export":true,"for_":["PAHistogramContribution"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"value","type":"dict-member","url":"#dom-pahistogramcontribution-value"},
"#dom-pasignalvalue-basevalue": {"export":true,"for_":["PASignalValue"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"baseValue","type":"dict-member","url":"#dom-pasignalvalue-basevalue"},
"#dom-pasignalvalue-offset": {"export":true,"for_":["PASignalValue"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"offset","type":"dict-member","url":"#dom-pasignalvalue-offset"},
"#dom-pasignalvalue-scale": {"export":true,"for_":["PASignalValue"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"scale","type":"dict-member","url":"#dom-pasignalvalue-scale"},
"#dom-privateaggregation-contributetohistogram": {"export":true,"for_":["PrivateAggregation"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"contributeToHistogram(contribution)","type":"method","url":"#dom-privateaggregation-contributetohistogram"},
"#dom-privateaggregation-contributetohistogramonevent": {"export":true,"for_":["PrivateAggregation"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"contributeToHistogramOnEvent(event, contribution)","type":"method","url":"#dom-privateaggregation-contributetohistogramonevent"},
"#dom-privateaggregation-enabledebugmode": {"export":true,"for_":["PrivateAggregation"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"enableDebugMode(options)","type":"method","url":"#dom-privateaggregation-enabledebugmode"},
"#dom-protectedaudienceprivateaggregationconfig-aggregationcoordinatororigin": {"export":true,"for_":["ProtectedAudiencePrivateAggregationConfig"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"aggregationCoordinatorOrigin","type":"dict-member","url":"#dom-protectedaudienceprivateaggregationconfig-aggregationcoordinatororigin"},
"#dom-sharedstorageprivateaggregationconfig-contextid": {"export":true,"for_":["SharedStoragePrivateAggregationConfig"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"contextId","type":"dict-member","url":"#dom-sharedstorageprivateaggregationconfig-contextid"},
"#dom-sharedstorageprivateaggregationconfig-filteringidbytesize": {"export":true,"for_":["SharedStoragePrivateAggregationConfig"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"filteringIdByteSize","type":"dict-member","url":"#dom-sharedstorageprivateaggregationconfig-filteringidbytesize"},
"#dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig": {"export":true,"for_":["SharedStorageRunOperationMethodOptions"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"privateAggregationConfig","type":"dict-member","url":"#dom-sharedstoragerunoperationmethodoptions-privateaggregationconfig"},
"#dom-sharedstorageworkletglobalscope-privateaggregation": {"export":true,"for_":["SharedStorageWorkletGlobalScope"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"privateAggregation","type":"attribute","url":"#dom-sharedstorageworkletglobalscope-privateaggregation"},
"#encode-an-integer-for-the-payload": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"encode an integer for the payload","type":"dfn","url":"#encode-an-integer-for-the-payload"},
"#encrypt-the-payload": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"encrypt the payload","type":"dfn","url":"#encrypt-the-payload"},
"#fill-in-the-contribution": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"fill in the contribution","type":"dfn","url":"#fill-in-the-contribution"},
"#fill-in-the-signal-value": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"fill in the signal value","type":"dfn","url":"#fill-in-the-signal-value"},
"#get-a-debug-details": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"get a debug details","type":"dfn","url":"#get-a-debug-details"},
"#get-or-create-a-batching-scope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"get or create a batching scope","type":"dfn","url":"#get-or-create-a-batching-scope"},
"#get-the-privateaggregation": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"get the privateaggregation","type":"dfn","url":"#get-the-privateaggregation"},
"#interest-group-private-aggregation-coordinator": {"export":true,"for_":["interest group"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"private aggregation coordinator","type":"dfn","url":"#interest-group-private-aggregation-coordinator"},
"#interestgroupreportingscriptrunnerglobalscope-interest-group": {"export":true,"for_":["InterestGroupReportingScriptRunnerGlobalScope"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"interest group","type":"dfn","url":"#interestgroupreportingscriptrunnerglobalscope-interest-group"},
"#interestgroupscriptrunnerglobalscope-auction-config": {"export":true,"for_":["InterestGroupScriptRunnerGlobalScope"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"auction config","type":"dfn","url":"#interestgroupscriptrunnerglobalscope-auction-config"},
"#mark-a-debug-scope-complete": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"mark a debug scope complete","type":"dfn","url":"#mark-a-debug-scope-complete"},
"#maximum-report-contributions": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"maximum report contributions","type":"dfn","url":"#maximum-report-contributions"},
"#maybe-obtain-an-interest-group": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"maybe obtain an interest group","type":"dfn","url":"#maybe-obtain-an-interest-group"},
"#minimum-report-delay": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"minimum report delay","type":"dfn","url":"#minimum-report-delay"},
"#obtain-a-report-delivery-time": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"obtain a report delivery time","type":"dfn","url":"#obtain-a-report-delivery-time"},
"#obtain-a-reporting-endpoint": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"obtain a reporting endpoint","type":"dfn","url":"#obtain-a-reporting-endpoint"},
"#obtain-a-reports-shared-info": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"obtain a report's shared info","type":"dfn","url":"#obtain-a-reports-shared-info"},
"#obtain-an-aggregatable-report": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"obtain an aggregatable report","type":"dfn","url":"#obtain-an-aggregatable-report"},
"#obtain-the-aggregation-coordinator": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"obtain the aggregation coordinator","type":"dfn","url":"#obtain-the-aggregation-coordinator"},
"#obtain-the-aggregation-service-payloads": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"obtain the aggregation service payloads","type":"dfn","url":"#obtain-the-aggregation-service-payloads"},
"#obtain-the-plaintext-payload": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"obtain the plaintext payload","type":"dfn","url":"#obtain-the-plaintext-payload"},
"#obtain-the-pre-specified-report-parameters": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"obtain the pre-specified report parameters","type":"dfn","url":"#obtain-the-pre-specified-report-parameters"},
"#obtain-the-private-aggregation-coordinator": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"obtain the private aggregation coordinator","type":"dfn","url":"#obtain-the-private-aggregation-coordinator"},
"#obtain-the-private-aggregation-coordinator-from-a-string": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"obtain the private aggregation coordinator from a string","type":"dfn","url":"#obtain-the-private-aggregation-coordinator-from-a-string"},
"#obtain-the-public-key-for-encryption": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"obtain the public key for encryption","type":"dfn","url":"#obtain-the-public-key-for-encryption"},
"#on-event-contribution-cache": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"on event contribution cache","type":"dfn","url":"#on-event-contribution-cache"},
"#on-event-contribution-cache-entry": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"on event contribution cache entry","type":"dfn","url":"#on-event-contribution-cache-entry"},
"#on-event-contribution-cache-entry-batching-scope": {"export":true,"for_":["on event contribution cache entry"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"batching scope","type":"dfn","url":"#on-event-contribution-cache-entry-batching-scope"},
"#on-event-contribution-cache-entry-contribution": {"export":true,"for_":["on event contribution cache entry"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"contribution","type":"dfn","url":"#on-event-contribution-cache-entry-contribution"},
"#on-event-contribution-cache-entry-debug-details": {"export":true,"for_":["on event contribution cache entry"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"debug details","type":"dfn","url":"#on-event-contribution-cache-entry-debug-details"},
"#on-event-contribution-cache-entry-debug-scope": {"export":true,"for_":["on event contribution cache entry"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"debug scope","type":"dfn","url":"#on-event-contribution-cache-entry-debug-scope"},
"#on-event-contribution-cache-entry-worklet-function": {"export":true,"for_":["on event contribution cache entry"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"worklet function","type":"dfn","url":"#on-event-contribution-cache-entry-worklet-function"},
"#permissions-policy-state": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"permissions policy state","type":"dfn","url":"#permissions-policy-state"},
"#permissions-policy-state-private-aggregation-enabled": {"export":true,"for_":["permissions policy state"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"private aggregation enabled","type":"dfn","url":"#permissions-policy-state-private-aggregation-enabled"},
"#pre-specified-report-parameters": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"pre-specified report parameters","type":"dfn","url":"#pre-specified-report-parameters"},
"#pre-specified-report-parameters-context-id": {"export":true,"for_":["pre-specified report parameters"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"context id","type":"dfn","url":"#pre-specified-report-parameters-context-id"},
"#pre-specified-report-parameters-filtering-id-byte-size": {"export":true,"for_":["pre-specified report parameters"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"filtering id byte size","type":"dfn","url":"#pre-specified-report-parameters-filtering-id-byte-size"},
"#pre-specified-report-parameters-map": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"pre-specified report parameters map","type":"dfn","url":"#pre-specified-report-parameters-map"},
"#private-aggregation": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"private-aggregation","type":"dfn","url":"#private-aggregation"},
"#privateaggregation": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"PrivateAggregation","type":"interface","url":"#privateaggregation"},
"#privateaggregation-allowed-to-use": {"export":true,"for_":["PrivateAggregation"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"allowed to use","type":"dfn","url":"#privateaggregation-allowed-to-use"},
"#privateaggregation-scoping-details": {"export":true,"for_":["PrivateAggregation"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"scoping details","type":"dfn","url":"#privateaggregation-scoping-details"},
"#process-contributions-for-a-batching-scope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"process contributions for a batching scope","type":"dfn","url":"#process-contributions-for-a-batching-scope"},
"#process-the-private-aggregation-contributions-for-an-auction": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"process the private aggregation contributions for an auction","type":"dfn","url":"#process-the-private-aggregation-contributions-for-an-auction"},
"#randomized-report-delay": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"randomized report delay","type":"dfn","url":"#randomized-report-delay"},
"#report-creation-and-scheduling-steps": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"report creation and scheduling steps","type":"dfn","url":"#report-creation-and-scheduling-steps"},
"#scoping-details": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"scoping details","type":"dfn","url":"#scoping-details"},
"#scoping-details-get-batching-scope-steps": {"export":true,"for_":["scoping details"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"get batching scope steps","type":"dfn","url":"#scoping-details-get-batching-scope-steps"},
"#scoping-details-get-debug-scope-steps": {"export":true,"for_":["scoping details"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"get debug scope steps","type":"dfn","url":"#scoping-details-get-debug-scope-steps"},
"#serialize-an-aggregatable-report": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"serialize an aggregatable report","type":"dfn","url":"#serialize-an-aggregatable-report"},
"#serialize-an-integer": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"serialize an integer","type":"dfn","url":"#serialize-an-integer"},
"#set-the-aggregation-coordinator-for-a-batching-scope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"set the aggregation coordinator for a batching scope","type":"dfn","url":"#set-the-aggregation-coordinator-for-a-batching-scope"},
"#set-the-pre-specified-report-parameters-for-a-batching-scope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"set the pre-specified report parameters for a batching scope","type":"dfn","url":"#set-the-pre-specified-report-parameters-for-a-batching-scope"},
"#signal-base-value": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"signal base value","type":"dfn","url":"#signal-base-value"},
"#signal-base-value-bid-reject-reason": {"export":true,"for_":["signal base value"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"bid-reject-reason","type":"dfn","url":"#signal-base-value-bid-reject-reason"},
"#signal-base-value-highest-scoring-other-bid": {"export":true,"for_":["signal base value"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"highest-scoring-other-bid","type":"dfn","url":"#signal-base-value-highest-scoring-other-bid"},
"#signal-base-value-script-run-time": {"export":true,"for_":["signal base value"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"script-run-time","type":"dfn","url":"#signal-base-value-script-run-time"},
"#signal-base-value-signals-fetch-time": {"export":true,"for_":["signal base value"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"signals-fetch-time","type":"dfn","url":"#signal-base-value-signals-fetch-time"},
"#signal-base-value-winning-bid": {"export":true,"for_":["signal base value"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"winning-bid","type":"dfn","url":"#signal-base-value-winning-bid"},
"#worklet-function": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"worklet function","type":"dfn","url":"#worklet-function"},
"#worklet-function-generate-bid": {"export":true,"for_":["worklet function"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"generate-bid","type":"dfn","url":"#worklet-function-generate-bid"},
"#worklet-function-report-result": {"export":true,"for_":["worklet function"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"report-result","type":"dfn","url":"#worklet-function-report-result"},
"#worklet-function-report-win": {"export":true,"for_":["worklet function"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"report-win","type":"dfn","url":"#worklet-function-report-win"},
"#worklet-function-score-ad": {"export":true,"for_":["worklet function"],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"private-aggregation-api-1","status":"local","text":"score-ad","type":"dfn","url":"#worklet-function-score-ad"},
"https://dom.spec.whatwg.org/#concept-document": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"document","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-document"},
"https://encoding.spec.whatwg.org/#utf-8-encode": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"encoding","spec":"encoding","status":"current","text":"utf-8 encode","type":"dfn","url":"https://encoding.spec.whatwg.org/#utf-8-encode"},
"https://fetch.spec.whatwg.org/#concept-fetch": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"fetch","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-fetch"},
"https://fetch.spec.whatwg.org/#concept-request": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"request","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request"},
"https://fetch.spec.whatwg.org/#concept-request-body": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"body","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-body"},
"https://fetch.spec.whatwg.org/#concept-request-cache-mode": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"cache mode","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-cache-mode"},
"https://fetch.spec.whatwg.org/#concept-request-client": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"client","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-client"},
"https://fetch.spec.whatwg.org/#concept-request-credentials-mode": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"credentials mode","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-credentials-mode"},
"https://fetch.spec.whatwg.org/#concept-request-header-list": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"header list","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-header-list"},
"https://fetch.spec.whatwg.org/#concept-request-initiator": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"initiator","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-initiator"},
"https://fetch.spec.whatwg.org/#concept-request-method": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"method","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-method"},
"https://fetch.spec.whatwg.org/#concept-request-mode": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"mode","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-mode"},
"https://fetch.spec.whatwg.org/#concept-request-referrer": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"referrer","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-referrer"},
"https://fetch.spec.whatwg.org/#concept-request-url": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"url","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-url"},
"https://fetch.spec.whatwg.org/#concept-request-window": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"window","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-window"},
"https://fetch.spec.whatwg.org/#dom-global-fetch": {"export":true,"for_":["WindowOrWorkerGlobalScope"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"fetch(input)","type":"method","url":"https://fetch.spec.whatwg.org/#dom-global-fetch"},
"https://fetch.spec.whatwg.org/#process-response": {"export":true,"for_":["fetch"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"processresponse","type":"dfn","url":"https://fetch.spec.whatwg.org/#process-response"},
"https://fetch.spec.whatwg.org/#request-service-workers-mode": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"service-workers mode","type":"dfn","url":"https://fetch.spec.whatwg.org/#request-service-workers-mode"},
"https://fetch.spec.whatwg.org/#unsafe-request-flag": {"export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"unsafe-request flag","type":"dfn","url":"https://fetch.spec.whatwg.org/#unsafe-request-flag"},
"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"serialization of an origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin"},
"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"},
"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host": {"export":true,"for_":["origin"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"host","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host"},
"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-port": {"export":true,"for_":["origin"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"port","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-port"},
"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme": {"export":true,"for_":["origin"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"scheme","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme"},
"https://html.spec.whatwg.org/multipage/browsers.html#same-site": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"same site","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#same-site"},
"https://html.spec.whatwg.org/multipage/browsers.html#site": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"site","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#site"},
"https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#unique-internal-value": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"unique internal value","type":"dfn","url":"https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#unique-internal-value"},
"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"allowed to use","type":"dfn","url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use"},
"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"in parallel","type":"dfn","url":"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"associated document","type":"dfn","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global": {"export":true,"for_":["realm"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"global object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-settings-object": {"export":true,"for_":["realm"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"settings object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-settings-object"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"relevant global object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin": {"export":true,"for_":["environment settings object"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin"},
"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"queue a task","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task"},
"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"relevant settings object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"},
"https://html.spec.whatwg.org/multipage/worklets.html#concept-worklet-global-scopes": {"export":true,"for_":["Worklet"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"global scopes","type":"dfn","url":"https://html.spec.whatwg.org/multipage/worklets.html#concept-worklet-global-scopes"},
"https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule": {"export":true,"for_":["Worklet"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"addModule(moduleURL, options)","type":"method","url":"https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule"},
"https://infra.spec.whatwg.org/#abort-when": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"abort when","type":"dfn","url":"https://infra.spec.whatwg.org/#abort-when"},
"https://infra.spec.whatwg.org/#assert": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"assert","type":"dfn","url":"https://infra.spec.whatwg.org/#assert"},
"https://infra.spec.whatwg.org/#boolean": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"boolean","type":"dfn","url":"https://infra.spec.whatwg.org/#boolean"},
"https://infra.spec.whatwg.org/#byte-sequence": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"byte sequence","type":"dfn","url":"https://infra.spec.whatwg.org/#byte-sequence"},
"https://infra.spec.whatwg.org/#forgiving-base64-encode": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"forgiving-base64 encode","type":"dfn","url":"https://infra.spec.whatwg.org/#forgiving-base64-encode"},
"https://infra.spec.whatwg.org/#if-aborted": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"if aborted","type":"dfn","url":"https://infra.spec.whatwg.org/#if-aborted"},
"https://infra.spec.whatwg.org/#implementation-defined": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"implementation-defined","type":"dfn","url":"https://infra.spec.whatwg.org/#implementation-defined"},
"https://infra.spec.whatwg.org/#iteration-break": {"export":true,"for_":["iteration"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"break","type":"dfn","url":"https://infra.spec.whatwg.org/#iteration-break"},
"https://infra.spec.whatwg.org/#iteration-continue": {"export":true,"for_":["iteration"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"continue","type":"dfn","url":"https://infra.spec.whatwg.org/#iteration-continue"},
"https://infra.spec.whatwg.org/#iteration-while": {"export":true,"for_":["iteration"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"while","type":"dfn","url":"https://infra.spec.whatwg.org/#iteration-while"},
"https://infra.spec.whatwg.org/#list": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"list","type":"dfn","url":"https://infra.spec.whatwg.org/#list"},
"https://infra.spec.whatwg.org/#list-append": {"export":true,"for_":["list"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"append","type":"dfn","url":"https://infra.spec.whatwg.org/#list-append"},
"https://infra.spec.whatwg.org/#list-contain": {"export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"contain","type":"dfn","url":"https://infra.spec.whatwg.org/#list-contain"},
"https://infra.spec.whatwg.org/#list-empty": {"export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"empty","type":"dfn","url":"https://infra.spec.whatwg.org/#list-empty"},
"https://infra.spec.whatwg.org/#list-is-empty": {"export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"is empty","type":"dfn","url":"https://infra.spec.whatwg.org/#list-is-empty"},
"https://infra.spec.whatwg.org/#list-item": {"export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"item","type":"dfn","url":"https://infra.spec.whatwg.org/#list-item"},
"https://infra.spec.whatwg.org/#list-iterate": {"export":true,"for_":["list","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"iterate","type":"dfn","url":"https://infra.spec.whatwg.org/#list-iterate"},
"https://infra.spec.whatwg.org/#list-remove": {"export":true,"for_":["list","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"remove","type":"dfn","url":"https://infra.spec.whatwg.org/#list-remove"},
"https://infra.spec.whatwg.org/#list-size": {"export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"size","type":"dfn","url":"https://infra.spec.whatwg.org/#list-size"},
"https://infra.spec.whatwg.org/#map-exists": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"exist","type":"dfn","url":"https://infra.spec.whatwg.org/#map-exists"},
"https://infra.spec.whatwg.org/#map-getting-the-keys": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"keys","type":"dfn","url":"https://infra.spec.whatwg.org/#map-getting-the-keys"},
"https://infra.spec.whatwg.org/#map-is-empty": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"is empty","type":"dfn","url":"https://infra.spec.whatwg.org/#map-is-empty"},
"https://infra.spec.whatwg.org/#map-iterate": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"iterate","type":"dfn","url":"https://infra.spec.whatwg.org/#map-iterate"},
"https://infra.spec.whatwg.org/#map-remove": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"remove","type":"dfn","url":"https://infra.spec.whatwg.org/#map-remove"},
"https://infra.spec.whatwg.org/#map-set": {"export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"set","type":"dfn","url":"https://infra.spec.whatwg.org/#map-set"},
"https://infra.spec.whatwg.org/#ordered-map": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"map","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-map"},
"https://infra.spec.whatwg.org/#ordered-set": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"set","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-set"},
"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-a-json-string": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"serializing an infra value to a json string","type":"dfn","url":"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-a-json-string"},
"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"serialize an infra value to json bytes","type":"dfn","url":"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes"},
"https://infra.spec.whatwg.org/#set-append": {"export":true,"for_":["set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"append","type":"dfn","url":"https://infra.spec.whatwg.org/#set-append"},
"https://infra.spec.whatwg.org/#string": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"string","type":"dfn","url":"https://infra.spec.whatwg.org/#string"},
"https://infra.spec.whatwg.org/#string-concatenate": {"export":true,"for_":["string"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"concatenation","type":"dfn","url":"https://infra.spec.whatwg.org/#string-concatenate"},
"https://infra.spec.whatwg.org/#string-length": {"export":true,"for_":["string","JavaScript string","scalar value string"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"length","type":"dfn","url":"https://infra.spec.whatwg.org/#string-length"},
"https://infra.spec.whatwg.org/#string-starts-with": {"export":true,"for_":["string"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"starts with","type":"dfn","url":"https://infra.spec.whatwg.org/#string-starts-with"},
"https://infra.spec.whatwg.org/#struct": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"struct","type":"dfn","url":"https://infra.spec.whatwg.org/#struct"},
"https://infra.spec.whatwg.org/#struct-item": {"export":true,"for_":["struct","tuple"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"item","type":"dfn","url":"https://infra.spec.whatwg.org/#struct-item"},
"https://infra.spec.whatwg.org/#the-exclusive-range": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"the exclusive range","type":"dfn","url":"https://infra.spec.whatwg.org/#the-exclusive-range"},
"https://infra.spec.whatwg.org/#tuple": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"tuple","type":"dfn","url":"https://infra.spec.whatwg.org/#tuple"},
"https://infra.spec.whatwg.org/#user-agent": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"user agent","type":"dfn","url":"https://infra.spec.whatwg.org/#user-agent"},
"https://tc39.es/ecma262/#sec-call": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"call","type":"dfn","url":"https://tc39.es/ecma262/#sec-call"},
"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type": {"export":true,"for_":["ECMAScript"],"level":"1","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"current","text":"abrupt completion","type":"dfn","url":"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type"},
"https://url.spec.whatwg.org/#concept-url": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"url","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url"},
"https://url.spec.whatwg.org/#concept-url-host": {"export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"host","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-host"},
"https://url.spec.whatwg.org/#concept-url-origin": {"export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"origin","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-origin"},
"https://url.spec.whatwg.org/#concept-url-parser": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"url parser","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-parser"},
"https://url.spec.whatwg.org/#concept-url-path": {"export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"path","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-path"},
"https://url.spec.whatwg.org/#concept-url-port": {"export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"port","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-port"},
"https://url.spec.whatwg.org/#concept-url-scheme": {"export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"scheme","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-scheme"},
"https://w3c.github.io/hr-time/#dfn-current-wall-time": {"export":true,"for_":[],"level":"","normative":true,"shortname":"hr-time","spec":"hr-time","status":"anchor-block","text":"current wall time","type":"dfn","url":"https://w3c.github.io/hr-time/#dfn-current-wall-time"},
"https://w3c.github.io/hr-time/#dfn-duration": {"export":true,"for_":[],"level":"","normative":true,"shortname":"hr-time","spec":"hr-time","status":"anchor-block","text":"duration","type":"dfn","url":"https://w3c.github.io/hr-time/#dfn-duration"},
"https://w3c.github.io/hr-time/#dfn-duration-from": {"export":true,"for_":[],"level":"","normative":true,"shortname":"hr-time","spec":"hr-time","status":"anchor-block","text":"duration from","type":"dfn","url":"https://w3c.github.io/hr-time/#dfn-duration-from"},
"https://w3c.github.io/hr-time/#dfn-moment": {"export":true,"for_":[],"level":"","normative":true,"shortname":"hr-time","spec":"hr-time","status":"anchor-block","text":"moment","type":"dfn","url":"https://w3c.github.io/hr-time/#dfn-moment"},
"https://w3c.github.io/hr-time/#dfn-unix-epoch": {"export":true,"for_":[],"level":"","normative":true,"shortname":"hr-time","spec":"hr-time","status":"anchor-block","text":"unix epoch","type":"dfn","url":"https://w3c.github.io/hr-time/#dfn-unix-epoch"},
"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"permissions-policy","spec":"permissions-policy-1","status":"current","text":"policy-controlled feature","type":"dfn","url":"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature"},
"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist": {"export":true,"for_":["policy-controlled feature"],"level":"1","normative":true,"shortname":"permissions-policy","spec":"permissions-policy-1","status":"current","text":"default allowlist","type":"dfn","url":"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist"},
"https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-origin": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"secure-contexts","spec":"secure-contexts","status":"current","text":"potentially trustworthy origin","type":"dfn","url":"https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-origin"},
"https://w3c.github.io/webcrypto/#dfn-generate-a-random-uuid": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webcryptoapi","spec":"webcryptoapi","status":"current","text":"generate a random uuid","type":"dfn","url":"https://w3c.github.io/webcrypto/#dfn-generate-a-random-uuid"},
"https://w3c.github.io/webdriver/#dfn-error": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"webdriver","spec":"webdriver2","status":"current","text":"error","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-error"},
"https://w3c.github.io/webdriver/#dfn-error-code": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"error code","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-error-code"},
"https://w3c.github.io/webdriver/#dfn-extension-commands": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"webdriver","spec":"webdriver2","status":"current","text":"extension commands","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-extension-commands"},
"https://w3c.github.io/webdriver/#dfn-getting-properties": {"export":true,"for_":[],"level":"","normative":true,"shortname":"webdriver","spec":"webdriver","status":"anchor-block","text":"getting a property","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-getting-properties"},
"https://w3c.github.io/webdriver/#dfn-invalid-argument": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"webdriver","spec":"webdriver2","status":"current","text":"invalid argument","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-invalid-argument"},
"https://w3c.github.io/webdriver/#dfn-remote-end-steps": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"webdriver","spec":"webdriver2","status":"current","text":"remote end steps","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-remote-end-steps"},
"https://w3c.github.io/webdriver/#dfn-success": {"export":true,"for_":[],"level":"2","normative":true,"shortname":"webdriver","spec":"webdriver2","status":"current","text":"success","type":"dfn","url":"https://w3c.github.io/webdriver/#dfn-success"},
"https://webidl.spec.whatwg.org/#EnforceRange": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"EnforceRange","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#EnforceRange"},
"https://webidl.spec.whatwg.org/#Exposed": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Exposed","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#Exposed"},
"https://webidl.spec.whatwg.org/#SecureContext": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SecureContext","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#SecureContext"},
"https://webidl.spec.whatwg.org/#a-promise-rejected-with": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"a promise rejected with","type":"dfn","url":"https://webidl.spec.whatwg.org/#a-promise-rejected-with"},
"https://webidl.spec.whatwg.org/#dataerror": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DataError","type":"exception","url":"https://webidl.spec.whatwg.org/#dataerror"},
"https://webidl.spec.whatwg.org/#dfn-attribute": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"attribute","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-attribute"},
"https://webidl.spec.whatwg.org/#dfn-read-only": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"read only","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-read-only"},
"https://webidl.spec.whatwg.org/#dfn-throw": {"export":true,"for_":["exception"],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"throw","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-throw"},
"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"RangeError","type":"exception","url":"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror"},
"https://webidl.spec.whatwg.org/#exceptiondef-typeerror": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"TypeError","type":"exception","url":"https://webidl.spec.whatwg.org/#exceptiondef-typeerror"},
"https://webidl.spec.whatwg.org/#getter-steps": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"getter steps","type":"dfn","url":"https://webidl.spec.whatwg.org/#getter-steps"},
"https://webidl.spec.whatwg.org/#idl-DOMException": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DOMException","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DOMException"},
"https://webidl.spec.whatwg.org/#idl-DOMString": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DOMString","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"https://webidl.spec.whatwg.org/#idl-USVString": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"USVString","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-USVString"},
"https://webidl.spec.whatwg.org/#idl-bigint": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"bigint","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-bigint"},
"https://webidl.spec.whatwg.org/#idl-boolean": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"boolean","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-boolean"},
"https://webidl.spec.whatwg.org/#idl-double": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"double","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-double"},
"https://webidl.spec.whatwg.org/#idl-long": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"long","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-long"},
"https://webidl.spec.whatwg.org/#idl-record": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"record","type":"dfn","url":"https://webidl.spec.whatwg.org/#idl-record"},
"https://webidl.spec.whatwg.org/#idl-sequence": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"sequence","type":"dfn","url":"https://webidl.spec.whatwg.org/#idl-sequence"},
"https://webidl.spec.whatwg.org/#idl-undefined": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"undefined","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-undefined"},
"https://webidl.spec.whatwg.org/#idl-unsigned-long-long": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"unsigned long long","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-unsigned-long-long"},
"https://webidl.spec.whatwg.org/#invalidaccesserror": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"InvalidAccessError","type":"exception","url":"https://webidl.spec.whatwg.org/#invalidaccesserror"},
"https://webidl.spec.whatwg.org/#notallowederror": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"NotAllowedError","type":"exception","url":"https://webidl.spec.whatwg.org/#notallowederror"},
"https://webidl.spec.whatwg.org/#this": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"this","type":"dfn","url":"https://webidl.spec.whatwg.org/#this"},
"https://webidl.spec.whatwg.org/#upon-fulfillment": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"upon fulfillment","type":"dfn","url":"https://webidl.spec.whatwg.org/#upon-fulfillment"},
"https://webidl.spec.whatwg.org/#upon-rejection": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"upon rejection","type":"dfn","url":"https://webidl.spec.whatwg.org/#upon-rejection"},
"https://wicg.github.io/attribution-reporting-api/#suitable-origin": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"attribution-reporting-api","spec":"attribution-reporting-api","status":"current","text":"suitable origin","type":"dfn","url":"https://wicg.github.io/attribution-reporting-api/#suitable-origin"},
"https://wicg.github.io/fenced-frame/#fencedframeconfig": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"fenced-frame","spec":"fenced-frame","status":"current","text":"FencedFrameConfig","type":"interface","url":"https://wicg.github.io/fenced-frame/#fencedframeconfig"},
"https://wicg.github.io/fenced-frame/#report-a-private-aggregation-event": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"fenced-frame","spec":"fenced-frame","status":"current","text":"report a private aggregation event","type":"dfn","url":"https://wicg.github.io/fenced-frame/#report-a-private-aggregation-event"},
"https://wicg.github.io/shared-storage/#dictdef-sharedstoragerunoperationmethodoptions": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"shared-storage","spec":"shared-storage","status":"current","text":"SharedStorageRunOperationMethodOptions","type":"dictionary","url":"https://wicg.github.io/shared-storage/#dictdef-sharedstoragerunoperationmethodoptions"},
"https://wicg.github.io/shared-storage/#dom-windowsharedstorage-run": {"export":true,"for_":["WindowSharedStorage"],"level":"1","normative":true,"shortname":"shared-storage","spec":"shared-storage","status":"current","text":"run(name)","type":"method","url":"https://wicg.github.io/shared-storage/#dom-windowsharedstorage-run"},
"https://wicg.github.io/shared-storage/#dom-windowsharedstorage-selecturl": {"export":true,"for_":["WindowSharedStorage"],"level":"1","normative":true,"shortname":"shared-storage","spec":"shared-storage","status":"current","text":"selectURL(name, urls)","type":"method","url":"https://wicg.github.io/shared-storage/#dom-windowsharedstorage-selecturl"},
"https://wicg.github.io/shared-storage/#sharedstorageworklet": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"","status":"anchor-block","text":"SharedStorageWorklet","type":"interface","url":"https://wicg.github.io/shared-storage/#sharedstorageworklet"},
"https://wicg.github.io/shared-storage/#sharedstorageworkletglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"","status":"anchor-block","text":"SharedStorageWorkletGlobalScope","type":"interface","url":"https://wicg.github.io/shared-storage/#sharedstorageworkletglobalscope"},
"https://wicg.github.io/shared-storage/#windowsharedstorage": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"shared-storage","spec":"shared-storage","status":"current","text":"WindowSharedStorage","type":"interface","url":"https://wicg.github.io/shared-storage/#windowsharedstorage"},
"https://wicg.github.io/turtledove/#auction-config": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"auction config","type":"dfn","url":"https://wicg.github.io/turtledove/#auction-config"},
"https://wicg.github.io/turtledove/#auction-config-interest-group-buyers": {"export":false,"for_":["auction config"],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"interest group buyers","type":"dfn","url":"https://wicg.github.io/turtledove/#auction-config-interest-group-buyers"},
"https://wicg.github.io/turtledove/#auction-config-seller": {"export":false,"for_":["auction config"],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"seller","type":"dfn","url":"https://wicg.github.io/turtledove/#auction-config-seller"},
"https://wicg.github.io/turtledove/#dictdef-auctionadconfig": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"AuctionAdConfig","type":"dictionary","url":"https://wicg.github.io/turtledove/#dictdef-auctionadconfig"},
"https://wicg.github.io/turtledove/#dictdef-auctionadinterestgroup": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"AuctionAdInterestGroup","type":"dictionary","url":"https://wicg.github.io/turtledove/#dictdef-auctionadinterestgroup"},
"https://wicg.github.io/turtledove/#dom-auctionadconfig-interestgroupbuyers": {"export":true,"for_":["AuctionAdConfig"],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"interestGroupBuyers","type":"dict-member","url":"https://wicg.github.io/turtledove/#dom-auctionadconfig-interestgroupbuyers"},
"https://wicg.github.io/turtledove/#dom-navigator-joinadinterestgroup": {"export":true,"for_":["Navigator"],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"joinAdInterestGroup(group)","type":"method","url":"https://wicg.github.io/turtledove/#dom-navigator-joinadinterestgroup"},
"https://wicg.github.io/turtledove/#dom-navigator-runadauction": {"export":true,"for_":["Navigator"],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"runAdAuction(config)","type":"method","url":"https://wicg.github.io/turtledove/#dom-navigator-runadauction"},
"https://wicg.github.io/turtledove/#evaluate-a-bidding-script": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"evaluate a bidding script","type":"dfn","url":"https://wicg.github.io/turtledove/#evaluate-a-bidding-script"},
"https://wicg.github.io/turtledove/#evaluate-a-reporting-script": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"evaluate a reporting script","type":"dfn","url":"https://wicg.github.io/turtledove/#evaluate-a-reporting-script"},
"https://wicg.github.io/turtledove/#evaluate-a-scoring-script": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"evaluate a scoring script","type":"dfn","url":"https://wicg.github.io/turtledove/#evaluate-a-scoring-script"},
"https://wicg.github.io/turtledove/#evaluate-a-script": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"evaluate a script","type":"dfn","url":"https://wicg.github.io/turtledove/#evaluate-a-script"},
"https://wicg.github.io/turtledove/#generate-a-bid": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"generate a bid","type":"dfn","url":"https://wicg.github.io/turtledove/#generate-a-bid"},
"https://wicg.github.io/turtledove/#generate-and-score-bids": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"generate and score bids","type":"dfn","url":"https://wicg.github.io/turtledove/#generate-and-score-bids"},
"https://wicg.github.io/turtledove/#generated-bid-bid": {"export":false,"for_":["generated bid"],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"bid","type":"dfn","url":"https://wicg.github.io/turtledove/#generated-bid-bid"},
"https://wicg.github.io/turtledove/#generated-bid-interest-group": {"export":false,"for_":["generated bid"],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"interest group","type":"dfn","url":"https://wicg.github.io/turtledove/#generated-bid-interest-group"},
"https://wicg.github.io/turtledove/#interest-group": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"interest group","type":"dfn","url":"https://wicg.github.io/turtledove/#interest-group"},
"https://wicg.github.io/turtledove/#interest-group-estimated-size": {"export":false,"for_":["interest group"],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"estimated size","type":"dfn","url":"https://wicg.github.io/turtledove/#interest-group-estimated-size"},
"https://wicg.github.io/turtledove/#interest-group-owner": {"export":false,"for_":["interest group"],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"owner","type":"dfn","url":"https://wicg.github.io/turtledove/#interest-group-owner"},
"https://wicg.github.io/turtledove/#interest-group-set": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"interest group set","type":"dfn","url":"https://wicg.github.io/turtledove/#interest-group-set"},
"https://wicg.github.io/turtledove/#interest-group-update": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"interest group update","type":"dfn","url":"https://wicg.github.io/turtledove/#interest-group-update"},
"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"","status":"anchor-block","text":"InterestGroupBiddingScriptRunnerGlobalScope","type":"interface","url":"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope"},
"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-interest-group": {"export":false,"for_":["InterestGroupBiddingScriptRunnerGlobalScope"],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"interest group","type":"dfn","url":"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-interest-group"},
"https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"","status":"anchor-block","text":"InterestGroupReportingScriptRunnerGlobalScope","type":"interface","url":"https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope"},
"https://wicg.github.io/turtledove/#interestgroupscoringscriptrunnerglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"","status":"anchor-block","text":"InterestGroupScoringScriptRunnerGlobalScope","type":"interface","url":"https://wicg.github.io/turtledove/#interestgroupscoringscriptrunnerglobalscope"},
"https://wicg.github.io/turtledove/#interestgroupscriptrunnerglobalscope": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"private-aggregation-api","spec":"","status":"anchor-block","text":"InterestGroupScriptRunnerGlobalScope","type":"interface","url":"https://wicg.github.io/turtledove/#interestgroupscriptrunnerglobalscope"},
"https://wicg.github.io/turtledove/#k-anonymity-threshold": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"k-anonymity threshold","type":"dfn","url":"https://wicg.github.io/turtledove/#k-anonymity-threshold"},
"https://wicg.github.io/turtledove/#leading-bid-info": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"leading bid info","type":"dfn","url":"https://wicg.github.io/turtledove/#leading-bid-info"},
"https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bid": {"export":false,"for_":["leading bid info"],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"highest scoring other bid","type":"dfn","url":"https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bid"},
"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid": {"export":false,"for_":["leading bid info"],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"leading bid","type":"dfn","url":"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid"},
"https://wicg.github.io/turtledove/#report-result": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"report result","type":"dfn","url":"https://wicg.github.io/turtledove/#report-result"},
"https://wicg.github.io/turtledove/#report-win": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"report win","type":"dfn","url":"https://wicg.github.io/turtledove/#report-win"},
"https://wicg.github.io/turtledove/#score-and-rank-a-bid": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"score and rank a bid","type":"dfn","url":"https://wicg.github.io/turtledove/#score-and-rank-a-bid"},
"https://wicg.github.io/turtledove/#validate-and-convert-auction-ad-config": {"export":false,"for_":[],"level":"1","normative":true,"shortname":"turtledove","spec":"turtledove","status":"current","text":"validate and convert auction ad config","type":"dfn","url":"https://wicg.github.io/turtledove/#validate-and-convert-auction-ad-config"},
"https://www.w3.org/Consortium/Process/#GroupsIG": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"w3c-process","spec":"w3c-process","status":"current","text":"interest groups","type":"dfn","url":"https://www.w3.org/Consortium/Process/#GroupsIG"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>